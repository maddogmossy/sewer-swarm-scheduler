{"file_contents":{"client/src/components/schedule/DepotCrewModal.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter } from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Trash2, Edit, Plus, Users, Truck, Mail, Sun, Moon, Settings, X } from \"lucide-react\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Popover, PopoverContent, PopoverTrigger } from \"@/components/ui/popover\";\n\ninterface DepotCrewModalProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  depotName: string;\n  crews: { id: string; name: string; shift?: 'day' | 'night' }[];\n  employees: { id: string; name: string; status: 'active' | 'holiday' | 'sick'; jobRole: 'operative' | 'assistant'; email?: string }[];\n  vehicles: { id: string; name: string; status: 'active' | 'off_road' | 'maintenance'; vehicleType: string }[];\n  onCrewCreate: (name: string, shift: 'day' | 'night') => void;\n  onCrewUpdate: (id: string, name: string, shift: 'day' | 'night') => void;\n  onCrewDelete: (id: string) => void;\n  onEmployeeCreate: (name: string, jobRole: 'operative' | 'assistant', email?: string) => void;\n  onEmployeeUpdate: (id: string, name: string, status?: 'active' | 'holiday' | 'sick', jobRole?: 'operative' | 'assistant', email?: string) => void;\n  onEmployeeDelete?: (id: string) => void;\n  onVehicleCreate: (name: string, vehicleType: string) => void;\n  onVehicleUpdate: (id: string, name: string, status?: 'active' | 'off_road' | 'maintenance', vehicleType?: string) => void;\n  onVehicleDelete?: (id: string) => void;\n  vehicleTypes?: string[];\n  onVehicleTypeCreate?: (type: string) => void;\n  onVehicleTypeDelete?: (type: string) => void;\n  isReadOnly?: boolean;\n}\n\nexport function DepotCrewModal({\n  open,\n  onOpenChange,\n  depotName,\n  crews = [],\n  employees = [],\n  vehicles = [],\n  onCrewCreate,\n  onCrewUpdate,\n  onCrewDelete,\n  onEmployeeCreate,\n  onEmployeeUpdate,\n  onEmployeeDelete = () => {},\n  onVehicleCreate,\n  onVehicleUpdate,\n  onVehicleDelete = () => {},\n  vehicleTypes = ['Van', 'CCTV', 'Jetting', 'Recycler', 'Other'],\n  onVehicleTypeCreate = () => {},\n  onVehicleTypeDelete = () => {},\n  isReadOnly = false,\n}: DepotCrewModalProps) {\n  const [newCrewName, setNewCrewName] = useState(\"\");\n  const [newCrewShift, setNewCrewShift] = useState<'day' | 'night'>(\"day\");\n  const [newEmployeeName, setNewEmployeeName] = useState(\"\");\n  const [newEmployeeRole, setNewEmployeeRole] = useState<'operative' | 'assistant'>('operative');\n  const [newEmployeeEmail, setNewEmployeeEmail] = useState(\"\");\n  const [newVehicleName, setNewVehicleName] = useState(\"\");\n  const [newVehicleType, setNewVehicleType] = useState(vehicleTypes[0] || \"Van\");\n  const [editingCrew, setEditingCrew] = useState<{ id: string; name: string; shift?: 'day' | 'night' } | null>(null);\n  const [editingEmployee, setEditingEmployee] = useState<{ id: string; name: string; jobRole: 'operative' | 'assistant'; email?: string } | null>(null);\n  const [editingVehicle, setEditingVehicle] = useState<{ id: string; name: string; vehicleType: string; status?: 'active' | 'off_road' | 'maintenance' } | null>(null);\n  const [newTypeName, setNewTypeName] = useState(\"\");\n  const [isManageTypesOpen, setIsManageTypesOpen] = useState(false);\n\n  // Refresh when modal opens or data changes\n  useEffect(() => {\n    if (open) {\n      setEditingCrew(null);\n      setEditingEmployee(null);\n      setEditingVehicle(null);\n      setNewVehicleType(vehicleTypes[0] || \"Van\");\n    }\n  }, [open, crews, employees, vehicles, vehicleTypes]);\n\n  const handleAddCrew = (shift: 'day' | 'night') => {\n    const prefix = shift === 'night' ? \"Night\" : \"Day\";\n    const count = crews.filter(c => c.shift === shift || (shift === 'night' ? c.name.toLowerCase().includes(\"night\") : !c.name.toLowerCase().includes(\"night\"))).length;\n    \n    const generatedName = `${prefix} ${count + 1}`;\n    onCrewCreate(generatedName, shift);\n  };\n\n  const handleAddEmployee = () => {\n    if (!newEmployeeName.trim()) return;\n    onEmployeeCreate(newEmployeeName, newEmployeeRole, newEmployeeEmail);\n    setNewEmployeeName(\"\");\n    setNewEmployeeRole('operative');\n    setNewEmployeeEmail(\"\");\n    // Force scroll to see the new item\n    setTimeout(() => {\n      const employeesList = document.querySelector('[data-employees-list]');\n      if (employeesList) {\n        employeesList.scrollTop = 0;\n      }\n    }, 0);\n  };\n\n  const handleAddVehicle = () => {\n    if (!newVehicleName.trim()) return;\n    onVehicleCreate(newVehicleName, newVehicleType);\n    setNewVehicleName(\"\");\n    // Don't reset type, keep last used\n    // Force scroll to see the new item\n    setTimeout(() => {\n      const vehiclesList = document.querySelector('[data-vehicles-list]');\n      if (vehiclesList) {\n        vehiclesList.scrollTop = 0;\n      }\n    }, 0);\n  };\n\n  const handleAddVehicleType = () => {\n    if (!newTypeName.trim()) return;\n    onVehicleTypeCreate(newTypeName);\n    setNewTypeName(\"\");\n  };\n\n  const handleSaveCrew = () => {\n    if (!editingCrew || !editingCrew.name.trim()) return;\n    onCrewUpdate(editingCrew.id, editingCrew.name, editingCrew.shift || 'day');\n    setEditingCrew(null);\n  };\n\n  const handleDeleteCrew = (crewId: string) => {\n    onCrewDelete(crewId);\n  };\n\n  const handleDeleteEmployee = (empId: string) => {\n    onEmployeeDelete(empId);\n  };\n\n  const handleDeleteVehicle = (vehId: string) => {\n    onVehicleDelete(vehId);\n  };\n\n  const handleSaveEmployee = () => {\n    if (!editingEmployee || !editingEmployee.name.trim()) return;\n    onEmployeeUpdate(editingEmployee.id, editingEmployee.name, undefined, editingEmployee.jobRole, editingEmployee.email);\n    setEditingEmployee(null);\n  };\n\n  const handleSaveVehicle = () => {\n    if (!editingVehicle || !editingVehicle.name.trim()) return;\n    onVehicleUpdate(editingVehicle.id, editingVehicle.name, undefined, editingVehicle.vehicleType);\n    setEditingVehicle(null);\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"sm:max-w-[600px] bg-white text-slate-900 max-h-[80vh] flex flex-col\">\n        <DialogHeader>\n          <DialogTitle>Manage Depot - {depotName}</DialogTitle>\n        </DialogHeader>\n\n        <Tabs defaultValue=\"crews\" className=\"flex-1 flex flex-col min-h-0\">\n          <TabsList className=\"grid w-full grid-cols-3\">\n            <TabsTrigger value=\"crews\">Crews</TabsTrigger>\n            <TabsTrigger value=\"employees\">Employees</TabsTrigger>\n            <TabsTrigger value=\"vehicles\">Vehicles</TabsTrigger>\n          </TabsList>\n\n          {/* CREWS TAB */}\n          <TabsContent value=\"crews\" className=\"flex-1 flex flex-col min-h-0 mt-4 space-y-4 overflow-hidden\">\n            <div className=\"space-y-2\">\n              <Label className=\"text-sm font-semibold\">Add New Crew</Label>\n              <div className=\"flex gap-2\">\n                <Button onClick={() => handleAddCrew('day')} className=\"flex-1 bg-amber-50 text-amber-700 hover:bg-amber-100 border border-amber-200\" disabled={isReadOnly}>\n                  <Sun className=\"w-4 h-4 mr-2\" /> Add Day Crew\n                </Button>\n                <Button onClick={() => handleAddCrew('night')} className=\"flex-1 bg-indigo-50 text-indigo-700 hover:bg-indigo-100 border border-indigo-200\" disabled={isReadOnly}>\n                  <Moon className=\"w-4 h-4 mr-2\" /> Add Night Crew\n                </Button>\n              </div>\n            </div>\n\n            <div className=\"space-y-2 flex-1 flex flex-col min-h-0\">\n              <Label className=\"text-sm font-semibold\">Current Crews</Label>\n              <div className=\"border rounded-md divide-y flex-1 overflow-y-auto\">\n                {crews.length === 0 ? (\n                  <div className=\"p-4 text-center text-slate-500 text-sm\">No crews yet</div>\n                ) : (\n                  [...crews].sort((a, b) => {\n                      // Sort by shift (night first), then by name\n                      if (a.shift === 'night' && b.shift !== 'night') return -1;\n                      if (a.shift !== 'night' && b.shift === 'night') return 1;\n                      return a.name.localeCompare(b.name);\n                  }).map((crew) => (\n                    <div key={crew.id} className=\"p-3 flex items-center justify-between hover:bg-slate-50\">\n                      {editingCrew?.id === crew.id ? (\n                        <div className=\"flex items-center gap-2 flex-1\">\n                          <Input\n                            value={editingCrew.name}\n                            onChange={(e) => setEditingCrew({ ...editingCrew, name: e.target.value })}\n                            autoFocus\n                            className=\"flex-1\"\n                          />\n                          <Select \n                            value={editingCrew.shift || 'day'} \n                            onValueChange={(v) => setEditingCrew({ ...editingCrew, shift: v as 'day'|'night' })}\n                          >\n                            <SelectTrigger className=\"w-32\">\n                                <SelectValue />\n                            </SelectTrigger>\n                            <SelectContent>\n                                <SelectItem value=\"day\">Day</SelectItem>\n                                <SelectItem value=\"night\">Night</SelectItem>\n                            </SelectContent>\n                          </Select>\n                          <Button size=\"sm\" onClick={handleSaveCrew}>\n                            Save\n                          </Button>\n                          <Button size=\"sm\" variant=\"ghost\" onClick={() => setEditingCrew(null)}>\n                            Cancel\n                          </Button>\n                        </div>\n                      ) : (\n                        <>\n                          <div className=\"flex items-center gap-3\">\n                             {crew.shift === 'night' ? (\n                                <div className=\"w-8 h-8 rounded bg-indigo-100 flex items-center justify-center text-indigo-600\" title=\"Night Shift\">\n                                    <Moon className=\"w-4 h-4\" />\n                                </div>\n                             ) : (\n                                <div className=\"w-8 h-8 rounded bg-amber-50 flex items-center justify-center text-amber-500\" title=\"Day Shift\">\n                                    <Sun className=\"w-4 h-4\" />\n                                </div>\n                             )}\n                             <div>\n                                <div className=\"font-medium text-slate-700\">{crew.name}</div>\n                                <div className=\"text-xs text-slate-500 capitalize\">{crew.shift || 'day'} Shift</div>\n                             </div>\n                          </div>\n                          <div className=\"flex gap-1\">\n                            <Button\n                              size=\"icon\"\n                              variant=\"ghost\"\n                              onClick={() => setEditingCrew(crew)}\n                              className=\"h-8 w-8\"\n                              disabled={isReadOnly}\n                            >\n                              <Edit className=\"w-4 h-4 text-slate-500\" />\n                            </Button>\n                            <Button\n                              size=\"icon\"\n                              variant=\"ghost\"\n                              onClick={(e) => {\n                                e.preventDefault();\n                                handleDeleteCrew(crew.id);\n                              }}\n                              className=\"h-8 w-8\"\n                              disabled={isReadOnly}\n                            >\n                              <Trash2 className=\"w-4 h-4 text-red-500\" />\n                            </Button>\n                          </div>\n                        </>\n                      )}\n                    </div>\n                  ))\n                )}\n              </div>\n            </div>\n          </TabsContent>\n\n          {/* EMPLOYEES TAB */}\n          <TabsContent value=\"employees\" className=\"flex-1 flex flex-col min-h-0 mt-4 space-y-4 overflow-hidden\">\n            <div className=\"space-y-2\">\n              <Label className=\"text-sm font-semibold\">Add New Employee</Label>\n              <div className=\"flex flex-col gap-2\">\n                <div className=\"flex gap-2\">\n                    <Input\n                    placeholder=\"Employee name\"\n                    value={newEmployeeName}\n                    onChange={(e) => setNewEmployeeName(e.target.value)}\n                    onKeyDown={(e) => e.key === \"Enter\" && handleAddEmployee()}\n                    className=\"flex-1\"\n                    />\n                    <Select value={newEmployeeRole} onValueChange={(val) => setNewEmployeeRole(val as 'operative' | 'assistant')}>\n                    <SelectTrigger className=\"w-32\">\n                        <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                        <SelectItem value=\"operative\">üë∑ Operative</SelectItem>\n                        <SelectItem value=\"assistant\">ü§ù Assistant</SelectItem>\n                    </SelectContent>\n                    </Select>\n                </div>\n                <div className=\"flex gap-2\">\n                    <Input\n                        placeholder=\"Email address (optional)\"\n                        value={newEmployeeEmail}\n                        onChange={(e) => setNewEmployeeEmail(e.target.value)}\n                        onKeyDown={(e) => e.key === \"Enter\" && handleAddEmployee()}\n                        className=\"flex-1 text-sm\"\n                        type=\"email\"\n                    />\n                    <Button onClick={handleAddEmployee} className=\"gap-2 w-32\">\n                    <Plus className=\"w-4 h-4\" /> Add\n                    </Button>\n                </div>\n              </div>\n            </div>\n\n            <div className=\"space-y-2 flex-1 flex flex-col min-h-0\">\n              <Label className=\"text-sm font-semibold\">Employees at {depotName}</Label>\n              <div className=\"border rounded-md divide-y flex-1 overflow-y-auto\" data-employees-list>\n                {employees.length === 0 ? (\n                  <div className=\"p-4 text-center text-slate-500 text-sm\">No employees</div>\n                ) : (\n                  employees.map((emp) => (\n                    <div key={emp.id} className=\"p-3 flex items-center justify-between hover:bg-slate-50\">\n                      {editingEmployee?.id === emp.id ? (\n                        <div className=\"flex flex-col gap-2 flex-1\">\n                            <div className=\"flex items-center gap-2 flex-1\">\n                                <Input\n                                    value={editingEmployee.name}\n                                    onChange={(e) => setEditingEmployee({ ...editingEmployee, name: e.target.value })}\n                                    autoFocus\n                                    className=\"flex-1\"\n                                    placeholder=\"Name\"\n                                />\n                                <Select value={editingEmployee.jobRole} onValueChange={(val) => setEditingEmployee({ ...editingEmployee, jobRole: val as 'operative' | 'assistant' })}>\n                                    <SelectTrigger className=\"w-32\">\n                                    <SelectValue />\n                                    </SelectTrigger>\n                                    <SelectContent>\n                                    <SelectItem value=\"operative\">Operative</SelectItem>\n                                    <SelectItem value=\"assistant\">Assistant</SelectItem>\n                                    </SelectContent>\n                                </Select>\n                            </div>\n                            <div className=\"flex items-center gap-2\">\n                                <Input\n                                    value={editingEmployee.email || \"\"}\n                                    onChange={(e) => setEditingEmployee({ ...editingEmployee, email: e.target.value })}\n                                    className=\"flex-1 text-sm\"\n                                    placeholder=\"Email address\"\n                                    type=\"email\"\n                                />\n                                <div className=\"flex gap-2 w-32 justify-end\">\n                                    <Button size=\"sm\" onClick={handleSaveEmployee}>\n                                        Save\n                                    </Button>\n                                    <Button size=\"sm\" variant=\"ghost\" onClick={() => setEditingEmployee(null)}>\n                                        Cancel\n                                    </Button>\n                                </div>\n                            </div>\n                        </div>\n                      ) : (\n                        <>\n                          <div className=\"flex items-center gap-2 flex-1\">\n                            <div className=\"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center text-blue-600 shrink-0\">\n                              <Users className=\"w-4 h-4\" />\n                            </div>\n                            <div className=\"min-w-0\">\n                              <div className=\"font-medium text-slate-700\">{emp.name}</div>\n                              <div className=\"text-xs text-slate-500 flex items-center gap-2\">\n                                <span>{emp.status} ‚Ä¢ {emp.jobRole === 'operative' ? 'üë∑ Operative' : 'ü§ù Assistant'}</span>\n                                {emp.email && (\n                                    <span className=\"flex items-center gap-1 text-slate-400 border-l border-slate-300 pl-2\">\n                                        <Mail className=\"w-3 h-3\" /> {emp.email}\n                                    </span>\n                                )}\n                              </div>\n                            </div>\n                          </div>\n                          <div className=\"flex gap-1 shrink-0\">\n                            <Button\n                              size=\"icon\"\n                              variant=\"ghost\"\n                              onClick={() => setEditingEmployee(emp)}\n                              className=\"h-8 w-8\"\n                            >\n                              <Edit className=\"w-4 h-4 text-slate-500\" />\n                            </Button>\n                            <Button\n                              size=\"icon\"\n                              variant=\"ghost\"\n                              onClick={(e) => {\n                                e.preventDefault();\n                                handleDeleteEmployee(emp.id);\n                              }}\n                              className=\"h-8 w-8\"\n                            >\n                              <Trash2 className=\"w-4 h-4 text-red-500\" />\n                            </Button>\n                          </div>\n                        </>\n                      )}\n                    </div>\n                  ))\n                )}\n              </div>\n            </div>\n          </TabsContent>\n\n          {/* VEHICLES TAB */}\n          <TabsContent value=\"vehicles\" className=\"flex-1 flex flex-col min-h-0 mt-4 space-y-4 overflow-hidden\">\n            <div className=\"space-y-2\">\n              <div className=\"flex justify-between items-center\">\n                <Label className=\"text-sm font-semibold\">Add New Vehicle</Label>\n                <Popover open={isManageTypesOpen} onOpenChange={setIsManageTypesOpen}>\n                    <PopoverTrigger asChild>\n                        <Button variant=\"ghost\" size=\"sm\" className=\"h-6 text-xs text-blue-600 hover:text-blue-700 p-0 hover:bg-transparent\">\n                            <Settings className=\"w-3 h-3 mr-1\" /> Manage Types\n                        </Button>\n                    </PopoverTrigger>\n                    <PopoverContent className=\"w-64 p-3\" align=\"end\">\n                        <div className=\"space-y-3\">\n                            <h4 className=\"font-medium text-sm\">Manage Vehicle Types</h4>\n                            <div className=\"flex gap-2\">\n                                <Input \n                                    placeholder=\"New Type...\" \n                                    className=\"h-8 text-sm\"\n                                    value={newTypeName}\n                                    onChange={(e) => setNewTypeName(e.target.value)}\n                                    onKeyDown={(e) => e.key === 'Enter' && handleAddVehicleType()}\n                                />\n                                <Button size=\"sm\" className=\"h-8 w-8 p-0\" onClick={handleAddVehicleType}>\n                                    <Plus className=\"w-4 h-4\" />\n                                </Button>\n                            </div>\n                            <div className=\"max-h-40 overflow-y-auto space-y-1\">\n                                {vehicleTypes.map(type => (\n                                    <div key={type} className=\"flex items-center justify-between text-sm group p-1 rounded hover:bg-slate-50\">\n                                        <span>{type}</span>\n                                        <Button \n                                            variant=\"ghost\" \n                                            size=\"sm\" \n                                            className=\"h-6 w-6 p-0 opacity-0 group-hover:opacity-100 text-red-500 hover:text-red-700 hover:bg-red-50\"\n                                            onClick={() => onVehicleTypeDelete(type)}\n                                        >\n                                            <X className=\"w-3 h-3\" />\n                                        </Button>\n                                    </div>\n                                ))}\n                            </div>\n                        </div>\n                    </PopoverContent>\n                </Popover>\n              </div>\n              <div className=\"flex gap-2\">\n                <Input\n                  placeholder=\"Vehicle name\"\n                  value={newVehicleName}\n                  onChange={(e) => setNewVehicleName(e.target.value)}\n                  onKeyDown={(e) => e.key === \"Enter\" && handleAddVehicle()}\n                  className=\"flex-1\"\n                />\n                <Select value={newVehicleType} onValueChange={setNewVehicleType}>\n                  <SelectTrigger className=\"w-32\">\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {vehicleTypes.map(type => (\n                        <SelectItem key={type} value={type}>{type}</SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n                <Button onClick={handleAddVehicle} className=\"gap-2\">\n                  <Plus className=\"w-4 h-4\" /> Add\n                </Button>\n              </div>\n            </div>\n\n            <div className=\"space-y-2 flex-1 flex flex-col min-h-0\">\n              <Label className=\"text-sm font-semibold\">Vehicles at {depotName}</Label>\n              <div className=\"border rounded-md flex-1 overflow-y-auto\" data-vehicles-list>\n                {vehicles.length === 0 ? (\n                  <div className=\"p-4 text-center text-slate-500 text-sm\">No vehicles</div>\n                ) : (\n                  (() => {\n                    // Group vehicles by type\n                    const groupedVehicles = vehicles.reduce((acc, vehicle) => {\n                      const type = vehicle.vehicleType || 'Other';\n                      if (!acc[type]) {\n                        acc[type] = [];\n                      }\n                      acc[type].push(vehicle);\n                      return acc;\n                    }, {} as Record<string, typeof vehicles>);\n\n                    // Sort types alphabetically\n                    const sortedTypes = Object.keys(groupedVehicles).sort();\n\n                    // Sort vehicles within each type alphabetically\n                    sortedTypes.forEach(type => {\n                      groupedVehicles[type].sort((a, b) => a.name.localeCompare(b.name));\n                    });\n\n                    return sortedTypes.map(type => (\n                      <div key={type}>\n                        <div className=\"bg-slate-100 px-3 py-1.5 text-xs font-bold text-slate-500 uppercase tracking-wider sticky top-0 z-10 border-b border-slate-200 shadow-sm\">\n                          {type}\n                        </div>\n                        <div className=\"divide-y border-b last:border-b-0\">\n                          {groupedVehicles[type].map((veh) => (\n                            <div key={veh.id} className=\"p-3 flex items-center justify-between hover:bg-slate-50\">\n                              {editingVehicle?.id === veh.id ? (\n                                <div className=\"flex items-center gap-2 flex-1 mr-4\">\n                                  <Input \n                                    value={editingVehicle.name} \n                                    onChange={(e) => setEditingVehicle({ ...editingVehicle, name: e.target.value })}\n                                    autoFocus\n                                    className=\"w-40\"\n                                  />\n                                  <Select \n                                    value={editingVehicle.vehicleType} \n                                    onValueChange={(val) => setEditingVehicle({ ...editingVehicle, vehicleType: val })}\n                                  >\n                                    <SelectTrigger className=\"w-32\">\n                                      <SelectValue />\n                                    </SelectTrigger>\n                                    <SelectContent>\n                                      {vehicleTypes.map(type => (\n                                          <SelectItem key={type} value={type}>{type}</SelectItem>\n                                      ))}\n                                    </SelectContent>\n                                  </Select>\n                                  <Select \n                                    value={editingVehicle.status || 'active'} \n                                    onValueChange={(val: any) => setEditingVehicle({ ...editingVehicle, status: val })}\n                                  >\n                                    <SelectTrigger className=\"w-32\">\n                                      <SelectValue />\n                                    </SelectTrigger>\n                                    <SelectContent>\n                                      <SelectItem value=\"active\">Active</SelectItem>\n                                      <SelectItem value=\"off_road\">VOR</SelectItem>\n                                      <SelectItem value=\"maintenance\">Maintenance</SelectItem>\n                                    </SelectContent>\n                                  </Select>\n                                  <Button size=\"sm\" onClick={handleSaveVehicle}>Save</Button>\n                                  <Button size=\"sm\" variant=\"ghost\" onClick={() => setEditingVehicle(null)}>Cancel</Button>\n                                </div>\n                              ) : (\n                                <div className=\"flex items-center gap-3 flex-1\">\n                                  <div className=\"w-8 h-8 bg-slate-100 rounded-full flex items-center justify-center text-slate-600 shrink-0\">\n                                    <Truck className=\"w-4 h-4\" />\n                                  </div>\n                                  <div className=\"flex flex-col\">\n                                    <span className=\"font-medium\">{veh.name}</span>\n                                    {veh.status !== 'active' && (\n                                      <span className=\"text-xs text-red-600 font-medium uppercase tracking-wider flex items-center gap-1\">\n                                        <Settings className=\"w-3 h-3\" /> {veh.status === 'off_road' ? 'VOR' : veh.status}\n                                      </span>\n                                    )}\n                                  </div>\n                                </div>\n                              )}\n                              \n                              {editingVehicle?.id !== veh.id && (\n                                <div className=\"flex gap-1\">\n                                  <Button size=\"icon\" variant=\"ghost\" onClick={() => setEditingVehicle(veh)}>\n                                    <Edit className=\"w-4 h-4 text-slate-500\" />\n                                  </Button>\n                                  <Button size=\"icon\" variant=\"ghost\" onClick={() => handleDeleteVehicle(veh.id)}>\n                                    <Trash2 className=\"w-4 h-4 text-red-500\" />\n                                  </Button>\n                                </div>\n                              )}\n                            </div>\n                          ))}\n                        </div>\n                      </div>\n                    ));\n                  })()\n                )}\n              </div>\n            </div>\n          </TabsContent>\n        </Tabs>\n\n        <DialogFooter>\n          <Button onClick={() => onOpenChange(false)}>Done</Button>\n        </DialogFooter>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","path":null,"size_bytes":29807,"size_tokens":null},"client/src/components/schedule/OperativeCard.tsx":{"content":"import { User, Truck, MoreHorizontal, Copy, Trash2, Edit, AlertCircle, CalendarDays, CalendarRange } from \"lucide-react\";\nimport { useSortable } from \"@dnd-kit/sortable\";\nimport { CSS } from \"@dnd-kit/utilities\";\nimport { cn } from \"@/lib/utils\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuSeparator,\n} from \"@/components/ui/dropdown-menu\";\nimport {\n    ContextMenu,\n    ContextMenuContent,\n    ContextMenuItem,\n    ContextMenuTrigger,\n    ContextMenuSub,\n    ContextMenuSubContent,\n    ContextMenuSubTrigger,\n    ContextMenuSeparator,\n} from \"@/components/ui/context-menu\";\nimport { Button } from \"@/components/ui/button\";\nimport { ScheduleItem } from \"./CalendarGrid\";\nimport { Tooltip, TooltipContent, TooltipProvider, TooltipTrigger } from \"@/components/ui/tooltip\";\n\ninterface OperativeCardProps {\n  item: ScheduleItem;\n  onEdit: (item: ScheduleItem) => void;\n  onDelete: (id: string, mode: 'single' | 'week' | 'remainder_month' | 'remainder_year' | 'next_2_months' | 'next_3_months' | 'next_4_months' | 'next_5_months' | 'next_6_months') => void;\n  onDuplicate: (item: ScheduleItem, mode: 'single' | 'week' | 'following_week' | 'custom' | 'remainder_month' | 'remainder_year' | 'next_2_months' | 'next_3_months' | 'next_4_months' | 'next_5_months' | 'next_6_months', days?: number) => void;\n  vehicles: { id: string; name: string; status?: string }[];\n  employees: { id: string; name: string; status?: string }[];\n  isReadOnly?: boolean;\n  isSelected?: boolean;\n  onToggleSelection?: (id: string, multi: boolean) => void;\n}\n\nexport function OperativeCard({ item, onEdit, onDelete, onDuplicate, vehicles, employees, isReadOnly = false, isSelected = false, onToggleSelection }: OperativeCardProps) {\n  const {\n    attributes,\n    listeners,\n    setNodeRef,\n    transform,\n    transition,\n    isDragging,\n  } = useSortable({ id: item.id, data: item, disabled: isReadOnly });\n\n  const style = {\n    transform: CSS.Transform.toString(transform),\n    transition,\n    opacity: isDragging ? 0.5 : 1,\n  };\n\n  const employee = employees.find(e => e.id === item.employeeId);\n  const vehicle = vehicles.find(v => v.id === item.vehicleId);\n  const isAssistant = item.type === 'assistant';\n\n  const isEmployeeUnavailable = employee?.status && employee.status !== 'active';\n  const isVehicleUnavailable = vehicle?.status && vehicle.status !== 'active';\n  const hasWarning = isEmployeeUnavailable || isVehicleUnavailable;\n\n  return (\n    <ContextMenu>\n        <ContextMenuTrigger>\n            <div\n            ref={setNodeRef}\n            style={style}\n            {...attributes}\n            {...listeners}\n            onDoubleClick={(e) => {\n                e.stopPropagation();\n                onEdit(item);\n            }}\n            onClick={(e) => {\n                if (e.shiftKey && onToggleSelection) {\n                    e.stopPropagation();\n                    onToggleSelection(item.id, true);\n                } else if (onToggleSelection) {\n                    // Optional: Click without shift selects just this one?\n                    // onToggleSelection(item.id, false);\n                }\n            }}\n            className={cn(\n                \"group relative rounded-lg border shadow-sm cursor-grab active:cursor-grabbing transition-all select-none overflow-hidden p-1 flex items-center gap-1\",\n                isSelected ? \"ring-2 ring-black ring-inset z-20 border-transparent\" : \"\",\n                // Grid cell behavior: fill the cell\n                \"w-full h-full min-w-0 mb-1\",\n                isAssistant \n                    ? \"bg-amber-50 border-amber-200 hover:border-amber-300\" // Assistant Style\n                    : \"bg-slate-50 border-slate-200 hover:border-blue-300\", // Operative Style\n                hasWarning && \"border-red-300 bg-red-50/50\"\n            )}\n            >\n            <div className={cn(\"p-1 rounded-full shrink-0 relative\", isAssistant ? \"bg-amber-100 text-amber-600\" : \"bg-blue-100 text-blue-600\")}>\n                    <User className=\"w-3 h-3\" />\n                    {isEmployeeUnavailable && (\n                        <div className=\"absolute -top-1 -right-1 bg-red-500 rounded-full p-0.5 border border-white\" title={`Employee is ${employee?.status}`}>\n                            <AlertCircle className=\"w-2 h-2 text-white\" />\n                        </div>\n                    )}\n                </div>\n                \n                <div className=\"flex flex-col min-w-0 flex-1\">\n                    <span className={cn(\"text-[10px] font-bold truncate leading-tight\", hasWarning ? \"text-red-700\" : \"text-slate-800\")}>\n                        {employee?.name || \"Unknown\"}\n                    </span>\n                    \n                    {!isAssistant && vehicle && (\n                        <div className={cn(\"flex items-center gap-1 text-[9px] leading-tight\", hasWarning ? \"text-red-600\" : \"text-blue-600\")}>\n                            <Truck className=\"w-2.5 h-2.5\" />\n                            <span className=\"truncate\">{vehicle.name}</span>\n                            {isVehicleUnavailable && (\n                                <AlertCircle className=\"w-2.5 h-2.5 text-red-500 ml-1\" />\n                            )}\n                        </div>\n                    )}\n                    {isAssistant && (\n                        <span className=\"text-[8px] text-amber-600 uppercase font-bold tracking-wider leading-tight\">\n                            Assistant\n                        </span>\n                    )}\n                </div>\n\n            <div className=\"opacity-0 group-hover:opacity-100 transition-opacity\" onPointerDown={(e) => e.stopPropagation()}>\n                <DropdownMenu>\n                    <DropdownMenuTrigger asChild>\n                    <Button variant=\"ghost\" size=\"icon\" className=\"h-5 w-5 p-0 hover:bg-black/5 text-slate-400 hover:text-slate-700\">\n                        <MoreHorizontal className=\"h-3 w-3\" />\n                    </Button>\n                    </DropdownMenuTrigger>\n                    <DropdownMenuContent align=\"end\" className=\"w-48\">\n                    {!isReadOnly && (\n                        <>\n                        <DropdownMenuItem onClick={() => onEdit(item)}>\n                            <Edit className=\"w-3 h-3 mr-2\" /> Edit\n                        </DropdownMenuItem>\n                        \n                        <DropdownMenuSub>\n                            <DropdownMenuSubTrigger>\n                                <Copy className=\"w-3 h-3 mr-2\" /> Duplicate\n                            </DropdownMenuSubTrigger>\n                            <DropdownMenuSubContent className=\"w-48\">\n                                <DropdownMenuItem onClick={() => onDuplicate(item, 'single')}>\n                                    Duplicate Single\n                                </DropdownMenuItem>\n                                <DropdownMenuItem onClick={() => onDuplicate(item, 'custom', 5)}>\n                                    <CalendarDays className=\"w-3 h-3 mr-2\" /> Next 5 Days\n                                </DropdownMenuItem>\n                                <DropdownMenuItem onClick={() => onDuplicate(item, 'week')}>\n                                    <CalendarRange className=\"w-3 h-3 mr-2\" /> Remainder of Week\n                                </DropdownMenuItem>\n                                <DropdownMenuItem onClick={() => onDuplicate(item, 'following_week')}>\n                                    <CalendarRange className=\"w-3 h-3 mr-2\" /> Following Week\n                                </DropdownMenuItem>\n                                <DropdownMenuSeparator />\n                                <DropdownMenuItem onClick={() => onDuplicate(item, 'remainder_month')}>\n                                    <CalendarRange className=\"w-3 h-3 mr-2\" /> Remainder of Month\n                                </DropdownMenuItem>\n                                <DropdownMenuItem onClick={() => onDuplicate(item, 'remainder_year')}>\n                                    <CalendarRange className=\"w-3 h-3 mr-2\" /> Remainder of Year\n                                </DropdownMenuItem>\n                                <DropdownMenuItem onClick={() => onDuplicate(item, 'next_2_months')}>\n                                    <CalendarRange className=\"w-3 h-3 mr-2\" /> Next 2 Months\n                                </DropdownMenuItem>\n                                <DropdownMenuItem onClick={() => onDuplicate(item, 'next_3_months')}>\n                                    <CalendarRange className=\"w-3 h-3 mr-2\" /> Next 3 Months\n                                </DropdownMenuItem>\n                                <DropdownMenuItem onClick={() => onDuplicate(item, 'next_4_months')}>\n                                    <CalendarRange className=\"w-3 h-3 mr-2\" /> Next 4 Months\n                                </DropdownMenuItem>\n                                <DropdownMenuItem onClick={() => onDuplicate(item, 'next_5_months')}>\n                                    <CalendarRange className=\"w-3 h-3 mr-2\" /> Next 5 Months\n                                </DropdownMenuItem>\n                                <DropdownMenuItem onClick={() => onDuplicate(item, 'next_6_months')}>\n                                    <CalendarRange className=\"w-3 h-3 mr-2\" /> Next 6 Months\n                                </DropdownMenuItem>\n                            </DropdownMenuSubContent>\n                        </DropdownMenuSub>\n\n                        <DropdownMenuSeparator />\n\n                        <DropdownMenuSub>\n                            <DropdownMenuSubTrigger className=\"text-red-600\">\n                                <Trash2 className=\"w-3 h-3 mr-2\" /> Delete\n                            </DropdownMenuSubTrigger>\n                            <DropdownMenuSubContent className=\"w-48\">\n                                <DropdownMenuItem onClick={() => onDelete(item.id, 'single')} className=\"text-red-600\">\n                                    Delete Single\n                                </DropdownMenuItem>\n                                <DropdownMenuItem onClick={() => onDelete(item.id, 'week')} className=\"text-red-600\">\n                                    <CalendarRange className=\"w-3 h-3 mr-2\" /> Remainder of Week\n                                </DropdownMenuItem>\n                                <DropdownMenuSeparator />\n                                <DropdownMenuItem onClick={() => onDelete(item.id, 'remainder_month')} className=\"text-red-600\">\n                                    <CalendarRange className=\"w-3 h-3 mr-2\" /> Remainder of Month\n                                </DropdownMenuItem>\n                                <DropdownMenuItem onClick={() => onDelete(item.id, 'remainder_year')} className=\"text-red-600\">\n                                    <CalendarRange className=\"w-3 h-3 mr-2\" /> Remainder of Year\n                                </DropdownMenuItem>\n                                <DropdownMenuItem onClick={() => onDelete(item.id, 'next_2_months')} className=\"text-red-600\">\n                                    <CalendarRange className=\"w-3 h-3 mr-2\" /> Next 2 Months\n                                </DropdownMenuItem>\n                                <DropdownMenuItem onClick={() => onDelete(item.id, 'next_3_months')} className=\"text-red-600\">\n                                    <CalendarRange className=\"w-3 h-3 mr-2\" /> Next 3 Months\n                                </DropdownMenuItem>\n                                <DropdownMenuItem onClick={() => onDelete(item.id, 'next_4_months')} className=\"text-red-600\">\n                                    <CalendarRange className=\"w-3 h-3 mr-2\" /> Next 4 Months\n                                </DropdownMenuItem>\n                                <DropdownMenuItem onClick={() => onDelete(item.id, 'next_5_months')} className=\"text-red-600\">\n                                    <CalendarRange className=\"w-3 h-3 mr-2\" /> Next 5 Months\n                                </DropdownMenuItem>\n                                <DropdownMenuItem onClick={() => onDelete(item.id, 'next_6_months')} className=\"text-red-600\">\n                                    <CalendarRange className=\"w-3 h-3 mr-2\" /> Next 6 Months\n                                </DropdownMenuItem>\n                            </DropdownMenuSubContent>\n                        </DropdownMenuSub>\n                        </>\n                    )}\n                    {isReadOnly && (\n                        <DropdownMenuItem disabled className=\"text-xs text-slate-400\">\n                            Read Only Mode\n                        </DropdownMenuItem>\n                    )}\n                    </DropdownMenuContent>\n                </DropdownMenu>\n            </div>\n            </div>\n        </ContextMenuTrigger>\n        <ContextMenuContent className=\"w-48\">\n            {!isReadOnly && (\n                <>\n                <ContextMenuItem onClick={() => onEdit(item)}>\n                    <Edit className=\"w-3 h-3 mr-2\" /> Edit\n                </ContextMenuItem>\n                \n                <ContextMenuSub>\n                    <ContextMenuSubTrigger>\n                        <Copy className=\"w-3 h-3 mr-2\" /> Duplicate\n                    </ContextMenuSubTrigger>\n                    <ContextMenuSubContent className=\"w-48\">\n                        <ContextMenuItem onClick={() => onDuplicate(item, 'single')}>\n                            Duplicate Single\n                        </ContextMenuItem>\n                        <ContextMenuItem onClick={() => onDuplicate(item, 'custom', 5)}>\n                            <CalendarDays className=\"w-3 h-3 mr-2\" /> Next 5 Days\n                        </ContextMenuItem>\n                        <ContextMenuItem onClick={() => onDuplicate(item, 'week')}>\n                            <CalendarRange className=\"w-3 h-3 mr-2\" /> Remainder of Week\n                        </ContextMenuItem>\n                        <ContextMenuItem onClick={() => onDuplicate(item, 'following_week')}>\n                            <CalendarRange className=\"w-3 h-3 mr-2\" /> Following Week\n                        </ContextMenuItem>\n                        <ContextMenuSeparator />\n                        <ContextMenuItem onClick={() => onDuplicate(item, 'remainder_month')}>\n                            <CalendarRange className=\"w-3 h-3 mr-2\" /> Remainder of Month\n                        </ContextMenuItem>\n                        <ContextMenuItem onClick={() => onDuplicate(item, 'remainder_year')}>\n                            <CalendarRange className=\"w-3 h-3 mr-2\" /> Remainder of Year\n                        </ContextMenuItem>\n                        <ContextMenuItem onClick={() => onDuplicate(item, 'next_2_months')}>\n                            <CalendarRange className=\"w-3 h-3 mr-2\" /> Next 2 Months\n                        </ContextMenuItem>\n                        <ContextMenuItem onClick={() => onDuplicate(item, 'next_3_months')}>\n                            <CalendarRange className=\"w-3 h-3 mr-2\" /> Next 3 Months\n                        </ContextMenuItem>\n                        <ContextMenuItem onClick={() => onDuplicate(item, 'next_4_months')}>\n                            <CalendarRange className=\"w-3 h-3 mr-2\" /> Next 4 Months\n                        </ContextMenuItem>\n                        <ContextMenuItem onClick={() => onDuplicate(item, 'next_5_months')}>\n                            <CalendarRange className=\"w-3 h-3 mr-2\" /> Next 5 Months\n                        </ContextMenuItem>\n                        <ContextMenuItem onClick={() => onDuplicate(item, 'next_6_months')}>\n                            <CalendarRange className=\"w-3 h-3 mr-2\" /> Next 6 Months\n                        </ContextMenuItem>\n                    </ContextMenuSubContent>\n                </ContextMenuSub>\n\n                <ContextMenuSeparator />\n\n                <ContextMenuSub>\n                    <ContextMenuSubTrigger className=\"text-red-600\">\n                        <Trash2 className=\"w-3 h-3 mr-2\" /> Delete\n                    </ContextMenuSubTrigger>\n                    <ContextMenuSubContent className=\"w-48\">\n                        <ContextMenuItem onClick={() => onDelete(item.id, 'single')} className=\"text-red-600\">\n                            Delete Single\n                        </ContextMenuItem>\n                        <ContextMenuItem onClick={() => onDelete(item.id, 'week')} className=\"text-red-600\">\n                            <CalendarRange className=\"w-3 h-3 mr-2\" /> Remainder of Week\n                        </ContextMenuItem>\n                        <ContextMenuSeparator />\n                        <ContextMenuItem onClick={() => onDelete(item.id, 'remainder_month')} className=\"text-red-600\">\n                            <CalendarRange className=\"w-3 h-3 mr-2\" /> Remainder of Month\n                        </ContextMenuItem>\n                        <ContextMenuItem onClick={() => onDelete(item.id, 'remainder_year')} className=\"text-red-600\">\n                            <CalendarRange className=\"w-3 h-3 mr-2\" /> Remainder of Year\n                        </ContextMenuItem>\n                        <ContextMenuItem onClick={() => onDelete(item.id, 'next_2_months')} className=\"text-red-600\">\n                            <CalendarRange className=\"w-3 h-3 mr-2\" /> Next 2 Months\n                        </ContextMenuItem>\n                        <ContextMenuItem onClick={() => onDelete(item.id, 'next_3_months')} className=\"text-red-600\">\n                            <CalendarRange className=\"w-3 h-3 mr-2\" /> Next 3 Months\n                        </ContextMenuItem>\n                        <ContextMenuItem onClick={() => onDelete(item.id, 'next_4_months')} className=\"text-red-600\">\n                            <CalendarRange className=\"w-3 h-3 mr-2\" /> Next 4 Months\n                        </ContextMenuItem>\n                        <ContextMenuItem onClick={() => onDelete(item.id, 'next_5_months')} className=\"text-red-600\">\n                            <CalendarRange className=\"w-3 h-3 mr-2\" /> Next 5 Months\n                        </ContextMenuItem>\n                        <ContextMenuItem onClick={() => onDelete(item.id, 'next_6_months')} className=\"text-red-600\">\n                            <CalendarRange className=\"w-3 h-3 mr-2\" /> Next 6 Months\n                        </ContextMenuItem>\n                    </ContextMenuSubContent>\n                </ContextMenuSub>\n                </>\n            )}\n            {isReadOnly && (\n                <ContextMenuItem disabled className=\"text-xs text-slate-400\">\n                    Read Only Mode\n                </ContextMenuItem>\n            )}\n        </ContextMenuContent>\n    </ContextMenu>\n  );\n}\n","path":null,"size_bytes":18883,"size_tokens":null},"client/src/components/ui/slider.tsx":{"content":"import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-1.5 w-full grow overflow-hidden rounded-full bg-primary/20\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-4 w-4 rounded-full border border-primary/50 bg-background shadow transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","path":null,"size_bytes":1037,"size_tokens":null},"client/src/lib/queryClient.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    const text = (await res.text()) || res.statusText;\n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\nexport async function apiRequest(\n  method: string,\n  url: string,\n  data?: unknown | undefined,\n): Promise<Response> {\n  const res = await fetch(url, {\n    method,\n    headers: data ? { \"Content-Type\": \"application/json\" } : {},\n    body: data ? JSON.stringify(data) : undefined,\n    credentials: \"include\",\n  });\n\n  await throwIfResNotOk(res);\n  return res;\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    const res = await fetch(queryKey.join(\"/\") as string, {\n      credentials: \"include\",\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: false,\n      staleTime: Infinity,\n      retry: false,\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});\n","path":null,"size_bytes":1383,"size_tokens":null},"drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","path":null,"size_bytes":325,"size_tokens":null},"client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"rounded-xl border bg-card text-card-foreground shadow\",\n      className\n    )}\n    {...props}\n  />\n))\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n))\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"font-semibold leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\n\nexport { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }\n","path":null,"size_bytes":1828,"size_tokens":null},"client/src/components/ui/dropdown-menu.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md\",\n        \"data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&>svg]:size-4 [&>svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","path":null,"size_bytes":7606,"size_tokens":null},"client/src/main.tsx":{"content":"import { createRoot } from \"react-dom/client\";\nimport App from \"./App\";\nimport \"./index.css\";\n\ncreateRoot(document.getElementById(\"root\")!).render(<App />);\n","path":null,"size_bytes":157,"size_tokens":null},"client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Minus } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-9 w-9 items-center justify-center border-y border-r border-input text-sm shadow-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-1 ring-ring\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Minus />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","path":null,"size_bytes":2143,"size_tokens":null},"client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 text-sm font-medium transition-all hover:underline text-left [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 text-muted-foreground transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","path":null,"size_bytes":2001,"size_tokens":null},"client/src/components/ui/switch.tsx":{"content":"import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-5 w-9 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-4 w-4 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-4 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n","path":null,"size_bytes":1148,"size_tokens":null},"client/src/components/ui/menubar.tsx":{"content":"import * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction MenubarMenu({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {\n  return <MenubarPrimitive.Menu {...props} />\n}\n\nfunction MenubarGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Group>) {\n  return <MenubarPrimitive.Group {...props} />\n}\n\nfunction MenubarPortal({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {\n  return <MenubarPrimitive.Portal {...props} />\n}\n\nfunction MenubarRadioGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {\n  return <MenubarPrimitive.RadioGroup {...props} />\n}\n\nfunction MenubarSub({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {\n  return <MenubarPrimitive.Sub data-slot=\"menubar-sub\" {...props} />\n}\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-9 items-center space-x-1 rounded-md border bg-background p-1 shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-4 w-4 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","path":null,"size_bytes":8608,"size_tokens":null},"client/src/components/schedule/SiteCard.tsx":{"content":"import { format } from \"date-fns\";\nimport { MapPin, Clock, MoreHorizontal, Copy, Trash2, Edit, CalendarDays, CalendarRange } from \"lucide-react\";\nimport { useSortable } from \"@dnd-kit/sortable\";\nimport { CSS } from \"@dnd-kit/utilities\";\nimport { cn } from \"@/lib/utils\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuSeparator,\n} from \"@/components/ui/dropdown-menu\";\nimport {\n    ContextMenu,\n    ContextMenuContent,\n    ContextMenuItem,\n    ContextMenuTrigger,\n    ContextMenuSub,\n    ContextMenuSubContent,\n    ContextMenuSubTrigger,\n    ContextMenuSeparator,\n} from \"@/components/ui/context-menu\";\nimport { Button } from \"@/components/ui/button\";\nimport { ScheduleItem } from \"./CalendarGrid\";\n\ninterface SiteCardProps {\n  item: ScheduleItem;\n  onEdit: (item: ScheduleItem) => void;\n  onDelete: (id: string, mode: 'single' | 'week' | 'remainder_month' | 'remainder_year' | 'next_2_months' | 'next_3_months' | 'next_4_months' | 'next_5_months' | 'next_6_months') => void;\n  onDuplicate: (item: ScheduleItem, mode: 'single' | 'week' | 'following_week' | 'custom' | 'remainder_month' | 'remainder_year' | 'next_2_months' | 'next_3_months' | 'next_4_months' | 'next_5_months' | 'next_6_months', days?: number) => void;\n  isReadOnly?: boolean;\n  isSelected?: boolean;\n  onToggleSelection?: (id: string, multi: boolean) => void;\n}\n\nexport function SiteCard({ item, onEdit, onDelete, onDuplicate, isReadOnly = false, isSelected = false, onToggleSelection }: SiteCardProps) {\n  const {\n    attributes,\n    listeners,\n    setNodeRef,\n    transform,\n    transition,\n    isDragging,\n  } = useSortable({ id: item.id, data: item, disabled: isReadOnly });\n\n  const style = {\n    transform: CSS.Transform.toString(transform),\n    transition,\n    opacity: isDragging ? 0.5 : 1,\n  };\n\n  // Pastel Colors\n  const colorClasses: Record<string, string> = {\n    blue: \"bg-[#BFDBFE] border-[#3B82F6] text-[#1E3A8A]\",\n    green: \"bg-[#BBF7D0] border-[#22C55E] text-[#14532D]\",\n    yellow: \"bg-[#FEF08A] border-[#EAB308] text-[#713F12]\",\n    orange: \"bg-[#FED7AA] border-[#F97316] text-[#7C2D12]\",\n    red: \"bg-[#FECACA] border-[#EF4444] text-[#7F1D1D]\",\n    purple: \"bg-[#E9D5FF] border-[#A855F7] text-[#581C87]\",\n    pink: \"bg-[#FBCFE8] border-[#EC4899] text-[#831843]\",\n    teal: \"bg-[#99F6E4] border-[#14B8A6] text-[#134E4A]\",\n    gray: \"bg-[#E2E8F0] border-[#64748B] text-[#1E293B]\",\n    indigo: \"bg-[#C7D2FE] border-[#6366F1] text-[#312E81]\",\n    cyan: \"bg-[#A5F3FC] border-[#06B6D4] text-[#164E63]\",\n    lime: \"bg-[#D9F99D] border-[#84CC16] text-[#365314]\",\n    emerald: \"bg-[#A7F3D0] border-[#10B981] text-[#064E3B]\",\n    amber: \"bg-[#FDE68A] border-[#D97706] text-[#78350F]\",\n    rose: \"bg-[#FECDD3] border-[#F43F5E] text-[#881337]\",\n    fuchsia: \"bg-[#F5D0FE] border-[#E879F9] text-[#701A75]\",\n    violet: \"bg-[#DDD6FE] border-[#8B5CF6] text-[#4C1D95]\",\n    sky: \"bg-[#BAE6FD] border-[#0EA5E9] text-[#0C4A6E]\",\n    indigo_dark: \"bg-[#C7D2FE] border-[#4F46E5] text-[#312E81]\",\n    blue_gray: \"bg-[#CBD5E1] border-[#64748B] text-[#0F172A]\",\n    stone: \"bg-[#D6D3D1] border-[#78716C] text-[#1C1917]\",\n    red_dark: \"bg-[#FECACA] border-[#B91C1C] text-[#7F1D1D]\",\n    orange_dark: \"bg-[#FED7AA] border-[#C2410C] text-[#7C2D12]\",\n    yellow_dark: \"bg-[#FEF08A] border-[#A16207] text-[#713F12]\",\n    // Default fallback\n    free: \"bg-white border-dashed border-slate-300 text-slate-400\", \n  };\n\n  const baseColor = colorClasses[item.color || 'blue'] || colorClasses.blue;\n\n  if (item.customer === \"FREE_SLOT\") {\n      return (\n          <div className=\"w-full mb-1 rounded-lg border-2 border-dashed border-slate-300 bg-slate-50/50 p-2 flex items-center justify-center text-xs text-slate-400 font-medium select-none\">\n              <Clock className=\"w-3 h-3 mr-1.5 opacity-50\" />\n              {item.duration}hrs Free\n          </div>\n      );\n  }\n\n  return (\n    <ContextMenu>\n        <ContextMenuTrigger>\n            <div\n            ref={setNodeRef}\n            style={style}\n            {...attributes}\n            {...listeners}\n            onDoubleClick={(e) => {\n                e.stopPropagation();\n                onEdit(item);\n            }}\n            onClick={(e) => {\n                if (e.shiftKey && onToggleSelection) {\n                    e.stopPropagation();\n                    onToggleSelection(item.id, true);\n                } else if (onToggleSelection) {\n                    // onToggleSelection(item.id, false);\n                }\n            }}\n            className={cn(\n                \"group relative rounded-lg border shadow-sm cursor-grab active:cursor-grabbing transition-all select-none overflow-hidden\",\n                isSelected ? \"ring-2 ring-black ring-inset z-20 border-transparent\" : \"\",\n                \"w-full mb-1\", // Jobs always take full width (100%)\n                \"bg-white border-l-4\",\n                // Map color classes dynamically or fallback to a default border\n                item.color && colorClasses[item.color] ? colorClasses[item.color].replace('bg-', 'border-l-').split(' ')[1] : 'border-l-blue-500'\n            )}\n            >\n            {/* Top Row: Customer | Site | Onsite Time */}\n            <div className={cn(\"px-1.5 py-1 text-[10px] font-bold flex justify-between items-center bg-opacity-30\", baseColor.split(' ')[0])}>\n                <div className=\"flex items-center gap-1 truncate max-w-[90%] min-w-0\">\n                    <span className=\"truncate shrink-1\">{item.customer}</span>\n                    <span className=\"opacity-50\">|</span>\n                    <span className=\"flex items-center gap-1 font-mono\">\n                        <Clock className=\"w-2.5 h-2.5\" />\n                        {item.startTime && <span className=\"opacity-75\">{item.startTime} -</span>}\n                        {item.onsiteTime || \"TBC\"}\n                        {item.projectManager && <span className=\"ml-1 text-slate-500 opacity-75 font-sans font-semibold\">({item.projectManager})</span>}\n                    </span>\n                </div>\n                \n                <div className=\"flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity\" onPointerDown={(e) => e.stopPropagation()}>\n                <DropdownMenu>\n                    <DropdownMenuTrigger asChild>\n                    <Button variant=\"ghost\" size=\"icon\" className=\"h-4 w-4 p-0 hover:bg-black/10 text-current\">\n                        <MoreHorizontal className=\"h-3 w-3\" />\n                    </Button>\n                    </DropdownMenuTrigger>\n                    <DropdownMenuContent align=\"end\" className=\"w-48\">\n                    {!isReadOnly && (\n                        <>\n                        <DropdownMenuItem onClick={() => onEdit(item)}>\n                            <Edit className=\"w-3 h-3 mr-2\" /> Edit\n                        </DropdownMenuItem>\n                        \n                        <DropdownMenuSub>\n                            <DropdownMenuSubTrigger>\n                                <Copy className=\"w-3 h-3 mr-2\" /> Duplicate\n                            </DropdownMenuSubTrigger>\n                            <DropdownMenuSubContent className=\"w-48\">\n                                <DropdownMenuItem onClick={() => onDuplicate(item, 'single')}>\n                                    Duplicate Single\n                                </DropdownMenuItem>\n                                <DropdownMenuItem onClick={() => onDuplicate(item, 'custom', 5)}>\n                                    <CalendarDays className=\"w-3 h-3 mr-2\" /> Next 5 Days\n                                </DropdownMenuItem>\n                                <DropdownMenuItem onClick={() => onDuplicate(item, 'week')}>\n                                    <CalendarRange className=\"w-3 h-3 mr-2\" /> Remainder of Week\n                                </DropdownMenuItem>\n                                <DropdownMenuItem onClick={() => onDuplicate(item, 'following_week')}>\n                                    <CalendarRange className=\"w-3 h-3 mr-2\" /> Following Week\n                                </DropdownMenuItem>\n                                <DropdownMenuSeparator />\n                                <DropdownMenuItem onClick={() => onDuplicate(item, 'remainder_month')}>\n                                    <CalendarRange className=\"w-3 h-3 mr-2\" /> Remainder of Month\n                                </DropdownMenuItem>\n                                <DropdownMenuItem onClick={() => onDuplicate(item, 'remainder_year')}>\n                                    <CalendarRange className=\"w-3 h-3 mr-2\" /> Remainder of Year\n                                </DropdownMenuItem>\n                                <DropdownMenuItem onClick={() => onDuplicate(item, 'next_2_months')}>\n                                    <CalendarRange className=\"w-3 h-3 mr-2\" /> Next 2 Months\n                                </DropdownMenuItem>\n                                <DropdownMenuItem onClick={() => onDuplicate(item, 'next_3_months')}>\n                                    <CalendarRange className=\"w-3 h-3 mr-2\" /> Next 3 Months\n                                </DropdownMenuItem>\n                                <DropdownMenuItem onClick={() => onDuplicate(item, 'next_4_months')}>\n                                    <CalendarRange className=\"w-3 h-3 mr-2\" /> Next 4 Months\n                                </DropdownMenuItem>\n                                <DropdownMenuItem onClick={() => onDuplicate(item, 'next_5_months')}>\n                                    <CalendarRange className=\"w-3 h-3 mr-2\" /> Next 5 Months\n                                </DropdownMenuItem>\n                                <DropdownMenuItem onClick={() => onDuplicate(item, 'next_6_months')}>\n                                    <CalendarRange className=\"w-3 h-3 mr-2\" /> Next 6 Months\n                                </DropdownMenuItem>\n                            </DropdownMenuSubContent>\n                        </DropdownMenuSub>\n\n                        <DropdownMenuSeparator />\n                        \n                        <DropdownMenuSub>\n                            <DropdownMenuSubTrigger className=\"text-red-600\">\n                                <Trash2 className=\"w-3 h-3 mr-2\" /> Delete\n                            </DropdownMenuSubTrigger>\n                            <DropdownMenuSubContent className=\"w-48\">\n                                <DropdownMenuItem onClick={() => onDelete(item.id, 'single')} className=\"text-red-600\">\n                                    Delete Single\n                                </DropdownMenuItem>\n                                <DropdownMenuItem onClick={() => onDelete(item.id, 'week')} className=\"text-red-600\">\n                                    <CalendarRange className=\"w-3 h-3 mr-2\" /> Remainder of Week\n                                </DropdownMenuItem>\n                                <DropdownMenuSeparator />\n                                <DropdownMenuItem onClick={() => onDelete(item.id, 'remainder_month')} className=\"text-red-600\">\n                                    <CalendarRange className=\"w-3 h-3 mr-2\" /> Remainder of Month\n                                </DropdownMenuItem>\n                                <DropdownMenuItem onClick={() => onDelete(item.id, 'remainder_year')} className=\"text-red-600\">\n                                    <CalendarRange className=\"w-3 h-3 mr-2\" /> Remainder of Year\n                                </DropdownMenuItem>\n                                <DropdownMenuItem onClick={() => onDelete(item.id, 'next_2_months')} className=\"text-red-600\">\n                                    <CalendarRange className=\"w-3 h-3 mr-2\" /> Next 2 Months\n                                </DropdownMenuItem>\n                                <DropdownMenuItem onClick={() => onDelete(item.id, 'next_3_months')} className=\"text-red-600\">\n                                    <CalendarRange className=\"w-3 h-3 mr-2\" /> Next 3 Months\n                                </DropdownMenuItem>\n                                <DropdownMenuItem onClick={() => onDelete(item.id, 'next_4_months')} className=\"text-red-600\">\n                                    <CalendarRange className=\"w-3 h-3 mr-2\" /> Next 4 Months\n                                </DropdownMenuItem>\n                                <DropdownMenuItem onClick={() => onDelete(item.id, 'next_5_months')} className=\"text-red-600\">\n                                    <CalendarRange className=\"w-3 h-3 mr-2\" /> Next 5 Months\n                                </DropdownMenuItem>\n                                <DropdownMenuItem onClick={() => onDelete(item.id, 'next_6_months')} className=\"text-red-600\">\n                                    <CalendarRange className=\"w-3 h-3 mr-2\" /> Next 6 Months\n                                </DropdownMenuItem>\n                            </DropdownMenuSubContent>\n                        </DropdownMenuSub>\n                        </>\n                    )}\n                    {isReadOnly && (\n                        <DropdownMenuItem disabled className=\"text-xs text-slate-400\">\n                            Read Only Mode\n                        </DropdownMenuItem>\n                    )}\n                    </DropdownMenuContent>\n                </DropdownMenu>\n                </div>\n            </div>\n\n            {/* Bottom Row: Job Number | Address */}\n            <div className=\"p-2 space-y-1 bg-white flex items-center gap-2\">\n                {/* Compact Job Number */}\n                <div className=\"flex items-center gap-1 shrink-0\">\n                     <span className=\"text-[9px] font-bold bg-slate-100 px-1 py-0.5 rounded text-slate-600 border border-slate-200\">\n                        {item.jobNumber || \"NO REF\"}\n                     </span>\n                     {/* Explicit Duration Badge */}\n                     <span className=\"text-[9px] font-semibold bg-blue-50 px-1 py-0.5 rounded text-blue-600 border border-blue-100\">\n                        {item.duration}h\n                     </span>\n                </div>\n\n                <div className=\"flex items-center gap-1 min-w-0 flex-1\">\n                    <MapPin className=\"w-3 h-3 text-slate-400 shrink-0 mt-0.5\" />\n                    <span className=\"break-words whitespace-normal leading-tight text-[10px] text-slate-600 line-clamp-2\">{item.address}</span>\n                </div>\n            </div>\n            </div>\n        </ContextMenuTrigger>\n        <ContextMenuContent className=\"w-48\">\n            {!isReadOnly && (\n                <>\n                <ContextMenuItem onClick={() => onEdit(item)}>\n                    <Edit className=\"w-3 h-3 mr-2\" /> Edit\n                </ContextMenuItem>\n                \n                <ContextMenuSub>\n                    <ContextMenuSubTrigger>\n                        <Copy className=\"w-3 h-3 mr-2\" /> Duplicate\n                    </ContextMenuSubTrigger>\n                    <ContextMenuSubContent className=\"w-48\">\n                        <ContextMenuItem onClick={() => onDuplicate(item, 'single')}>\n                            Duplicate Single\n                        </ContextMenuItem>\n                        <ContextMenuItem onClick={() => onDuplicate(item, 'custom', 5)}>\n                            <CalendarDays className=\"w-3 h-3 mr-2\" /> Next 5 Days\n                        </ContextMenuItem>\n                        <ContextMenuItem onClick={() => onDuplicate(item, 'week')}>\n                            <CalendarRange className=\"w-3 h-3 mr-2\" /> Remainder of Week\n                        </ContextMenuItem>\n                        <ContextMenuItem onClick={() => onDuplicate(item, 'following_week')}>\n                            <CalendarRange className=\"w-3 h-3 mr-2\" /> Following Week\n                        </ContextMenuItem>\n                        <ContextMenuSeparator />\n                        <ContextMenuItem onClick={() => onDuplicate(item, 'remainder_month')}>\n                            <CalendarRange className=\"w-3 h-3 mr-2\" /> Remainder of Month\n                        </ContextMenuItem>\n                        <ContextMenuItem onClick={() => onDuplicate(item, 'remainder_year')}>\n                            <CalendarRange className=\"w-3 h-3 mr-2\" /> Remainder of Year\n                        </ContextMenuItem>\n                        <ContextMenuItem onClick={() => onDuplicate(item, 'next_2_months')}>\n                            <CalendarRange className=\"w-3 h-3 mr-2\" /> Next 2 Months\n                        </ContextMenuItem>\n                        <ContextMenuItem onClick={() => onDuplicate(item, 'next_3_months')}>\n                            <CalendarRange className=\"w-3 h-3 mr-2\" /> Next 3 Months\n                        </ContextMenuItem>\n                        <ContextMenuItem onClick={() => onDuplicate(item, 'next_4_months')}>\n                            <CalendarRange className=\"w-3 h-3 mr-2\" /> Next 4 Months\n                        </ContextMenuItem>\n                        <ContextMenuItem onClick={() => onDuplicate(item, 'next_5_months')}>\n                            <CalendarRange className=\"w-3 h-3 mr-2\" /> Next 5 Months\n                        </ContextMenuItem>\n                        <ContextMenuItem onClick={() => onDuplicate(item, 'next_6_months')}>\n                            <CalendarRange className=\"w-3 h-3 mr-2\" /> Next 6 Months\n                        </ContextMenuItem>\n                    </ContextMenuSubContent>\n                </ContextMenuSub>\n\n                <ContextMenuSeparator />\n\n                <ContextMenuSub>\n                    <ContextMenuSubTrigger className=\"text-red-600\">\n                        <Trash2 className=\"w-3 h-3 mr-2\" /> Delete\n                    </ContextMenuSubTrigger>\n                    <ContextMenuSubContent className=\"w-48\">\n                        <ContextMenuItem onClick={() => onDelete(item.id, 'single')} className=\"text-red-600\">\n                            Delete Single\n                        </ContextMenuItem>\n                        <ContextMenuItem onClick={() => onDelete(item.id, 'week')} className=\"text-red-600\">\n                            <CalendarRange className=\"w-3 h-3 mr-2\" /> Remainder of Week\n                        </ContextMenuItem>\n                        <ContextMenuSeparator />\n                        <ContextMenuItem onClick={() => onDelete(item.id, 'remainder_month')} className=\"text-red-600\">\n                            <CalendarRange className=\"w-3 h-3 mr-2\" /> Remainder of Month\n                        </ContextMenuItem>\n                        <ContextMenuItem onClick={() => onDelete(item.id, 'remainder_year')} className=\"text-red-600\">\n                            <CalendarRange className=\"w-3 h-3 mr-2\" /> Remainder of Year\n                        </ContextMenuItem>\n                        <ContextMenuItem onClick={() => onDelete(item.id, 'next_2_months')} className=\"text-red-600\">\n                            <CalendarRange className=\"w-3 h-3 mr-2\" /> Next 2 Months\n                        </ContextMenuItem>\n                        <ContextMenuItem onClick={() => onDelete(item.id, 'next_3_months')} className=\"text-red-600\">\n                            <CalendarRange className=\"w-3 h-3 mr-2\" /> Next 3 Months\n                        </ContextMenuItem>\n                        <ContextMenuItem onClick={() => onDelete(item.id, 'next_4_months')} className=\"text-red-600\">\n                            <CalendarRange className=\"w-3 h-3 mr-2\" /> Next 4 Months\n                        </ContextMenuItem>\n                        <ContextMenuItem onClick={() => onDelete(item.id, 'next_5_months')} className=\"text-red-600\">\n                            <CalendarRange className=\"w-3 h-3 mr-2\" /> Next 5 Months\n                        </ContextMenuItem>\n                        <ContextMenuItem onClick={() => onDelete(item.id, 'next_6_months')} className=\"text-red-600\">\n                            <CalendarRange className=\"w-3 h-3 mr-2\" /> Next 6 Months\n                        </ContextMenuItem>\n                    </ContextMenuSubContent>\n                </ContextMenuSub>\n                </>\n            )}\n            {isReadOnly && (\n                <ContextMenuItem disabled className=\"text-xs text-slate-400\">\n                    Read Only Mode\n                </ContextMenuItem>\n            )}\n        </ContextMenuContent>\n    </ContextMenu>\n  );\n}\n","path":null,"size_bytes":20485,"size_tokens":null},"client/src/components/ui/avatar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","path":null,"size_bytes":1419,"size_tokens":null},"client/src/components/ui/spinner.tsx":{"content":"import { Loader2Icon } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction Spinner({ className, ...props }: React.ComponentProps<\"svg\">) {\n  return (\n    <Loader2Icon\n      role=\"status\"\n      aria-label=\"Loading\"\n      className={cn(\"size-4 animate-spin\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Spinner }\n","path":null,"size_bytes":331,"size_tokens":null},"client/src/components/ui/collapsible.tsx":{"content":"\"use client\"\n\nimport * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","path":null,"size_bytes":329,"size_tokens":null},"client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center gap-2 rounded-md text-sm font-medium transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent shadow-sm hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-9 px-2 min-w-9\",\n        sm: \"h-8 px-1.5 min-w-8\",\n        lg: \"h-10 px-2.5 min-w-10\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","path":null,"size_bytes":1486,"size_tokens":null},"client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","path":null,"size_bytes":1642,"size_tokens":null},"client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border px-4 py-3 text-sm [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground [&>svg~*]:pl-7\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","path":null,"size_bytes":1598,"size_tokens":null},"server/index.ts":{"content":"import express, { type Request, Response, NextFunction } from \"express\";\nimport session from \"express-session\";\nimport connectPgSimple from \"connect-pg-simple\";\nimport { registerRoutes } from \"./routes\";\nimport { setupVite, serveStatic, log } from \"./vite\";\nimport { runMigrations, pool } from \"./db\";\nimport { runMigrations as runStripeMigrations } from 'stripe-replit-sync';\nimport { getStripeSync } from \"./stripeClient\";\nimport { WebhookHandlers } from \"./webhookHandlers\";\n\nconst app = express();\n\ndeclare module 'http' {\n  interface IncomingMessage {\n    rawBody: unknown\n  }\n}\n\nconst isProduction = process.env.NODE_ENV === 'production';\n\n// Trust proxy for production (needed for secure cookies behind reverse proxy)\nif (isProduction) {\n  app.set('trust proxy', 1);\n}\n\n// CRITICAL: Register Stripe webhook route BEFORE express.json()\n// This webhook needs raw Buffer, not parsed JSON\napp.post(\n  '/api/stripe/webhook/:uuid',\n  express.raw({ type: 'application/json' }),\n  async (req, res) => {\n    const signature = req.headers['stripe-signature'];\n\n    if (!signature) {\n      return res.status(400).json({ error: 'Missing stripe-signature' });\n    }\n\n    try {\n      const sig = Array.isArray(signature) ? signature[0] : signature;\n\n      if (!Buffer.isBuffer(req.body)) {\n        console.error('STRIPE WEBHOOK ERROR: req.body is not a Buffer');\n        return res.status(500).json({ error: 'Webhook processing error' });\n      }\n\n      const { uuid } = req.params;\n      await WebhookHandlers.processWebhook(req.body as Buffer, sig, uuid);\n\n      res.status(200).json({ received: true });\n    } catch (error: any) {\n      console.error('Webhook error:', error.message);\n      res.status(400).json({ error: 'Webhook processing error' });\n    }\n  }\n);\n\n// Configure session store\nconst PgSession = connectPgSimple(session);\nconst sessionStore = pool ? new PgSession({\n  pool: pool,\n  tableName: 'session',\n  createTableIfMissing: true,\n}) : undefined;\n\n// Session configuration\napp.use(session({\n  store: sessionStore,\n  secret: process.env.SESSION_SECRET || 'crew-scheduling-secret-key-change-in-production',\n  resave: false,\n  saveUninitialized: false,\n  cookie: {\n    secure: isProduction,\n    httpOnly: true,\n    sameSite: isProduction ? 'none' : 'lax',\n    maxAge: 1000 * 60 * 60 * 24 * 7, // 7 days\n  },\n  proxy: isProduction,\n}));\n\napp.use(express.json({\n  verify: (req, _res, buf) => {\n    req.rawBody = buf;\n  }\n}));\napp.use(express.urlencoded({ extended: false }));\n\napp.use((req, res, next) => {\n  const start = Date.now();\n  const path = req.path;\n  let capturedJsonResponse: Record<string, any> | undefined = undefined;\n\n  const originalResJson = res.json;\n  res.json = function (bodyJson, ...args) {\n    capturedJsonResponse = bodyJson;\n    return originalResJson.apply(res, [bodyJson, ...args]);\n  };\n\n  res.on(\"finish\", () => {\n    const duration = Date.now() - start;\n    if (path.startsWith(\"/api\")) {\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      if (capturedJsonResponse) {\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n      }\n\n      if (logLine.length > 80) {\n        logLine = logLine.slice(0, 79) + \"‚Ä¶\";\n      }\n\n      log(logLine);\n    }\n  });\n\n  next();\n});\n\n(async () => {\n  const server = await registerRoutes(app);\n\n  app.use((err: any, _req: Request, res: Response, _next: NextFunction) => {\n    const status = err.status || err.statusCode || 500;\n    const message = err.message || \"Internal Server Error\";\n\n    res.status(status).json({ message });\n    throw err;\n  });\n\n  // importantly only setup vite in development and after\n  // setting up all the other routes so the catch-all route\n  // doesn't interfere with the other routes\n  if (app.get(\"env\") === \"development\") {\n    await setupVite(app, server);\n  } else {\n    serveStatic(app);\n  }\n\n  // Run database migrations - non-blocking to allow health checks\n  const dbSuccess = await runMigrations();\n  if (dbSuccess) {\n    log(\"Database ready\");\n    \n    // Initialize Stripe after database is ready\n    try {\n      log(\"Initializing Stripe...\");\n      const isProduction = process.env.NODE_ENV === 'production';\n      const databaseUrl = isProduction && process.env.PRODUCTION_DATABASE_URL \n        ? process.env.PRODUCTION_DATABASE_URL \n        : process.env.DATABASE_URL!;\n      \n      await runStripeMigrations({ \n        databaseUrl\n      });\n      log(\"Stripe schema ready\");\n      \n      const stripeSync = await getStripeSync();\n      \n      // Set up managed webhook\n      const webhookBaseUrl = `https://${process.env.REPLIT_DOMAINS?.split(',')[0]}`;\n      if (webhookBaseUrl && webhookBaseUrl !== 'https://undefined') {\n        const { webhook, uuid } = await stripeSync.findOrCreateManagedWebhook(\n          `${webhookBaseUrl}/api/stripe/webhook`,\n          {\n            enabled_events: ['*'],\n            description: 'Managed webhook for Stripe sync',\n          }\n        );\n        log(`Stripe webhook configured: ${webhook.url} (UUID: ${uuid})`);\n      }\n      \n      // Sync Stripe data in background\n      stripeSync.syncBackfill()\n        .then(() => log(\"Stripe data synced\"))\n        .catch((err: any) => console.error(\"Error syncing Stripe data:\", err));\n      \n      log(\"Stripe initialized\");\n    } catch (stripeError: any) {\n      console.error(\"Failed to initialize Stripe:\", stripeError.message);\n      log(\"Stripe not available - payment features disabled\");\n    }\n  } else {\n    log(\"Database not available - running in degraded mode\");\n    log(\"API routes requiring database will return 503\");\n  }\n\n  // ALWAYS serve the app on the port specified in the environment variable PORT\n  // Other ports are firewalled. Default to 5000 if not specified.\n  // this serves both the API and the client.\n  // It is the only port that is not firewalled.\n  const port = parseInt(process.env.PORT || '5000', 10);\n  server.listen({\n    port,\n    host: \"0.0.0.0\",\n    reusePort: true,\n  }, () => {\n    log(`serving on port ${port}`);\n  });\n})();\n","path":null,"size_bytes":6022,"size_tokens":null},"client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-10 px-2 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\n      \"p-2 align-middle [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]\",\n      className\n    )}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","path":null,"size_bytes":2859,"size_tokens":null},"client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","path":null,"size_bytes":6210,"size_tokens":null},"client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","path":null,"size_bytes":768,"size_tokens":null},"client/src/components/ui/sonner.tsx":{"content":"\"use client\"\n\nimport { useTheme } from \"next-themes\"\nimport { Toaster as Sonner } from \"sonner\"\n\ntype ToasterProps = React.ComponentProps<typeof Sonner>\n\nconst Toaster = ({ ...props }: ToasterProps) => {\n  const { theme = \"system\" } = useTheme()\n\n  return (\n    <Sonner\n      theme={theme as ToasterProps[\"theme\"]}\n      className=\"toaster group\"\n      toastOptions={{\n        classNames: {\n          toast:\n            \"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg\",\n          description: \"group-[.toast]:text-muted-foreground\",\n          actionButton:\n            \"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground\",\n          cancelButton:\n            \"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground\",\n        },\n      }}\n      {...props}\n    />\n  )\n}\n\nexport { Toaster }\n","path":null,"size_bytes":894,"size_tokens":null},"client/src/components/schedule/SmartSearchModal.tsx":{"content":"import { useState, useMemo } from \"react\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Search, MapPin, Clock, ArrowRight, CheckCircle2, Truck } from \"lucide-react\";\nimport { format, addDays, startOfToday, isSameDay, startOfDay } from \"date-fns\";\nimport { cn } from \"@/lib/utils\";\nimport { ScheduleItem, Crew } from \"./CalendarGrid\";\n\ninterface SmartSearchModalProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  items: ScheduleItem[];\n  crews: Crew[];\n  depots: { id: string; name: string; address: string }[];\n  vehicles: { id: string; name: string; vehicleType: string }[];\n  vehicleTypes?: string[];\n  colorLabels: Record<string, string>;\n  onBookSlot: (date: Date, crewId: string, depotId: string, duration: number, color: string) => void;\n}\n\nexport function SmartSearchModal({ \n  open, onOpenChange, items, crews, depots, vehicles, vehicleTypes, colorLabels, onBookSlot \n}: SmartSearchModalProps) {\n  const [vehicleType, setVehicleType] = useState(\"any\");\n  const [shiftType, setShiftType] = useState<'any' | 'day' | 'night'>(\"any\");\n  const [duration, setDuration] = useState(\"8\");\n  const [location, setLocation] = useState(\"all\");\n  const [jobPostcode, setJobPostcode] = useState(\"\");\n  const [results, setResults] = useState<any[] | null>(null);\n  const [isSearching, setIsSearching] = useState(false);\n\n  // Extract unique vehicle types or use provided types\n  const availableVehicleTypes = useMemo(() => {\n      if (vehicleTypes && vehicleTypes.length > 0) return vehicleTypes;\n      const types = new Set(vehicles.map(v => v.vehicleType).filter(Boolean));\n      return Array.from(types).sort();\n  }, [vehicles, vehicleTypes]);\n\n  const handleSearch = () => {\n    setIsSearching(true);\n    setResults(null);\n\n    // Simulate API delay\n    setTimeout(() => {\n      const reqDuration = parseInt(duration) || 8;\n      const today = startOfToday();\n      const searchResults: any[] = [];\n\n      // Iterate through next 60 days (increased from 30 to catch next month)\n      // Start from start of week if user expects to see current week's past days? \n      // No, \"Availability Search\" usually implies future booking. \n      // But we'll ensure we check 'today' properly.\n      for (let i = 0; i < 60; i++) {\n        const date = addDays(today, i);\n        \n        // Iterate through all depots\n        depots.forEach(depot => {\n          // Location Filter Check\n          // IMPORTANT: If location is empty string or \"all\", we search ALL depots.\n          if (location !== \"all\" && depot.id !== location) {\n              return;\n          }\n          \n          // Mock Distance Calculation (if postcode provided)\n          // In a real app, this would use a mapping service\n          let distance = 0;\n          if (jobPostcode.trim()) {\n             // Generate a deterministic \"mock\" distance based on depot ID and postcode length\n             // so it doesn't change on every search for the same inputs\n             const hash = (depot.id.charCodeAt(0) + jobPostcode.length) % 50;\n             distance = hash + 5; // 5 to 55 miles\n          }\n\n          crews.forEach(crew => {\n             // STRICT CHECK: Crew must belong to this depot\n             // If crew has no depotId, we assume it belongs to 'd1' (legacy default)\n             const crewDepotId = crew.depotId || 'd1';\n             if (crewDepotId !== depot.id) return;\n\n             // Check Shift\n             if (shiftType !== 'any' && crew.shift !== shiftType) return;\n\n             // 1. Check what vehicle this crew has on this specific day\n             // Find operative items for this crew/date to see assigned vehicle\n             const operativeItem = items.find(item => \n                item.type === 'operative' && \n                item.crewId === crew.id && \n                isSameDay(new Date(item.date), date) &&\n                item.vehicleId // Must have a vehicle\n             );\n\n             let hasCorrectVehicle = false;\n             let isPotential = false;\n             \n             // STRICTER SEARCH:\n             // If the crew has NO operative assigned for this day, we treat it as \"Unavailable/Not Working\".\n             // This prevents \"Ghost/Empty Crews\" from showing up as available slots, which confuses users\n             // who have deleted their staff but kept the crew names.\n             if (!operativeItem) {\n                 return;\n             }\n             \n             if (vehicleType === 'any') {\n                 hasCorrectVehicle = true;\n             } else if (operativeItem && operativeItem.vehicleId) {\n                 // Crew has an operative with a vehicle. Does it match?\n                 const vehicle = vehicles.find(v => v.id === operativeItem.vehicleId);\n                 if (vehicle && vehicle.vehicleType === vehicleType) {\n                     hasCorrectVehicle = true;\n                 }\n             }\n\n             // If we are searching for a specific vehicle type, and the crew does NOT have it assigned today,\n             // then we filter it out.\n             if (vehicleType !== 'any' && !hasCorrectVehicle) {\n                 return; \n             }\n\n             // 2. Check availability / free time\n             // Normalize query date to start of day for robust comparison\n             const queryDateStart = startOfDay(date);\n             \n             const dayItems = items.filter(item => \n                item.type === 'job' && \n                item.crewId === crew.id && \n                isSameDay(startOfDay(new Date(item.date)), queryDateStart)\n             );\n             \n             // Check if working at this depot (if they have jobs)\n             const workingDepotId = dayItems.length > 0 ? dayItems[0].depotId : null;\n             // If they have jobs at a different depot, they are not available at this depot\n             // UNLESS the job is at the requested depot?\n             // The logic here says: if they are working at Depot B, they can't take a job at Depot A.\n             if (workingDepotId && workingDepotId !== depot.id) {\n                 return; // Working elsewhere\n             }\n\n             // Calculate used time (excluding free slots)\n             const realWorkItems = dayItems.filter(i => i.customer !== 'FREE_SLOT');\n             const realUsedDuration = realWorkItems.reduce((acc, item) => acc + (Number(item.duration) || 0), 0);\n             \n             const freeSpace = 8 - realUsedDuration;\n\n             if (freeSpace >= reqDuration) {\n               // Match!\n               \n               // Determine displayed vehicle type\n               let displayVehicle = vehicleType === 'any' ? \"Unassigned\" : vehicleType;\n               \n               if (operativeItem && operativeItem.vehicleId) {\n                   const v = vehicles.find(x => x.id === operativeItem.vehicleId);\n                   if (v) displayVehicle = v.vehicleType;\n               } else if (isPotential) {\n                   displayVehicle = `${vehicleType} (Unassigned)`;\n               }\n\n               searchResults.push({\n                 date,\n                 depot,\n                 crew,\n                 freeSpace,\n                 vehicleType: displayVehicle,\n                 isPotential,\n                 distance // Add distance to result\n               });\n             }\n          });\n        });\n      }\n\n      // Deduplicate results\n      const uniqueKeys = new Set();\n      const uniqueResults = searchResults.filter(res => {\n          const key = `${res.date.toISOString()}-${res.crew.id}-${res.depot.id}`;\n          if (uniqueKeys.has(key)) return false;\n          uniqueKeys.add(key);\n          return true;\n      });\n\n      // Sort results\n      uniqueResults.sort((a, b) => {\n          // 1. Sort by Distance (if provided) - Nearest first\n          if (jobPostcode.trim()) {\n              if (a.distance !== b.distance) return a.distance - b.distance;\n          }\n          \n          // 2. Sort by Date\n          if (a.date.getTime() !== b.date.getTime()) return a.date.getTime() - b.date.getTime();\n          \n          // 3. Sort by Free Space (Most available first)\n          return b.freeSpace - a.freeSpace;\n      });\n\n      setResults(uniqueResults.slice(0, 100));\n      setIsSearching(false);\n    }, 800);\n  };\n\n  const handleBook = (res: any) => {\n      onBookSlot(res.date, res.crew.id, res.depot.id, parseInt(duration), \"blue\");\n      onOpenChange(false);\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"sm:max-w-[700px] bg-white text-slate-900 max-h-[85vh] overflow-hidden flex flex-col\">\n        <DialogHeader>\n          <DialogTitle className=\"flex items-center gap-2 text-xl\">\n            <Search className=\"w-6 h-6 text-blue-600\" />\n            Availability Search\n          </DialogTitle>\n        </DialogHeader>\n\n        <div className=\"flex-1 overflow-hidden flex flex-col gap-4 py-4\">\n            {/* Search Form */}\n            <div className=\"grid grid-cols-1 sm:grid-cols-3 gap-4 p-4 bg-slate-50 rounded-xl border border-slate-100 shrink-0\">\n                <div className=\"space-y-2\">\n                    <Label>Vehicle / Resource Type</Label>\n                    <Select value={vehicleType} onValueChange={setVehicleType}>\n                        <SelectTrigger className=\"bg-white\">\n                            <SelectValue />\n                        </SelectTrigger>\n                        <SelectContent>\n                           <SelectItem value=\"any\">Any Vehicle</SelectItem>\n                           {availableVehicleTypes.map((type) => (\n                               <SelectItem key={type} value={type}>\n                                   <div className=\"flex items-center gap-2\">\n                                       <Truck className=\"w-4 h-4 text-slate-500\" />\n                                       {type}\n                                   </div>\n                               </SelectItem>\n                           ))}\n                        </SelectContent>\n                    </Select>\n                </div>\n\n                <div className=\"space-y-2\">\n                    <Label>Shift</Label>\n                    <Select value={shiftType} onValueChange={(v) => setShiftType(v as any)}>\n                        <SelectTrigger className=\"bg-white\">\n                            <SelectValue />\n                        </SelectTrigger>\n                        <SelectContent>\n                           <SelectItem value=\"any\">Any Shift</SelectItem>\n                           <SelectItem value=\"day\">Day Shift</SelectItem>\n                           <SelectItem value=\"night\">Night Shift</SelectItem>\n                        </SelectContent>\n                    </Select>\n                </div>\n\n                <div className=\"space-y-2\">\n                    <Label>Job Postcode / Address</Label>\n                    <div className=\"relative\">\n                        <Input \n                            value={jobPostcode} \n                            onChange={(e) => setJobPostcode(e.target.value)}\n                            className=\"pl-9 bg-white\"\n                            placeholder=\"e.g. SW1A 1AA\"\n                        />\n                        <MapPin className=\"w-4 h-4 absolute left-3 top-3 text-slate-400\" />\n                    </div>\n                </div>\n\n                <div className=\"space-y-2\">\n                    <Label>Duration Required</Label>\n                    <div className=\"relative\">\n                        <Input \n                            type=\"number\" \n                            value={duration} \n                            onChange={(e) => setDuration(e.target.value)}\n                            className=\"pl-9 bg-white\"\n                            min=\"1\" max=\"8\"\n                        />\n                        <Clock className=\"w-4 h-4 absolute left-3 top-3 text-slate-400\" />\n                        <span className=\"absolute right-3 top-2.5 text-xs text-slate-500\">hrs</span>\n                    </div>\n                </div>\n\n                <div className=\"space-y-2\">\n                    <Label>Location</Label>\n                    <Select value={location} onValueChange={setLocation}>\n                        <SelectTrigger className=\"bg-white\">\n                            <SelectValue placeholder=\"All Depots\" />\n                        </SelectTrigger>\n                        <SelectContent>\n                           <SelectItem value=\"all\">All Depots</SelectItem>\n                           {depots.map((depot) => (\n                               <SelectItem key={depot.id} value={depot.id}>\n                                   <div className=\"flex items-center gap-2\">\n                                       <MapPin className=\"w-4 h-4 text-slate-500\" />\n                                       {depot.name}\n                                   </div>\n                               </SelectItem>\n                           ))}\n                        </SelectContent>\n                    </Select>\n                </div>\n\n                <div className=\"col-span-1 sm:col-span-3\">\n                    <Button \n                        onClick={handleSearch} \n                        className=\"w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold h-10\"\n                        disabled={isSearching}\n                    >\n                        {isSearching ? \"Searching Network...\" : \"Find Earliest Availability\"}\n                    </Button>\n                </div>\n            </div>\n\n            {/* Results Area */}\n            <div className=\"flex-1 overflow-y-auto min-h-[300px] rounded-xl border border-slate-100 bg-slate-50/50 p-2\">\n                {!results && !isSearching && (\n                    <div className=\"h-full flex flex-col items-center justify-center text-slate-400 p-8\">\n                        <Search className=\"w-12 h-12 mb-3 opacity-20\" />\n                        <p>Search for earliest availability by vehicle type</p>\n                    </div>\n                )}\n\n                {isSearching && (\n                    <div className=\"h-full flex flex-col items-center justify-center text-blue-600 p-8\">\n                        <div className=\"animate-spin w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full mb-3\"></div>\n                        <p className=\"font-medium\">Checking schedule across {depots.length} depots...</p>\n                    </div>\n                )}\n\n                {results && results.length === 0 && (\n                    <div className=\"h-full flex flex-col items-center justify-center text-slate-500 p-8\">\n                        <p>No slots found matching your criteria.</p>\n                        <Button variant=\"link\" onClick={() => setDuration(\"4\")}>Try shorter duration?</Button>\n                    </div>\n                )}\n\n\n                {results && results.length > 0 && (\n                    <div className=\"space-y-6\">\n                        <div className=\"flex items-center justify-between px-2 pb-2\">\n                            <h3 className=\"text-sm font-semibold text-slate-500 uppercase tracking-wider\">Earliest Available Slots</h3>\n                            <span className=\"text-xs text-slate-400\">{results.length} options found</span>\n                        </div>\n                        \n                        {/* Group by Date */}\n                        {Array.from(new Set(results.map(r => r.date.toISOString()))).map((dateStr) => {\n                            const dateResults = results.filter(r => r.date.toISOString() === dateStr);\n                            const date = new Date(dateStr);\n                            \n                            return (\n                                <div key={dateStr} className=\"space-y-2\">\n                                    <div className=\"sticky top-0 z-10 bg-slate-50/95 backdrop-blur px-2 py-2 border-b border-slate-200 flex items-center gap-2\">\n                                        <span className=\"font-bold text-slate-900\">{format(date, 'EEEE, d MMMM')}</span>\n                                        <span className=\"text-xs bg-slate-200 text-slate-600 px-2 py-0.5 rounded-full\">{dateResults.length} slots</span>\n                                    </div>\n\n                                    <div className=\"grid gap-2\">\n                                        {dateResults.map((res, idx) => (\n                                            <div key={`${dateStr}-${idx}`} className=\"bg-white p-3 rounded-lg border border-slate-200 shadow-sm hover:border-blue-300 transition-all group\">\n                                                <div className=\"flex items-center justify-between\">\n                                                    <div className=\"flex items-center gap-4\">\n                                                        <div className=\"w-12 h-12 bg-blue-50 rounded-lg flex flex-col items-center justify-center border border-blue-100 text-blue-700 shrink-0\">\n                                                            <Clock className=\"w-5 h-5 mb-1\" />\n                                                            <span className=\"text-[10px] font-bold leading-none\">{res.freeSpace}h</span>\n                                                        </div>\n                                                        \n                                                        <div>\n                                                            <div className=\"flex items-center gap-2\">\n                                                                <h4 className=\"font-semibold text-slate-900\">{res.depot.name}</h4>\n                                                                {res.distance > 0 && (\n                                                                    <span className=\"text-xs bg-blue-50 text-blue-700 px-2 py-0.5 rounded-full border border-blue-100 font-medium\">\n                                                                        {res.distance} miles away\n                                                                    </span>\n                                                                )}\n                                                                <span className={cn(\n                                                                    \"text-xs px-2 py-0.5 rounded-full font-medium flex items-center border\",\n                                                                    res.isPotential \n                                                                        ? \"bg-amber-50 text-amber-700 border-amber-200 border-dashed\" \n                                                                        : \"bg-slate-100 text-slate-600 border-slate-200\"\n                                                                )}>\n                                                                    <Truck className=\"w-3 h-3 mr-1\" /> {res.vehicleType}\n                                                                </span>\n                                                            </div>\n                                                            <div className=\"text-xs text-slate-500 mt-1 flex items-center gap-3\">\n                                                                <span className=\"flex items-center\"><CheckCircle2 className=\"w-3 h-3 mr-1\" /> {res.crew.name}</span>\n                                                                {res.isPotential && <span className=\"text-amber-600 font-medium\">Needs Vehicle Assignment</span>}\n                                                            </div>\n                                                        </div>\n                                                    </div>\n\n                                                    <Button \n                                                        onClick={() => handleBook(res)}\n                                                        className=\"opacity-0 group-hover:opacity-100 transition-opacity bg-blue-600 hover:bg-blue-700 text-white\"\n                                                        size=\"sm\"\n                                                    >\n                                                        Book <ArrowRight className=\"w-4 h-4 ml-2\" />\n                                                    </Button>\n                                                </div>\n                                            </div>\n                                        ))}\n                                    </div>\n                                </div>\n                            );\n                        })}\n                    </div>\n                )}\n            </div>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","path":null,"size_bytes":20954,"size_tokens":null},"client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\" +\n\" hover-elevate active-elevate-2\",\n  {\n    variants: {\n      variant: {\n        default:\n           // @replit: no hover, and add primary border\n           \"bg-primary text-primary-foreground border border-primary-border\",\n        destructive:\n          \"bg-destructive text-destructive-foreground shadow-sm border-destructive-border\",\n        outline:\n          // @replit Shows the background color of whatever card / sidebar / accent background it is inside of.\n          // Inherits the current text color. Uses shadow-xs. no shadow on active\n          // No hover state\n          \" border [border-color:var(--button-outline)] shadow-xs active:shadow-none \",\n        secondary:\n          // @replit border, no hover, no shadow, secondary border.\n          \"border bg-secondary text-secondary-foreground border border-secondary-border \",\n        // @replit no hover, transparent border\n        ghost: \"border border-transparent\",\n        link: \"text-primary underline-offset-4 hover:underline\",\n      },\n      size: {\n        // @replit changed sizes\n        default: \"min-h-9 px-4 py-2\",\n        sm: \"min-h-8 rounded-md px-3 text-xs\",\n        lg: \"min-h-10 rounded-md px-8\",\n        icon: \"h-9 w-9\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","path":null,"size_bytes":2356,"size_tokens":null},"client/src/hooks/use-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","path":null,"size_bytes":565,"size_tokens":null},"client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-primary/10\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","path":null,"size_bytes":266,"size_tokens":null},"client/src/pages/not-found.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { AlertCircle } from \"lucide-react\";\n\nexport default function NotFound() {\n  return (\n    <div className=\"min-h-screen w-full flex items-center justify-center bg-gray-50\">\n      <Card className=\"w-full max-w-md mx-4\">\n        <CardContent className=\"pt-6\">\n          <div className=\"flex mb-4 gap-2\">\n            <AlertCircle className=\"h-8 w-8 text-red-500\" />\n            <h1 className=\"text-2xl font-bold text-gray-900\">404 Page Not Found</h1>\n          </div>\n\n          <p className=\"mt-4 text-sm text-gray-600\">\n            Did you forget to add the page to the router?\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":711,"size_tokens":null},"client/src/components/ui/empty.tsx":{"content":"import { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction Empty({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"empty\"\n      className={cn(\n        \"flex min-w-0 flex-1 flex-col items-center justify-center gap-6 text-balance rounded-lg border-dashed p-6 text-center md:p-12\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction EmptyHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"empty-header\"\n      className={cn(\n        \"flex max-w-sm flex-col items-center gap-2 text-center\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nconst emptyMediaVariants = cva(\n  \"mb-2 flex shrink-0 items-center justify-center [&_svg]:pointer-events-none [&_svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        icon: \"bg-muted text-foreground flex size-10 shrink-0 items-center justify-center rounded-lg [&_svg:not([class*='size-'])]:size-6\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nfunction EmptyMedia({\n  className,\n  variant = \"default\",\n  ...props\n}: React.ComponentProps<\"div\"> & VariantProps<typeof emptyMediaVariants>) {\n  return (\n    <div\n      data-slot=\"empty-icon\"\n      data-variant={variant}\n      className={cn(emptyMediaVariants({ variant, className }))}\n      {...props}\n    />\n  )\n}\n\nfunction EmptyTitle({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"empty-title\"\n      className={cn(\"text-lg font-medium tracking-tight\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction EmptyDescription({ className, ...props }: React.ComponentProps<\"p\">) {\n  return (\n    <div\n      data-slot=\"empty-description\"\n      className={cn(\n        \"text-muted-foreground [&>a:hover]:text-primary text-sm/relaxed [&>a]:underline [&>a]:underline-offset-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction EmptyContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"empty-content\"\n      className={cn(\n        \"flex w-full min-w-0 max-w-sm flex-col items-center gap-4 text-balance text-sm\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Empty,\n  EmptyHeader,\n  EmptyTitle,\n  EmptyDescription,\n  EmptyContent,\n  EmptyMedia,\n}\n","path":null,"size_bytes":2396,"size_tokens":null},"client/src/components/ui/dialog.tsx":{"content":"import * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogTrigger,\n  DialogClose,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","path":null,"size_bytes":3835,"size_tokens":null},"client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Textarea = React.forwardRef<\n  HTMLTextAreaElement,\n  React.ComponentProps<\"textarea\">\n>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        \"flex min-h-[60px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-base shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  )\n})\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","path":null,"size_bytes":649,"size_tokens":null},"postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","path":null,"size_bytes":80,"size_tokens":null},"client/src/components/ui/calendar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport {\n  ChevronDownIcon,\n  ChevronLeftIcon,\n  ChevronRightIcon,\n} from \"lucide-react\"\nimport { DayButton, DayPicker, getDefaultClassNames } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button, buttonVariants } from \"@/components/ui/button\"\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  captionLayout = \"label\",\n  buttonVariant = \"ghost\",\n  formatters,\n  components,\n  ...props\n}: React.ComponentProps<typeof DayPicker> & {\n  buttonVariant?: React.ComponentProps<typeof Button>[\"variant\"]\n}) {\n  const defaultClassNames = getDefaultClassNames()\n\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\n        \"bg-background group/calendar p-3 [--cell-size:2rem] [[data-slot=card-content]_&]:bg-transparent [[data-slot=popover-content]_&]:bg-transparent\",\n        String.raw`rtl:**:[.rdp-button\\_next>svg]:rotate-180`,\n        String.raw`rtl:**:[.rdp-button\\_previous>svg]:rotate-180`,\n        className\n      )}\n      captionLayout={captionLayout}\n      formatters={{\n        formatMonthDropdown: (date) =>\n          date.toLocaleString(\"default\", { month: \"short\" }),\n        ...formatters,\n      }}\n      classNames={{\n        root: cn(\"w-fit\", defaultClassNames.root),\n        months: cn(\n          \"relative flex flex-col gap-4 md:flex-row\",\n          defaultClassNames.months\n        ),\n        month: cn(\"flex w-full flex-col gap-4\", defaultClassNames.month),\n        nav: cn(\n          \"absolute inset-x-0 top-0 flex w-full items-center justify-between gap-1\",\n          defaultClassNames.nav\n        ),\n        button_previous: cn(\n          buttonVariants({ variant: buttonVariant }),\n          \"h-[--cell-size] w-[--cell-size] select-none p-0 aria-disabled:opacity-50\",\n          defaultClassNames.button_previous\n        ),\n        button_next: cn(\n          buttonVariants({ variant: buttonVariant }),\n          \"h-[--cell-size] w-[--cell-size] select-none p-0 aria-disabled:opacity-50\",\n          defaultClassNames.button_next\n        ),\n        month_caption: cn(\n          \"flex h-[--cell-size] w-full items-center justify-center px-[--cell-size]\",\n          defaultClassNames.month_caption\n        ),\n        dropdowns: cn(\n          \"flex h-[--cell-size] w-full items-center justify-center gap-1.5 text-sm font-medium\",\n          defaultClassNames.dropdowns\n        ),\n        dropdown_root: cn(\n          \"has-focus:border-ring border-input shadow-xs has-focus:ring-ring/50 has-focus:ring-[3px] relative rounded-md border\",\n          defaultClassNames.dropdown_root\n        ),\n        dropdown: cn(\n          \"bg-popover absolute inset-0 opacity-0\",\n          defaultClassNames.dropdown\n        ),\n        caption_label: cn(\n          \"select-none font-medium\",\n          captionLayout === \"label\"\n            ? \"text-sm\"\n            : \"[&>svg]:text-muted-foreground flex h-8 items-center gap-1 rounded-md pl-2 pr-1 text-sm [&>svg]:size-3.5\",\n          defaultClassNames.caption_label\n        ),\n        table: \"w-full border-collapse\",\n        weekdays: cn(\"flex\", defaultClassNames.weekdays),\n        weekday: cn(\n          \"text-muted-foreground flex-1 select-none rounded-md text-[0.8rem] font-normal\",\n          defaultClassNames.weekday\n        ),\n        week: cn(\"mt-2 flex w-full\", defaultClassNames.week),\n        week_number_header: cn(\n          \"w-[--cell-size] select-none\",\n          defaultClassNames.week_number_header\n        ),\n        week_number: cn(\n          \"text-muted-foreground select-none text-[0.8rem]\",\n          defaultClassNames.week_number\n        ),\n        day: cn(\n          \"group/day relative aspect-square h-full w-full select-none p-0 text-center [&:first-child[data-selected=true]_button]:rounded-l-md [&:last-child[data-selected=true]_button]:rounded-r-md\",\n          defaultClassNames.day\n        ),\n        range_start: cn(\n          \"bg-accent rounded-l-md\",\n          defaultClassNames.range_start\n        ),\n        range_middle: cn(\"rounded-none\", defaultClassNames.range_middle),\n        range_end: cn(\"bg-accent rounded-r-md\", defaultClassNames.range_end),\n        today: cn(\n          \"bg-accent text-accent-foreground rounded-md data-[selected=true]:rounded-none\",\n          defaultClassNames.today\n        ),\n        outside: cn(\n          \"text-muted-foreground aria-selected:text-muted-foreground\",\n          defaultClassNames.outside\n        ),\n        disabled: cn(\n          \"text-muted-foreground opacity-50\",\n          defaultClassNames.disabled\n        ),\n        hidden: cn(\"invisible\", defaultClassNames.hidden),\n        ...classNames,\n      }}\n      components={{\n        Root: ({ className, rootRef, ...props }) => {\n          return (\n            <div\n              data-slot=\"calendar\"\n              ref={rootRef}\n              className={cn(className)}\n              {...props}\n            />\n          )\n        },\n        Chevron: ({ className, orientation, ...props }) => {\n          if (orientation === \"left\") {\n            return (\n              <ChevronLeftIcon className={cn(\"size-4\", className)} {...props} />\n            )\n          }\n\n          if (orientation === \"right\") {\n            return (\n              <ChevronRightIcon\n                className={cn(\"size-4\", className)}\n                {...props}\n              />\n            )\n          }\n\n          return (\n            <ChevronDownIcon className={cn(\"size-4\", className)} {...props} />\n          )\n        },\n        DayButton: CalendarDayButton,\n        WeekNumber: ({ children, ...props }) => {\n          return (\n            <td {...props}>\n              <div className=\"flex size-[--cell-size] items-center justify-center text-center\">\n                {children}\n              </div>\n            </td>\n          )\n        },\n        ...components,\n      }}\n      {...props}\n    />\n  )\n}\n\nfunction CalendarDayButton({\n  className,\n  day,\n  modifiers,\n  ...props\n}: React.ComponentProps<typeof DayButton>) {\n  const defaultClassNames = getDefaultClassNames()\n\n  const ref = React.useRef<HTMLButtonElement>(null)\n  React.useEffect(() => {\n    if (modifiers.focused) ref.current?.focus()\n  }, [modifiers.focused])\n\n  return (\n    <Button\n      ref={ref}\n      variant=\"ghost\"\n      size=\"icon\"\n      data-day={day.date.toLocaleDateString()}\n      data-selected-single={\n        modifiers.selected &&\n        !modifiers.range_start &&\n        !modifiers.range_end &&\n        !modifiers.range_middle\n      }\n      data-range-start={modifiers.range_start}\n      data-range-end={modifiers.range_end}\n      data-range-middle={modifiers.range_middle}\n      className={cn(\n        \"data-[selected-single=true]:bg-primary data-[selected-single=true]:text-primary-foreground data-[range-middle=true]:bg-accent data-[range-middle=true]:text-accent-foreground data-[range-start=true]:bg-primary data-[range-start=true]:text-primary-foreground data-[range-end=true]:bg-primary data-[range-end=true]:text-primary-foreground group-data-[focused=true]/day:border-ring group-data-[focused=true]/day:ring-ring/50 flex aspect-square h-auto w-full min-w-[--cell-size] flex-col gap-1 font-normal leading-none data-[range-end=true]:rounded-md data-[range-middle=true]:rounded-none data-[range-start=true]:rounded-md group-data-[focused=true]/day:relative group-data-[focused=true]/day:z-10 group-data-[focused=true]/day:ring-[3px] [&>span]:text-xs [&>span]:opacity-70\",\n        defaultClassNames.day,\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport { Calendar, CalendarDayButton }\n","path":null,"size_bytes":7569,"size_tokens":null},"client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","path":null,"size_bytes":4419,"size_tokens":null},"client/src/components/ui/toggle-group.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","path":null,"size_bytes":1753,"size_tokens":null},"client/src/components/ui/input-group.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Textarea } from \"@/components/ui/textarea\"\n\nfunction InputGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"input-group\"\n      role=\"group\"\n      className={cn(\n        \"group/input-group border-input dark:bg-input/30 shadow-xs relative flex w-full items-center rounded-md border outline-none transition-[color,box-shadow]\",\n        \"h-9 has-[>textarea]:h-auto\",\n\n        // Variants based on alignment.\n        \"has-[>[data-align=inline-start]]:[&>input]:pl-2\",\n        \"has-[>[data-align=inline-end]]:[&>input]:pr-2\",\n        \"has-[>[data-align=block-start]]:h-auto has-[>[data-align=block-start]]:flex-col has-[>[data-align=block-start]]:[&>input]:pb-3\",\n        \"has-[>[data-align=block-end]]:h-auto has-[>[data-align=block-end]]:flex-col has-[>[data-align=block-end]]:[&>input]:pt-3\",\n\n        // Focus state.\n        \"has-[[data-slot=input-group-control]:focus-visible]:ring-ring has-[[data-slot=input-group-control]:focus-visible]:ring-1\",\n\n        // Error state.\n        \"has-[[data-slot][aria-invalid=true]]:ring-destructive/20 has-[[data-slot][aria-invalid=true]]:border-destructive dark:has-[[data-slot][aria-invalid=true]]:ring-destructive/40\",\n\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nconst inputGroupAddonVariants = cva(\n  \"text-muted-foreground flex h-auto cursor-text select-none items-center justify-center gap-2 py-1.5 text-sm font-medium group-data-[disabled=true]/input-group:opacity-50 [&>kbd]:rounded-[calc(var(--radius)-5px)] [&>svg:not([class*='size-'])]:size-4\",\n  {\n    variants: {\n      align: {\n        \"inline-start\":\n          \"order-first pl-3 has-[>button]:ml-[-0.45rem] has-[>kbd]:ml-[-0.35rem]\",\n        \"inline-end\":\n          \"order-last pr-3 has-[>button]:mr-[-0.4rem] has-[>kbd]:mr-[-0.35rem]\",\n        \"block-start\":\n          \"[.border-b]:pb-3 order-first w-full justify-start px-3 pt-3 group-has-[>input]/input-group:pt-2.5\",\n        \"block-end\":\n          \"[.border-t]:pt-3 order-last w-full justify-start px-3 pb-3 group-has-[>input]/input-group:pb-2.5\",\n      },\n    },\n    defaultVariants: {\n      align: \"inline-start\",\n    },\n  }\n)\n\nfunction InputGroupAddon({\n  className,\n  align = \"inline-start\",\n  ...props\n}: React.ComponentProps<\"div\"> & VariantProps<typeof inputGroupAddonVariants>) {\n  return (\n    <div\n      role=\"group\"\n      data-slot=\"input-group-addon\"\n      data-align={align}\n      className={cn(inputGroupAddonVariants({ align }), className)}\n      onClick={(e) => {\n        if ((e.target as HTMLElement).closest(\"button\")) {\n          return\n        }\n        e.currentTarget.parentElement?.querySelector(\"input\")?.focus()\n      }}\n      {...props}\n    />\n  )\n}\n\nconst inputGroupButtonVariants = cva(\n  \"flex items-center gap-2 text-sm shadow-none\",\n  {\n    variants: {\n      size: {\n        xs: \"h-6 gap-1 rounded-[calc(var(--radius)-5px)] px-2 has-[>svg]:px-2 [&>svg:not([class*='size-'])]:size-3.5\",\n        sm: \"h-8 gap-1.5 rounded-md px-2.5 has-[>svg]:px-2.5\",\n        \"icon-xs\":\n          \"size-6 rounded-[calc(var(--radius)-5px)] p-0 has-[>svg]:p-0\",\n        \"icon-sm\": \"size-8 p-0 has-[>svg]:p-0\",\n      },\n    },\n    defaultVariants: {\n      size: \"xs\",\n    },\n  }\n)\n\nfunction InputGroupButton({\n  className,\n  type = \"button\",\n  variant = \"ghost\",\n  size = \"xs\",\n  ...props\n}: Omit<React.ComponentProps<typeof Button>, \"size\"> &\n  VariantProps<typeof inputGroupButtonVariants>) {\n  return (\n    <Button\n      type={type}\n      data-size={size}\n      variant={variant}\n      className={cn(inputGroupButtonVariants({ size }), className)}\n      {...props}\n    />\n  )\n}\n\nfunction InputGroupText({ className, ...props }: React.ComponentProps<\"span\">) {\n  return (\n    <span\n      className={cn(\n        \"text-muted-foreground flex items-center gap-2 text-sm [&_svg:not([class*='size-'])]:size-4 [&_svg]:pointer-events-none\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction InputGroupInput({\n  className,\n  ...props\n}: React.ComponentProps<\"input\">) {\n  return (\n    <Input\n      data-slot=\"input-group-control\"\n      className={cn(\n        \"flex-1 rounded-none border-0 bg-transparent shadow-none focus-visible:ring-0 dark:bg-transparent\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction InputGroupTextarea({\n  className,\n  ...props\n}: React.ComponentProps<\"textarea\">) {\n  return (\n    <Textarea\n      data-slot=\"input-group-control\"\n      className={cn(\n        \"flex-1 resize-none rounded-none border-0 bg-transparent py-3 shadow-none focus-visible:ring-0 dark:bg-transparent\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  InputGroup,\n  InputGroupAddon,\n  InputGroupButton,\n  InputGroupText,\n  InputGroupInput,\n  InputGroupTextarea,\n}\n","path":null,"size_bytes":4971,"size_tokens":null},"client/src/components/ui/tooltip.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Portal>\n    <TooltipPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 overflow-hidden rounded-md bg-primary px-3 py-1.5 text-xs text-primary-foreground animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </TooltipPrimitive.Portal>\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","path":null,"size_bytes":1267,"size_tokens":null},"client/src/components/ui/toast.tsx":{"content":"import * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n","path":null,"size_bytes":4845,"size_tokens":null},"client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { ButtonProps, buttonVariants } from \"@/components/ui/button\"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<\"nav\">) => (\n  <nav\n    role=\"navigation\"\n    aria-label=\"pagination\"\n    className={cn(\"mx-auto flex w-full justify-center\", className)}\n    {...props}\n  />\n)\nPagination.displayName = \"Pagination\"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn(\"flex flex-row items-center gap-1\", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = \"PaginationContent\"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn(\"\", className)} {...props} />\n))\nPaginationItem.displayName = \"PaginationItem\"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, \"size\"> &\n  React.ComponentProps<\"a\">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = \"icon\",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? \"page\" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? \"outline\" : \"ghost\",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = \"PaginationLink\"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to previous page\"\n    size=\"default\"\n    className={cn(\"gap-1 pl-2.5\", className)}\n    {...props}\n  >\n    <ChevronLeft className=\"h-4 w-4\" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = \"PaginationPrevious\"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to next page\"\n    size=\"default\"\n    className={cn(\"gap-1 pr-2.5\", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className=\"h-4 w-4\" />\n  </PaginationLink>\n)\nPaginationNext.displayName = \"PaginationNext\"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    aria-hidden\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = \"PaginationEllipsis\"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationLink,\n  PaginationItem,\n  PaginationPrevious,\n  PaginationNext,\n  PaginationEllipsis,\n}\n","path":null,"size_bytes":2751,"size_tokens":null},"client/src/components/schedule/ItemModal.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter } from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Calendar } from \"@/components/ui/calendar\";\nimport { Popover, PopoverContent, PopoverTrigger } from \"@/components/ui/popover\";\nimport { format, isSameDay } from \"date-fns\";\nimport { CalendarIcon, MapPin, Briefcase, Check, User, Truck, Edit2, AlertCircle, Plus, X, Trash2, Search, FileText } from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\nimport { ScheduleItem } from \"./CalendarGrid\";\nimport { Command, CommandEmpty, CommandGroup, CommandInput, CommandItem, CommandList } from \"@/components/ui/command\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\n\n// ------------------- SCHEMAS -------------------\n\nconst siteSchema = z.object({\n  customer: z.string().min(1, \"Customer is required\"),\n  jobNumber: z.string().optional(),\n  address: z.string().min(1, \"Address is required\"),\n  projectManager: z.string().optional(),\n  startTime: z.string().optional(), // Start time (e.g. 08:00)\n  onsiteTime: z.string().optional(), // Onsite time (e.g. 09:00)\n  duration: z.string().optional(), // Duration in hours (string input from form)\n  color: z.string().default(\"blue\"),\n});\n\nconst operativeSchema = z.object({\n  employeeId: z.string().min(1, \"Employee is required\"),\n  vehicleId: z.string().optional(), // Optional for assistant\n});\n\n// ------------------- COLORS -------------------\n\nconst AVAILABLE_COLORS = [\n    { value: \"blue\", class: \"bg-[#BFDBFE] border-[#3B82F6]\", defaultLabel: \"Standard Job\" },\n    { value: \"green\", class: \"bg-[#BBF7D0] border-[#22C55E]\", defaultLabel: \"Completed\" },\n    { value: \"yellow\", class: \"bg-[#FEF08A] border-[#EAB308]\", defaultLabel: \"Pending\" },\n    { value: \"orange\", class: \"bg-[#FED7AA] border-[#F97316]\", defaultLabel: \"Warning\" },\n    { value: \"red\", class: \"bg-[#FECACA] border-[#EF4444]\", defaultLabel: \"Urgent\" },\n    { value: \"purple\", class: \"bg-[#E9D5FF] border-[#A855F7]\", defaultLabel: \"Specialist\" },\n    { value: \"pink\", class: \"bg-[#FBCFE8] border-[#EC4899]\", defaultLabel: \"Other\" },\n    { value: \"teal\", class: \"bg-[#99F6E4] border-[#14B8A6]\", defaultLabel: \"Maintenance\" },\n    { value: \"gray\", class: \"bg-[#E2E8F0] border-[#64748B]\", defaultLabel: \"Cancelled\" },\n    // Extra colors for expansion\n    { value: \"indigo\", class: \"bg-[#C7D2FE] border-[#6366F1]\", defaultLabel: \"New Category\" },\n    { value: \"cyan\", class: \"bg-[#A5F3FC] border-[#06B6D4]\", defaultLabel: \"New Category\" },\n    { value: \"lime\", class: \"bg-[#D9F99D] border-[#84CC16]\", defaultLabel: \"New Category\" },\n    { value: \"emerald\", class: \"bg-[#A7F3D0] border-[#10B981]\", defaultLabel: \"New Category\" },\n    { value: \"amber\", class: \"bg-[#FDE68A] border-[#D97706]\", defaultLabel: \"New Category\" },\n    { value: \"rose\", class: \"bg-[#FECDD3] border-[#F43F5E]\", defaultLabel: \"New Category\" },\n    { value: \"fuchsia\", class: \"bg-[#F5D0FE] border-[#E879F9]\", defaultLabel: \"New Category\" },\n    { value: \"violet\", class: \"bg-[#DDD6FE] border-[#8B5CF6]\", defaultLabel: \"New Category\" },\n    { value: \"sky\", class: \"bg-[#BAE6FD] border-[#0EA5E9]\", defaultLabel: \"New Category\" },\n    { value: \"indigo_dark\", class: \"bg-[#C7D2FE] border-[#4F46E5]\", defaultLabel: \"New Category\" },\n    { value: \"blue_gray\", class: \"bg-[#CBD5E1] border-[#64748B]\", defaultLabel: \"New Category\" },\n    { value: \"stone\", class: \"bg-[#D6D3D1] border-[#78716C]\", defaultLabel: \"New Category\" },\n    { value: \"red_dark\", class: \"bg-[#FECACA] border-[#B91C1C]\", defaultLabel: \"New Category\" },\n    { value: \"orange_dark\", class: \"bg-[#FED7AA] border-[#C2410C]\", defaultLabel: \"New Category\" },\n    { value: \"yellow_dark\", class: \"bg-[#FEF08A] border-[#A16207]\", defaultLabel: \"New Category\" },\n];\n\n// Mock Data for Address/Client Autocomplete\nconst MOCK_CLIENTS = [\n    \"Thames Water\", \"Balfour Beatty\", \"Murphy Group\", \"Skanska\", \"Costain\", \n    \"Network Rail\", \"United Utilities\", \"Severn Trent\", \"Anglian Water\", \n    \"Highways England\", \"Transport for London\"\n];\n\nconst MOCK_ADDRESSES = [\n    \"10 Downing Street, London, SW1A 2AA\",\n    \"Buckingham Palace, London, SW1A 1AA\",\n    \"Tower of London, London, EC3N 4AB\",\n    \"The Shard, 32 London Bridge St, London, SE1 9SG\",\n    \"Hyde Park Corner, London, W1J 7NT\",\n    \"221B Baker Street, London, NW1 6XE\",\n    \"Houses of Parliament, Westminster, London, SW1A 0AA\",\n    \"British Museum, Great Russell St, London, WC1B 3DG\",\n    \"Tate Modern, Bankside, London, SE1 9TG\",\n    \"Wembley Stadium, London, HA9 0WS\"\n];\n\n\n// ------------------- TYPES -------------------\n\ninterface ItemModalProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  onSubmit: (data: any) => void;\n  type: 'job' | 'operative' | 'assistant' | 'note';\n  initialData?: Partial<ScheduleItem>;\n  employees: { id: string; name: string; status: 'active' | 'holiday' | 'sick'; jobRole?: 'operative' | 'assistant' }[];\n  vehicles: { id: string; name: string; status: 'active' | 'off_road' | 'maintenance' }[];\n  items: ScheduleItem[]; // For conflict detection\n  crews?: { id: string }[]; // For validating assignments against active crews\n  colorLabels?: Record<string, string>;\n  onColorLabelUpdate?: (color: string, label: string) => void;\n}\n\nconst noteSchema = z.object({\n  noteContent: z.string().min(1, \"Note content is required\"),\n});\n\nexport function ItemModal({ open, onOpenChange, onSubmit, type, initialData, employees, vehicles, items, crews, colorLabels, onColorLabelUpdate }: ItemModalProps) {\n  // We conditionally render different forms based on type\n  if (type === 'job') {\n    return <SiteForm open={open} onOpenChange={onOpenChange} onSubmit={onSubmit} initialData={initialData} colorLabels={colorLabels} onColorLabelUpdate={onColorLabelUpdate} />;\n  }\n  if (type === 'note') {\n      return <NoteForm open={open} onOpenChange={onOpenChange} onSubmit={onSubmit} initialData={initialData} />;\n  }\n  return <OperativeForm open={open} onOpenChange={onOpenChange} onSubmit={onSubmit} type={type} initialData={initialData} employees={employees} vehicles={vehicles} items={items} crews={crews} />;\n}\n\n// ------------------- NOTE FORM -------------------\n\nfunction NoteForm({ open, onOpenChange, onSubmit, initialData }: any) {\n    const [applyToWeek, setApplyToWeek] = useState(false);\n    const form = useForm({\n        resolver: zodResolver(noteSchema),\n        defaultValues: {\n            noteContent: initialData?.noteContent || \"\",\n        },\n    });\n\n    useEffect(() => {\n        if (open) {\n            setApplyToWeek(false);\n            form.reset({\n                noteContent: initialData?.noteContent || \"\",\n            });\n        }\n    }, [initialData, open, form]);\n\n    return (\n        <Dialog open={open} onOpenChange={onOpenChange}>\n            <DialogContent className=\"sm:max-w-[400px] bg-white text-slate-900\">\n                <DialogHeader>\n                    <DialogTitle className=\"flex items-center gap-2\">\n                        <FileText className=\"w-5 h-5 text-red-600\" />\n                        {initialData ? \"Edit Note\" : \"Add Note\"}\n                    </DialogTitle>\n                </DialogHeader>\n                <form onSubmit={form.handleSubmit((data) => { onSubmit(data, applyToWeek); onOpenChange(false); form.reset(); })} className=\"space-y-4 mt-4\">\n                    <div className=\"space-y-2\">\n                        <Label>Note Content</Label>\n                        <Textarea \n                            {...form.register(\"noteContent\")} \n                            placeholder=\"Type your note here...\" \n                            className=\"min-h-[100px]\"\n                        />\n                    </div>\n\n                    <DialogFooter className=\"flex items-center justify-between sm:justify-between gap-4\">\n                         <div className=\"flex items-center space-x-2\">\n                            <Checkbox id=\"applyToWeek\" checked={applyToWeek} onCheckedChange={(c) => setApplyToWeek(!!c)} />\n                            <label\n                                htmlFor=\"applyToWeek\"\n                                className=\"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n                            >\n                                Apply to week?\n                            </label>\n                        </div>\n                        <div className=\"flex gap-2\">\n                            <Button type=\"button\" variant=\"outline\" onClick={() => onOpenChange(false)}>Cancel</Button>\n                            <Button type=\"submit\" className=\"bg-red-600 hover:bg-red-700 text-white\">Save Note</Button>\n                        </div>\n                    </DialogFooter>\n                </form>\n            </DialogContent>\n        </Dialog>\n    );\n}\n\n// ------------------- SITE FORM -------------------\n\nfunction SiteForm({ open, onOpenChange, onSubmit, initialData, colorLabels, onColorLabelUpdate }: any) {\n  const [applyToWeek, setApplyToWeek] = useState(false);\n  const form = useForm({\n    resolver: zodResolver(siteSchema),\n    defaultValues: {\n      customer: initialData?.customer || \"\",\n      jobNumber: initialData?.jobNumber || \"\",\n      address: initialData?.address || \"\",\n      projectManager: initialData?.projectManager || \"\",\n      startTime: initialData?.startTime || \"08:00\",\n      onsiteTime: initialData?.onsiteTime || \"09:00\",\n      duration: initialData?.duration?.toString() || \"8\",\n      color: initialData?.color || \"blue\",\n    },\n  });\n\n  // Reset form when initialData changes or modal opens\n  useEffect(() => {\n    if (open) {\n        setApplyToWeek(false);\n        form.reset({\n            customer: initialData?.customer || \"\",\n            jobNumber: initialData?.jobNumber || \"\",\n            address: initialData?.address || \"\",\n            projectManager: initialData?.projectManager || \"\",\n            startTime: initialData?.startTime || \"08:00\",\n            onsiteTime: initialData?.onsiteTime || \"09:00\",\n            duration: initialData?.duration?.toString() || \"8\",\n            color: initialData?.color || \"blue\",\n        });\n    }\n  }, [initialData, open, form]);\n\n  const selectedColor = form.watch(\"color\");\n  const [editingLabel, setEditingLabel] = useState<string | null>(null);\n  const [labelValue, setLabelValue] = useState(\"\");\n  const [activeColors, setActiveColors] = useState<string[]>(() => {\n      // Default visible colors are the ones that exist in colorLabels or defaults\n      if (colorLabels) return Object.keys(colorLabels);\n      return AVAILABLE_COLORS.slice(0, 9).map(c => c.value);\n  });\n  const [isAddingColor, setIsAddingColor] = useState(false);\n\n  // Sync active colors if colorLabels prop updates\n  useEffect(() => {\n      if (colorLabels) {\n          setActiveColors(Object.keys(colorLabels));\n      }\n  }, [colorLabels]);\n\n\n  const handleLabelEdit = (color: string) => {\n    setEditingLabel(color);\n    setLabelValue(colorLabels?.[color] || AVAILABLE_COLORS.find(c => c.value === color)?.defaultLabel || \"New Category\");\n  };\n\n  const handleLabelSave = (color: string) => {\n    if (onColorLabelUpdate) {\n        onColorLabelUpdate(color, labelValue);\n    }\n    setEditingLabel(null);\n  };\n\n  const handleAddColor = (color: string) => {\n      if (!activeColors.includes(color)) {\n          const newColors = [...activeColors, color];\n          setActiveColors(newColors);\n          // Also initialize its label\n          if (onColorLabelUpdate) {\n              const defaultLabel = AVAILABLE_COLORS.find(c => c.value === color)?.defaultLabel || \"New Category\";\n              onColorLabelUpdate(color, defaultLabel);\n          }\n          // Select it immediately\n          form.setValue(\"color\", color);\n      }\n      setIsAddingColor(false);\n  };\n\n  const handleRemoveColor = (color: string, e: React.MouseEvent) => {\n      e.stopPropagation(); // Prevent selecting the color when clicking delete\n      if (activeColors.length <= 1) return; // Prevent deleting the last color\n      \n      const newColors = activeColors.filter(c => c !== color);\n      setActiveColors(newColors);\n      \n      // If we deleted the selected color, select the first available one\n      if (selectedColor === color) {\n          form.setValue(\"color\", newColors[0]);\n      }\n      \n      // Note: We don't strictly need to remove it from colorLabels in parent, \n      // but we could if we wanted to cleanup. For now, hiding it is enough.\n  };\n\n  // --- Autocomplete State ---\n  const [openClient, setOpenClient] = useState(false);\n  const [openAddress, setOpenAddress] = useState(false);\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"sm:max-w-[600px] bg-white text-slate-900 max-h-[90vh] overflow-y-auto\">\n        <DialogHeader>\n          <DialogTitle className=\"flex items-center gap-2\">\n            <Briefcase className=\"w-5 h-5 text-blue-600\" />\n            {initialData ? \"Edit Site Details\" : \"Add New Site\"}\n          </DialogTitle>\n        </DialogHeader>\n        <form onSubmit={form.handleSubmit((data) => { onSubmit(data, applyToWeek); onOpenChange(false); form.reset(); })} className=\"space-y-6 mt-4\">\n            \n            {/* Color Picker / Categories */}\n            <div className=\"space-y-3 bg-slate-50 p-4 rounded-lg border border-slate-100\">\n                <div className=\"flex items-center justify-between\">\n                    <Label>Category & Color</Label>\n                    <Popover open={isAddingColor} onOpenChange={setIsAddingColor}>\n                        <PopoverTrigger asChild>\n                            <Button variant=\"ghost\" size=\"sm\" className=\"h-6 text-xs text-blue-600 hover:text-blue-700 hover:bg-blue-50 p-0\">\n                                <Plus className=\"w-3 h-3 mr-1\" /> Add Category\n                            </Button>\n                        </PopoverTrigger>\n                        <PopoverContent className=\"w-64 p-2\" align=\"end\">\n                            <div className=\"text-xs font-semibold mb-2 text-slate-500 uppercase tracking-wider\">Select Color to Add</div>\n                            <div className=\"grid grid-cols-5 gap-2\">\n                                {AVAILABLE_COLORS.filter(c => !activeColors.includes(c.value)).map(c => (\n                                    <button\n                                        key={c.value}\n                                        type=\"button\"\n                                        onClick={() => handleAddColor(c.value)}\n                                        className={cn(\"w-8 h-8 rounded-md border-2 hover:scale-110 transition-transform\", c.class)}\n                                        title={c.defaultLabel}\n                                    />\n                                ))}\n                                {AVAILABLE_COLORS.every(c => activeColors.includes(c.value)) && (\n                                    <div className=\"col-span-5 text-center text-xs text-slate-400 py-2\">\n                                        All colors used\n                                    </div>\n                                )}\n                            </div>\n                        </PopoverContent>\n                    </Popover>\n                </div>\n                \n                <div className=\"grid grid-cols-2 gap-2\">\n                    {activeColors.map((colorValue) => {\n                        const c = AVAILABLE_COLORS.find(ac => ac.value === colorValue) || { value: colorValue, class: \"bg-slate-100 border-slate-300\", defaultLabel: \"Unknown\" };\n                        return (\n                            <div key={c.value} className=\"flex items-center gap-2 p-1 rounded-md hover:bg-white hover:shadow-sm transition-all group/item relative pr-6\">\n                                <div \n                                    onClick={() => form.setValue(\"color\", c.value)}\n                                    className={cn(\n                                        \"w-8 h-8 rounded-md cursor-pointer transition-all flex items-center justify-center border-2 shrink-0\",\n                                        c.class,\n                                        selectedColor === c.value ? \"scale-110 shadow-md ring-2 ring-offset-2 ring-slate-400\" : \"opacity-70 hover:opacity-100\"\n                                    )}\n                                >\n                                    {selectedColor === c.value && <Check className=\"w-4 h-4 text-slate-800\" />}\n                                </div>\n                                \n                                <div className=\"flex-1 min-w-0\">\n                                    {editingLabel === c.value ? (\n                                        <div className=\"flex items-center gap-1\">\n                                            <Input \n                                                className=\"h-6 text-xs py-0\" \n                                                value={labelValue} \n                                                onChange={(e) => setLabelValue(e.target.value)}\n                                                autoFocus\n                                                onBlur={() => handleLabelSave(c.value)}\n                                                onKeyDown={(e) => e.key === 'Enter' && handleLabelSave(c.value)}\n                                            />\n                                        </div>\n                                    ) : (\n                                        <div \n                                            className=\"text-sm text-slate-600 truncate cursor-text flex items-center gap-2 group\"\n                                            onClick={() => handleLabelEdit(c.value)}\n                                        >\n                                            {colorLabels?.[c.value] || c.defaultLabel}\n                                            <Edit2 className=\"w-3 h-3 opacity-0 group-hover:opacity-50\" />\n                                        </div>\n                                    )}\n                                </div>\n\n                                {/* Delete Button (Hidden unless hovering) */}\n                                <button\n                                    type=\"button\"\n                                    onClick={(e) => handleRemoveColor(c.value, e)}\n                                    className=\"absolute right-1 top-1/2 -translate-y-1/2 opacity-0 group-hover/item:opacity-100 text-slate-300 hover:text-red-500 transition-colors\"\n                                    title=\"Remove Category\"\n                                >\n                                    <X className=\"w-3 h-3\" />\n                                </button>\n                            </div>\n                        );\n                    })}\n                </div>\n            </div>\n\n            <div className=\"grid grid-cols-2 gap-4\">\n                {/* Customer Autocomplete */}\n                <div className=\"space-y-2 col-span-2\">\n                    <Label>Customer / Project</Label>\n                    <Popover open={openClient} onOpenChange={setOpenClient}>\n                        <PopoverTrigger asChild>\n                            <Button\n                                variant=\"outline\"\n                                role=\"combobox\"\n                                aria-expanded={openClient}\n                                className=\"w-full justify-between font-normal text-slate-900 border-slate-200 bg-white hover:bg-slate-50\"\n                            >\n                                {form.watch(\"customer\") || \"Select or type customer...\"}\n                                <Briefcase className=\"ml-2 h-4 w-4 shrink-0 opacity-50\" />\n                            </Button>\n                        </PopoverTrigger>\n                        <PopoverContent className=\"w-[400px] p-0\" align=\"start\">\n                            <div className=\"flex items-center border-b px-3\">\n                                <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n                                <input\n                                    className=\"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\"\n                                    placeholder=\"Search customer...\"\n                                    value={form.watch(\"customer\")}\n                                    onChange={(e) => form.setValue(\"customer\", e.target.value)}\n                                    onKeyDown={(e) => {\n                                        if (e.key === 'Enter') {\n                                            e.preventDefault();\n                                            setOpenClient(false);\n                                        }\n                                    }}\n                                />\n                            </div>\n                            <div className=\"max-h-[300px] overflow-y-auto overflow-x-hidden\">\n                                {(() => {\n                                    const filtered = MOCK_CLIENTS.filter(client => \n                                        client.toLowerCase().includes((form.watch(\"customer\") || \"\").toLowerCase())\n                                    );\n                                    \n                                    if (filtered.length === 0) {\n                                        return <div className=\"py-6 text-center text-sm text-slate-500\">No customer found. Type to add new.</div>;\n                                    }\n\n                                    return (\n                                        <div className=\"overflow-hidden p-1 text-foreground\">\n                                            <div className=\"px-2 py-1.5 text-xs font-medium text-muted-foreground\">Suggestions</div>\n                                            {filtered.map((client) => (\n                                                <div\n                                                    key={client}\n                                                    onClick={() => {\n                                                        form.setValue(\"customer\", client);\n                                                        setOpenClient(false);\n                                                    }}\n                                                    className={cn(\n                                                        \"relative flex cursor-pointer select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none hover:bg-slate-100 hover:text-slate-900\",\n                                                        form.watch(\"customer\") === client && \"bg-slate-100\"\n                                                    )}\n                                                >\n                                                    <Check\n                                                        className={cn(\n                                                            \"mr-2 h-4 w-4\",\n                                                            form.watch(\"customer\") === client ? \"opacity-100\" : \"opacity-0\"\n                                                        )}\n                                                    />\n                                                    {client}\n                                                </div>\n                                            ))}\n                                        </div>\n                                    );\n                                })()}\n                            </div>\n                        </PopoverContent>\n                    </Popover>\n                </div>\n\n                <div className=\"space-y-2\">\n                    <Label>Job Number</Label>\n                    <Input {...form.register(\"jobNumber\")} placeholder=\"J-1234\" />\n                </div>\n                \n                <div className=\"grid grid-cols-3 gap-2\">\n                    <div className=\"space-y-2\">\n                        <Label>Start Time</Label>\n                        <Input type=\"time\" {...form.register(\"startTime\")} />\n                    </div>\n                    <div className=\"space-y-2\">\n                        <Label>Onsite Time</Label>\n                        <Input type=\"time\" {...form.register(\"onsiteTime\")} />\n                    </div>\n                    <div className=\"space-y-2\">\n                        <Label>PM Initials</Label>\n                        <Input {...form.register(\"projectManager\")} placeholder=\"e.g. JD\" maxLength={5} />\n                    </div>\n                </div>\n                \n                <div className=\"space-y-2\">\n                    <Label>Duration (Hrs)</Label>\n                    <Input type=\"number\" {...form.register(\"duration\")} min=\"1\" max=\"24\" />\n                </div>\n\n                {/* Address Autocomplete */}\n                <div className=\"space-y-2 col-span-2\">\n                    <Label>Address</Label>\n                    <Popover open={openAddress} onOpenChange={setOpenAddress}>\n                        <PopoverTrigger asChild>\n                             <Button\n                                variant=\"outline\"\n                                role=\"combobox\"\n                                aria-expanded={openAddress}\n                                className=\"w-full justify-between font-normal text-slate-900 border-slate-200 bg-white hover:bg-slate-50 h-auto min-h-[80px] items-start p-3 whitespace-normal text-left\"\n                            >\n                                {form.watch(\"address\") || \"Search address...\"}\n                                <MapPin className=\"ml-2 h-4 w-4 shrink-0 opacity-50 mt-0.5\" />\n                            </Button>\n                        </PopoverTrigger>\n                        <PopoverContent className=\"w-[400px] p-0\" align=\"start\">\n                            <div className=\"flex items-center border-b px-3\">\n                                <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n                                <input\n                                    className=\"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\"\n                                    placeholder=\"Search address (Google Maps)...\"\n                                    value={form.watch(\"address\")}\n                                    onChange={(e) => form.setValue(\"address\", e.target.value)}\n                                    onKeyDown={(e) => {\n                                        if (e.key === 'Enter') {\n                                            e.preventDefault();\n                                            setOpenAddress(false);\n                                        }\n                                    }}\n                                />\n                            </div>\n                            <div className=\"max-h-[300px] overflow-y-auto overflow-x-hidden\">\n                                {(() => {\n                                    const filtered = MOCK_ADDRESSES.filter(addr => \n                                        addr.toLowerCase().includes((form.watch(\"address\") || \"\").toLowerCase())\n                                    );\n                                    \n                                    if (filtered.length === 0) {\n                                        return <div className=\"py-6 text-center text-sm text-slate-500\">No address found. Type to add manually.</div>;\n                                    }\n\n                                    return (\n                                        <div className=\"overflow-hidden p-1 text-foreground\">\n                                            <div className=\"px-2 py-1.5 text-xs font-medium text-muted-foreground\">Google Maps Suggestions</div>\n                                            {filtered.map((address) => (\n                                                <div\n                                                    key={address}\n                                                    onClick={() => {\n                                                        form.setValue(\"address\", address);\n                                                        setOpenAddress(false);\n                                                    }}\n                                                    className={cn(\n                                                        \"relative flex cursor-pointer select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none hover:bg-slate-100 hover:text-slate-900\",\n                                                        form.watch(\"address\") === address && \"bg-slate-100\"\n                                                    )}\n                                                >\n                                                    <MapPin className=\"mr-2 h-4 w-4 opacity-50\" />\n                                                    {address}\n                                                </div>\n                                            ))}\n                                        </div>\n                                    );\n                                })()}\n                            </div>\n                        </PopoverContent>\n                    </Popover>\n                    <div className=\"text-[10px] text-slate-400 text-right\">\n                        Powered by Google Maps (Simulation)\n                    </div>\n                </div>\n            </div>\n\n            <DialogFooter className=\"flex items-center justify-between sm:justify-between gap-4\">\n                <div className=\"flex items-center space-x-2\">\n                    <Checkbox id=\"applyToWeek\" checked={applyToWeek} onCheckedChange={(c) => setApplyToWeek(!!c)} />\n                    <label\n                        htmlFor=\"applyToWeek\"\n                        className=\"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n                    >\n                        Apply to remainder of week?\n                    </label>\n                </div>\n                <div className=\"flex gap-2\">\n                    <Button type=\"button\" variant=\"outline\" onClick={() => onOpenChange(false)}>Cancel</Button>\n                    <Button type=\"submit\" className=\"bg-blue-600 hover:bg-blue-700 text-white\">Save Site</Button>\n                </div>\n            </DialogFooter>\n        </form>\n      </DialogContent>\n    </Dialog>\n  );\n}\n\n// ------------------- OPERATIVE FORM -------------------\n\nfunction OperativeForm({ open, onOpenChange, onSubmit, type, initialData, employees, vehicles, items, crews }: any) {\n  const [applyToWeek, setApplyToWeek] = useState(false);\n  const form = useForm({\n    resolver: zodResolver(operativeSchema),\n    defaultValues: {\n      employeeId: initialData?.employeeId || \"\",\n      vehicleId: initialData?.vehicleId || \"\",\n    },\n  });\n\n  // Reset form when initialData changes or modal opens\n  useEffect(() => {\n    if (open) {\n        setApplyToWeek(false);\n        form.reset({\n            employeeId: initialData?.employeeId || \"\",\n            vehicleId: initialData?.vehicleId || \"\",\n        });\n    }\n  }, [initialData, open, form]);\n\n  // Check for conflicts\n  const targetDate = initialData?.date ? new Date(initialData.date) : new Date();\n  \n  // Get valid crew IDs set for efficient lookup\n  const validCrewIds = crews ? new Set(crews.map((c: any) => c.id)) : null;\n  \n  // Determine the shift of the crew we are assigning to\n  const currentCrewId = initialData?.crewId;\n  const currentCrew = crews?.find((c: any) => c.id === currentCrewId);\n  const targetShift = currentCrew?.shift || 'day'; // Default to day if unknown\n\n  // Get employees who are already assigned on this day\n  const assignedEmployeeIds = items\n    .filter((item: ScheduleItem) => \n        (item.type === 'operative' || item.type === 'assistant') && \n        isSameDay(new Date(item.date), targetDate) &&\n        item.id !== initialData?.id && // Exclude self if editing\n        (!validCrewIds || validCrewIds.has(item.crewId)) // Only count items for valid crews\n    )\n    .map((item: ScheduleItem) => item.employeeId);\n\n  // Get vehicles who are already assigned on this day, AND their shift\n  const assignedVehiclesInfo = items\n    .filter((item: ScheduleItem) => \n        item.type === 'operative' && \n        isSameDay(new Date(item.date), targetDate) &&\n        item.id !== initialData?.id && // Exclude self if editing\n        (!validCrewIds || validCrewIds.has(item.crewId)) && // Only count items for valid crews\n        item.vehicleId\n    )\n    .reduce((acc: Record<string, string>, item: ScheduleItem) => {\n        // Find the shift of this assignment\n        const itemCrew = crews?.find((c: any) => c.id === item.crewId);\n        const itemShift = itemCrew?.shift || 'day';\n        acc[item.vehicleId!] = itemShift;\n        return acc;\n    }, {});\n\n  // Group vehicles by type\n  const groupedVehicles = vehicles.reduce((acc: any, v: any) => {\n    const type = v.vehicleType || \"Other\";\n    if (!acc[type]) acc[type] = [];\n    acc[type].push(v);\n    return acc;\n  }, {});\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"sm:max-w-[400px] bg-white text-slate-900\">\n        <DialogHeader>\n          <DialogTitle className=\"flex items-center gap-2\">\n            <User className=\"w-5 h-5 text-blue-600\" />\n            {type === 'operative' ? \"Add Operative (Driver)\" : \"Add Assistant\"}\n          </DialogTitle>\n        </DialogHeader>\n        <form onSubmit={form.handleSubmit((data) => { onSubmit(data, applyToWeek); onOpenChange(false); form.reset(); })} className=\"space-y-6 mt-4\">\n            \n            <div className=\"space-y-4\">\n                <div className=\"space-y-2\">\n                    <Label>Employee</Label>\n                    <Select \n                        onValueChange={(val) => form.setValue(\"employeeId\", val)} \n                        defaultValue={form.getValues(\"employeeId\") || initialData?.employeeId}\n                    >\n                        <SelectTrigger><SelectValue placeholder=\"Select Person\" /></SelectTrigger>\n                        <SelectContent>\n                            {employees\n                                .filter((e: any) => {\n                                    // Strict role filtering\n                                    if (type === 'operative') return e.jobRole === 'operative';\n                                    if (type === 'assistant') return e.jobRole === 'assistant';\n                                    return true;\n                                })\n                                .sort((a: any, b: any) => a.name.localeCompare(b.name))\n                                .map((e: any) => {\n                                const isAssigned = assignedEmployeeIds.includes(e.id);\n                                const isUnavailable = e.status !== 'active';\n                                return (\n                                    <SelectItem \n                                        key={e.id} \n                                        value={e.id}\n                                        disabled={isAssigned || isUnavailable}\n                                        className={cn(\n                                            (isAssigned || isUnavailable) && \"opacity-50 bg-slate-50 text-slate-400 cursor-not-allowed\"\n                                        )}\n                                    >\n                                        <div className=\"flex items-center justify-between w-full gap-2 min-w-[200px]\">\n                                            <span>{e.name}</span>\n                                            <div className=\"flex items-center gap-2\">\n                                                {isUnavailable && <span className=\"text-xs text-red-500 font-medium\">({e.status})</span>}\n                                                {isAssigned && <span className=\"text-xs text-slate-400 font-medium italic\">(Already Scheduled)</span>}\n                                            </div>\n                                        </div>\n                                    </SelectItem>\n                                );\n                            })}\n                        </SelectContent>\n                    </Select>\n                </div>\n\n                {type === 'operative' && (\n                    <div className=\"space-y-2\">\n                        <Label>Vehicle</Label>\n                        <Select \n                            onValueChange={(val) => form.setValue(\"vehicleId\", val)} \n                            defaultValue={form.getValues(\"vehicleId\") || initialData?.vehicleId}\n                        >\n                            <SelectTrigger><SelectValue placeholder=\"Select Vehicle\" /></SelectTrigger>\n                            <SelectContent>\n                                {Object.entries(groupedVehicles).sort(([typeA], [typeB]) => typeA.localeCompare(typeB)).map(([type, typeVehicles]) => (\n                                    <div key={type}>\n                                        <div className=\"px-2 py-1.5 text-xs font-semibold text-slate-500 bg-slate-50 sticky top-0 z-10\">\n                                            {type}\n                                        </div>\n                                        {(typeVehicles as any[]).map((v: any) => {\n                                            const assignedShift = assignedVehiclesInfo[v.id];\n                                            const isGlobalUnavailable = v.status !== 'active';\n                                            const isAssignedToSameShift = assignedShift === targetShift;\n                                            const isAssignedToDifferentShift = assignedShift && assignedShift !== targetShift;\n                                            \n                                            // FIX: Ensure disabled is ONLY true if global unavailable or same shift conflict\n                                            const isDisabled = isGlobalUnavailable || isAssignedToSameShift;\n\n                                            return (\n                                                <SelectItem \n                                                    key={v.id} \n                                                    value={v.id}\n                                                    disabled={isDisabled}\n                                                    className={cn(\n                                                        isDisabled && \"opacity-50\"\n                                                    )}\n                                                >\n                                                    <div className=\"flex items-center justify-between w-full gap-2\">\n                                                        <span>{v.name}</span>\n                                                        {isGlobalUnavailable && <span className=\"text-xs text-red-500\">({v.status === 'off_road' ? 'VOR' : v.status})</span>}\n                                                        {isAssignedToSameShift && <span className=\"text-xs text-blue-500\">(In Use)</span>}\n                                                        {isAssignedToDifferentShift && <span className=\"text-xs text-amber-600 font-medium\">(Used on {assignedShift === 'day' ? 'Day' : 'Night'})</span>}\n                                                    </div>\n                                                </SelectItem>\n                                            );\n                                        })}\n                                    </div>\n                                ))}\n                            </SelectContent>\n                        </Select>\n                    </div>\n                )}\n            </div>\n\n            <DialogFooter className=\"flex items-center justify-between sm:justify-between gap-4\">\n                <div className=\"flex items-center space-x-2\">\n                    <Checkbox id=\"applyToWeekOp\" checked={applyToWeek} onCheckedChange={(c) => setApplyToWeek(!!c)} />\n                    <label\n                        htmlFor=\"applyToWeekOp\"\n                        className=\"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n                    >\n                        Apply to remainder of week?\n                    </label>\n                </div>\n                <div className=\"flex gap-2\">\n                    <Button type=\"button\" variant=\"outline\" onClick={() => onOpenChange(false)}>Cancel</Button>\n                    <Button type=\"submit\" className=\"bg-blue-600 hover:bg-blue-700 text-white\">Add Person</Button>\n                </div>\n            </DialogFooter>\n        </form>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","path":null,"size_bytes":41223,"size_tokens":null},"client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverAnchor = PopoverPrimitive.Anchor\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent, PopoverAnchor }\n","path":null,"size_bytes":1342,"size_tokens":null},"client/src/components/schedule/CalendarGrid.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { format, startOfWeek, addDays, isSameDay, endOfWeek, isAfter, isBefore, startOfDay, endOfMonth, addMonths, endOfYear } from \"date-fns\";\nimport { DndContext, DragOverlay, closestCorners, KeyboardSensor, PointerSensor, useSensor, useSensors, DragStartEvent, DragEndEvent, useDroppable, Modifier } from \"@dnd-kit/core\";\nimport { SortableContext, rectSortingStrategy, arrayMove } from \"@dnd-kit/sortable\";\nimport { SiteCard } from \"./SiteCard\";\nimport { OperativeCard } from \"./OperativeCard\";\nimport { NoteCard } from \"./NoteCard\";\nimport { ItemModal } from \"./ItemModal\";\nimport { ResourcesModal } from \"./ResourcesModal\";\nimport { Button } from \"@/components/ui/button\";\nimport { Plus, ChevronLeft, ChevronRight, Calendar as CalendarIcon, Users, MoreHorizontal, Trash2, Briefcase, UserPlus, User, Truck, Settings, Edit, Search, Lock, Mail, Check, Sun, Moon, ChevronDown, ChevronRight as ChevronRightIcon, RotateCcw, RotateCw, FileText } from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter } from \"@/components/ui/dialog\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport {\n    DropdownMenu,\n    DropdownMenuContent,\n    DropdownMenuItem,\n    DropdownMenuTrigger,\n    DropdownMenuSeparator\n} from \"@/components/ui/dropdown-menu\";\nimport { Tooltip, TooltipContent, TooltipProvider, TooltipTrigger } from \"@/components/ui/tooltip\";\n\nimport { SmartSearchModal } from \"./SmartSearchModal\";\nimport { EmailPreviewModal } from \"./EmailPreviewModal\";\n\nexport interface Crew {\n    id: string;\n    name: string;\n    depotId?: string;\n    shift?: 'day' | 'night';\n    archivedAt?: string | null;\n}\n\n// Unified Schedule Item Type\nexport interface ScheduleItem {\n    id: string;\n    type: 'job' | 'operative' | 'assistant' | 'note';\n    date: Date;\n    crewId: string;\n    depotId: string;\n\n    // Job Specifics\n    customer?: string;\n    jobNumber?: string;\n    address?: string;\n    projectManager?: string; // PM Initials\n    startTime?: string;\n    onsiteTime?: string;\n    color?: string;\n    duration?: number; // Duration in hours\n\n    // Person Specifics\n    employeeId?: string;\n    vehicleId?: string;\n\n    // Note Specifics\n    noteContent?: string;\n}\n\ninterface CalendarGridProps {\n  items: ScheduleItem[];\n  crews: Crew[];\n  employees: { id: string; name: string; status: 'active' | 'holiday' | 'sick'; email?: string; jobRole?: 'operative' | 'assistant' }[];\n  vehicles: { id: string; name: string; status: 'active' | 'off_road' | 'maintenance'; vehicleType: string }[];\n  colorLabels: Record<string, string>;\n  isReadOnly: boolean;\n  depots: { id: string; name: string; address: string }[];\n  allItems: ScheduleItem[];\n  onItemUpdate: (item: ScheduleItem) => void;\n  onItemCreate: (item: ScheduleItem) => void;\n  onItemDelete: (id: string) => void;\n  onItemReorder: (activeId: string, overId: string) => void;\n  onCrewCreate: (name: string, shift: 'day' | 'night') => void;\n  onCrewUpdate: (id: string, name: string, shift: 'day' | 'night') => void;\n  onCrewDelete: (id: string) => void;\n  onEmployeeCreate: (name: string) => void;\n  onEmployeeUpdate: (id: string, name: string, status?: 'active' | 'holiday' | 'sick', jobRole?: 'operative' | 'assistant', email?: string) => void;\n  onEmployeeDelete: (id: string) => void;\n  onVehicleCreate: (name: string) => void;\n  onVehicleUpdate: (id: string, name: string, status?: 'active' | 'off_road' | 'maintenance') => void;\n  onVehicleDelete: (id: string) => void;\n  onColorLabelUpdate: (color: string, label: string) => void;\n  vehicleTypes?: string[];\n  allCrews?: Crew[];\n  onUndo?: () => void;\n  onRedo?: () => void;\n  canUndo?: boolean;\n  canRedo?: boolean;\n}\n\nfunction DroppableCell({ id, children, className, style, onDoubleClick, disabled }: { id: string, children: React.ReactNode, className?: string, style?: React.CSSProperties, onDoubleClick?: (e: React.MouseEvent) => void, disabled?: boolean }) {\n  const { setNodeRef, isOver } = useDroppable({ id, disabled });\n  \n  return (\n    <td \n      ref={setNodeRef}\n      className={cn(\n        className, \n        isOver ? \"bg-blue-50/80 ring-2 ring-inset ring-blue-300 transition-all\" : \"\",\n        \"overflow-hidden\", // Ensure content doesn't spill out of the cell\n        disabled ? \"bg-slate-50/40 opacity-60 cursor-not-allowed\" : \"\"\n      )}\n      style={style}\n      onDoubleClick={disabled ? undefined : onDoubleClick}\n    >\n      {children}\n    </td>\n  );\n}\n\nexport function CalendarGrid({ \n    items, crews, employees, vehicles, colorLabels, isReadOnly,\n    onItemUpdate, onItemCreate, onItemDelete, onItemReorder,\n    onCrewCreate, onCrewUpdate, onCrewDelete,\n    onEmployeeCreate, onEmployeeUpdate, onEmployeeDelete,\n    onVehicleCreate, onVehicleUpdate, onVehicleDelete,\n    onColorLabelUpdate, depots, allItems, vehicleTypes, allCrews,\n    onUndo, onRedo, canUndo, canRedo\n}: CalendarGridProps) {\n  const [currentDate, setCurrentDate] = useState(new Date());\n  const today = startOfDay(new Date());\n  const [viewDays, setViewDays] = useState(5); // 5 or 7 day view\n  const [activeId, setActiveId] = useState<string | null>(null);\n  const [isCtrlPressed, setIsCtrlPressed] = useState(false);\n  const [selectedItemIds, setSelectedItemIds] = useState<Set<string>>(new Set());\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  \n  // Mock Email Status State\n  const [emailStatus, setEmailStatus] = useState<Record<string, { sent: boolean, timestamp?: string }>>({});\n  const [emailModalOpen, setEmailModalOpen] = useState(false);\n  const [emailModalDate, setEmailModalDate] = useState<Date | null>(null);\n\n  // Modal States\n  const [modalState, setModalState] = useState<{\n    isOpen: boolean;\n    type: 'job' | 'operative' | 'assistant' | 'note';\n    data?: ScheduleItem;\n    target?: { date: Date; crewId: string };\n  }>({ isOpen: false, type: 'job' });\n\n  const [selectionMenu, setSelectionMenu] = useState<{\n    isOpen: boolean;\n    date: Date;\n    crewId: string;\n  } | null>(null);\n  \n  const [crewModal, setCrewModal] = useState<{ isOpen: boolean, mode: 'create' | 'edit', id?: string, name: string, shift: 'day' | 'night' }>({ isOpen: false, mode: 'create', name: \"\", shift: 'day' });\n\n  // Auto-generate name when shift changes in Create mode\n  useEffect(() => {\n      if (crewModal.isOpen && crewModal.mode === 'create') {\n          const prefix = crewModal.shift === 'night' ? \"Night\" : \"Day\";\n          // Count existing crews of this shift type to find the next number\n          // Simple heuristic: Count how many start with the prefix\n          const count = crews.filter(c => c.shift === crewModal.shift || (crewModal.shift === 'night' ? c.name.toLowerCase().includes(\"night\") : !c.name.toLowerCase().includes(\"night\"))).length;\n          \n          // Only auto-fill if name is empty or matches the pattern of the OTHER shift\n          const otherPrefix = crewModal.shift === 'night' ? \"Day\" : \"Night\";\n          if (!crewModal.name || crewModal.name.startsWith(otherPrefix)) {\n               const numberWords = [\"One\", \"Two\", \"Three\", \"Four\", \"Five\", \"Six\", \"Seven\", \"Eight\", \"Nine\", \"Ten\"];\n               const nextNumWord = numberWords[count] || (count + 1).toString();\n               \n               setCrewModal(prev => ({ ...prev, name: `${prefix} ${nextNumWord}` }));\n          }\n      }\n  }, [crewModal.shift, crewModal.isOpen, crewModal.mode]); // Depend on shift change\n  \n  const [resourcesModalOpen, setResourcesModalOpen] = useState(false);\n  const [smartSearchOpen, setSmartSearchOpen] = useState(false);\n  const [expandedShifts, setExpandedShifts] = useState<{ night: boolean, day: boolean }>({ night: true, day: true });\n\n  const weekStart = startOfWeek(currentDate, { weekStartsOn: 1 });\n  const weekDays = Array.from({ length: viewDays }).map((_, i) => addDays(weekStart, i));\n\n  const sensors = useSensors(\n    useSensor(PointerSensor, { activationConstraint: { distance: 8 } }),\n    useSensor(KeyboardSensor)\n  );\n\n  // --- DRAG AND DROP ---\n\n  const handleDragStart = (event: DragStartEvent) => {\n    if (isReadOnly) return;\n    const activeItem = items.find(i => i.id === event.active.id);\n    if (activeItem && isBefore(startOfDay(new Date(activeItem.date)), startOfDay(new Date()))) return;\n\n    setActiveId(event.active.id as string);\n    // Check if Ctrl is held down at start of drag\n    // @ts-ignore - dnd-kit doesn't expose native event directly in DragStartEvent type easily but it exists\n    const nativeEvent = event.activatorEvent as MouseEvent;\n    if (nativeEvent && (nativeEvent.ctrlKey || nativeEvent.metaKey)) {\n        setIsCtrlPressed(true);\n    } else {\n        setIsCtrlPressed(false);\n    }\n  };\n\n  const handleDragEnd = (event: DragEndEvent) => {\n    if (isReadOnly) return;\n    const { active, over } = event;\n    setIsCtrlPressed(false);\n    \n    if (!over) {\n      setActiveId(null);\n      return;\n    }\n\n    const activeItem = items.find(i => i.id === active.id);\n    if (!activeItem) return;\n\n    let targetCrewId = \"\";\n    let targetDateStr = \"\";\n    const overId = over.id as string;\n\n    // Check if dropping onto another Item (Reordering) or onto a Cell (Moving/Empty Drop)\n    const overItem = items.find(i => i.id === overId);\n    const isDroppingOnItem = !!overItem;\n\n    if (overId.includes(\"|\")) {\n        // Dropped on empty cell space\n        const [cId, dStr] = overId.split(\"|\");\n        targetCrewId = cId;\n        targetDateStr = dStr;\n    } else if (overItem) {\n        // Dropped on an item\n        targetCrewId = overItem.crewId;\n        targetDateStr = format(overItem.date, \"yyyy-MM-dd\");\n    }\n\n    if (targetCrewId && targetDateStr) {\n        const newDate = new Date(targetDateStr);\n\n        // Prevent dropping onto past dates\n        if (isBefore(startOfDay(newDate), startOfDay(new Date()))) {\n            setActiveId(null);\n            return;\n        }\n        \n        if (isCtrlPressed) {\n             // Duplicate\n             onItemCreate({\n                ...activeItem,\n                id: Math.random().toString(36).substr(2, 9),\n                crewId: targetCrewId,\n                date: newDate\n            });\n        } else {\n             // Move or Reorder\n             const isSameCell = activeItem.crewId === targetCrewId && isSameDay(activeItem.date, newDate);\n             \n             if (isSameCell && isDroppingOnItem && active.id !== over.id) {\n                 // Reorder within same cell\n                 onItemReorder(active.id as string, over.id as string);\n             } else if (!isSameCell) {\n                 // Move to new cell\n                 onItemUpdate({ ...activeItem, crewId: targetCrewId, date: newDate });\n             }\n        }\n    }\n    setActiveId(null);\n  };\n\n  const handleSendDailyEmails = (date: Date) => {\n      if (isReadOnly) return;\n      \n      const dateKey = format(date, \"yyyy-MM-dd\");\n      const status = emailStatus[dateKey];\n      \n      if (status?.sent) {\n          // Already sent, maybe confirm resend?\n          if (!confirm(`Emails already sent at ${status.timestamp}. Resend?`)) return;\n      }\n      \n      // Find operatives working on this day\n      const peopleOnDay = items.filter(i => \n          (i.type === 'operative' || i.type === 'assistant') && \n          isSameDay(new Date(i.date), date)\n      );\n      \n      if (peopleOnDay.length === 0) {\n          alert(\"No operatives or assistants scheduled for this day.\");\n          return;\n      }\n\n      // Open the preview modal\n      setEmailModalDate(date);\n      setEmailModalOpen(true);\n  };\n\n  const handleEmailSent = (date: Date, count: number) => {\n      const dateKey = format(date, \"yyyy-MM-dd\");\n      setEmailStatus(prev => ({\n          ...prev,\n          [dateKey]: {\n              sent: true,\n              timestamp: format(new Date(), \"HH:mm\")\n          }\n      }));\n      alert(`Success! Schedule sent to ${count} staff members.`);\n  };\n\n  // --- HANDLERS ---\n\n  const handleCellDoubleClick = (date: Date, crewId: string) => {\n     if (isReadOnly) return;\n     if (isBefore(startOfDay(date), startOfDay(new Date()))) return;\n     setSelectionMenu({ isOpen: true, date, crewId });\n  };\n\n  const handleSelection = (type: 'job' | 'operative' | 'assistant' | 'note') => {\n    if (selectionMenu) {\n        if (isBefore(startOfDay(selectionMenu.date), startOfDay(new Date()))) return;\n        setModalState({ \n            isOpen: true, \n            type, \n            target: { date: selectionMenu.date, crewId: selectionMenu.crewId } \n        });\n        setSelectionMenu(null);\n    }\n  };\n\n  const handleToggleSelection = (id: string, multi: boolean) => {\n      setSelectedItemIds(prev => {\n          const newSet = new Set(multi ? prev : []);\n          if (multi) {\n              if (newSet.has(id)) {\n                  newSet.delete(id);\n              } else {\n                  newSet.add(id);\n              }\n          } else {\n              // If not holding shift, just select this one (clearing others)\n              // This mimics standard file explorer behavior\n              newSet.add(id);\n          }\n          return newSet;\n      });\n  };\n\n  const handleEditItem = (item: ScheduleItem) => {\n    if (isReadOnly) return;\n    if (isBefore(startOfDay(item.date), startOfDay(new Date()))) return;\n    setModalState({ isOpen: true, type: item.type, data: item });\n  };\n\n  const handleDuplicateItem = (item: ScheduleItem, mode: 'single' | 'week' | 'following_week' | 'custom' | 'remainder_month' | 'next_2_months' | 'next_3_months' | 'next_4_months' | 'next_5_months' | 'next_6_months' | 'remainder_year' = 'single', days = 1) => {\n    if (isReadOnly) return;\n\n    // Determine which items to process\n    const targetItems = selectedItemIds.has(item.id) \n        ? items.filter(i => selectedItemIds.has(i.id))\n        : [item];\n\n    const itemsToCreate: ScheduleItem[] = [];\n\n    targetItems.forEach(sourceItem => {\n        const startDate = new Date(sourceItem.date);\n        \n        if (mode === 'single') {\n             itemsToCreate.push({ ...sourceItem, id: Math.random().toString(36).substr(2, 9) });\n        } else if (mode === 'week') {\n            // Duplicate for remainder of the displayed week\n            const currentViewEnd = addDays(weekStart, viewDays - 1);\n            let nextDate = addDays(startDate, 1);\n            \n            while (isSameDay(nextDate, currentViewEnd) || isBefore(nextDate, currentViewEnd)) {\n                itemsToCreate.push({\n                    ...sourceItem,\n                    id: Math.random().toString(36).substr(2, 9),\n                    date: new Date(nextDate)\n                });\n                nextDate = addDays(nextDate, 1);\n            }\n        } else if (mode === 'following_week') {\n            // Duplicate for the WHOLE of the following week\n            const nextWeekStart = addDays(startOfWeek(startDate, { weekStartsOn: 1 }), 7);\n            const daysToFill = viewDays; \n            \n            for (let i = 0; i < daysToFill; i++) {\n                 itemsToCreate.push({\n                    ...sourceItem,\n                    id: Math.random().toString(36).substr(2, 9),\n                    date: addDays(nextWeekStart, i)\n                });\n            }\n        } else if (mode === 'custom') {\n            // Duplicate for X days\n            for (let i = 1; i <= days; i++) {\n                 itemsToCreate.push({\n                    ...sourceItem,\n                    id: Math.random().toString(36).substr(2, 9),\n                    date: addDays(startDate, i)\n                });\n            }\n        } else if (['remainder_month', 'next_2_months', 'next_3_months', 'next_4_months', 'next_5_months', 'next_6_months', 'remainder_year'].includes(mode)) {\n            let endDate: Date;\n            if (mode === 'remainder_month') {\n                endDate = endOfMonth(startDate);\n            } else if (mode === 'remainder_year') {\n                endDate = endOfYear(startDate);\n            } else {\n                const monthsToAdd = parseInt(mode.split('_')[1]);\n                endDate = addMonths(startDate, monthsToAdd);\n            }\n    \n            let nextDate = addDays(startDate, 1);\n            let safetyCounter = 0;\n            const MAX_ITEMS_PER_SOURCE = 365; // Safety limit\n    \n            while ((isBefore(nextDate, endDate) || isSameDay(nextDate, endDate)) && safetyCounter < MAX_ITEMS_PER_SOURCE) {\n                itemsToCreate.push({\n                    ...sourceItem,\n                    id: Math.random().toString(36).substr(2, 9),\n                    date: new Date(nextDate)\n                });\n                nextDate = addDays(nextDate, 1);\n                safetyCounter++;\n            }\n        }\n    });\n\n    itemsToCreate.forEach(newItem => onItemCreate(newItem));\n  };\n\n  const handleDeleteItem = (id: string, mode: 'single' | 'week' | 'remainder_month' | 'next_2_months' | 'next_3_months' | 'next_4_months' | 'next_5_months' | 'next_6_months' | 'remainder_year' = 'single') => {\n      if (isReadOnly) return;\n      \n      // Determine items to delete\n      const isSelected = selectedItemIds.has(id);\n      const targetIds = isSelected ? Array.from(selectedItemIds) : [id];\n\n      // Filter out past items from deletion\n      const validTargetIds = targetIds.filter(tid => {\n          const item = items.find(i => i.id === tid);\n          if (!item) return false;\n          // Prevent deleting past items\n          return !isBefore(startOfDay(new Date(item.date)), startOfDay(new Date()));\n      });\n\n      if (validTargetIds.length === 0) return;\n      \n      validTargetIds.forEach(targetId => {\n          if (mode === 'single') {\n              onItemDelete(targetId);\n          } else {\n              // Bulk Delete Modes\n              const itemToDelete = items.find(i => i.id === targetId);\n              if (!itemToDelete) return;\n              \n              const startDate = new Date(itemToDelete.date);\n              let endDate: Date;\n    \n              if (mode === 'week') {\n                  endDate = addDays(weekStart, viewDays - 1);\n              } else if (mode === 'remainder_month') {\n                  endDate = endOfMonth(startDate);\n              } else if (mode === 'remainder_year') {\n                  endDate = endOfYear(startDate);\n              } else {\n                 const monthsToAdd = parseInt(mode.split('_')[1]);\n                 endDate = addMonths(startDate, monthsToAdd);\n              }\n              \n              const idsToDelete = items.filter(i => {\n                  if (i.id === targetId) return true;\n                  \n                  const iDate = new Date(i.date);\n                  const isFuture = isAfter(iDate, startDate) && (isBefore(iDate, endDate) || isSameDay(iDate, endDate));\n                  \n                  if (!isFuture && i.id !== targetId) return false;\n                  if (i.crewId !== itemToDelete.crewId) return false;\n                  if (i.type !== itemToDelete.type) return false;\n                  \n                  if (i.type === 'job') {\n                      return i.customer === itemToDelete.customer && i.address === itemToDelete.address;\n                  } else {\n                      return i.employeeId === itemToDelete.employeeId;\n                  }\n              }).map(i => i.id);\n              \n              idsToDelete.forEach(delId => onItemDelete(delId));\n          }\n      });\n      \n      // Clear selection if we deleted selected items\n      if (isSelected) {\n          setSelectedItemIds(new Set());\n      }\n  };\n\n  const handleModalSubmit = (data: any, applyToWeek: boolean = false) => {\n    if (modalState.data) {\n        // UPDATE\n        const updatedItem = { ...modalState.data, ...data };\n        onItemUpdate(updatedItem);\n        \n        if (applyToWeek) {\n            // Apply changes to future occurrences in this week\n            const startDate = new Date(updatedItem.date);\n            const currentViewEnd = addDays(weekStart, viewDays - 1);\n            \n            items.forEach(i => {\n                if (i.id === updatedItem.id) return;\n                \n                const iDate = new Date(i.date);\n                const isFuture = isAfter(iDate, startDate) && (isBefore(iDate, currentViewEnd) || isSameDay(iDate, currentViewEnd));\n                \n                // Simplified logic: If it looks like part of the same \"series\" (Same Crew + Same Type), update it.\n                // This handles the \"whole group\" request by updating subsequent days.\n                if (isFuture && i.crewId === updatedItem.crewId && i.type === updatedItem.type) {\n                    let isMatch = false;\n                    \n                    if (i.type === 'job') {\n                         // Match if it shares the same Customer (before edit)\n                         // This assumes the user hasn't changed the customer yet, or we match loosely.\n                         // If \"Apply to week\" is checked, we assume the user wants to update the \"slot\" for this job.\n                         if (i.customer === modalState.data?.customer) isMatch = true;\n                    } else {\n                        // For people, match the Employee ID\n                        if (i.employeeId === modalState.data?.employeeId) isMatch = true;\n                    }\n                    \n                    if (isMatch) {\n                        onItemUpdate({ ...i, ...data });\n                    }\n                }\n            });\n        }\n        \n    } else if (modalState.target) {\n        // CREATE\n        onItemCreate({\n            id: Math.random().toString(36).substr(2, 9),\n            type: modalState.type,\n            date: modalState.target.date,\n            crewId: modalState.target.crewId,\n            depotId: \"\",\n            ...data\n        });\n        // Apply to week for Create? Usually handled by Duplicate. \n        // But if user checks it on create, we could loop create.\n        if (applyToWeek) {\n             const startDate = new Date(modalState.target.date);\n             const currentViewEnd = addDays(weekStart, viewDays - 1);\n             let nextDate = addDays(startDate, 1);\n             \n             while (isSameDay(nextDate, currentViewEnd) || isBefore(nextDate, currentViewEnd)) {\n                onItemCreate({\n                    id: Math.random().toString(36).substr(2, 9),\n                    type: modalState.type,\n                    date: new Date(nextDate),\n                    crewId: modalState.target.crewId,\n                    depotId: \"\",\n                    ...data\n                });\n                nextDate = addDays(nextDate, 1);\n             }\n        }\n    }\n  };\n\n  const handleCrewSubmit = () => {\n    if (crewModal.name.trim()) {\n        if (crewModal.mode === 'create') {\n            onCrewCreate(crewModal.name, crewModal.shift);\n        } else if (crewModal.mode === 'edit' && crewModal.id) {\n            onCrewUpdate(crewModal.id, crewModal.name, crewModal.shift);\n        }\n        setCrewModal({ isOpen: false, mode: 'create', name: \"\", shift: 'day' });\n    }\n  };\n\n  const activeItem = activeId ? items.find(i => i.id === activeId) : null;\n\n  // --- FILTERING ---\n  const filteredItems = items.filter(item => {\n      if (!searchQuery) return true;\n      const query = searchQuery.toLowerCase();\n      \n      // Search in Job details\n      if (item.type === 'job') {\n          return (\n              item.customer?.toLowerCase().includes(query) ||\n              item.jobNumber?.toLowerCase().includes(query) ||\n              item.address?.toLowerCase().includes(query)\n          );\n      }\n      \n      // Search in People details (Operative/Assistant)\n      if (item.type === 'operative' || item.type === 'assistant') {\n          const emp = employees.find(e => e.id === item.employeeId);\n          const veh = vehicles.find(v => v.id === item.vehicleId);\n          return (\n              emp?.name.toLowerCase().includes(query) ||\n              veh?.name.toLowerCase().includes(query)\n          );\n      }\n      return false;\n  });\n\n  return (\n    <div className=\"h-full flex flex-col bg-slate-50 text-slate-900\"\n        onKeyDown={(e) => { if(e.ctrlKey && !isReadOnly) setIsCtrlPressed(true); }}\n        onKeyUp={(e) => { if(!e.ctrlKey && !isReadOnly) setIsCtrlPressed(false); }}\n        tabIndex={0} // Make div focusable to catch key events\n    >\n      {/* Header */}\n      <div className=\"flex items-center justify-between p-4 border-b border-slate-200 bg-white sticky top-0 z-20 shadow-sm\">\n        <div className=\"flex items-center gap-4\">\n          <div className=\"flex items-center bg-slate-100 rounded-md border border-slate-200 p-0.5\">\n            <Button variant=\"ghost\" size=\"icon\" onClick={() => setCurrentDate(addDays(currentDate, -7))} className=\"h-8 w-8 hover:bg-white text-slate-500 hover:text-slate-900\">\n              <ChevronLeft className=\"w-4 h-4\" />\n            </Button>\n            <div className=\"px-4 font-medium min-w-[140px] text-center flex items-center gap-2 justify-center text-sm\">\n              <CalendarIcon className=\"w-4 h-4 text-blue-600\" />\n              {format(weekStart, \"MMM d\")} - {format(addDays(weekStart, viewDays - 1), \"MMM d, yyyy\")}\n            </div>\n            <Button variant=\"ghost\" size=\"icon\" onClick={() => setCurrentDate(addDays(currentDate, 7))} className=\"h-8 w-8 hover:bg-white text-slate-500 hover:text-slate-900\">\n              <ChevronRight className=\"w-4 h-4\" />\n            </Button>\n          </div>\n          <div className=\"flex items-center bg-slate-100 rounded-md border border-slate-200 p-0.5\">\n             <Button \n                variant=\"ghost\" \n                size=\"sm\" \n                onClick={() => setViewDays(5)}\n                className={cn(\"h-8 text-xs px-3\", viewDays === 5 ? \"bg-white shadow-sm text-blue-600 font-medium hover:bg-white\" : \"text-slate-500 hover:text-slate-900\")}\n             >\n                5 Day\n             </Button>\n             <Button \n                variant=\"ghost\" \n                size=\"sm\" \n                onClick={() => setViewDays(7)}\n                className={cn(\"h-8 text-xs px-3\", viewDays === 7 ? \"bg-white shadow-sm text-blue-600 font-medium hover:bg-white\" : \"text-slate-500 hover:text-slate-900\")}\n             >\n                7 Day\n             </Button>\n          </div>\n          <div className=\"flex items-center bg-slate-100 rounded-md border border-slate-200 p-0.5 mr-2\">\n             <Button \n                variant=\"ghost\" \n                size=\"icon\" \n                onClick={onUndo}\n                disabled={!canUndo}\n                className={cn(\"h-8 w-8\", canUndo ? \"text-slate-700 hover:bg-white hover:text-slate-900\" : \"text-slate-300\")}\n                title=\"Undo\"\n             >\n                <RotateCcw className=\"w-4 h-4\" />\n             </Button>\n             <Button \n                variant=\"ghost\" \n                size=\"icon\" \n                onClick={onRedo}\n                disabled={!canRedo}\n                className={cn(\"h-8 w-8\", canRedo ? \"text-slate-700 hover:bg-white hover:text-slate-900\" : \"text-slate-300\")}\n                title=\"Redo\"\n             >\n                <RotateCw className=\"w-4 h-4\" />\n             </Button>\n          </div>\n          <Button variant=\"outline\" onClick={() => setCurrentDate(new Date())} className=\"border-slate-200 hover:bg-slate-50 text-slate-600\">\n            Today\n          </Button>\n\n           {/* Availability Search Button */}\n           <Button \n              variant=\"outline\" \n              className=\"ml-2 border-blue-200 bg-blue-50 text-blue-700 hover:bg-blue-100 hover:text-blue-800 hover:border-blue-300 shadow-sm transition-all\"\n              onClick={() => setSmartSearchOpen(true)}\n              title=\"Find earliest availability\"\n           >\n              <Truck className=\"w-4 h-4 mr-2\" /> Check Availability\n           </Button>\n\n           {/* Job Search Bar */}\n           <div className=\"relative w-64 ml-4\">\n            <Search className=\"absolute left-2.5 top-2.5 h-4 w-4 text-slate-400\" />\n            <Input\n              placeholder=\"Search jobs, people...\"\n              className=\"pl-9 h-10 bg-slate-50 border-slate-200 text-slate-800 focus:ring-blue-600 focus:bg-white transition-all\"\n              value={searchQuery}\n              onChange={(e) => setSearchQuery(e.target.value)}\n            />\n          </div>\n        </div>\n        \n        <div className=\"flex items-center gap-2\">\n            {!isReadOnly ? (\n                <Button variant=\"outline\" onClick={() => setResourcesModalOpen(true)} className=\"bg-white text-slate-700 border-slate-300 hover:bg-slate-50 gap-2\">\n                    <Settings className=\"w-4 h-4\" /> Manage Resources\n                </Button>\n            ) : (\n                <div className=\"flex items-center gap-2 text-slate-400 text-sm bg-slate-50 px-3 py-2 rounded-md border border-slate-200\">\n                    <Lock className=\"w-3 h-3\" /> Read Only View\n                </div>\n            )}\n        </div>\n      </div>\n\n      {/* Matrix Grid */}\n      <DndContext \n        sensors={sensors} \n        collisionDetection={closestCorners} \n        onDragStart={handleDragStart} \n        onDragEnd={handleDragEnd}\n        // Disable drag completely if read only\n        // Note: DndContext doesn't have a disabled prop, but we handle it in sensors/events\n      >\n        <div className=\"flex-1 overflow-auto bg-slate-50 relative\">\n            <table className=\"w-full border-collapse table-fixed\">\n                <thead className=\"sticky top-0 z-10 bg-white shadow-sm\">\n                    <tr>\n                        <th className=\"w-14 p-3 border-b border-r border-slate-200 bg-slate-50 text-center font-semibold text-slate-600 text-sm\">\n                            <div className=\"flex items-center justify-center\">\n                                {!isReadOnly && (\n                                    <Button \n                                        size=\"icon\" \n                                        variant=\"ghost\" \n                                        className=\"h-6 w-6 p-0 hover:bg-slate-100\"\n                                        onClick={() => setCrewModal({ isOpen: true, mode: 'create', name: \"\", shift: 'day' })}\n                                        title=\"Add new crew\"\n                                    >\n                                        <Plus className=\"w-4 h-4 text-slate-500\" />\n                                    </Button>\n                                )}\n                            </div>\n                        </th>\n                        {weekDays.map((day) => {\n                            const isToday = isSameDay(day, new Date());\n                            const dateKey = format(day, \"yyyy-MM-dd\");\n                            const status = emailStatus[dateKey];\n                            \n                            return (\n                                <th key={day.toString()} className={cn(\"p-3 border-b border-r border-slate-200 relative group/header\", isToday ? \"bg-blue-50/50\" : \"bg-white\")}>\n                                    <div className=\"flex flex-col items-center justify-center\">\n                                        <div className={cn(\"text-xs font-medium uppercase tracking-wider\", isToday ? \"text-blue-600\" : \"text-slate-500\")}>\n                                            {format(day, \"EEEE\")}\n                                        </div>\n                                        <div className={cn(\"text-xl font-light mt-0.5\", isToday ? \"text-blue-700\" : \"text-slate-700\")}>\n                                            {format(day, \"d\")}\n                                        </div>\n                                        \n                                        {/* Email Button */}\n                                        <div className=\"mt-2 w-full flex justify-center\">\n                                            <Button \n                                                size=\"sm\" \n                                                variant={status?.sent ? \"outline\" : \"destructive\"}\n                                                className={cn(\n                                                    \"h-6 text-[10px] px-2 flex items-center gap-1 transition-all\",\n                                                    status?.sent \n                                                        ? \"bg-green-50 text-green-700 border-green-200 hover:bg-green-100\" \n                                                        : \"bg-red-50 text-red-600 border-red-200 hover:bg-red-100 hover:text-red-700 shadow-sm opacity-70 group-hover/header:opacity-100\"\n                                                )}\n                                                onClick={() => handleSendDailyEmails(day)}\n                                                title={status?.sent ? `Sent at ${status.timestamp}` : \"Send daily schedule emails\"}\n                                            >\n                                                {status?.sent ? (\n                                                    <>\n                                                        <Check className=\"w-3 h-3\" /> Sent {status.timestamp}\n                                                    </>\n                                                ) : (\n                                                    <>\n                                                        <Mail className=\"w-3 h-3\" /> Email Schedule\n                                                    </>\n                                                )}\n                                            </Button>\n                                        </div>\n                                    </div>\n                                </th>\n                            );\n                        })}\n                    </tr>\n                </thead>\n                <tbody>\n                    {/* Night Shift Header */}\n                    <tr \n                        className=\"cursor-pointer hover:bg-slate-50 transition-colors bg-indigo-50/50\"\n                        onClick={() => setExpandedShifts(prev => ({ ...prev, night: !prev.night }))}\n                    >\n                        <td colSpan={viewDays + 1} className=\"p-2 border-b border-slate-200\">\n                            <div className=\"flex items-center gap-2 font-semibold text-indigo-900 text-sm\">\n                                {expandedShifts.night ? <ChevronDown className=\"w-4 h-4\" /> : <ChevronRightIcon className=\"w-4 h-4\" />}\n                                <Moon className=\"w-4 h-4 text-indigo-600\" />\n                                <span>Night Shift</span>\n                            </div>\n                        </td>\n                    </tr>\n\n                    {expandedShifts.night && [...crews]\n                        .filter(c => c.shift === 'night')\n                        .sort((a, b) => a.name.localeCompare(b.name))\n                        .map((crew) => (\n                        <tr key={crew.id} className=\"group\">\n                            <td className=\"p-2 border-b border-r border-slate-200 bg-white font-medium text-slate-700 align-top sticky left-0 z-10 w-14\">\n                                <div className=\"flex items-center justify-center h-full group relative\">\n                                    <TooltipProvider>\n                                        <Tooltip>\n                                            <TooltipTrigger asChild>\n                                                <div className=\"w-8 h-8 rounded-full bg-indigo-100 flex items-center justify-center shrink-0 cursor-help transition-all hover:ring-2 hover:ring-indigo-200 hover:scale-105\">\n                                                    <Moon className=\"w-4 h-4 text-indigo-600\" />\n                                                </div>\n                                            </TooltipTrigger>\n                                            <TooltipContent side=\"right\" className=\"flex flex-col gap-1 z-50\">\n                                                <p className=\"font-bold\">{crew.name}{crew.archivedAt && <span className=\"text-amber-500 ml-1\">(Archived)</span>}</p>\n                                                <p className=\"text-xs text-slate-400 uppercase\">Night Shift</p>\n                                                {!isReadOnly && !crew.archivedAt && (\n                                                    <div className=\"flex gap-1 mt-1 pt-1 border-t border-slate-700/50\">\n                                                        <Button \n                                                            variant=\"ghost\" \n                                                            size=\"sm\" \n                                                            className=\"h-6 px-2 text-xs hover:bg-white/10\"\n                                                            onClick={(e) => {\n                                                                e.stopPropagation();\n                                                                setCrewModal({ isOpen: true, mode: 'edit', id: crew.id, name: crew.name, shift: crew.shift || 'day' });\n                                                            }}\n                                                        >\n                                                            Edit\n                                                        </Button>\n                                                        <Button \n                                                            variant=\"ghost\" \n                                                            size=\"sm\" \n                                                            className=\"h-6 px-2 text-xs hover:bg-red-900/20 text-red-400 hover:text-red-300\"\n                                                            onClick={(e) => {\n                                                                e.stopPropagation();\n                                                                onCrewDelete(crew.id);\n                                                            }}\n                                                        >\n                                                            Archive\n                                                        </Button>\n                                                    </div>\n                                                )}\n                                            </TooltipContent>\n                                        </Tooltip>\n                                    </TooltipProvider>\n                                </div>\n                            </td>\n\n                            {weekDays.map((day) => {\n                                const dateStr = format(day, \"yyyy-MM-dd\");\n                                const cellId = `${crew.id}|${dateStr}`;\n                                const cellItems = filteredItems.filter(i => \n                                    isSameDay(new Date(i.date), day) && \n                                    i.crewId === crew.id\n                                );\n                                \n                                // Sort displayItems to match the visual rendering order (People first, then Jobs)\n                                const displayItems = [...cellItems].sort((a, b) => {\n                                    const aIsJob = a.type === 'job';\n                                    const bIsJob = b.type === 'job';\n                                    if (aIsJob === bIsJob) return 0;\n                                    return aIsJob ? 1 : -1; // People first, Jobs last\n                                });\n                                \n                                const peopleItems = displayItems.filter(i => i.type !== 'job' && i.type !== 'note');\n                                const noteItems = displayItems.filter(i => i.type === 'note');\n                                const jobItems = displayItems.filter(i => i.type === 'job');\n\n                                const isToday = isSameDay(day, new Date());\n\n                                return (\n                                    <DroppableCell \n                                        key={cellId}\n                                        id={cellId}\n                                        disabled={!isReadOnly && isBefore(startOfDay(day), today)}\n                                        onDoubleClick={(e) => {\n                                            e.stopPropagation();\n                                            handleCellDoubleClick(day, crew.id);\n                                        }}\n                                        className={cn(\n                                            \"border-b border-r border-slate-200 align-top p-1.5 transition-colors hover:bg-slate-50\",\n                                            isReadOnly ? \"\" : \"cursor-pointer\",\n                                            isToday ? \"bg-blue-50/20\" : \"\"\n                                        )}\n                                        style={{ minHeight: \"120px\" }}\n                                    >\n                                        <SortableContext \n                                            id={cellId} \n                                            items={displayItems.map(i => i.id)} \n                                            strategy={rectSortingStrategy}\n                                            disabled={isReadOnly}\n                                        >\n                                            <div className=\"h-full min-h-[120px] w-full flex flex-col gap-1 min-w-0\">\n                                                {peopleItems.length > 0 && (\n                                                    <div className={cn(\n                                                        \"w-full grid gap-1\",\n                                                        peopleItems.length === 1 ? \"grid-cols-1\" : \"grid-cols-2\"\n                                                    )}>\n                                                        {peopleItems.map((item) => (\n                                                            <OperativeCard \n                                                                key={item.id} \n                                                                item={item}\n                                                                onEdit={handleEditItem} \n                                                                onDelete={(id, mode) => handleDeleteItem(id, mode)} \n                                                                onDuplicate={(item, mode, days) => handleDuplicateItem(item, mode, days)} \n                                                                employees={employees}\n                                                                vehicles={vehicles}\n                                                                isReadOnly={isReadOnly || isBefore(startOfDay(new Date(item.date)), startOfDay(new Date()))}\n                                                                isSelected={selectedItemIds.has(item.id)}\n                                                                onToggleSelection={handleToggleSelection}\n                                                            />\n                                                        ))}\n                                                    </div>\n                                                )}\n                                                {noteItems.map((item) => (\n                                                    <NoteCard \n                                                        key={item.id} \n                                                        item={item} \n                                                        onEdit={handleEditItem} \n                                                        onDelete={(id, mode) => handleDeleteItem(id, mode)} \n                                                        onDuplicate={(item, mode, days) => handleDuplicateItem(item, mode, days)} \n                                                        isReadOnly={isReadOnly || isBefore(startOfDay(new Date(item.date)), startOfDay(new Date()))}\n                                                        isSelected={selectedItemIds.has(item.id)}\n                                                        onToggleSelection={handleToggleSelection}\n                                                    />\n                                                ))}\n                                                {jobItems.map((item) => (\n                                                    <SiteCard \n                                                        key={item.id} \n                                                        item={item} \n                                                        onEdit={handleEditItem} \n                                                        onDelete={(id, mode) => handleDeleteItem(id, mode)} \n                                                        onDuplicate={(item, mode, days) => handleDuplicateItem(item, mode, days)} \n                                                        isReadOnly={isReadOnly || isBefore(startOfDay(new Date(item.date)), startOfDay(new Date()))}\n                                                        isSelected={selectedItemIds.has(item.id)}\n                                                        onToggleSelection={handleToggleSelection}\n                                                    />\n                                                ))}\n                                            </div>\n                                        </SortableContext>\n                                    </DroppableCell>\n                                );\n                            })}\n                        </tr>\n                    ))}\n\n                    {/* Day Shift Header */}\n                    <tr \n                        className=\"cursor-pointer hover:bg-slate-50 transition-colors bg-amber-50/50\"\n                        onClick={() => setExpandedShifts(prev => ({ ...prev, day: !prev.day }))}\n                    >\n                        <td colSpan={viewDays + 1} className=\"p-2 border-b border-slate-200\">\n                            <div className=\"flex items-center gap-2 font-semibold text-amber-900 text-sm\">\n                                {expandedShifts.day ? <ChevronDown className=\"w-4 h-4\" /> : <ChevronRightIcon className=\"w-4 h-4\" />}\n                                <Sun className=\"w-4 h-4 text-amber-500\" />\n                                <span>Day Shift</span>\n                            </div>\n                        </td>\n                    </tr>\n\n                    {expandedShifts.day && [...crews]\n                        .filter(c => c.shift !== 'night')\n                        .sort((a, b) => a.name.localeCompare(b.name))\n                        .map((crew) => (\n                        <tr key={crew.id} className=\"group\">\n                            <td className=\"p-2 border-b border-r border-slate-200 bg-white font-medium text-slate-700 align-top sticky left-0 z-10 w-14\">\n                                <div className=\"flex items-center justify-center h-full group relative\">\n                                    <TooltipProvider>\n                                        <Tooltip>\n                                            <TooltipTrigger asChild>\n                                                <div className=\"w-8 h-8 rounded-full bg-amber-50 flex items-center justify-center shrink-0 cursor-help transition-all hover:ring-2 hover:ring-amber-200 hover:scale-105\">\n                                                    <Sun className=\"w-4 h-4 text-amber-500\" />\n                                                </div>\n                                            </TooltipTrigger>\n                                            <TooltipContent side=\"right\" className=\"flex flex-col gap-1 z-50\">\n                                                <p className=\"font-bold\">{crew.name}{crew.archivedAt && <span className=\"text-amber-500 ml-1\">(Archived)</span>}</p>\n                                                <p className=\"text-xs text-slate-400 uppercase\">Day Shift</p>\n                                                {!isReadOnly && !crew.archivedAt && (\n                                                    <div className=\"flex gap-1 mt-1 pt-1 border-t border-slate-700/50\">\n                                                        <Button \n                                                            variant=\"ghost\" \n                                                            size=\"sm\" \n                                                            className=\"h-6 px-2 text-xs hover:bg-white/10\"\n                                                            onClick={(e) => {\n                                                                e.stopPropagation();\n                                                                setCrewModal({ isOpen: true, mode: 'edit', id: crew.id, name: crew.name, shift: crew.shift || 'day' });\n                                                            }}\n                                                        >\n                                                            Edit\n                                                        </Button>\n                                                        <Button \n                                                            variant=\"ghost\" \n                                                            size=\"sm\" \n                                                            className=\"h-6 px-2 text-xs hover:bg-red-900/20 text-red-400 hover:text-red-300\"\n                                                            onClick={(e) => {\n                                                                e.stopPropagation();\n                                                                onCrewDelete(crew.id);\n                                                            }}\n                                                        >\n                                                            Archive\n                                                        </Button>\n                                                    </div>\n                                                )}\n                                            </TooltipContent>\n                                        </Tooltip>\n                                    </TooltipProvider>\n                                </div>\n                            </td>\n\n                            {weekDays.map((day) => {\n                                const dateStr = format(day, \"yyyy-MM-dd\");\n                                const cellId = `${crew.id}|${dateStr}`;\n                                const cellItems = filteredItems.filter(i => \n                                    isSameDay(new Date(i.date), day) && \n                                    i.crewId === crew.id\n                                );\n                                \n                                // Sort displayItems to match the visual rendering order (People first, then Jobs)\n                                const displayItems = [...cellItems].sort((a, b) => {\n                                    const aIsJob = a.type === 'job';\n                                    const bIsJob = b.type === 'job';\n                                    if (aIsJob === bIsJob) return 0;\n                                    return aIsJob ? 1 : -1; // People first, Jobs last\n                                });\n                                \n                                const peopleItems = displayItems.filter(i => i.type !== 'job' && i.type !== 'note');\n                                const noteItems = displayItems.filter(i => i.type === 'note');\n                                const jobItems = displayItems.filter(i => i.type === 'job');\n\n                                const isToday = isSameDay(day, new Date());\n\n                                return (\n                                    <DroppableCell \n                                        key={cellId}\n                                        id={cellId}\n                                        disabled={!isReadOnly && isBefore(startOfDay(day), today)}\n                                        onDoubleClick={(e) => {\n                                            e.stopPropagation();\n                                            handleCellDoubleClick(day, crew.id);\n                                        }}\n                                        className={cn(\n                                            \"border-b border-r border-slate-200 align-top p-1.5 transition-colors hover:bg-slate-50\",\n                                            isReadOnly ? \"\" : \"cursor-pointer\",\n                                            isToday ? \"bg-blue-50/20\" : \"\"\n                                        )}\n                                        style={{ minHeight: \"120px\" }}\n                                    >\n                                        <SortableContext \n                                            id={cellId} \n                                            items={displayItems.map(i => i.id)} \n                                            strategy={rectSortingStrategy}\n                                            disabled={isReadOnly}\n                                        >\n                                            <div className=\"h-full min-h-[120px] w-full flex flex-col gap-1 min-w-0\">\n                                                {peopleItems.length > 0 && (\n                                                    <div className={cn(\n                                                        \"w-full grid gap-1\",\n                                                        peopleItems.length === 1 ? \"grid-cols-1\" : \"grid-cols-2\"\n                                                    )}>\n                                                        {peopleItems.map((item) => (\n                                                            <OperativeCard \n                                                                key={item.id} \n                                                                item={item}\n                                                                onEdit={handleEditItem} \n                                                                onDelete={(id, mode) => handleDeleteItem(id, mode)} \n                                                                onDuplicate={(item, mode, days) => handleDuplicateItem(item, mode, days)} \n                                                                employees={employees}\n                                                                vehicles={vehicles}\n                                                                isReadOnly={isReadOnly || isBefore(startOfDay(new Date(item.date)), startOfDay(new Date()))}\n                                                                isSelected={selectedItemIds.has(item.id)}\n                                                                onToggleSelection={handleToggleSelection}\n                                                            />\n                                                        ))}\n                                                    </div>\n                                                )}\n                                                {noteItems.map((item) => (\n                                                    <NoteCard \n                                                        key={item.id} \n                                                        item={item} \n                                                        onEdit={handleEditItem} \n                                                        onDelete={(id, mode) => handleDeleteItem(id, mode)} \n                                                        onDuplicate={(item, mode, days) => handleDuplicateItem(item, mode, days)} \n                                                        isReadOnly={isReadOnly || isBefore(startOfDay(new Date(item.date)), startOfDay(new Date()))}\n                                                        isSelected={selectedItemIds.has(item.id)}\n                                                        onToggleSelection={handleToggleSelection}\n                                                    />\n                                                ))}\n                                                {jobItems.map((item) => (\n                                                    <SiteCard \n                                                        key={item.id} \n                                                        item={item} \n                                                        onEdit={handleEditItem} \n                                                        onDelete={(id, mode) => handleDeleteItem(id, mode)} \n                                                        onDuplicate={(item, mode, days) => handleDuplicateItem(item, mode, days)} \n                                                        isReadOnly={isReadOnly || isBefore(startOfDay(new Date(item.date)), startOfDay(new Date()))}\n                                                        isSelected={selectedItemIds.has(item.id)}\n                                                        onToggleSelection={handleToggleSelection}\n                                                    />\n                                                ))}\n                                            </div>\n                                        </SortableContext>\n                                    </DroppableCell>\n                                );\n                            })}\n                        </tr>\n                    ))}\n                </tbody>\n            </table>\n        </div>\n\n        <DragOverlay>\n          {activeItem ? (\n             activeItem.type === 'job' ? (\n                <div className=\"w-[200px] opacity-90 rotate-2 cursor-grabbing shadow-xl\">\n                    <SiteCard \n                        item={activeItem} \n                        onEdit={() => {}} \n                        onDelete={() => {}} \n                        onDuplicate={() => {}} \n                    />\n                </div>\n             ) : (\n                <div className=\"opacity-90 rotate-2 cursor-grabbing shadow-xl\">\n                    <OperativeCard \n                        item={activeItem} \n                        onEdit={() => {}} \n                        onDelete={() => {}} \n                        onDuplicate={() => {}} \n                        employees={employees}\n                        vehicles={vehicles}\n                    />\n                </div>\n             )\n          ) : null}\n        </DragOverlay>\n      </DndContext>\n\n      {/* Selection Menu Modal */}\n      <Dialog open={!!selectionMenu} onOpenChange={(open) => !open && setSelectionMenu(null)}>\n        <DialogContent className=\"sm:max-w-[400px] bg-white text-slate-900\">\n            <DialogHeader>\n                <DialogTitle>Add Item to Schedule</DialogTitle>\n            </DialogHeader>\n            <div className=\"grid gap-3 py-4\">\n                <Button onClick={() => handleSelection('operative')} className=\"justify-start h-12 text-lg bg-slate-50 text-slate-700 hover:bg-slate-100 border border-slate-200 shadow-sm\">\n                    <User className=\"mr-3 w-5 h-5\" /> Add Operative\n                </Button>\n                <Button onClick={() => handleSelection('assistant')} className=\"justify-start h-12 text-lg bg-amber-50 text-amber-700 hover:bg-amber-100 border border-amber-200 shadow-sm\">\n                    <UserPlus className=\"mr-3 w-5 h-5\" /> Add Assistant\n                </Button>\n                <Button onClick={() => handleSelection('note')} className=\"justify-start h-12 text-lg bg-red-50 text-red-700 hover:bg-red-100 border border-red-200 shadow-sm\">\n                    <FileText className=\"mr-3 w-5 h-5\" /> Add Note\n                </Button>\n                <Button onClick={() => handleSelection('job')} className=\"justify-start h-12 text-lg bg-blue-50 text-blue-700 hover:bg-blue-100 border border-blue-200 shadow-sm\">\n                    <Briefcase className=\"mr-3 w-5 h-5\" /> Add Site / Job\n                </Button>\n            </div>\n        </DialogContent>\n      </Dialog>\n\n      {/* Item Editor Modal */}\n      <ItemModal \n        open={modalState.isOpen} \n        onOpenChange={(isOpen) => setModalState(prev => ({ ...prev, isOpen }))}\n        onSubmit={handleModalSubmit}\n        type={modalState.type}\n        initialData={modalState.data || (modalState.target ? { date: modalState.target.date, crewId: modalState.target.crewId } : undefined)}\n        employees={employees}\n        vehicles={vehicles}\n        items={items} // Pass items for conflict detection\n        crews={crews} // Pass crews for validating assignments\n        colorLabels={colorLabels}\n        onColorLabelUpdate={onColorLabelUpdate}\n      />\n\n      {/* Crew Modal */}\n      <Dialog open={crewModal.isOpen} onOpenChange={(open) => setCrewModal(prev => ({ ...prev, isOpen: open }))}>\n        <DialogContent className=\"sm:max-w-[425px] bg-white text-slate-900\">\n            <DialogHeader>\n                <DialogTitle>{crewModal.mode === 'create' ? 'Add New Crew' : 'Edit Crew'}</DialogTitle>\n            </DialogHeader>\n            \n            {crewModal.mode === 'create' ? (\n               <div className=\"py-4 flex gap-4\">\n                  <Button \n                    onClick={() => onCrewCreate(\n                       (() => {\n                           const prefix = \"Day\";\n                           const count = crews.filter(c => c.shift === 'day' || !c.name.toLowerCase().includes(\"night\")).length;\n                           return `${prefix} ${count + 1}`;\n                       })(), \n                       'day'\n                    )} \n                    className=\"flex-1 h-24 flex flex-col gap-2 bg-amber-50 text-amber-700 hover:bg-amber-100 border border-amber-200\"\n                  >\n                    <Sun className=\"w-8 h-8\" />\n                    <span className=\"font-semibold text-lg\">Add Day Crew</span>\n                  </Button>\n                  \n                  <Button \n                    onClick={() => onCrewCreate(\n                       (() => {\n                           const prefix = \"Night\";\n                           const count = crews.filter(c => c.shift === 'night' || c.name.toLowerCase().includes(\"night\")).length;\n                           return `${prefix} ${count + 1}`;\n                       })(), \n                       'night'\n                    )}\n                    className=\"flex-1 h-24 flex flex-col gap-2 bg-indigo-50 text-indigo-700 hover:bg-indigo-100 border border-indigo-200\"\n                  >\n                    <Moon className=\"w-8 h-8\" />\n                    <span className=\"font-semibold text-lg\">Add Night Crew</span>\n                  </Button>\n               </div>\n            ) : (\n                <>\n                    <div className=\"grid gap-4 py-4\">\n                        <div className=\"grid grid-cols-4 items-center gap-4\">\n                            <Label htmlFor=\"name\" className=\"text-right\">Name</Label>\n                            <Input id=\"name\" value={crewModal.name} onChange={(e) => setCrewModal(prev => ({ ...prev, name: e.target.value }))} className=\"col-span-3\" />\n                        </div>\n                        <div className=\"grid grid-cols-4 items-center gap-4\">\n                            <Label htmlFor=\"shift\" className=\"text-right\">Shift</Label>\n                            <Select \n                                value={crewModal.shift} \n                                onValueChange={(val) => setCrewModal(prev => ({ ...prev, shift: val as 'day' | 'night' }))}\n                            >\n                                <SelectTrigger className=\"col-span-3\">\n                                    <SelectValue placeholder=\"Select shift type\" />\n                                </SelectTrigger>\n                                <SelectContent>\n                                    <SelectItem value=\"day\">Day Shift</SelectItem>\n                                    <SelectItem value=\"night\">Night Shift</SelectItem>\n                                </SelectContent>\n                            </Select>\n                        </div>\n                    </div>\n                    <DialogFooter>\n                        <Button type=\"button\" variant=\"outline\" onClick={() => setCrewModal(prev => ({ ...prev, isOpen: false }))}>Cancel</Button>\n                        <Button type=\"submit\" onClick={handleCrewSubmit} className=\"bg-blue-600 text-white hover:bg-blue-700\">\n                            Save Changes\n                        </Button>\n                    </DialogFooter>\n                </>\n            )}\n        </DialogContent>\n      </Dialog>\n\n      {/* Resources Manager Modal */}\n      <ResourcesModal \n        open={resourcesModalOpen} \n        onOpenChange={setResourcesModalOpen}\n        employees={employees}\n        vehicles={vehicles}\n        onEmployeeCreate={onEmployeeCreate}\n        onEmployeeUpdate={onEmployeeUpdate}\n        onEmployeeDelete={onEmployeeDelete}\n        onVehicleCreate={onVehicleCreate}\n        onVehicleUpdate={onVehicleUpdate}\n        onVehicleDelete={onVehicleDelete}\n      />\n\n      {/* Smart Search Modal */}\n      <SmartSearchModal \n        open={smartSearchOpen}\n        onOpenChange={setSmartSearchOpen}\n        items={allItems}\n        crews={allCrews || crews}\n        depots={depots}\n        vehicles={vehicles}\n        vehicleTypes={vehicleTypes}\n        colorLabels={colorLabels}\n        onBookSlot={(date, crewId, depotId, duration, color) => {\n            onItemCreate({\n                id: Math.random().toString(36).substr(2, 9),\n                type: 'job',\n                date: date,\n                crewId: crewId,\n                depotId: depotId,\n                duration: duration,\n                color: color,\n                customer: \"New Booking\",\n                address: \"TBC\",\n                startTime: \"08:00\",\n                onsiteTime: \"09:00\"\n            });\n        }}\n      />\n\n      {/* Email Preview Modal */}\n      {emailModalDate && (\n          <EmailPreviewModal\n            open={emailModalOpen}\n            onOpenChange={setEmailModalOpen}\n            date={emailModalDate}\n            items={items}\n            employees={employees.map(e => ({...e, jobRole: e.jobRole || 'operative'}))} // Normalize role just in case\n            onUpdateEmail={(id, email) => onEmployeeUpdate(id, employees.find(e => e.id === id)?.name || \"Unknown\", undefined, undefined, email)}\n            onSend={handleEmailSent}\n          />\n      )}\n    </div>\n  );\n}\n","path":null,"size_bytes":66824,"size_tokens":null},"client/src/components/ui/progress.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-2 w-full overflow-hidden rounded-full bg-primary/20\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n","path":null,"size_bytes":792,"size_tokens":null},"client/src/hooks/use-toast.ts":{"content":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","path":null,"size_bytes":3895,"size_tokens":null},"client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","path":null,"size_bytes":756,"size_tokens":null},"server/vite.ts":{"content":"import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config\";\nimport { nanoid } from \"nanoid\";\n\nconst viteLogger = createLogger();\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\nexport async function setupVite(app: Express, server: Server) {\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { server },\n    allowedHosts: true as const,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n  app.use(\"*\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        import.meta.dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n\nexport function serveStatic(app: Express) {\n  const distPath = path.resolve(import.meta.dirname, \"public\");\n\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"*\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n","path":null,"size_bytes":2263,"size_tokens":null},"client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  // @replit\n  // Whitespace-nowrap: Badges should never wrap.\n  \"whitespace-nowrap inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\" +\n  \" hover-elevate \",\n  {\n    variants: {\n      variant: {\n        default:\n          // @replit shadow-xs instead of shadow, no hover because we use hover-elevate\n          \"border-transparent bg-primary text-primary-foreground shadow-xs\",\n        secondary:\n          // @replit no hover because we use hover-elevate\n          \"border-transparent bg-secondary text-secondary-foreground\",\n        destructive:\n          // @replit shadow-xs instead of shadow, no hover because we use hover-elevate\n          \"border-transparent bg-destructive text-destructive-foreground shadow-xs\",\n          // @replit shadow-xs\" - use badge outline variable\n        outline: \"text-foreground border [border-color:var(--badge-outline)]\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  )\n}\n\nexport { Badge, badgeVariants }\n","path":null,"size_bytes":1522,"size_tokens":null},"client/src/components/ui/toaster.tsx":{"content":"import { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","path":null,"size_bytes":772,"size_tokens":null},"server/storage.ts":{"content":"import { \n  type User, \n  type InsertUser,\n  type Depot,\n  type InsertDepot,\n  type Crew,\n  type InsertCrew,\n  type Employee,\n  type InsertEmployee,\n  type Vehicle,\n  type InsertVehicle,\n  type ScheduleItem,\n  type InsertScheduleItem,\n  type ColorLabel,\n  type InsertColorLabel,\n  type Organization,\n  type InsertOrganization,\n  type OrganizationMembership,\n  type InsertMembership,\n  type TeamInvite,\n  type InsertTeamInvite,\n  type MemberRole,\n  type PlanType,\n  users,\n  depots,\n  crews,\n  employees,\n  vehicles,\n  scheduleItems,\n  colorLabels,\n  organizations,\n  organizationMemberships,\n  teamInvites,\n  PLAN_LIMITS,\n} from \"@shared/schema\";\nimport { db } from \"./db\";\nimport { eq, and, sql, desc, isNull, gte } from \"drizzle-orm\";\n\n// Helper to ensure db is available\nfunction getDb() {\n  if (!db) {\n    throw new Error(\"Database not configured. Please ensure DATABASE_URL is set.\");\n  }\n  return db;\n}\n\nexport interface IStorage {\n  // Users\n  getUser(id: string): Promise<User | undefined>;\n  getUserByUsername(username: string): Promise<User | undefined>;\n  createUser(user: InsertUser): Promise<User>;\n  updateUserStripeInfo(userId: string, stripeInfo: {\n    stripeCustomerId?: string;\n    stripeSubscriptionId?: string;\n    subscriptionStatus?: string;\n    trialEndsAt?: Date;\n  }): Promise<User | undefined>;\n  \n  // Organizations\n  getOrganization(id: string): Promise<Organization | undefined>;\n  getOrganizationByOwner(ownerId: string): Promise<Organization | undefined>;\n  createOrganization(org: InsertOrganization): Promise<Organization>;\n  updateOrganization(id: string, org: Partial<InsertOrganization>): Promise<Organization | undefined>;\n  \n  // Organization Memberships\n  getMembership(userId: string, organizationId: string): Promise<OrganizationMembership | undefined>;\n  getMembershipsByOrg(organizationId: string): Promise<OrganizationMembership[]>;\n  getMembershipsByUser(userId: string): Promise<OrganizationMembership[]>;\n  createMembership(membership: InsertMembership): Promise<OrganizationMembership>;\n  updateMembershipRole(id: string, role: MemberRole): Promise<OrganizationMembership | undefined>;\n  deleteMembership(id: string): Promise<void>;\n  \n  // Team Invites\n  getInviteById(id: string): Promise<TeamInvite | undefined>;\n  getInviteByToken(token: string): Promise<TeamInvite | undefined>;\n  getInvitesByOrg(organizationId: string): Promise<TeamInvite[]>;\n  createInvite(invite: InsertTeamInvite): Promise<TeamInvite>;\n  updateInvite(id: string, data: { token: string; expiresAt: Date }): Promise<TeamInvite | undefined>;\n  deleteInvite(id: string): Promise<void>;\n  \n  // Quota checking\n  getOrganizationCounts(organizationId: string): Promise<{\n    depots: number;\n    crews: number;\n    employees: number;\n    vehicles: number;\n    members: number;\n  }>;\n  \n  // Depots (by organization)\n  getDepotsByOrg(organizationId: string): Promise<Depot[]>;\n  getDepots(userId: string): Promise<Depot[]>;\n  getDepot(id: string): Promise<Depot | undefined>;\n  createDepot(depot: InsertDepot): Promise<Depot>;\n  updateDepot(id: string, depot: Partial<InsertDepot>): Promise<Depot | undefined>;\n  deleteDepot(id: string): Promise<void>;\n  \n  // Crews (by organization) - active only by default\n  getCrewsByOrg(organizationId: string): Promise<Crew[]>;\n  getAllCrewsByOrg(organizationId: string): Promise<Crew[]>;\n  getCrews(userId: string): Promise<Crew[]>;\n  getCrew(id: string): Promise<Crew | undefined>;\n  createCrew(crew: InsertCrew): Promise<Crew>;\n  updateCrew(id: string, crew: Partial<InsertCrew>): Promise<Crew | undefined>;\n  archiveCrew(id: string): Promise<Crew | undefined>;\n  restoreCrew(id: string): Promise<Crew | undefined>;\n  \n  // Employees (by organization)\n  getEmployeesByOrg(organizationId: string): Promise<Employee[]>;\n  getEmployees(userId: string): Promise<Employee[]>;\n  getEmployee(id: string): Promise<Employee | undefined>;\n  createEmployee(employee: InsertEmployee): Promise<Employee>;\n  updateEmployee(id: string, employee: Partial<InsertEmployee>): Promise<Employee | undefined>;\n  deleteEmployee(id: string): Promise<void>;\n  \n  // Vehicles (by organization)\n  getVehiclesByOrg(organizationId: string): Promise<Vehicle[]>;\n  getVehicles(userId: string): Promise<Vehicle[]>;\n  getVehicle(id: string): Promise<Vehicle | undefined>;\n  createVehicle(vehicle: InsertVehicle): Promise<Vehicle>;\n  updateVehicle(id: string, vehicle: Partial<InsertVehicle>): Promise<Vehicle | undefined>;\n  deleteVehicle(id: string): Promise<void>;\n  \n  // Schedule Items (by organization)\n  getScheduleItemsByOrg(organizationId: string, startDate?: Date, endDate?: Date): Promise<ScheduleItem[]>;\n  getPendingScheduleItems(organizationId: string): Promise<ScheduleItem[]>;\n  approveScheduleItem(id: string, approverId: string): Promise<ScheduleItem | undefined>;\n  rejectScheduleItem(id: string, approverId: string, reason: string): Promise<ScheduleItem | undefined>;\n  getScheduleItems(userId: string, startDate?: Date, endDate?: Date): Promise<ScheduleItem[]>;\n  getScheduleItem(id: string): Promise<ScheduleItem | undefined>;\n  createScheduleItem(item: InsertScheduleItem): Promise<ScheduleItem>;\n  updateScheduleItem(id: string, item: Partial<InsertScheduleItem>): Promise<ScheduleItem | undefined>;\n  deleteScheduleItem(id: string): Promise<void>;\n  \n  // Color Labels (by organization)\n  getColorLabelsByOrg(organizationId: string): Promise<ColorLabel[]>;\n  getColorLabels(userId: string): Promise<ColorLabel[]>;\n  getColorLabel(id: string): Promise<ColorLabel | undefined>;\n  upsertColorLabel(userId: string, color: string, label: string, organizationId?: string): Promise<ColorLabel>;\n  deleteColorLabel(id: string): Promise<void>;\n}\n\nexport class DatabaseStorage implements IStorage {\n  // ============= USERS =============\n  async getUser(id: string): Promise<User | undefined> {\n    const result = await getDb().select().from(users).where(eq(users.id, id));\n    return result[0];\n  }\n\n  async getUserByUsername(username: string): Promise<User | undefined> {\n    const result = await getDb().select().from(users).where(eq(users.username, username));\n    return result[0];\n  }\n\n  async createUser(insertUser: InsertUser): Promise<User> {\n    const result = await getDb().insert(users).values(insertUser).returning();\n    return result[0];\n  }\n\n  async updateUserStripeInfo(userId: string, stripeInfo: {\n    stripeCustomerId?: string;\n    stripeSubscriptionId?: string;\n    subscriptionStatus?: string;\n    trialEndsAt?: Date;\n  }): Promise<User | undefined> {\n    const result = await getDb().update(users).set(stripeInfo).where(eq(users.id, userId)).returning();\n    return result[0];\n  }\n\n  // ============= ORGANIZATIONS =============\n  async getOrganization(id: string): Promise<Organization | undefined> {\n    const result = await getDb().select().from(organizations).where(eq(organizations.id, id));\n    return result[0];\n  }\n\n  async getOrganizationByOwner(ownerId: string): Promise<Organization | undefined> {\n    const result = await getDb().select().from(organizations).where(eq(organizations.ownerId, ownerId));\n    return result[0];\n  }\n\n  async createOrganization(org: InsertOrganization): Promise<Organization> {\n    const result = await getDb().insert(organizations).values(org).returning();\n    return result[0];\n  }\n\n  async updateOrganization(id: string, org: Partial<InsertOrganization>): Promise<Organization | undefined> {\n    const result = await getDb().update(organizations).set(org).where(eq(organizations.id, id)).returning();\n    return result[0];\n  }\n\n  // ============= ORGANIZATION MEMBERSHIPS =============\n  async getMembership(userId: string, organizationId: string): Promise<OrganizationMembership | undefined> {\n    const result = await getDb().select().from(organizationMemberships).where(\n      and(eq(organizationMemberships.userId, userId), eq(organizationMemberships.organizationId, organizationId))\n    );\n    return result[0];\n  }\n\n  async getMembershipsByOrg(organizationId: string): Promise<OrganizationMembership[]> {\n    return await getDb().select().from(organizationMemberships).where(eq(organizationMemberships.organizationId, organizationId));\n  }\n\n  async getMembershipsByUser(userId: string): Promise<OrganizationMembership[]> {\n    return await getDb()\n      .select()\n      .from(organizationMemberships)\n      .where(eq(organizationMemberships.userId, userId))\n      .orderBy(desc(organizationMemberships.acceptedAt));\n  }\n\n  async getPrimaryMembership(userId: string): Promise<(OrganizationMembership & { organization: Organization }) | undefined> {\n    const memberships = await this.getMembershipsByUser(userId);\n    if (memberships.length === 0) return undefined;\n    \n    for (const membership of memberships) {\n      const org = await this.getOrganization(membership.organizationId);\n      if (org && org.ownerId === userId) {\n        return { ...membership, organization: org };\n      }\n    }\n    \n    const firstMembership = memberships[0];\n    const org = await this.getOrganization(firstMembership.organizationId);\n    if (!org) return undefined;\n    return { ...firstMembership, organization: org };\n  }\n\n  async createMembership(membership: InsertMembership): Promise<OrganizationMembership> {\n    const result = await getDb().insert(organizationMemberships).values(membership).returning();\n    return result[0];\n  }\n\n  async updateMembershipRole(id: string, role: MemberRole): Promise<OrganizationMembership | undefined> {\n    const result = await getDb().update(organizationMemberships).set({ role }).where(eq(organizationMemberships.id, id)).returning();\n    return result[0];\n  }\n\n  async deleteMembership(id: string): Promise<void> {\n    await getDb().delete(organizationMemberships).where(eq(organizationMemberships.id, id));\n  }\n\n  // ============= TEAM INVITES =============\n  async getInviteById(id: string): Promise<TeamInvite | undefined> {\n    const result = await getDb().select().from(teamInvites).where(eq(teamInvites.id, id));\n    return result[0];\n  }\n\n  async getInviteByToken(token: string): Promise<TeamInvite | undefined> {\n    const result = await getDb().select().from(teamInvites).where(eq(teamInvites.token, token));\n    return result[0];\n  }\n\n  async getInvitesByOrg(organizationId: string): Promise<TeamInvite[]> {\n    return await getDb().select().from(teamInvites).where(eq(teamInvites.organizationId, organizationId));\n  }\n\n  async createInvite(invite: InsertTeamInvite): Promise<TeamInvite> {\n    const result = await getDb().insert(teamInvites).values(invite).returning();\n    return result[0];\n  }\n\n  async updateInvite(id: string, data: { token: string; expiresAt: Date }): Promise<TeamInvite | undefined> {\n    const result = await getDb().update(teamInvites).set(data).where(eq(teamInvites.id, id)).returning();\n    return result[0];\n  }\n\n  async deleteInvite(id: string): Promise<void> {\n    await getDb().delete(teamInvites).where(eq(teamInvites.id, id));\n  }\n\n  // ============= QUOTA CHECKING =============\n  async getOrganizationCounts(organizationId: string): Promise<{\n    depots: number;\n    crews: number;\n    employees: number;\n    vehicles: number;\n    members: number;\n  }> {\n    const database = getDb();\n    \n    const [depotCount, crewCount, employeeCount, vehicleCount, memberCount] = await Promise.all([\n      database.select({ count: sql<number>`count(*)` }).from(depots).where(eq(depots.organizationId, organizationId)),\n      database.select({ count: sql<number>`count(*)` }).from(crews).where(eq(crews.organizationId, organizationId)),\n      database.select({ count: sql<number>`count(*)` }).from(employees).where(eq(employees.organizationId, organizationId)),\n      database.select({ count: sql<number>`count(*)` }).from(vehicles).where(eq(vehicles.organizationId, organizationId)),\n      database.select({ count: sql<number>`count(*)` }).from(organizationMemberships).where(eq(organizationMemberships.organizationId, organizationId)),\n    ]);\n\n    return {\n      depots: Number(depotCount[0]?.count || 0),\n      crews: Number(crewCount[0]?.count || 0),\n      employees: Number(employeeCount[0]?.count || 0),\n      vehicles: Number(vehicleCount[0]?.count || 0),\n      members: Number(memberCount[0]?.count || 0),\n    };\n  }\n\n  // ============= DEPOTS =============\n  async getDepotsByOrg(organizationId: string): Promise<Depot[]> {\n    return await getDb().select().from(depots).where(eq(depots.organizationId, organizationId));\n  }\n  async getDepots(userId: string): Promise<Depot[]> {\n    return await getDb().select().from(depots).where(eq(depots.userId, userId));\n  }\n\n  async getDepot(id: string): Promise<Depot | undefined> {\n    const result = await getDb().select().from(depots).where(eq(depots.id, id));\n    return result[0];\n  }\n\n  async createDepot(depot: InsertDepot): Promise<Depot> {\n    const result = await getDb().insert(depots).values(depot).returning();\n    return result[0];\n  }\n\n  async updateDepot(id: string, depot: Partial<InsertDepot>): Promise<Depot | undefined> {\n    const result = await getDb().update(depots).set(depot).where(eq(depots.id, id)).returning();\n    return result[0];\n  }\n\n  async deleteDepot(id: string): Promise<void> {\n    await getDb().delete(depots).where(eq(depots.id, id));\n  }\n\n  // ============= CREWS =============\n  async getCrewsByOrg(organizationId: string): Promise<Crew[]> {\n    return await getDb().select().from(crews).where(\n      and(eq(crews.organizationId, organizationId), isNull(crews.archivedAt))\n    );\n  }\n\n  async getAllCrewsByOrg(organizationId: string): Promise<Crew[]> {\n    return await getDb().select().from(crews).where(eq(crews.organizationId, organizationId));\n  }\n\n  async getCrews(userId: string): Promise<Crew[]> {\n    return await getDb().select().from(crews).where(\n      and(eq(crews.userId, userId), isNull(crews.archivedAt))\n    );\n  }\n\n  async getCrew(id: string): Promise<Crew | undefined> {\n    const result = await getDb().select().from(crews).where(eq(crews.id, id));\n    return result[0];\n  }\n\n  async createCrew(crew: InsertCrew): Promise<Crew> {\n    const result = await getDb().insert(crews).values(crew).returning();\n    return result[0];\n  }\n\n  async updateCrew(id: string, crew: Partial<InsertCrew>): Promise<Crew | undefined> {\n    const result = await getDb().update(crews).set(crew).where(eq(crews.id, id)).returning();\n    return result[0];\n  }\n\n  async archiveCrew(id: string): Promise<Crew | undefined> {\n    const database = getDb();\n    const today = new Date();\n    today.setHours(0, 0, 0, 0);\n    \n    // Use transaction to ensure atomicity\n    return await database.transaction(async (tx) => {\n      // Delete future schedule items for this crew (preserve historical data)\n      await tx.delete(scheduleItems).where(\n        and(eq(scheduleItems.crewId, id), gte(scheduleItems.date, today))\n      );\n      \n      // Archive the crew\n      const result = await tx.update(crews).set({ archivedAt: new Date() }).where(eq(crews.id, id)).returning();\n      return result[0];\n    });\n  }\n\n  async restoreCrew(id: string): Promise<Crew | undefined> {\n    const result = await getDb().update(crews).set({ archivedAt: null }).where(eq(crews.id, id)).returning();\n    return result[0];\n  }\n\n  // ============= EMPLOYEES =============\n  async getEmployeesByOrg(organizationId: string): Promise<Employee[]> {\n    return await getDb().select().from(employees).where(eq(employees.organizationId, organizationId));\n  }\n\n  async getEmployees(userId: string): Promise<Employee[]> {\n    return await getDb().select().from(employees).where(eq(employees.userId, userId));\n  }\n\n  async getEmployee(id: string): Promise<Employee | undefined> {\n    const result = await getDb().select().from(employees).where(eq(employees.id, id));\n    return result[0];\n  }\n\n  async createEmployee(employee: InsertEmployee): Promise<Employee> {\n    const result = await getDb().insert(employees).values(employee).returning();\n    return result[0];\n  }\n\n  async updateEmployee(id: string, employee: Partial<InsertEmployee>): Promise<Employee | undefined> {\n    const result = await getDb().update(employees).set(employee).where(eq(employees.id, id)).returning();\n    return result[0];\n  }\n\n  async deleteEmployee(id: string): Promise<void> {\n    await getDb().delete(employees).where(eq(employees.id, id));\n  }\n\n  // ============= VEHICLES =============\n  async getVehiclesByOrg(organizationId: string): Promise<Vehicle[]> {\n    return await getDb().select().from(vehicles).where(eq(vehicles.organizationId, organizationId));\n  }\n\n  async getVehicles(userId: string): Promise<Vehicle[]> {\n    return await getDb().select().from(vehicles).where(eq(vehicles.userId, userId));\n  }\n\n  async getVehicle(id: string): Promise<Vehicle | undefined> {\n    const result = await getDb().select().from(vehicles).where(eq(vehicles.id, id));\n    return result[0];\n  }\n\n  async createVehicle(vehicle: InsertVehicle): Promise<Vehicle> {\n    const result = await getDb().insert(vehicles).values(vehicle).returning();\n    return result[0];\n  }\n\n  async updateVehicle(id: string, vehicle: Partial<InsertVehicle>): Promise<Vehicle | undefined> {\n    const result = await getDb().update(vehicles).set(vehicle).where(eq(vehicles.id, id)).returning();\n    return result[0];\n  }\n\n  async deleteVehicle(id: string): Promise<void> {\n    await getDb().delete(vehicles).where(eq(vehicles.id, id));\n  }\n\n  // ============= SCHEDULE ITEMS =============\n  async getScheduleItemsByOrg(organizationId: string, startDate?: Date, endDate?: Date): Promise<ScheduleItem[]> {\n    return await getDb().select().from(scheduleItems).where(eq(scheduleItems.organizationId, organizationId));\n  }\n\n  async getPendingScheduleItems(organizationId: string): Promise<ScheduleItem[]> {\n    return await getDb().select().from(scheduleItems).where(\n      and(eq(scheduleItems.organizationId, organizationId), eq(scheduleItems.status, \"pending\"))\n    );\n  }\n\n  async approveScheduleItem(id: string, approverId: string): Promise<ScheduleItem | undefined> {\n    const result = await getDb().update(scheduleItems).set({\n      status: \"approved\",\n      approvedBy: approverId,\n      approvedAt: new Date(),\n    }).where(eq(scheduleItems.id, id)).returning();\n    return result[0];\n  }\n\n  async rejectScheduleItem(id: string, approverId: string, reason: string): Promise<ScheduleItem | undefined> {\n    const result = await getDb().update(scheduleItems).set({\n      status: \"rejected\",\n      approvedBy: approverId,\n      rejectionReason: reason,\n    }).where(eq(scheduleItems.id, id)).returning();\n    return result[0];\n  }\n\n  async getScheduleItems(userId: string, startDate?: Date, endDate?: Date): Promise<ScheduleItem[]> {\n    const database = getDb();\n    let query = database.select().from(scheduleItems).where(eq(scheduleItems.userId, userId));\n    \n    if (startDate && endDate) {\n      query = database.select().from(scheduleItems).where(\n        and(\n          eq(scheduleItems.userId, userId),\n        )\n      );\n    }\n    \n    return await query;\n  }\n\n  async getScheduleItem(id: string): Promise<ScheduleItem | undefined> {\n    const result = await getDb().select().from(scheduleItems).where(eq(scheduleItems.id, id));\n    return result[0];\n  }\n\n  async createScheduleItem(item: InsertScheduleItem): Promise<ScheduleItem> {\n    const result = await getDb().insert(scheduleItems).values(item).returning();\n    return result[0];\n  }\n\n  async updateScheduleItem(id: string, item: Partial<InsertScheduleItem>): Promise<ScheduleItem | undefined> {\n    const result = await getDb().update(scheduleItems).set(item).where(eq(scheduleItems.id, id)).returning();\n    return result[0];\n  }\n\n  async deleteScheduleItem(id: string): Promise<void> {\n    await getDb().delete(scheduleItems).where(eq(scheduleItems.id, id));\n  }\n\n  // ============= COLOR LABELS =============\n  async getColorLabelsByOrg(organizationId: string): Promise<ColorLabel[]> {\n    return await getDb().select().from(colorLabels).where(eq(colorLabels.organizationId, organizationId));\n  }\n\n  async getColorLabels(userId: string): Promise<ColorLabel[]> {\n    return await getDb().select().from(colorLabels).where(eq(colorLabels.userId, userId));\n  }\n\n  async getColorLabel(id: string): Promise<ColorLabel | undefined> {\n    const result = await getDb().select().from(colorLabels).where(eq(colorLabels.id, id));\n    return result[0];\n  }\n\n  async upsertColorLabel(userId: string, color: string, label: string, organizationId?: string): Promise<ColorLabel> {\n    const database = getDb();\n    // Check if exists\n    const existing = await database.select().from(colorLabels).where(\n      and(eq(colorLabels.userId, userId), eq(colorLabels.color, color))\n    );\n    \n    if (existing.length > 0) {\n      const result = await database.update(colorLabels)\n        .set({ label })\n        .where(eq(colorLabels.id, existing[0].id))\n        .returning();\n      return result[0];\n    } else {\n      const result = await database.insert(colorLabels)\n        .values({ userId, color, label, organizationId })\n        .returning();\n      return result[0];\n    }\n  }\n\n  async deleteColorLabel(id: string): Promise<void> {\n    await getDb().delete(colorLabels).where(eq(colorLabels.id, id));\n  }\n}\n\nexport const storage = new DatabaseStorage();\n","path":null,"size_bytes":21193,"size_tokens":null},"client/src/components/ui/chart.tsx":{"content":"import * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item?.dataKey || item?.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload\n            .filter((item) => item.type !== \"none\")\n            .map((item, index) => {\n              const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n              const itemConfig = getPayloadConfigFromPayload(config, item, key)\n              const indicatorColor = color || item.payload.fill || item.color\n\n              return (\n                <div\n                  key={item.dataKey}\n                  className={cn(\n                    \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                    indicator === \"dot\" && \"items-center\"\n                  )}\n                >\n                  {formatter && item?.value !== undefined && item.name ? (\n                    formatter(item.value, item.name, item, index, item.payload)\n                  ) : (\n                    <>\n                      {itemConfig?.icon ? (\n                        <itemConfig.icon />\n                      ) : (\n                        !hideIndicator && (\n                          <div\n                            className={cn(\n                              \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                              {\n                                \"h-2.5 w-2.5\": indicator === \"dot\",\n                                \"w-1\": indicator === \"line\",\n                                \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                  indicator === \"dashed\",\n                                \"my-0.5\": nestLabel && indicator === \"dashed\",\n                              }\n                            )}\n                            style={\n                              {\n                                \"--color-bg\": indicatorColor,\n                                \"--color-border\": indicatorColor,\n                              } as React.CSSProperties\n                            }\n                          />\n                        )\n                      )}\n                      <div\n                        className={cn(\n                          \"flex flex-1 justify-between leading-none\",\n                          nestLabel ? \"items-end\" : \"items-center\"\n                        )}\n                      >\n                        <div className=\"grid gap-1.5\">\n                          {nestLabel ? tooltipLabel : null}\n                          <span className=\"text-muted-foreground\">\n                            {itemConfig?.label || item.name}\n                          </span>\n                        </div>\n                        {item.value && (\n                          <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                            {item.value.toLocaleString()}\n                          </span>\n                        )}\n                      </div>\n                    </>\n                  )}\n                </div>\n              )\n            })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload\n          .filter((item) => item.type !== \"none\")\n          .map((item) => {\n            const key = `${nameKey || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n            return (\n              <div\n                key={item.value}\n                className={cn(\n                  \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n                )}\n              >\n                {itemConfig?.icon && !hideIcon ? (\n                  <itemConfig.icon />\n                ) : (\n                  <div\n                    className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                    style={{\n                      backgroundColor: item.color,\n                    }}\n                  />\n                )}\n                {itemConfig?.label}\n              </div>\n            )\n          })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","path":null,"size_bytes":10763,"size_tokens":null},"client/src/components/ui/drawer.tsx":{"content":"import * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = \"Drawer\"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\n        className\n      )}\n      {...props}\n    >\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = \"DrawerContent\"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = \"DrawerHeader\"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = \"DrawerFooter\"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n","path":null,"size_bytes":3007,"size_tokens":null},"client/src/components/ui/breadcrumb.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<\"a\"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn(\"transition-colors hover:text-foreground\", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:w-3.5 [&>svg]:h-3.5\", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","path":null,"size_bytes":2712,"size_tokens":null},"client/src/pages/home.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Check, Shield, Upload, BarChart3, CalendarDays, Users, Zap, GripHorizontal, Loader2 } from \"lucide-react\";\nimport { Label } from \"@/components/ui/label\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription, CardFooter } from \"@/components/ui/card\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useQuery } from \"@tanstack/react-query\";\n\ninterface Price {\n  id: string;\n  unit_amount: number;\n  currency: string;\n  recurring: { interval: string } | null;\n  active: boolean;\n  metadata: Record<string, string> | null;\n}\n\ninterface Product {\n  id: string;\n  name: string;\n  description: string | null;\n  active: boolean;\n  metadata: Record<string, string> | null;\n  prices: Price[];\n}\n\nexport default function HomePage() {\n  const [email, setEmail] = useState(\"\");\n  const [password, setPassword] = useState(\"\");\n  const [fullName, setFullName] = useState(\"\");\n  const [company, setCompany] = useState(\"\");\n  const [isYearly, setIsYearly] = useState(true);\n  const [isLoginMode, setIsLoginMode] = useState(true);\n  const [loading, setLoading] = useState(false);\n  const [checkoutLoading, setCheckoutLoading] = useState<string | null>(null);\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n\n  const { data: productsData, isLoading: productsLoading } = useQuery<{ data: Product[] }>({\n    queryKey: ['/api/stripe/products'],\n    queryFn: async () => {\n      const res = await fetch('/api/stripe/products');\n      if (!res.ok) throw new Error('Failed to fetch products');\n      return res.json();\n    },\n  });\n\n  const products = productsData?.data || [];\n  const starterProduct = products.find(p => p.metadata?.tier === 'starter');\n  const proProduct = products.find(p => p.metadata?.tier === 'pro');\n\n  const getPrice = (product: Product | undefined, interval: 'month' | 'year') => {\n    if (!product) return null;\n    return product.prices.find(p => p.recurring?.interval === interval);\n  };\n\n  const formatPrice = (price: Price | null | undefined) => {\n    if (!price) return '‚Äî';\n    const amount = price.unit_amount / 100;\n    const currency = price.currency.toUpperCase();\n    const symbol = currency === 'GBP' ? '¬£' : currency === 'USD' ? '$' : currency === 'EUR' ? '‚Ç¨' : currency;\n    return `${symbol}${amount}`;\n  };\n\n  const handleCheckout = async (priceId: string, trialDays?: number) => {\n    setCheckoutLoading(priceId);\n    try {\n      const res = await fetch('/api/stripe/checkout', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ priceId, trialDays }),\n      });\n\n      if (res.status === 401) {\n        toast({\n          title: \"Please sign in first\",\n          description: \"Create an account or sign in to start your subscription\",\n          variant: \"destructive\",\n        });\n        setIsLoginMode(false);\n        return;\n      }\n\n      if (!res.ok) {\n        const error = await res.json();\n        throw new Error(error.error || 'Checkout failed');\n      }\n\n      const { url } = await res.json();\n      if (url) {\n        window.location.href = url;\n      }\n    } catch (error: any) {\n      toast({\n        title: \"Checkout failed\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    } finally {\n      setCheckoutLoading(null);\n    }\n  };\n\n  const handleLogin = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setLoading(true);\n    \n    try {\n      const response = await fetch(\"/api/login\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ username: email, password }),\n      });\n\n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.error || \"Login failed\");\n      }\n\n      toast({\n        title: \"Welcome back!\",\n        description: \"Logged in successfully\",\n      });\n      \n      setLocation(\"/schedule\");\n    } catch (error: any) {\n      toast({\n        title: \"Login failed\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleRegister = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setLoading(true);\n    \n    try {\n      const response = await fetch(\"/api/register\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ \n          username: email, \n          password, \n          email,\n          role: \"user\" \n        }),\n      });\n\n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.error || \"Registration failed\");\n      }\n\n      toast({\n        title: \"Account created!\",\n        description: \"Welcome to Sewer Swarm AI\",\n      });\n      \n      setLocation(\"/schedule\");\n    } catch (error: any) {\n      toast({\n        title: \"Registration failed\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-white font-sans text-slate-900\">\n      {/* Header */}\n      <header className=\"flex items-center justify-between px-6 py-4 max-w-7xl mx-auto\">\n        <div className=\"flex items-center gap-2\">\n             <div className=\"w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center shadow-sm shrink-0\">\n                <span className=\"text-white font-bold text-lg\">‚âà</span>\n             </div>\n             <span className=\"text-xl font-bold text-blue-900 tracking-tight\">Sewer Swarm AI</span>\n        </div>\n        <nav className=\"hidden md:flex items-center gap-8 text-sm font-medium text-slate-600\">\n          <a href=\"#features\" className=\"hover:text-blue-600 transition-colors\">Features</a>\n          <a href=\"#pricing\" className=\"hover:text-blue-600 transition-colors\">Pricing</a>\n          <a href=\"#\" className=\"hover:text-blue-600 transition-colors\">Standards</a>\n        </nav>\n        <div className=\"flex items-center gap-4\">\n          <Button variant=\"ghost\" className=\"text-slate-600 hover:text-blue-600\" onClick={() => setIsLoginMode(true)}>Sign In</Button>\n          <Button className=\"bg-blue-600 hover:bg-blue-700 text-white\" onClick={() => setIsLoginMode(false)}>Get Started</Button>\n        </div>\n      </header>\n\n      {/* Hero Section */}\n      <section className=\"px-6 py-16 md:py-24 max-w-7xl mx-auto grid md:grid-cols-2 gap-12 items-center\">\n        <div className=\"space-y-8\">\n          <h1 className=\"text-4xl md:text-6xl font-bold text-slate-900 leading-tight\">\n            Sewer Swarm <br/>\n            <span className=\"text-blue-900\">Intelligent Crew Scheduling</span>\n          </h1>\n          <p className=\"text-lg text-slate-600 max-w-lg leading-relaxed\">\n            The ultimate drag-and-drop scheduling platform built for drainage, civils, CCTV surveying, jetting, lining, and utility contractors. Optimise your workforce with AI-driven logic, instant conflict alerts, and real-time crew visibility.\n          </p>\n          \n          <div className=\"space-y-4\">\n            <div className=\"flex items-start gap-3\">\n              <div className=\"mt-1 w-5 h-5 rounded-full bg-blue-600 flex items-center justify-center shrink-0\">\n                <Check className=\"w-3 h-3 text-white\" />\n              </div>\n              <div>\n                <h3 className=\"font-semibold text-slate-900\">Drag & Drop Simplicity</h3>\n                <p className=\"text-sm text-slate-500\">Assign jobs, operatives, assistants, and vehicles in seconds. Reschedule effortlessly across days and depots.</p>\n              </div>\n            </div>\n            <div className=\"flex items-start gap-3\">\n              <div className=\"mt-1 w-5 h-5 rounded-full bg-blue-600 flex items-center justify-center shrink-0\">\n                <Check className=\"w-3 h-3 text-white\" />\n              </div>\n              <div>\n                <h3 className=\"font-semibold text-slate-900\">AI Logic Engine</h3>\n                <p className=\"text-sm text-slate-500\">Automatically detects clashes, double-bookings, and vehicle conflicts. Suggests optimal crew setups for each job.</p>\n              </div>\n            </div>\n            <div className=\"flex items-start gap-3\">\n              <div className=\"mt-1 w-5 h-5 rounded-full bg-blue-600 flex items-center justify-center shrink-0\">\n                <Check className=\"w-3 h-3 text-white\" />\n              </div>\n              <div>\n                <h3 className=\"font-semibold text-slate-900\">Utility-Grade Performance</h3>\n                <p className=\"text-sm text-slate-500\">Built for companies of all sizes ‚Äî from single-van operators to multi-depot utility contractors.</p>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        {/* Login/Signup Card */}\n        <div className=\"flex justify-center md:justify-end\">\n          <Card className=\"w-full max-w-md shadow-xl border-slate-100\">\n            <CardHeader className=\"space-y-1\">\n              <CardTitle className=\"text-2xl font-bold\">{isLoginMode ? \"Welcome Back\" : \"Create Your Account\"}</CardTitle>\n              <CardDescription>\n                {isLoginMode ? \"Sign in to manage your teams, jobs, and depot schedules.\" : \"Start your 1-month free trial ‚Äî no credit card required.\"}\n              </CardDescription>\n            </CardHeader>\n            <CardContent>\n              {isLoginMode ? (\n                <form onSubmit={handleLogin} className=\"space-y-4\">\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"email\">Email</Label>\n                    <Input \n                      id=\"email\" \n                      type=\"email\" \n                      placeholder=\"yourname@company.com\" \n                      value={email}\n                      onChange={(e) => setEmail(e.target.value)}\n                      required\n                      className=\"border-slate-200 focus:ring-blue-600\"\n                    />\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"password\">Password</Label>\n                    <Input \n                      id=\"password\" \n                      type=\"password\" \n                      placeholder=\"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢\"\n                      value={password}\n                      onChange={(e) => setPassword(e.target.value)}\n                      required\n                      className=\"border-slate-200 focus:ring-blue-600\"\n                    />\n                  </div>\n                  <Button type=\"submit\" className=\"w-full bg-blue-600 hover:bg-blue-700 h-11 text-base\" disabled={loading}>\n                    {loading ? \"Signing in...\" : \"Sign In\"}\n                  </Button>\n                </form>\n              ) : (\n                <form onSubmit={handleRegister} className=\"space-y-3\">\n                  <div className=\"grid grid-cols-2 gap-3\">\n                    <div className=\"space-y-1\">\n                        <Label htmlFor=\"fullname\">Full Name</Label>\n                        <Input id=\"fullname\" placeholder=\"John Doe\" className=\"border-slate-200\" value={fullName} onChange={(e) => setFullName(e.target.value)} />\n                    </div>\n                    <div className=\"space-y-1\">\n                        <Label htmlFor=\"company\">Company</Label>\n                        <Input id=\"company\" placeholder=\"Acme Civils\" className=\"border-slate-200\" value={company} onChange={(e) => setCompany(e.target.value)} />\n                    </div>\n                  </div>\n                  <div className=\"space-y-1\">\n                    <Label htmlFor=\"signup-email\">Email</Label>\n                    <Input id=\"signup-email\" type=\"email\" placeholder=\"name@company.com\" className=\"border-slate-200\" required value={email} onChange={(e) => setEmail(e.target.value)} />\n                  </div>\n                  <div className=\"space-y-1\">\n                    <Label htmlFor=\"signup-pass\">Password</Label>\n                    <Input id=\"signup-pass\" type=\"password\" className=\"border-slate-200\" required minLength={6} value={password} onChange={(e) => setPassword(e.target.value)} />\n                  </div>\n                  <div className=\"space-y-1\">\n                    <Label htmlFor=\"plan\">Select your plan</Label>\n                    <select className=\"w-full h-10 px-3 py-2 rounded-md border border-slate-200 bg-white text-sm focus:ring-2 focus:ring-blue-600 focus:outline-none\">\n                        <option>Starter Team (Free Trial)</option>\n                        <option>Professional (Free Trial)</option>\n                    </select>\n                  </div>\n                  <Button type=\"submit\" className=\"w-full bg-blue-600 hover:bg-blue-700 h-11 text-base mt-2\" disabled={loading}>\n                    {loading ? \"Creating account...\" : \"Start Free Trial\"}\n                  </Button>\n                </form>\n              )}\n            </CardContent>\n            <CardFooter className=\"justify-center border-t border-slate-50 pt-6 pb-6 flex-col gap-2\">\n              {isLoginMode ? (\n                  <p className=\"text-sm text-slate-500\">\n                    New here? <button onClick={() => setIsLoginMode(false)} className=\"text-blue-600 hover:underline font-medium\">Start your free trial ‚Üí Sign Up</button>\n                  </p>\n              ) : (\n                  <p className=\"text-sm text-slate-500\">\n                    Already have an account? <button onClick={() => setIsLoginMode(true)} className=\"text-blue-600 hover:underline font-medium\">Sign In</button>\n                  </p>\n              )}\n            </CardFooter>\n          </Card>\n        </div>\n      </section>\n\n      {/* Features Section */}\n      <section id=\"features\" className=\"py-20 bg-slate-50 border-t border-slate-200\">\n        <div className=\"max-w-7xl mx-auto px-6\">\n          <div className=\"text-center max-w-2xl mx-auto mb-16\">\n            <h2 className=\"text-3xl font-bold text-slate-900 mb-4\">Why Choose Sewer Swarm AI?</h2>\n            <p className=\"text-slate-600 text-lg\">\n              Built specifically for utility managers who need speed, accuracy, and flexibility in their scheduling.\n            </p>\n          </div>\n\n          <div className=\"grid md:grid-cols-3 gap-8\">\n            {/* Feature 1 */}\n            <Card className=\"border-slate-200 shadow-sm hover:shadow-md transition-shadow\">\n              <CardHeader>\n                <div className=\"w-12 h-12 bg-blue-50 rounded-lg flex items-center justify-center mb-4\">\n                  <GripHorizontal className=\"w-6 h-6 text-blue-600\" />\n                </div>\n                <CardTitle className=\"text-xl\">Drag & Drop Interface</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <p className=\"text-slate-600 leading-relaxed\">\n                  A clean, intuitive calendar matrix built around drainage & civils workflows. Quickly move jobs, swap crews, and rebalance workloads during the working day.\n                </p>\n              </CardContent>\n            </Card>\n\n            {/* Feature 2 */}\n            <Card className=\"border-slate-200 shadow-sm hover:shadow-md transition-shadow\">\n              <CardHeader>\n                <div className=\"w-12 h-12 bg-purple-50 rounded-lg flex items-center justify-center mb-4\">\n                  <Zap className=\"w-6 h-6 text-purple-600\" />\n                </div>\n                <CardTitle className=\"text-xl\">AI Logic Engine</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <p className=\"text-slate-600 leading-relaxed\">\n                  Smart routing and conflict detection. The system flags clashes, advises on crew availability, and prevents double-booking of vans, operatives, or assistants.\n                </p>\n              </CardContent>\n            </Card>\n\n            {/* Feature 3 */}\n            <Card className=\"border-slate-200 shadow-sm hover:shadow-md transition-shadow\">\n              <CardHeader>\n                <div className=\"w-12 h-12 bg-green-50 rounded-lg flex items-center justify-center mb-4\">\n                  <Users className=\"w-6 h-6 text-green-600\" />\n                </div>\n                <CardTitle className=\"text-xl\">Crew Optimisation</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <p className=\"text-slate-600 leading-relaxed\">\n                  Instantly see spare capacity (‚Äúfree labour‚Äù), under-used vehicles, and depot-wide availability. Maximise efficiency and reduce wasted hours.\n                </p>\n              </CardContent>\n            </Card>\n          </div>\n        </div>\n      </section>\n\n      {/* Pricing Section */}\n      <section id=\"pricing\" className=\"py-20 bg-white\">\n        <div className=\"max-w-7xl mx-auto px-6\">\n          <div className=\"text-center max-w-2xl mx-auto mb-12\">\n            <h2 className=\"text-3xl font-bold text-slate-900 mb-4\">Flexible User Pricing</h2>\n            <p className=\"text-slate-600 text-lg mb-8\">\n              Scalable plans for contractors of all sizes ‚Äî no report fees, no per-job charges.\n            </p>\n            <div className=\"flex items-center justify-center gap-4\">\n              <span className={!isYearly ? \"font-semibold text-slate-900\" : \"text-slate-500\"}>Monthly</span>\n              <Switch checked={isYearly} onCheckedChange={setIsYearly} />\n              <span className={isYearly ? \"font-semibold text-slate-900\" : \"text-slate-500\"}>Yearly <span className=\"text-green-600 text-sm font-bold\">(Save 20%)</span></span>\n            </div>\n          </div>\n\n          <div className=\"grid md:grid-cols-3 gap-6 max-w-5xl mx-auto\">\n            {/* Starter */}\n            <Card className=\"border-slate-200 shadow-sm hover:shadow-md transition-all flex flex-col\">\n              <CardHeader className=\"text-center pb-2\">\n                <CardTitle className=\"text-xl\">Starter Team</CardTitle>\n              </CardHeader>\n              <CardContent className=\"text-center flex-1\">\n                {productsLoading ? (\n                  <div className=\"flex justify-center py-8\">\n                    <Loader2 className=\"w-6 h-6 animate-spin text-slate-400\" />\n                  </div>\n                ) : (\n                  <>\n                    <div className=\"text-4xl font-bold text-slate-900 mb-1\">\n                      {formatPrice(getPrice(starterProduct, isYearly ? 'year' : 'month'))}\n                    </div>\n                    <div className=\"text-sm text-slate-500 mb-6\">\n                      {isYearly ? 'per year' : 'per month'}\n                    </div>\n                  </>\n                )}\n                <p className=\"text-sm text-slate-600 mb-4 italic\">Perfect for small contractors and 1‚Äì5 person teams.</p>\n                <Button \n                  variant=\"outline\" \n                  className=\"w-full mb-6\"\n                  disabled={!starterProduct || checkoutLoading !== null}\n                  onClick={() => {\n                    const price = getPrice(starterProduct, isYearly ? 'year' : 'month');\n                    if (price) handleCheckout(price.id, 30);\n                  }}\n                  data-testid=\"button-starter-checkout\"\n                >\n                  {checkoutLoading === getPrice(starterProduct, isYearly ? 'year' : 'month')?.id ? (\n                    <><Loader2 className=\"w-4 h-4 mr-2 animate-spin\" /> Processing...</>\n                  ) : (\n                    'Start Free Trial'\n                  )}\n                </Button>\n                <ul className=\"text-left space-y-3 text-sm text-slate-600\">\n                  <li className=\"flex items-center gap-2\"><Check className=\"w-4 h-4 text-green-500\" /> Up to 3 Crews</li>\n                  <li className=\"flex items-center gap-2\"><Check className=\"w-4 h-4 text-green-500\" /> Up to 10 Employees</li>\n                  <li className=\"flex items-center gap-2\"><Check className=\"w-4 h-4 text-green-500\" /> Up to 5 Vehicles</li>\n                  <li className=\"flex items-center gap-2\"><Check className=\"w-4 h-4 text-green-500\" /> Drag-and-drop Scheduling</li>\n                  <li className=\"flex items-center gap-2 font-semibold text-blue-600\"><Check className=\"w-4 h-4 text-blue-600\" /> 30-Day Free Trial</li>\n                </ul>\n              </CardContent>\n            </Card>\n\n            {/* Professional - Featured */}\n            <Card className=\"border-blue-600 shadow-lg scale-105 z-10 flex flex-col relative bg-white\">\n                <div className=\"absolute -top-4 left-1/2 -translate-x-1/2 bg-blue-600 text-white px-4 py-1 rounded-full text-xs font-bold uppercase tracking-wide\">\n                    Most Popular\n                </div>\n              <CardHeader className=\"text-center pb-2 pt-8\">\n                <CardTitle className=\"text-xl\">Professional</CardTitle>\n              </CardHeader>\n              <CardContent className=\"text-center flex-1\">\n                {productsLoading ? (\n                  <div className=\"flex justify-center py-8\">\n                    <Loader2 className=\"w-6 h-6 animate-spin text-slate-400\" />\n                  </div>\n                ) : (\n                  <>\n                    <div className=\"text-4xl font-bold text-slate-900 mb-1\">\n                      {formatPrice(getPrice(proProduct, isYearly ? 'year' : 'month'))}\n                    </div>\n                    <div className=\"text-sm text-slate-500 mb-6\">\n                      {isYearly ? 'per year' : 'per month'}\n                    </div>\n                  </>\n                )}\n                <p className=\"text-sm text-slate-600 mb-4 italic\">For growing drainage & civils teams needing automation and full visibility.</p>\n                <Button \n                  className=\"w-full bg-blue-600 hover:bg-blue-700 mb-6\"\n                  disabled={!proProduct || checkoutLoading !== null}\n                  onClick={() => {\n                    const price = getPrice(proProduct, isYearly ? 'year' : 'month');\n                    if (price) handleCheckout(price.id, 30);\n                  }}\n                  data-testid=\"button-pro-checkout\"\n                >\n                  {checkoutLoading === getPrice(proProduct, isYearly ? 'year' : 'month')?.id ? (\n                    <><Loader2 className=\"w-4 h-4 mr-2 animate-spin\" /> Processing...</>\n                  ) : (\n                    'Get Started'\n                  )}\n                </Button>\n                <ul className=\"text-left space-y-3 text-sm text-slate-600\">\n                  <li className=\"flex items-center gap-2\"><Check className=\"w-4 h-4 text-green-500\" /> Unlimited Crews</li>\n                  <li className=\"flex items-center gap-2\"><Check className=\"w-4 h-4 text-green-500\" /> Unlimited Employees</li>\n                  <li className=\"flex items-center gap-2\"><Check className=\"w-4 h-4 text-green-500\" /> Unlimited Vehicles</li>\n                  <li className=\"flex items-center gap-2\"><Check className=\"w-4 h-4 text-green-500\" /> Conflict Detection & Alerts</li>\n                  <li className=\"flex items-center gap-2\"><Check className=\"w-4 h-4 text-green-500\" /> Multi-depot Support</li>\n                  <li className=\"flex items-center gap-2\"><Check className=\"w-4 h-4 text-green-500\" /> Email Notifications</li>\n                  <li className=\"flex items-center gap-2 font-semibold text-blue-600\"><Check className=\"w-4 h-4 text-blue-600\" /> 30-Day Free Trial</li>\n                </ul>\n              </CardContent>\n            </Card>\n\n            {/* Enterprise */}\n            <Card className=\"border-slate-200 shadow-sm hover:shadow-md transition-all flex flex-col\">\n              <CardHeader className=\"text-center pb-2\">\n                <CardTitle className=\"text-xl\">Enterprise</CardTitle>\n              </CardHeader>\n              <CardContent className=\"text-center flex-1\">\n                <div className=\"text-4xl font-bold text-slate-900 mb-1\">Custom</div>\n                <div className=\"text-sm text-slate-500 mb-6\">contact sales</div>\n                <p className=\"text-sm text-slate-600 mb-4 italic\">For large contractors, multi-depot operations, or nationwide fleets.</p>\n                <Button variant=\"outline\" className=\"w-full mb-6\" data-testid=\"button-enterprise-contact\">Contact Us</Button>\n                <ul className=\"text-left space-y-3 text-sm text-slate-600\">\n                  <li className=\"flex items-center gap-2\"><Check className=\"w-4 h-4 text-green-500\" /> Dedicated Support Team</li>\n                  <li className=\"flex items-center gap-2\"><Check className=\"w-4 h-4 text-green-500\" /> Custom API Integrations</li>\n                  <li className=\"flex items-center gap-2\"><Check className=\"w-4 h-4 text-green-500\" /> White-Label Options</li>\n                  <li className=\"flex items-center gap-2\"><Check className=\"w-4 h-4 text-green-500\" /> Priority Feature Development</li>\n                </ul>\n              </CardContent>\n            </Card>\n          </div>\n        </div>\n      </section>\n\n      {/* Footer */}\n      <footer className=\"bg-slate-900 text-slate-400 py-12 border-t border-slate-800\">\n        <div className=\"max-w-7xl mx-auto px-6 grid md:grid-cols-4 gap-8\">\n            <div>\n                <h4 className=\"text-white font-bold text-lg mb-4\">Sewer Swarm AI</h4>\n                <p className=\"text-sm\">Revolutionizing utility scheduling with intelligent resource management.</p>\n                <p className=\"text-xs mt-4 text-slate-500\">Built for the UK Drainage, Civils & Utilities Industry</p>\n            </div>\n            <div>\n                <h4 className=\"text-white font-bold mb-4\">Product</h4>\n                <ul className=\"space-y-2 text-sm\">\n                    <li><a href=\"#\" className=\"hover:text-white\">Features</a></li>\n                    <li><a href=\"#\" className=\"hover:text-white\">Pricing</a></li>\n                    <li><a href=\"#\" className=\"hover:text-white\">Scheduling</a></li>\n                </ul>\n            </div>\n            <div>\n                <h4 className=\"text-white font-bold mb-4\">Company</h4>\n                <ul className=\"space-y-2 text-sm\">\n                    <li><a href=\"#\" className=\"hover:text-white\">About Us</a></li>\n                    <li><a href=\"#\" className=\"hover:text-white\">Contact</a></li>\n                    <li><a href=\"#\" className=\"hover:text-white\">Privacy Policy</a></li>\n                </ul>\n            </div>\n            <div>\n                <h4 className=\"text-white font-bold mb-4\">Connect</h4>\n                <p className=\"text-sm mb-4\">Follow us for updates on AI scheduling features.</p>\n            </div>\n        </div>\n        <div className=\"max-w-7xl mx-auto px-6 mt-12 pt-8 border-t border-slate-800 text-center text-xs\">\n            &copy; 2025 Sewer Swarm AI. All rights reserved.\n        </div>\n      </footer>\n    </div>\n  );\n}\n","path":null,"size_bytes":27081,"size_tokens":null},"client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","path":null,"size_bytes":140,"size_tokens":null},"client/src/components/ui/sheet.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=closed]:duration-300 data-[state=open]:duration-500 data-[state=open]:animate-in data-[state=closed]:animate-out\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4 border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n      {children}\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","path":null,"size_bytes":4280,"size_tokens":null},"client/src/components/ui/item.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Separator } from \"@/components/ui/separator\"\n\nfunction ItemGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      role=\"list\"\n      data-slot=\"item-group\"\n      className={cn(\"group/item-group flex flex-col\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction ItemSeparator({\n  className,\n  ...props\n}: React.ComponentProps<typeof Separator>) {\n  return (\n    <Separator\n      data-slot=\"item-separator\"\n      orientation=\"horizontal\"\n      className={cn(\"my-0\", className)}\n      {...props}\n    />\n  )\n}\n\nconst itemVariants = cva(\n  \"group/item [a]:hover:bg-accent/50 focus-visible:border-ring focus-visible:ring-ring/50 [a]:transition-colors flex flex-wrap items-center rounded-md border border-transparent text-sm outline-none transition-colors duration-100 focus-visible:ring-[3px]\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline: \"border-border\",\n        muted: \"bg-muted/50\",\n      },\n      size: {\n        default: \"gap-4 p-4 \",\n        sm: \"gap-2.5 px-4 py-3\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nfunction Item({\n  className,\n  variant = \"default\",\n  size = \"default\",\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"div\"> &\n  VariantProps<typeof itemVariants> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"div\"\n  return (\n    <Comp\n      data-slot=\"item\"\n      data-variant={variant}\n      data-size={size}\n      className={cn(itemVariants({ variant, size, className }))}\n      {...props}\n    />\n  )\n}\n\nconst itemMediaVariants = cva(\n  \"flex shrink-0 items-center justify-center gap-2 group-has-[[data-slot=item-description]]/item:translate-y-0.5 group-has-[[data-slot=item-description]]/item:self-start [&_svg]:pointer-events-none\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        icon: \"bg-muted size-8 rounded-sm border [&_svg:not([class*='size-'])]:size-4\",\n        image:\n          \"size-10 overflow-hidden rounded-sm [&_img]:size-full [&_img]:object-cover\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nfunction ItemMedia({\n  className,\n  variant = \"default\",\n  ...props\n}: React.ComponentProps<\"div\"> & VariantProps<typeof itemMediaVariants>) {\n  return (\n    <div\n      data-slot=\"item-media\"\n      data-variant={variant}\n      className={cn(itemMediaVariants({ variant, className }))}\n      {...props}\n    />\n  )\n}\n\nfunction ItemContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"item-content\"\n      className={cn(\n        \"flex flex-1 flex-col gap-1 [&+[data-slot=item-content]]:flex-none\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction ItemTitle({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"item-title\"\n      className={cn(\n        \"flex w-fit items-center gap-2 text-sm font-medium leading-snug\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction ItemDescription({ className, ...props }: React.ComponentProps<\"p\">) {\n  return (\n    <p\n      data-slot=\"item-description\"\n      className={cn(\n        \"text-muted-foreground line-clamp-2 text-balance text-sm font-normal leading-normal\",\n        \"[&>a:hover]:text-primary [&>a]:underline [&>a]:underline-offset-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction ItemActions({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"item-actions\"\n      className={cn(\"flex items-center gap-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction ItemHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"item-header\"\n      className={cn(\n        \"flex basis-full items-center justify-between gap-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction ItemFooter({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"item-footer\"\n      className={cn(\n        \"flex basis-full items-center justify-between gap-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Item,\n  ItemMedia,\n  ItemContent,\n  ItemActions,\n  ItemGroup,\n  ItemSeparator,\n  ItemTitle,\n  ItemDescription,\n  ItemHeader,\n  ItemFooter,\n}\n","path":null,"size_bytes":4494,"size_tokens":null},"client/src/components/ui/sidebar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, VariantProps } from \"class-variance-authority\"\nimport { PanelLeftIcon } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar_state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContextProps = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContextProps | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nfunction SidebarProvider({\n  defaultOpen = true,\n  open: openProp,\n  onOpenChange: setOpenProp,\n  className,\n  style,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  defaultOpen?: boolean\n  open?: boolean\n  onOpenChange?: (open: boolean) => void\n}) {\n  const isMobile = useIsMobile()\n  const [openMobile, setOpenMobile] = React.useState(false)\n\n  // This is the internal state of the sidebar.\n  // We use openProp and setOpenProp for control from outside the component.\n  const [_open, _setOpen] = React.useState(defaultOpen)\n  const open = openProp ?? _open\n  const setOpen = React.useCallback(\n    (value: boolean | ((value: boolean) => boolean)) => {\n      const openState = typeof value === \"function\" ? value(open) : value\n      if (setOpenProp) {\n        setOpenProp(openState)\n      } else {\n        _setOpen(openState)\n      }\n\n      // This sets the cookie to keep the sidebar state.\n      document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n    },\n    [setOpenProp, open]\n  )\n\n  // Helper to toggle the sidebar.\n  const toggleSidebar = React.useCallback(() => {\n    return isMobile ? setOpenMobile((open) => !open) : setOpen((open) => !open)\n  }, [isMobile, setOpen, setOpenMobile])\n\n  // Adds a keyboard shortcut to toggle the sidebar.\n  React.useEffect(() => {\n    const handleKeyDown = (event: KeyboardEvent) => {\n      if (\n        event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n        (event.metaKey || event.ctrlKey)\n      ) {\n        event.preventDefault()\n        toggleSidebar()\n      }\n    }\n\n    window.addEventListener(\"keydown\", handleKeyDown)\n    return () => window.removeEventListener(\"keydown\", handleKeyDown)\n  }, [toggleSidebar])\n\n  // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n  // This makes it easier to style the sidebar with Tailwind classes.\n  const state = open ? \"expanded\" : \"collapsed\"\n\n  const contextValue = React.useMemo<SidebarContextProps>(\n    () => ({\n      state,\n      open,\n      setOpen,\n      isMobile,\n      openMobile,\n      setOpenMobile,\n      toggleSidebar,\n    }),\n    [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n  )\n\n  return (\n    <SidebarContext.Provider value={contextValue}>\n      <TooltipProvider delayDuration={0}>\n        <div\n          data-slot=\"sidebar-wrapper\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH,\n              \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n              ...style,\n            } as React.CSSProperties\n          }\n          className={cn(\n            \"group/sidebar-wrapper has-data-[variant=inset]:bg-sidebar flex min-h-svh w-full\",\n            className\n          )}\n          {...props}\n        >\n          {children}\n        </div>\n      </TooltipProvider>\n    </SidebarContext.Provider>\n  )\n}\n\nfunction Sidebar({\n  side = \"left\",\n  variant = \"sidebar\",\n  collapsible = \"offcanvas\",\n  className,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  side?: \"left\" | \"right\"\n  variant?: \"sidebar\" | \"floating\" | \"inset\"\n  collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n}) {\n  const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n  if (collapsible === \"none\") {\n    return (\n      <div\n        data-slot=\"sidebar\"\n        className={cn(\n          \"bg-sidebar text-sidebar-foreground flex h-full w-[var(--sidebar-width)] flex-col\",\n          className\n        )}\n        {...props}\n      >\n        {children}\n      </div>\n    )\n  }\n\n  if (isMobile) {\n    return (\n      <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n        <SheetContent\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar\"\n          data-mobile=\"true\"\n          className=\"bg-sidebar text-sidebar-foreground w-[var(--sidebar-width)] p-0 [&>button]:hidden\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n            } as React.CSSProperties\n          }\n          side={side}\n        >\n          <SheetHeader className=\"sr-only\">\n            <SheetTitle>Sidebar</SheetTitle>\n            <SheetDescription>Displays the mobile sidebar.</SheetDescription>\n          </SheetHeader>\n          <div className=\"flex h-full w-full flex-col\">{children}</div>\n        </SheetContent>\n      </Sheet>\n    )\n  }\n\n  return (\n    <div\n      className=\"group peer text-sidebar-foreground hidden md:block\"\n      data-state={state}\n      data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n      data-variant={variant}\n      data-side={side}\n      data-slot=\"sidebar\"\n    >\n      {/* This is what handles the sidebar gap on desktop */}\n      <div\n        data-slot=\"sidebar-gap\"\n        className={cn(\n          \"relative w-[var(--sidebar-width)] bg-transparent transition-[width] duration-200 ease-linear\",\n          \"group-data-[collapsible=offcanvas]:w-0\",\n          \"group-data-[side=right]:rotate-180\",\n          variant === \"floating\" || variant === \"inset\"\n            ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4))]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)]\"\n        )}\n      />\n      <div\n        data-slot=\"sidebar-container\"\n        className={cn(\n          \"fixed inset-y-0 z-10 hidden h-svh w-[var(--sidebar-width)] transition-[left,right,width] duration-200 ease-linear md:flex\",\n          side === \"left\"\n            ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n            : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n          // Adjust the padding for floating and inset variants.\n          variant === \"floating\" || variant === \"inset\"\n            ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4)+2px)]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n          className\n        )}\n        {...props}\n      >\n        <div\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar-inner\"\n          className=\"bg-sidebar group-data-[variant=floating]:border-sidebar-border flex h-full w-full flex-col group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:shadow-sm\"\n        >\n          {children}\n        </div>\n      </div>\n    </div>\n  )\n}\n\nfunction SidebarTrigger({\n  className,\n  onClick,\n  ...props\n}: React.ComponentProps<typeof Button>) {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      data-sidebar=\"trigger\"\n      data-slot=\"sidebar-trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeftIcon />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n}\n\nfunction SidebarRail({ className, ...props }: React.ComponentProps<\"button\">) {\n  const { toggleSidebar } = useSidebar()\n\n  // Note: Tailwind v3.4 doesn't support \"in-\" selectors. So the rail won't work perfectly.\n  return (\n    <button\n      data-sidebar=\"rail\"\n      data-slot=\"sidebar-rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"hover:after:bg-sidebar-border absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear group-data-[side=left]:-right-4 group-data-[side=right]:left-0 after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] sm:flex\",\n        \"in-data-[side=left]:cursor-w-resize in-data-[side=right]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"hover:group-data-[collapsible=offcanvas]:bg-sidebar group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInset({ className, ...props }: React.ComponentProps<\"main\">) {\n  return (\n    <main\n      data-slot=\"sidebar-inset\"\n      className={cn(\n        \"bg-background relative flex w-full flex-1 flex-col\",\n        \"md:peer-data-[variant=inset]:m-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow-sm md:peer-data-[variant=inset]:peer-data-[state=collapsed]:ml-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInput({\n  className,\n  ...props\n}: React.ComponentProps<typeof Input>) {\n  return (\n    <Input\n      data-slot=\"sidebar-input\"\n      data-sidebar=\"input\"\n      className={cn(\"bg-background h-8 w-full shadow-none\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-header\"\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarFooter({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-footer\"\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarSeparator({\n  className,\n  ...props\n}: React.ComponentProps<typeof Separator>) {\n  return (\n    <Separator\n      data-slot=\"sidebar-separator\"\n      data-sidebar=\"separator\"\n      className={cn(\"bg-sidebar-border mx-2 w-auto\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-content\"\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group\"\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupLabel({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"div\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-label\"\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"text-sidebar-foreground/70 ring-sidebar-ring flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium outline-hidden transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:h-4 [&>svg]:w-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupAction({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"button\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-action\"\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground absolute top-3.5 right-3 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupContent({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group-content\"\n      data-sidebar=\"group-content\"\n      className={cn(\"w-full text-sm\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenu({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu\"\n      data-sidebar=\"menu\"\n      className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuItem({ className, ...props }: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-item\"\n      data-sidebar=\"menu-item\"\n      className={cn(\"group/menu-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-hidden ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-data-[sidebar=menu-action]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:w-8! group-data-[collapsible=icon]:h-8! group-data-[collapsible=icon]:p-2! [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:p-0!\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nfunction SidebarMenuButton({\n  asChild = false,\n  isActive = false,\n  variant = \"default\",\n  size = \"default\",\n  tooltip,\n  className,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  isActive?: boolean\n  tooltip?: string | React.ComponentProps<typeof TooltipContent>\n} & VariantProps<typeof sidebarMenuButtonVariants>) {\n  const Comp = asChild ? Slot : \"button\"\n  const { isMobile, state } = useSidebar()\n\n  const button = (\n    <Comp\n      data-slot=\"sidebar-menu-button\"\n      data-sidebar=\"menu-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n      {...props}\n    />\n  )\n\n  if (!tooltip) {\n    return button\n  }\n\n  if (typeof tooltip === \"string\") {\n    tooltip = {\n      children: tooltip,\n    }\n  }\n\n  return (\n    <Tooltip>\n      <TooltipTrigger asChild>{button}</TooltipTrigger>\n      <TooltipContent\n        side=\"right\"\n        align=\"center\"\n        hidden={state !== \"collapsed\" || isMobile}\n        {...tooltip}\n      />\n    </Tooltip>\n  )\n}\n\nfunction SidebarMenuAction({\n  className,\n  asChild = false,\n  showOnHover = false,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  showOnHover?: boolean\n}) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-action\"\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground peer-hover/menu-button:text-sidebar-accent-foreground absolute top-1.5 right-1 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"peer-data-[active=true]/menu-button:text-sidebar-accent-foreground group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuBadge({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-menu-badge\"\n      data-sidebar=\"menu-badge\"\n      className={cn(\n        \"text-sidebar-foreground pointer-events-none absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums select-none\",\n        \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSkeleton({\n  className,\n  showIcon = false,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  showIcon?: boolean\n}) {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      data-slot=\"sidebar-menu-skeleton\"\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 max-w-[var(--skeleton-width)] flex-1\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n}\n\nfunction SidebarMenuSub({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu-sub\"\n      data-sidebar=\"menu-sub\"\n      className={cn(\n        \"border-sidebar-border mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l px-2.5 py-0.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubItem({\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-sub-item\"\n      data-sidebar=\"menu-sub-item\"\n      className={cn(\"group/menu-sub-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubButton({\n  asChild = false,\n  size = \"md\",\n  isActive = false,\n  className,\n  ...props\n}: React.ComponentProps<\"a\"> & {\n  asChild?: boolean\n  size?: \"sm\" | \"md\"\n  isActive?: boolean\n}) {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-sub-button\"\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground active:bg-sidebar-accent active:text-sidebar-accent-foreground [&>svg]:text-sidebar-accent-foreground flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 outline outline-2 outline-transparent outline-offset-2 focus-visible:ring-2 disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","path":null,"size_bytes":21846,"size_tokens":null},"client/src/components/ui/resizable.tsx":{"content":"\"use client\"\n\nimport { GripVertical } from \"lucide-react\"\nimport * as ResizablePrimitive from \"react-resizable-panels\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ResizablePanelGroup = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\n  <ResizablePrimitive.PanelGroup\n    className={cn(\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst ResizablePanel = ResizablePrimitive.Panel\n\nconst ResizableHandle = ({\n  withHandle,\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\n  withHandle?: boolean\n}) => (\n  <ResizablePrimitive.PanelResizeHandle\n    className={cn(\n      \"relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\n      className\n    )}\n    {...props}\n  >\n    {withHandle && (\n      <div className=\"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border\">\n        <GripVertical className=\"h-2.5 w-2.5\" />\n      </div>\n    )}\n  </ResizablePrimitive.PanelResizeHandle>\n)\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n","path":null,"size_bytes":1723,"size_tokens":null},"client/src/components/ui/label.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","path":null,"size_bytes":724,"size_tokens":null},"client/src/components/schedule/Sidebar.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { cn } from \"@/lib/utils\";\nimport { Search, MapPin, Users, Truck, Check, ChevronLeft, ChevronRight, Trash2, Edit, MoreVertical, Plus, Settings, UserCog, CreditCard } from \"lucide-react\";\nimport { Input } from \"@/components/ui/input\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Button } from \"@/components/ui/button\";\nimport { DropdownMenu, DropdownMenuContent, DropdownMenuItem, DropdownMenuTrigger, DropdownMenuSeparator } from \"@/components/ui/dropdown-menu\";\n\ninterface Depot {\n  id: string;\n  name: string;\n  address: string;\n  employees: number;\n  vehicles: number;\n}\n\ninterface SidebarProps {\n  depots: Depot[];\n  selectedDepotId: string | null;\n  onSelectDepot: (id: string) => void;\n  onEditDepot: () => void;\n  onDeleteDepot?: (id: string) => void;\n  onUpdateDepot?: (id: string, updates: { name?: string, address?: string }) => void;\n  onAddDepot?: () => void;\n  isReadOnly?: boolean;\n  onOpenSettings?: () => void;\n  canAccessSettings?: boolean;\n}\n\nexport function Sidebar({ depots, selectedDepotId, onSelectDepot, onEditDepot = () => {}, onDeleteDepot = () => {}, onUpdateDepot = () => {}, onAddDepot = () => {}, isReadOnly = false, onOpenSettings, canAccessSettings = false }: SidebarProps) {\n  const [search, setSearch] = useState(\"\");\n  const [isCollapsed, setIsCollapsed] = useState(false);\n  const [editingDepotId, setEditingDepotId] = useState<string | null>(null);\n  const [editForm, setEditForm] = useState<{ name: string, address: string }>({ name: \"\", address: \"\" });\n\n  const handleToggle = () => {\n    setIsCollapsed(!isCollapsed);\n    // Dispatch resize event after transition to force layout update\n    setTimeout(() => {\n        window.dispatchEvent(new Event('resize'));\n    }, 305); // slightly longer than the 300ms transition\n  };\n\n  const filteredDepots = depots.filter(d => \n    d.name.toLowerCase().includes(search.toLowerCase()) || \n    d.address.toLowerCase().includes(search.toLowerCase())\n  );\n\n  return (\n    <div \n      className={cn(\n        \"bg-white border-r border-slate-200 flex flex-col h-full shadow-sm z-20 relative\",\n        isCollapsed ? \"w-14\" : \"w-72\"\n      )}\n      style={{ transition: \"width 300ms ease\" }} // Use standard CSS transition instead of Tailwind class for clarity/override\n    >\n      {/* Collapse Toggle Button */}\n      <Button\n        variant=\"outline\"\n        size=\"icon\"\n        className=\"absolute -right-3 top-6 w-6 h-6 rounded-full border-slate-200 shadow-sm z-30 bg-white hover:bg-slate-50 p-0\"\n        onClick={handleToggle}\n      >\n        {isCollapsed ? <ChevronRight className=\"w-3 h-3\" /> : <ChevronLeft className=\"w-3 h-3\" />}\n      </Button>\n\n      <div className={cn(\"border-b border-slate-200 bg-slate-50/50 transition-all\", isCollapsed ? \"p-2\" : \"p-4\")}>\n        <div className={cn(\"flex items-center gap-2 mb-5\", isCollapsed && \"justify-center mb-2\")}>\n             <div className=\"w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center shadow-sm shrink-0\">\n                <span className=\"text-white font-bold text-lg\">‚âà</span>\n             </div>\n             {!isCollapsed && (\n               <h2 className=\"text-lg font-bold text-slate-800 tracking-tight whitespace-nowrap overflow-hidden\">\n                Sewer Swarm\n               </h2>\n             )}\n        </div>\n        \n        {!isCollapsed && (\n          <div className=\"relative\">\n            <Search className=\"absolute left-2.5 top-2.5 h-4 w-4 text-slate-400\" />\n            <Input\n              placeholder=\"Search depots...\"\n              className=\"pl-9 bg-white border-slate-200 text-slate-800 focus:ring-blue-600 placeholder:text-slate-400 shadow-sm\"\n              value={search}\n              onChange={(e) => setSearch(e.target.value)}\n            />\n          </div>\n        )}\n      </div>\n\n      <ScrollArea className=\"flex-1 bg-white\">\n        <div className={cn(\"space-y-1\", isCollapsed ? \"p-2\" : \"p-3\")}>\n          {!isCollapsed && (\n            <div className=\"flex items-center justify-between px-2 py-1.5\">\n                <div className=\"text-xs font-semibold text-slate-400 uppercase tracking-wider\">\n                Your Depots\n                </div>\n                <Button \n                    variant=\"ghost\" \n                    size=\"icon\" \n                    className=\"h-5 w-5 text-slate-400 hover:text-blue-600 disabled:opacity-50\"\n                    onClick={onAddDepot}\n                    title=\"Add New Depot\"\n                    disabled={isReadOnly}\n                >\n                    <Plus className=\"w-3 h-3\" />\n                </Button>\n            </div>\n          )}\n          {filteredDepots.map((depot) => {\n             const isSelected = selectedDepotId === depot.id;\n             return (\n              <div key={depot.id} className=\"space-y-1\">\n                <div\n                  onClick={() => onSelectDepot(depot.id)}\n                  className={cn(\n                    \"group flex flex-col gap-1 rounded-lg cursor-pointer transition-all border\",\n                    isCollapsed ? \"p-2 items-center justify-center\" : \"p-3\",\n                    isSelected \n                      ? \"bg-blue-50 border-blue-200 shadow-sm\" \n                      : \"bg-transparent border-transparent hover:bg-slate-50 hover:border-slate-100\"\n                  )}\n                  title={isCollapsed ? depot.name : undefined}\n                >\n                  {isCollapsed ? (\n                    // Collapsed View Item\n                    <div className=\"flex flex-col items-center gap-1\">\n                      <span className={cn(\"font-bold text-xs\", isSelected ? \"text-blue-700\" : \"text-slate-700\")}>\n                        {depot.name.substring(0, 2).toUpperCase()}\n                      </span>\n                      {isSelected && <div className=\"w-1.5 h-1.5 rounded-full bg-blue-600\" />}\n                    </div>\n                  ) : (\n                    // Expanded View Item\n                    <>\n                      <div className=\"flex items-center justify-between\">\n                        <span className={cn(\"font-semibold text-sm truncate\", isSelected ? \"text-blue-700\" : \"text-slate-700\")}>\n                          {depot.name}\n                        </span>\n                        {isSelected && <Check className=\"w-3 h-3 text-blue-600\" />}\n                      </div>\n                      \n                      <div className=\"flex items-center gap-1.5 text-xs text-slate-500\">\n                        <MapPin className=\"w-3 h-3\" />\n                        <span className=\"truncate\">{depot.address}</span>\n                      </div>\n\n                      <div className=\"flex items-center justify-between mt-2\">\n                          <div className=\"flex items-center gap-3\">\n                              <div className={cn(\"flex items-center gap-1 text-[10px] px-2 py-0.5 rounded-full border\", isSelected ? \"bg-white border-blue-100 text-blue-600\" : \"bg-slate-100 border-slate-200 text-slate-500\")}>\n                                  <Users className=\"w-3 h-3\" /> {depot.employees}\n                              </div>\n                              <div className={cn(\"flex items-center gap-1 text-[10px] px-2 py-0.5 rounded-full border\", isSelected ? \"bg-white border-blue-100 text-blue-600\" : \"bg-slate-100 border-slate-200 text-slate-500\")}>\n                                  <Truck className=\"w-3 h-3\" /> {depot.vehicles}\n                              </div>\n                          </div>\n\n                          {isSelected && (\n                             <DropdownMenu>\n                                <DropdownMenuTrigger asChild>\n                                  <Button\n                                    size=\"sm\"\n                                    variant=\"ghost\"\n                                    className=\"h-7 w-7 p-0 hover:bg-slate-100 rounded-full\"\n                                    onClick={(e) => e.stopPropagation()}\n                                  >\n                                    <MoreVertical className=\"w-4 h-4 text-slate-600\" />\n                                  </Button>\n                                </DropdownMenuTrigger>\n                                <DropdownMenuContent align=\"end\" className=\"w-48\">\n                                  {!isReadOnly && (\n                                    <DropdownMenuItem\n                                        onClick={(e) => {\n                                            e.stopPropagation();\n                                            onEditDepot();\n                                        }}\n                                        className=\"cursor-pointer flex items-center gap-2\"\n                                    >\n                                        <Settings className=\"w-4 h-4\" />\n                                        <span>Manage Crews & Vehicles</span>\n                                    </DropdownMenuItem>\n                                  )}\n                                  {!isReadOnly && <DropdownMenuSeparator />}\n                                  {!isReadOnly && (\n                                    <DropdownMenuItem\n                                        onClick={(e) => {\n                                            e.stopPropagation();\n                                            setEditingDepotId(depot.id);\n                                            setEditForm({ name: depot.name, address: depot.address });\n                                        }}\n                                        className=\"cursor-pointer flex items-center gap-2\"\n                                    >\n                                        <Edit className=\"w-4 h-4\" />\n                                        <span>Edit Depot Details</span>\n                                    </DropdownMenuItem>\n                                  )}\n                                  {!isReadOnly && (\n                                    <DropdownMenuItem\n                                        onClick={(e) => {\n                                            e.stopPropagation();\n                                            onDeleteDepot(depot.id);\n                                        }}\n                                        className=\"cursor-pointer flex items-center gap-2 text-red-600 focus:text-red-600 focus:bg-red-50\"\n                                    >\n                                        <Trash2 className=\"w-4 h-4\" />\n                                        <span>Delete Depot</span>\n                                    </DropdownMenuItem>\n                                  )}\n                                  {isReadOnly && (\n                                    <DropdownMenuItem disabled className=\"text-xs text-slate-400\">\n                                        Read Only Mode\n                                    </DropdownMenuItem>\n                                  )}\n                                </DropdownMenuContent>\n                              </DropdownMenu>\n                          )}\n                      </div>\n                    </>\n                  )}\n                </div>\n                {isSelected && !isCollapsed && editingDepotId === depot.id && (\n                    <div className=\"flex flex-col gap-2 px-3 pb-3 bg-slate-50 rounded-b-lg -mt-1 border-x border-b border-blue-200\">\n                      <div className=\"space-y-1\">\n                        <label className=\"text-[10px] font-semibold text-slate-500 uppercase\">Depot Name</label>\n                        <input\n                          type=\"text\"\n                          value={editForm.name}\n                          onChange={(e) => setEditForm(prev => ({ ...prev, name: e.target.value }))}\n                          onKeyDown={(e) => {\n                            if (e.key === \"Enter\") {\n                              onUpdateDepot(depot.id, editForm);\n                              setEditingDepotId(null);\n                            } else if (e.key === \"Escape\") {\n                              setEditingDepotId(null);\n                            }\n                          }}\n                          autoFocus\n                          className=\"w-full text-xs px-2 py-1.5 rounded border border-slate-300 focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white\"\n                          placeholder=\"Depot Name\"\n                        />\n                      </div>\n                      \n                      <div className=\"space-y-1\">\n                        <label className=\"text-[10px] font-semibold text-slate-500 uppercase\">Address / Postcode</label>\n                        <input\n                          type=\"text\"\n                          value={editForm.address}\n                          onChange={(e) => setEditForm(prev => ({ ...prev, address: e.target.value }))}\n                          onKeyDown={(e) => {\n                            if (e.key === \"Enter\") {\n                              onUpdateDepot(depot.id, editForm);\n                              setEditingDepotId(null);\n                            } else if (e.key === \"Escape\") {\n                              setEditingDepotId(null);\n                            }\n                          }}\n                          className=\"w-full text-xs px-2 py-1.5 rounded border border-slate-300 focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white\"\n                          placeholder=\"Full Address\"\n                        />\n                      </div>\n\n                      <div className=\"flex justify-end gap-2 mt-1\">\n                          <Button\n                            size=\"sm\"\n                            variant=\"ghost\"\n                            className=\"text-xs h-7 px-2\"\n                            onClick={() => setEditingDepotId(null)}\n                          >\n                            Cancel\n                          </Button>\n                          <Button\n                            size=\"sm\"\n                            className=\"text-xs h-7 px-3 bg-blue-600 hover:bg-blue-700 text-white\"\n                            onClick={() => {\n                              onUpdateDepot(depot.id, editForm);\n                              setEditingDepotId(null);\n                            }}\n                          >\n                            Save Changes\n                          </Button>\n                      </div>\n                    </div>\n                )}\n              </div>\n            );\n          })}\n        </div>\n      </ScrollArea>\n      \n      {!isCollapsed && (\n        <div className=\"p-4 border-t border-slate-200 bg-slate-50 space-y-3\">\n           {canAccessSettings && onOpenSettings && (\n             <Button\n               variant=\"outline\"\n               className=\"w-full justify-start gap-2 text-slate-600 hover:text-blue-600 hover:border-blue-200\"\n               onClick={onOpenSettings}\n               data-testid=\"button-settings\"\n             >\n               <UserCog className=\"w-4 h-4\" />\n               <span>Team & Settings</span>\n             </Button>\n           )}\n           <div className=\"text-xs text-slate-400 text-center\">\n              Sewer Swarm AI ¬© 2025\n              <br/>\n              <span className=\"opacity-70\">v2.1.0 (Production)</span>\n           </div>\n        </div>\n      )}\n      {isCollapsed && canAccessSettings && onOpenSettings && (\n        <div className=\"p-2 border-t border-slate-200 bg-slate-50 flex justify-center\">\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            className=\"w-8 h-8 text-slate-500 hover:text-blue-600\"\n            onClick={onOpenSettings}\n            title=\"Team & Settings\"\n            data-testid=\"button-settings-collapsed\"\n          >\n            <UserCog className=\"w-4 h-4\" />\n          </Button>\n        </div>\n      )}\n    </div>\n  );\n}\n","path":null,"size_bytes":15874,"size_tokens":null},"client/src/components/ui/radio-group.tsx":{"content":"import * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary shadow focus:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-3.5 w-3.5 fill-primary\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","path":null,"size_bytes":1410,"size_tokens":null},"client/src/components/schedule/EmailPreviewModal.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter } from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Check, AlertCircle, Mail, User } from \"lucide-react\";\nimport { format } from \"date-fns\";\nimport { ScheduleItem } from \"./CalendarGrid\";\n\ninterface StaffMember {\n    id: string;\n    name: string;\n    role: 'operative' | 'assistant';\n    email?: string;\n}\n\ninterface EmailPreviewModalProps {\n    open: boolean;\n    onOpenChange: (open: boolean) => void;\n    date: Date;\n    items: ScheduleItem[];\n    employees: { id: string; name: string; status: 'active' | 'holiday' | 'sick'; email?: string; jobRole: 'operative' | 'assistant' }[];\n    onUpdateEmail: (id: string, email: string) => void;\n    onSend: (date: Date, recipientCount: number) => void;\n}\n\nexport function EmailPreviewModal({\n    open,\n    onOpenChange,\n    date,\n    items,\n    employees,\n    onUpdateEmail,\n    onSend\n}: EmailPreviewModalProps) {\n    const [recipients, setRecipients] = useState<StaffMember[]>([]);\n    const [isSending, setIsSending] = useState(false);\n\n    // Identify recipients based on the schedule for the given date\n    useEffect(() => {\n        if (!open) return;\n\n        const scheduledItems = items.filter(i => \n            (i.type === 'operative' || i.type === 'assistant') &&\n            new Date(i.date).toDateString() === date.toDateString()\n        );\n\n        const uniqueEmployeeIds = new Set(scheduledItems.map(i => i.employeeId));\n        \n        const staffList = employees\n            .filter(e => uniqueEmployeeIds.has(e.id))\n            .map(e => ({\n                id: e.id,\n                name: e.name,\n                role: e.jobRole,\n                email: e.email\n            }));\n\n        setRecipients(staffList);\n    }, [open, date, items, employees]);\n\n    const handleEmailChange = (id: string, newEmail: string) => {\n        // Update local state for immediate feedback\n        setRecipients(prev => prev.map(r => r.id === id ? { ...r, email: newEmail } : r));\n        // Update global state\n        onUpdateEmail(id, newEmail);\n    };\n\n    const handleSend = () => {\n        setIsSending(true);\n        \n        // Simulate network request\n        setTimeout(() => {\n            setIsSending(false);\n            const validRecipients = recipients.filter(r => r.email && r.email.includes('@'));\n            onSend(date, validRecipients.length);\n            onOpenChange(false);\n        }, 800);\n    };\n\n    const validCount = recipients.filter(r => r.email && r.email.includes('@')).length;\n    const totalCount = recipients.length;\n    const missingCount = totalCount - validCount;\n\n    return (\n        <Dialog open={open} onOpenChange={onOpenChange}>\n            <DialogContent className=\"sm:max-w-[600px] bg-white text-slate-900 max-h-[80vh] flex flex-col\">\n                <DialogHeader>\n                    <DialogTitle className=\"flex items-center gap-2\">\n                        <Mail className=\"w-5 h-5 text-blue-600\" />\n                        Email Schedule for {format(date, \"EEEE, MMM do\")}\n                    </DialogTitle>\n                </DialogHeader>\n\n                <div className=\"flex-1 overflow-hidden flex flex-col\">\n                    <div className=\"bg-slate-50 p-4 rounded-lg border border-slate-100 mb-4\">\n                        <div className=\"flex items-center justify-between mb-2\">\n                            <span className=\"text-sm font-medium text-slate-700\">Summary</span>\n                            <Badge variant={missingCount > 0 ? \"destructive\" : \"default\"} className={missingCount > 0 ? \"bg-amber-100 text-amber-700 hover:bg-amber-100\" : \"bg-green-100 text-green-700 hover:bg-green-100\"}>\n                                {missingCount > 0 ? `${missingCount} Missing Emails` : \"Ready to Send\"}\n                            </Badge>\n                        </div>\n                        <p className=\"text-xs text-slate-500\">\n                            Review recipients below. Add missing emails to ensure everyone receives their job details.\n                        </p>\n                    </div>\n\n                    <div className=\"flex-1 overflow-y-auto border rounded-md divide-y\">\n                        {recipients.length === 0 ? (\n                            <div className=\"p-8 text-center text-slate-400\">\n                                No staff scheduled for this day.\n                            </div>\n                        ) : (\n                            recipients.map(staff => (\n                                <div key={staff.id} className=\"p-3 flex items-center gap-3 hover:bg-slate-50\">\n                                    <div className=\"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center text-blue-600 shrink-0\">\n                                        <User className=\"w-4 h-4\" />\n                                    </div>\n                                    \n                                    <div className=\"flex-1 min-w-0\">\n                                        <div className=\"flex items-center gap-2\">\n                                            <span className=\"font-medium text-sm\">{staff.name}</span>\n                                            <Badge variant=\"outline\" className=\"text-[10px] h-5 px-1.5 text-slate-500\">\n                                                {staff.role}\n                                            </Badge>\n                                        </div>\n                                        <Input \n                                            value={staff.email || \"\"}\n                                            onChange={(e) => handleEmailChange(staff.id, e.target.value)}\n                                            placeholder=\"Enter email address...\"\n                                            className=\"mt-1 h-7 text-xs bg-white\"\n                                        />\n                                    </div>\n\n                                    <div className=\"shrink-0\">\n                                        {staff.email && staff.email.includes('@') ? (\n                                            <Check className=\"w-5 h-5 text-green-500\" />\n                                        ) : (\n                                            <AlertCircle className=\"w-5 h-5 text-amber-500\" />\n                                        )}\n                                    </div>\n                                </div>\n                            ))\n                        )}\n                    </div>\n                </div>\n\n                <DialogFooter className=\"gap-2 sm:gap-0\">\n                    <div className=\"flex-1 flex items-center text-xs text-slate-500\">\n                        Sending to {validCount} of {totalCount} recipients\n                    </div>\n                    <Button variant=\"outline\" onClick={() => onOpenChange(false)}>Cancel</Button>\n                    <Button \n                        onClick={handleSend} \n                        disabled={validCount === 0 || isSending}\n                        className=\"bg-blue-600 hover:bg-blue-700 text-white gap-2\"\n                    >\n                        {isSending ? \"Sending...\" : \"Send Emails\"}\n                        <Mail className=\"w-4 h-4\" />\n                    </Button>\n                </DialogFooter>\n            </DialogContent>\n        </Dialog>\n    );\n}\n","path":null,"size_bytes":7565,"size_tokens":null},"client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-9 items-center justify-center rounded-lg bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","path":null,"size_bytes":1877,"size_tokens":null},"client/src/components/ui/select.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-9 w-full items-center justify-between whitespace-nowrap rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-1 focus:ring-ring disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"px-2 py-1.5 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-2 pr-8 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute right-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","path":null,"size_bytes":5745,"size_tokens":null},"client/src/components/schedule/JobCard.tsx":{"content":"import { format } from \"date-fns\";\nimport { MapPin, User, Truck, Clock, MoreHorizontal } from \"lucide-react\";\nimport { useSortable } from \"@dnd-kit/sortable\";\nimport { CSS } from \"@dnd-kit/utilities\";\nimport { cn } from \"@/lib/utils\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport { Button } from \"@/components/ui/button\";\n\nexport interface Job {\n  id: string;\n  title: string;\n  customer: string;\n  jobNumber?: string;\n  address: string;\n  date: Date;\n  startTime: string;\n  onsiteTime: string;\n  employeeId: string;\n  vehicleId: string;\n  assistantId?: string;\n  color: string;\n  depotId: string;\n  crewId?: string; // Added crewId\n}\n\ninterface JobCardProps {\n  job: Job;\n  employees: { id: string; name: string }[];\n  vehicles: { id: string; name: string }[];\n  onEdit: (job: Job) => void;\n  onDelete: (id: string) => void;\n  onDuplicate: (job: Job) => void;\n}\n\nexport function JobCard({ job, employees, vehicles, onEdit, onDelete, onDuplicate }: JobCardProps) {\n  const {\n    attributes,\n    listeners,\n    setNodeRef,\n    transform,\n    transition,\n    isDragging,\n  } = useSortable({ id: job.id, data: job });\n\n  const style = {\n    transform: CSS.Transform.toString(transform),\n    transition,\n    opacity: isDragging ? 0.5 : 1,\n  };\n\n  const employee = employees.find((e) => e.id === job.employeeId);\n  const vehicle = vehicles.find((v) => v.id === job.vehicleId);\n\n  // Modern Pastel Colors based on Sewer Swarm Style\n  const colorClasses: Record<string, string> = {\n    blue: \"bg-[#BFDBFE] border-[#3B82F6] text-[#1E3A8A]\",\n    green: \"bg-[#BBF7D0] border-[#22C55E] text-[#14532D]\",\n    yellow: \"bg-[#FEF08A] border-[#EAB308] text-[#713F12]\",\n    orange: \"bg-[#FED7AA] border-[#F97316] text-[#7C2D12]\",\n    red: \"bg-[#FECACA] border-[#EF4444] text-[#7F1D1D]\",\n    purple: \"bg-[#E9D5FF] border-[#A855F7] text-[#581C87]\",\n    pink: \"bg-[#FBCFE8] border-[#EC4899] text-[#831843]\",\n    teal: \"bg-[#99F6E4] border-[#14B8A6] text-[#134E4A]\",\n    gray: \"bg-[#E2E8F0] border-[#64748B] text-[#1E293B]\",\n  };\n\n  const headerColors: Record<string, string> = {\n    blue: \"bg-[#3B82F6] text-white\",\n    green: \"bg-[#22C55E] text-white\",\n    yellow: \"bg-[#EAB308] text-white\",\n    orange: \"bg-[#F97316] text-white\",\n    red: \"bg-[#EF4444] text-white\",\n    purple: \"bg-[#A855F7] text-white\",\n    pink: \"bg-[#EC4899] text-white\",\n    teal: \"bg-[#14B8A6] text-white\",\n    gray: \"bg-[#64748B] text-white\",\n  };\n\n  const baseColor = colorClasses[job.color] || colorClasses.blue;\n  const headerColor = headerColors[job.color] || headerColors.blue;\n\n  return (\n    <div\n      ref={setNodeRef}\n      style={style}\n      {...attributes}\n      {...listeners}\n      className={cn(\n        \"group relative rounded-lg border shadow-sm cursor-grab active:cursor-grabbing transition-all mb-2 select-none overflow-hidden\",\n        \"bg-white border-l-4\", // Use white background with colored border\n        `border-l-${job.color === 'blue' ? 'blue-500' : job.color === 'red' ? 'red-500' : job.color === 'green' ? 'green-500' : job.color === 'yellow' ? 'yellow-500' : job.color === 'purple' ? 'purple-500' : job.color === 'orange' ? 'orange-500' : job.color === 'pink' ? 'pink-500' : job.color === 'teal' ? 'teal-500' : 'slate-500'}`\n      )}\n    >\n      {/* Colored Category Header */}\n      <div className={cn(\"px-3 py-1.5 text-[11px] font-bold uppercase tracking-wide flex justify-between items-center\", baseColor)}>\n        <span className=\"truncate max-w-[85%]\">{job.customer}</span>\n        <div className=\"flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity\" onPointerDown={(e) => e.stopPropagation()}>\n           <DropdownMenu>\n            <DropdownMenuTrigger asChild>\n              <Button variant=\"ghost\" size=\"icon\" className=\"h-4 w-4 p-0 hover:bg-black/10 text-current\">\n                <MoreHorizontal className=\"h-3 w-3\" />\n              </Button>\n            </DropdownMenuTrigger>\n            <DropdownMenuContent align=\"end\" className=\"w-32 bg-white border-slate-200 text-slate-700 shadow-md\">\n              <DropdownMenuItem onClick={() => onEdit(job)} className=\"cursor-pointer hover:bg-slate-100\">\n                Edit\n              </DropdownMenuItem>\n              <DropdownMenuItem onClick={() => onDuplicate(job)} className=\"cursor-pointer hover:bg-slate-100\">\n                Duplicate\n              </DropdownMenuItem>\n              <DropdownMenuItem onClick={() => onDelete(job.id)} className=\"text-red-600 cursor-pointer hover:bg-red-50\">\n                Delete\n              </DropdownMenuItem>\n            </DropdownMenuContent>\n          </DropdownMenu>\n        </div>\n      </div>\n\n      {/* Body */}\n      <div className=\"p-3 space-y-2 bg-white\">\n        {/* Job Number */}\n        <div className=\"text-xs font-bold text-slate-800\">\n           {job.jobNumber || \"No Job #\"}\n        </div>\n\n        {/* Info Grid */}\n        <div className=\"grid grid-cols-2 gap-x-2 gap-y-1.5 text-xs text-slate-600\">\n            <div className=\"flex items-center gap-1.5 col-span-2 font-mono text-slate-500\">\n                <Clock className=\"w-3 h-3\" />\n                <span className=\"bg-slate-100 px-1.5 py-0.5 rounded text-[10px] border border-slate-200\">{job.startTime} - {job.onsiteTime}</span>\n            </div>\n\n            <div className=\"flex items-center gap-1.5 col-span-2\">\n                <User className=\"w-3 h-3 text-slate-400\" />\n                <span className=\"font-medium text-slate-800\">{employee?.name || \"Unassigned\"}</span>\n            </div>\n\n            {/* Only show vehicle if one is assigned (Lead) */}\n            {job.vehicleId ? (\n              <div className=\"flex items-center gap-1.5 col-span-2 text-blue-600\">\n                  <Truck className=\"w-3 h-3\" />\n                  <span className=\"font-medium\">{vehicle?.name || \"No Vehicle\"}</span>\n              </div>\n            ) : (\n               <div className=\"col-span-2 text-[10px] text-slate-400 italic pl-5\">\n                  (Passenger)\n               </div>\n            )}\n        </div>\n\n        {/* Address */}\n        <div className=\"pt-2 border-t border-slate-100 mt-1\">\n            <div className=\"flex items-start gap-1.5 text-[10px] text-slate-500 leading-tight\">\n                <MapPin className=\"w-3 h-3 shrink-0 mt-0.5 text-slate-400\" />\n                <span className=\"line-clamp-2\">{job.address}</span>\n            </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":6480,"size_tokens":null},"client/src/components/ui/form.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  FormProvider,\n  useFormContext,\n  type ControllerProps,\n  type FieldPath,\n  type FieldValues,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue | null>(null)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  if (!itemContext) {\n    throw new Error(\"useFormField should be used within <FormItem>\")\n  }\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue | null>(null)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-[0.8rem] text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message ?? \"\") : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-[0.8rem] font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","path":null,"size_bytes":4175,"size_tokens":null},"client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-4 w-4 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","path":null,"size_bytes":7406,"size_tokens":null},"vite.config.ts":{"content":"import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport tailwindcss from \"@tailwindcss/vite\";\nimport path from \"path\";\nimport runtimeErrorOverlay from \"@replit/vite-plugin-runtime-error-modal\";\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    runtimeErrorOverlay(),\n    tailwindcss(),\n    ...(process.env.NODE_ENV !== \"production\" &&\n    process.env.REPL_ID !== undefined\n      ? [\n          await import(\"@replit/vite-plugin-cartographer\").then((m) =>\n            m.cartographer(),\n          ),\n          await import(\"@replit/vite-plugin-dev-banner\").then((m) =>\n            m.devBanner(),\n          ),\n        ]\n      : []),\n  ],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(import.meta.dirname, \"client\", \"src\"),\n      \"@shared\": path.resolve(import.meta.dirname, \"shared\"),\n      \"@assets\": path.resolve(import.meta.dirname, \"attached_assets\"),\n    },\n  },\n  css: {\n    postcss: {\n      plugins: [],\n    },\n  },\n  root: path.resolve(import.meta.dirname, \"client\"),\n  build: {\n    outDir: path.resolve(import.meta.dirname, \"dist/public\"),\n    emptyOutDir: true,\n  },\n  server: {\n    host: \"0.0.0.0\",\n    allowedHosts: true,\n    fs: {\n      strict: true,\n      deny: [\"**/.*\"],\n    },\n  },\n});\n","path":null,"size_bytes":1244,"size_tokens":null},"client/src/lib/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n","path":null,"size_bytes":166,"size_tokens":null},"server/routes.ts":{"content":"import type { Express, Request, Response, NextFunction } from \"express\";\nimport { createServer, type Server } from \"http\";\nimport { storage } from \"./storage\";\nimport { insertUserSchema, insertDepotSchema, insertCrewSchema, insertEmployeeSchema, insertVehicleSchema, insertScheduleItemSchema } from \"@shared/schema\";\nimport { fromZodError } from \"zod-validation-error\";\nimport bcrypt from \"bcrypt\";\nimport { db, dbState } from \"./db\";\nimport { sql } from \"drizzle-orm\";\nimport { stripeService } from \"./stripeService\";\nimport { getStripePublishableKey } from \"./stripeClient\";\nimport { getOrganizationQuotaUsage, canCreateDepot, canCreateCrew, canCreateEmployee, canCreateVehicle, PLAN_LIMITS, planRequiresApproval, type PlanType } from \"./quotaService\";\nimport { loadOrganizationContext, requireRole, checkDepotQuota, checkCrewQuota, checkEmployeeQuota, checkVehicleQuota, requireActiveSubscription, bookingRequiresApproval } from \"./rbacMiddleware\";\n\ndeclare module \"express-session\" {\n  interface SessionData {\n    userId: string;\n  }\n}\n\n// Middleware to check authentication\nfunction requireAuth(req: Request, res: Response, next: Function) {\n  if (!req.session.userId) {\n    return res.status(401).json({ error: \"Not authenticated\" });\n  }\n  next();\n}\n\n// Middleware to check database readiness\nfunction requireDb(req: Request, res: Response, next: Function) {\n  if (!dbState.ready) {\n    return res.status(503).json({ \n      error: \"Database not available. Please try again later.\",\n      retryAfter: 30\n    });\n  }\n  next();\n}\n\n// Middleware to handle database errors and return 503 when DB is unavailable\nfunction handleDbError(error: any, req: Request, res: Response, next: NextFunction) {\n  if (error.message?.includes(\"Database not configured\") || \n      error.message?.includes(\"DATABASE_URL\") ||\n      error.code === 'ECONNREFUSED' ||\n      error.code === 'EAI_AGAIN' ||\n      error.code === '42P01') {\n    return res.status(503).json({ \n      error: \"Service temporarily unavailable - database connection failed\",\n      retryAfter: 30\n    });\n  }\n  next(error);\n}\n\nexport async function registerRoutes(app: Express): Promise<Server> {\n  // ==================== HEALTH CHECK ====================\n  app.get(\"/api/health\", async (req, res) => {\n    const health = {\n      status: dbState.ready ? \"ok\" : \"degraded\",\n      timestamp: new Date().toISOString(),\n      database: dbState.ready ? \"connected\" : (db ? \"disconnected\" : \"not configured\")\n    };\n    \n    res.json(health);\n  });\n\n  // ==================== AUTH ROUTES ====================\n  \n  app.post(\"/api/register\", requireDb, async (req, res) => {\n    try {\n      console.log(\"Register request body:\", req.body);\n      const validated = insertUserSchema.parse(req.body);\n      console.log(\"Validated:\", validated);\n      \n      // Check if user already exists\n      const existing = await storage.getUserByUsername(validated.username);\n      console.log(\"Existing user check:\", existing);\n      if (existing) {\n        return res.status(400).json({ error: \"Username already exists\" });\n      }\n      \n      // Hash password\n      const hashedPassword = await bcrypt.hash(validated.password, 10);\n      console.log(\"Password hashed\");\n      \n      // Create user\n      const user = await storage.createUser({\n        ...validated,\n        password: hashedPassword,\n      });\n      console.log(\"User created:\", user);\n      \n      // Get company name from request (optional)\n      const companyName = req.body.company || `${validated.username}'s Organization`;\n      const selectedPlan = (req.body.plan === \"pro\" ? \"pro\" : \"starter\") as \"starter\" | \"pro\";\n      \n      // Create organization for this user (they become the admin)\n      const trialEndsAt = new Date();\n      trialEndsAt.setDate(trialEndsAt.getDate() + 30);\n      \n      const organization = await storage.createOrganization({\n        name: companyName,\n        ownerId: user.id,\n        plan: selectedPlan,\n        subscriptionStatus: \"trialing\",\n        trialEndsAt,\n      });\n      console.log(\"Organization created:\", organization);\n      \n      // Create membership making this user an admin\n      await storage.createMembership({\n        organizationId: organization.id,\n        userId: user.id,\n        role: \"admin\",\n        acceptedAt: new Date(),\n      });\n      console.log(\"Membership created for admin\");\n      \n      // Set session\n      req.session.userId = user.id;\n      \n      res.json({ \n        id: user.id, \n        username: user.username, \n        email: user.email,\n        role: user.role,\n        organization: {\n          id: organization.id,\n          name: organization.name,\n          plan: organization.plan,\n        }\n      });\n    } catch (error: any) {\n      console.error(\"Registration error:\", error.message || error);\n      console.error(\"Full error:\", JSON.stringify(error, Object.getOwnPropertyNames(error)));\n      if (error.name === \"ZodError\") {\n        return res.status(400).json({ error: fromZodError(error).message });\n      }\n      if (error.code === '42P01') {\n        return res.status(503).json({ error: \"Database tables not initialized. Please try again in a moment.\" });\n      }\n      res.status(500).json({ error: error.message || \"Failed to create user\" });\n    }\n  });\n\n  app.post(\"/api/login\", requireDb, async (req, res) => {\n    try {\n      const { username, password } = req.body;\n      console.log(\"Login attempt for:\", username);\n      \n      if (!username || !password) {\n        return res.status(400).json({ error: \"Username and password required\" });\n      }\n      \n      // Get user\n      const user = await storage.getUserByUsername(username);\n      console.log(\"User found:\", !!user);\n      if (!user) {\n        return res.status(401).json({ error: \"Invalid credentials\" });\n      }\n      \n      // Check password\n      const valid = await bcrypt.compare(password, user.password);\n      if (!valid) {\n        return res.status(401).json({ error: \"Invalid credentials\" });\n      }\n      \n      // Set session\n      req.session.userId = user.id;\n      \n      // Get user's primary organization membership (owned org first, then most recent)\n      const primaryMembership = await storage.getPrimaryMembership(user.id);\n      \n      res.json({ \n        id: user.id, \n        username: user.username, \n        email: user.email,\n        role: primaryMembership?.role || user.role,\n        organization: primaryMembership ? {\n          id: primaryMembership.organization.id,\n          name: primaryMembership.organization.name,\n          plan: primaryMembership.organization.plan,\n        } : null,\n        membershipRole: primaryMembership?.role || null\n      });\n    } catch (error: any) {\n      console.error(\"Login error:\", error.message || error);\n      console.error(\"Full login error:\", JSON.stringify(error, Object.getOwnPropertyNames(error)));\n      if (error.code === '42P01') {\n        return res.status(503).json({ error: \"Database tables not initialized. Please try again in a moment.\" });\n      }\n      res.status(500).json({ error: error.message || \"Login failed\" });\n    }\n  });\n\n  app.post(\"/api/logout\", requireDb, (req, res) => {\n    req.session.destroy((err) => {\n      if (err) {\n        return res.status(500).json({ error: \"Logout failed\" });\n      }\n      res.json({ success: true });\n    });\n  });\n\n  app.get(\"/api/me\", requireDb, async (req, res) => {\n    if (!req.session.userId) {\n      return res.status(401).json({ error: \"Not authenticated\" });\n    }\n    \n    const user = await storage.getUser(req.session.userId);\n    if (!user) {\n      return res.status(404).json({ error: \"User not found\" });\n    }\n    \n    // Get user's primary organization membership (owned org first, then most recent)\n    const primaryMembership = await storage.getPrimaryMembership(user.id);\n    \n    res.json({ \n      id: user.id, \n      username: user.username, \n      email: user.email,\n      role: primaryMembership?.role || user.role,\n      organization: primaryMembership ? {\n        id: primaryMembership.organization.id,\n        name: primaryMembership.organization.name,\n        plan: primaryMembership.organization.plan,\n        subscriptionStatus: primaryMembership.organization.subscriptionStatus,\n      } : null,\n      membershipRole: primaryMembership?.role || null\n    });\n  });\n\n  // ==================== ORGANIZATION & QUOTA ROUTES ====================\n  \n  app.get(\"/api/organization\", requireAuth, requireDb, async (req, res) => {\n    try {\n      const memberships = await storage.getMembershipsByUser(req.session.userId!);\n      if (memberships.length === 0) {\n        return res.status(404).json({ error: \"No organization found\" });\n      }\n      \n      const membership = memberships[0];\n      const org = await storage.getOrganization(membership.organizationId);\n      if (!org) {\n        return res.status(404).json({ error: \"Organization not found\" });\n      }\n      \n      res.json({\n        id: org.id,\n        name: org.name,\n        plan: org.plan,\n        subscriptionStatus: org.subscriptionStatus,\n        membershipRole: membership.role,\n      });\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch organization\" });\n    }\n  });\n\n  app.get(\"/api/organization/quota\", requireAuth, requireDb, async (req, res) => {\n    try {\n      const memberships = await storage.getMembershipsByUser(req.session.userId!);\n      if (memberships.length === 0) {\n        return res.status(404).json({ error: \"No organization found\" });\n      }\n      \n      const membership = memberships[0];\n      const org = await storage.getOrganization(membership.organizationId);\n      if (!org) {\n        return res.status(404).json({ error: \"Organization not found\" });\n      }\n      \n      const quotaUsage = await getOrganizationQuotaUsage(org.id, org.plan as PlanType);\n      \n      res.json({\n        plan: org.plan,\n        limits: PLAN_LIMITS[org.plan as PlanType],\n        usage: quotaUsage,\n        requiresApproval: planRequiresApproval(org.plan as PlanType),\n      });\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch quota\" });\n    }\n  });\n\n  app.get(\"/api/organization/members\", requireAuth, requireDb, async (req, res) => {\n    try {\n      const memberships = await storage.getMembershipsByUser(req.session.userId!);\n      if (memberships.length === 0) {\n        return res.status(404).json({ error: \"No organization found\" });\n      }\n      \n      const membership = memberships[0];\n      const members = await storage.getMembershipsByOrg(membership.organizationId);\n      \n      const membersWithUsers = await Promise.all(\n        members.map(async (m) => {\n          const user = await storage.getUser(m.userId);\n          return {\n            id: m.id,\n            userId: m.userId,\n            username: user?.username || \"Unknown\",\n            email: user?.email || \"\",\n            role: m.role,\n            acceptedAt: m.acceptedAt,\n          };\n        })\n      );\n      \n      res.json(membersWithUsers);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch members\" });\n    }\n  });\n\n  // ==================== TEAM INVITE ROUTES ====================\n\n  app.get(\"/api/organization/invites\", requireAuth, requireDb, loadOrganizationContext, requireRole(\"admin\"), async (req, res) => {\n    try {\n      const invites = await storage.getInvitesByOrg(req.orgContext!.organizationId);\n      res.json(invites);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch invites\" });\n    }\n  });\n\n  app.post(\"/api/organization/invites\", requireAuth, requireDb, loadOrganizationContext, requireRole(\"admin\"), async (req, res) => {\n    try {\n      const { email, role } = req.body;\n      if (!email || typeof email !== \"string\") {\n        return res.status(400).json({ error: \"Email is required\" });\n      }\n      const validRoles = [\"admin\", \"operations\", \"user\"];\n      if (!role || !validRoles.includes(role)) {\n        return res.status(400).json({ error: `Role must be one of: ${validRoles.join(\", \")}` });\n      }\n      \n      // Check if user is already a member\n      const existingUser = await storage.getUserByUsername(email);\n      if (existingUser) {\n        const existingMembership = await storage.getMembership(existingUser.id, req.orgContext!.organizationId);\n        if (existingMembership) {\n          return res.status(400).json({ error: \"User is already a member of this organization\" });\n        }\n      }\n      \n      // Check if invite already exists for this email\n      const existingInvites = await storage.getInvitesByOrg(req.orgContext!.organizationId);\n      const existingInvite = existingInvites.find(i => i.email.toLowerCase() === email.toLowerCase());\n      if (existingInvite) {\n        return res.status(400).json({ error: \"An invite already exists for this email\" });\n      }\n      \n      // Generate invite token\n      const token = `${req.orgContext!.organizationId}_${Date.now()}_${Math.random().toString(36).substring(2, 15)}`;\n      const expiresAt = new Date();\n      expiresAt.setDate(expiresAt.getDate() + 7); // 7 day expiry\n      \n      const invite = await storage.createInvite({\n        organizationId: req.orgContext!.organizationId,\n        email,\n        role,\n        invitedBy: req.session.userId!,\n        token,\n        expiresAt,\n      });\n      \n      res.json(invite);\n    } catch (error) {\n      console.error(\"Error creating invite:\", error);\n      res.status(500).json({ error: \"Failed to create invite\" });\n    }\n  });\n\n  app.delete(\"/api/organization/invites/:id\", requireAuth, requireDb, loadOrganizationContext, requireRole(\"admin\"), async (req, res) => {\n    try {\n      await storage.deleteInvite(req.params.id);\n      res.json({ success: true });\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to delete invite\" });\n    }\n  });\n\n  // Resend invite (regenerate token and extend expiry)\n  app.post(\"/api/organization/invites/:id/resend\", requireAuth, requireDb, loadOrganizationContext, requireRole(\"admin\"), async (req, res) => {\n    try {\n      // Verify invite belongs to current organization\n      const existingInvite = await storage.getInviteById(req.params.id);\n      if (!existingInvite) {\n        return res.status(404).json({ error: \"Invite not found\" });\n      }\n      if (existingInvite.organizationId !== req.orgContext!.organizationId) {\n        return res.status(403).json({ error: \"Access denied\" });\n      }\n      \n      const newToken = `${req.orgContext!.organizationId}_${Date.now()}_${Math.random().toString(36).substring(2, 15)}`;\n      const newExpiresAt = new Date();\n      newExpiresAt.setDate(newExpiresAt.getDate() + 7);\n      \n      const updatedInvite = await storage.updateInvite(req.params.id, {\n        token: newToken,\n        expiresAt: newExpiresAt,\n      });\n      \n      res.json(updatedInvite);\n    } catch (error) {\n      console.error(\"Error resending invite:\", error);\n      res.status(500).json({ error: \"Failed to resend invite\" });\n    }\n  });\n\n  // Accept invite (public route - uses token for authentication)\n  app.post(\"/api/invites/accept\", requireDb, async (req, res) => {\n    try {\n      const { token, username, password } = req.body;\n      if (!token || typeof token !== \"string\") {\n        return res.status(400).json({ error: \"Invite token is required\" });\n      }\n      \n      const invite = await storage.getInviteByToken(token);\n      if (!invite) {\n        return res.status(404).json({ error: \"Invalid or expired invite\" });\n      }\n      \n      if (new Date() > invite.expiresAt) {\n        await storage.deleteInvite(invite.id);\n        return res.status(400).json({ error: \"This invite has expired\" });\n      }\n      \n      // Check if user already exists with this email (username is email)\n      let user = await storage.getUserByUsername(invite.email);\n      \n      if (!user) {\n        // Need username and password for new users\n        if (!username || !password) {\n          return res.status(400).json({ error: \"Username and password required for new users\" });\n        }\n        \n        // Check if username is taken\n        const existingUsername = await storage.getUserByUsername(username);\n        if (existingUsername) {\n          return res.status(400).json({ error: \"Username is already taken\" });\n        }\n        \n        // Create new user\n        const hashedPassword = await bcrypt.hash(password, 10);\n        user = await storage.createUser({\n          username,\n          password: hashedPassword,\n          email: invite.email,\n        });\n      }\n      \n      // Check if already a member\n      const existingMembership = await storage.getMembership(user.id, invite.organizationId);\n      if (existingMembership) {\n        await storage.deleteInvite(invite.id);\n        return res.status(400).json({ error: \"You are already a member of this organization\" });\n      }\n      \n      // Create membership\n      await storage.createMembership({\n        organizationId: invite.organizationId,\n        userId: user.id,\n        role: invite.role as \"admin\" | \"operations\" | \"user\",\n        acceptedAt: new Date(),\n      });\n      \n      // Delete invite\n      await storage.deleteInvite(invite.id);\n      \n      // Log the user in\n      req.session.userId = user.id;\n      \n      const org = await storage.getOrganization(invite.organizationId);\n      \n      res.json({\n        success: true,\n        user: {\n          id: user.id,\n          username: user.username,\n          email: user.email,\n        },\n        organization: org ? {\n          id: org.id,\n          name: org.name,\n          plan: org.plan,\n        } : null,\n      });\n    } catch (error) {\n      console.error(\"Error accepting invite:\", error);\n      res.status(500).json({ error: \"Failed to accept invite\" });\n    }\n  });\n\n  // Get invite info (for displaying invite landing page)\n  app.get(\"/api/invites/:token\", requireDb, async (req, res) => {\n    try {\n      const invite = await storage.getInviteByToken(req.params.token);\n      if (!invite) {\n        return res.status(404).json({ error: \"Invalid or expired invite\" });\n      }\n      \n      if (new Date() > invite.expiresAt) {\n        return res.status(400).json({ error: \"This invite has expired\" });\n      }\n      \n      const org = await storage.getOrganization(invite.organizationId);\n      const inviter = await storage.getUser(invite.invitedBy);\n      \n      res.json({\n        email: invite.email,\n        role: invite.role,\n        organizationName: org?.name || \"Unknown Organization\",\n        invitedBy: inviter?.username || \"Unknown\",\n        expiresAt: invite.expiresAt,\n      });\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch invite info\" });\n    }\n  });\n\n  // Update member role (Admin only)\n  app.patch(\"/api/organization/members/:id/role\", requireAuth, requireDb, loadOrganizationContext, requireRole(\"admin\"), async (req, res) => {\n    try {\n      const { role } = req.body;\n      const validRoles = [\"admin\", \"operations\", \"user\"];\n      if (!role || !validRoles.includes(role)) {\n        return res.status(400).json({ error: `Role must be one of: ${validRoles.join(\", \")}` });\n      }\n      \n      const updated = await storage.updateMembershipRole(req.params.id, role as \"admin\" | \"operations\" | \"user\");\n      if (!updated) {\n        return res.status(404).json({ error: \"Member not found\" });\n      }\n      res.json(updated);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to update member role\" });\n    }\n  });\n\n  // Remove member (Admin only)\n  app.delete(\"/api/organization/members/:id\", requireAuth, requireDb, loadOrganizationContext, requireRole(\"admin\"), async (req, res) => {\n    try {\n      await storage.deleteMembership(req.params.id);\n      res.json({ success: true });\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to remove member\" });\n    }\n  });\n\n  // ==================== DEPOT ROUTES ====================\n  \n  app.get(\"/api/depots\", requireAuth, requireDb, async (req, res) => {\n    try {\n      const depots = await storage.getDepots(req.session.userId!);\n      res.json(depots);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch depots\" });\n    }\n  });\n\n  app.post(\"/api/depots\", requireAuth, requireDb, loadOrganizationContext, requireActiveSubscription, checkDepotQuota, async (req, res) => {\n    try {\n      const validated = insertDepotSchema.parse({\n        ...req.body,\n        userId: req.session.userId,\n        organizationId: req.orgContext!.organizationId,\n      });\n      const depot = await storage.createDepot(validated);\n      res.json(depot);\n    } catch (error: any) {\n      if (error.name === \"ZodError\") {\n        return res.status(400).json({ error: fromZodError(error).message });\n      }\n      res.status(500).json({ error: \"Failed to create depot\" });\n    }\n  });\n\n  app.patch(\"/api/depots/:id\", requireAuth, requireDb, async (req, res) => {\n    try {\n      const depot = await storage.updateDepot(req.params.id, req.body);\n      if (!depot) {\n        return res.status(404).json({ error: \"Depot not found\" });\n      }\n      res.json(depot);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to update depot\" });\n    }\n  });\n\n  app.delete(\"/api/depots/:id\", requireAuth, requireDb, async (req, res) => {\n    try {\n      await storage.deleteDepot(req.params.id);\n      res.json({ success: true });\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to delete depot\" });\n    }\n  });\n\n  // ==================== CREW ROUTES ====================\n  \n  app.get(\"/api/crews\", requireAuth, requireDb, loadOrganizationContext, async (req, res) => {\n    try {\n      const includeArchived = req.query.includeArchived === 'true';\n      const orgId = req.orgContext?.organizationId;\n      \n      let crewList;\n      if (orgId && includeArchived) {\n        crewList = await storage.getAllCrewsByOrg(orgId);\n      } else if (orgId) {\n        crewList = await storage.getCrewsByOrg(orgId);\n      } else {\n        crewList = await storage.getCrews(req.session.userId!);\n      }\n      res.json(crewList);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch crews\" });\n    }\n  });\n\n  app.post(\"/api/crews\", requireAuth, requireDb, loadOrganizationContext, requireActiveSubscription, checkCrewQuota, async (req, res) => {\n    try {\n      const validated = insertCrewSchema.parse({\n        ...req.body,\n        userId: req.session.userId,\n        organizationId: req.orgContext!.organizationId,\n      });\n      const crew = await storage.createCrew(validated);\n      res.json(crew);\n    } catch (error: any) {\n      if (error.name === \"ZodError\") {\n        return res.status(400).json({ error: fromZodError(error).message });\n      }\n      res.status(500).json({ error: \"Failed to create crew\" });\n    }\n  });\n\n  app.patch(\"/api/crews/:id\", requireAuth, requireDb, async (req, res) => {\n    try {\n      const crew = await storage.updateCrew(req.params.id, req.body);\n      if (!crew) {\n        return res.status(404).json({ error: \"Crew not found\" });\n      }\n      res.json(crew);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to update crew\" });\n    }\n  });\n\n  app.delete(\"/api/crews/:id\", requireAuth, requireDb, async (req, res) => {\n    try {\n      const crew = await storage.archiveCrew(req.params.id);\n      if (!crew) {\n        return res.status(404).json({ error: \"Crew not found\" });\n      }\n      res.json({ success: true, archived: true });\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to archive crew\" });\n    }\n  });\n\n  app.post(\"/api/crews/:id/restore\", requireAuth, requireDb, async (req, res) => {\n    try {\n      const crew = await storage.restoreCrew(req.params.id);\n      if (!crew) {\n        return res.status(404).json({ error: \"Crew not found\" });\n      }\n      res.json(crew);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to restore crew\" });\n    }\n  });\n\n  // ==================== EMPLOYEE ROUTES ====================\n  \n  app.get(\"/api/employees\", requireAuth, requireDb, async (req, res) => {\n    try {\n      const employees = await storage.getEmployees(req.session.userId!);\n      res.json(employees);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch employees\" });\n    }\n  });\n\n  app.post(\"/api/employees\", requireAuth, requireDb, loadOrganizationContext, requireActiveSubscription, checkEmployeeQuota, async (req, res) => {\n    try {\n      const validated = insertEmployeeSchema.parse({\n        ...req.body,\n        userId: req.session.userId,\n        organizationId: req.orgContext!.organizationId,\n      });\n      const employee = await storage.createEmployee(validated);\n      res.json(employee);\n    } catch (error: any) {\n      if (error.name === \"ZodError\") {\n        return res.status(400).json({ error: fromZodError(error).message });\n      }\n      res.status(500).json({ error: \"Failed to create employee\" });\n    }\n  });\n\n  app.patch(\"/api/employees/:id\", requireAuth, requireDb, async (req, res) => {\n    try {\n      const employee = await storage.updateEmployee(req.params.id, req.body);\n      if (!employee) {\n        return res.status(404).json({ error: \"Employee not found\" });\n      }\n      res.json(employee);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to update employee\" });\n    }\n  });\n\n  app.delete(\"/api/employees/:id\", requireAuth, requireDb, async (req, res) => {\n    try {\n      await storage.deleteEmployee(req.params.id);\n      res.json({ success: true });\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to delete employee\" });\n    }\n  });\n\n  // ==================== VEHICLE ROUTES ====================\n  \n  app.get(\"/api/vehicles\", requireAuth, requireDb, async (req, res) => {\n    try {\n      const vehicles = await storage.getVehicles(req.session.userId!);\n      res.json(vehicles);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch vehicles\" });\n    }\n  });\n\n  app.post(\"/api/vehicles\", requireAuth, requireDb, loadOrganizationContext, requireActiveSubscription, checkVehicleQuota, async (req, res) => {\n    try {\n      const validated = insertVehicleSchema.parse({\n        ...req.body,\n        userId: req.session.userId,\n        organizationId: req.orgContext!.organizationId,\n      });\n      const vehicle = await storage.createVehicle(validated);\n      res.json(vehicle);\n    } catch (error: any) {\n      if (error.name === \"ZodError\") {\n        return res.status(400).json({ error: fromZodError(error).message });\n      }\n      res.status(500).json({ error: \"Failed to create vehicle\" });\n    }\n  });\n\n  app.patch(\"/api/vehicles/:id\", requireAuth, requireDb, async (req, res) => {\n    try {\n      const vehicle = await storage.updateVehicle(req.params.id, req.body);\n      if (!vehicle) {\n        return res.status(404).json({ error: \"Vehicle not found\" });\n      }\n      res.json(vehicle);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to update vehicle\" });\n    }\n  });\n\n  app.delete(\"/api/vehicles/:id\", requireAuth, requireDb, async (req, res) => {\n    try {\n      await storage.deleteVehicle(req.params.id);\n      res.json({ success: true });\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to delete vehicle\" });\n    }\n  });\n\n  // ==================== SCHEDULE ITEM ROUTES ====================\n  \n  app.get(\"/api/schedule-items\", requireAuth, requireDb, async (req, res) => {\n    try {\n      const items = await storage.getScheduleItems(req.session.userId!);\n      res.json(items);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch schedule items\" });\n    }\n  });\n\n  app.post(\"/api/schedule-items\", requireAuth, requireDb, loadOrganizationContext, requireActiveSubscription, async (req, res) => {\n    try {\n      const requiresApproval = bookingRequiresApproval(req.orgContext!.role, req.orgContext!.plan);\n      const status = requiresApproval ? \"pending\" : \"approved\";\n      \n      const validated = insertScheduleItemSchema.parse({\n        ...req.body,\n        userId: req.session.userId,\n        organizationId: req.orgContext!.organizationId,\n        date: new Date(req.body.date),\n        status,\n        requestedBy: req.session.userId,\n        approvedBy: requiresApproval ? null : req.session.userId,\n        approvedAt: requiresApproval ? null : new Date(),\n      });\n      const item = await storage.createScheduleItem(validated);\n      res.json(item);\n    } catch (error: any) {\n      if (error.name === \"ZodError\") {\n        return res.status(400).json({ error: fromZodError(error).message });\n      }\n      res.status(500).json({ error: \"Failed to create schedule item\" });\n    }\n  });\n\n  app.patch(\"/api/schedule-items/:id\", requireAuth, requireDb, async (req, res) => {\n    try {\n      const updates = { ...req.body };\n      if (updates.date) {\n        updates.date = new Date(updates.date);\n      }\n      const item = await storage.updateScheduleItem(req.params.id, updates);\n      if (!item) {\n        return res.status(404).json({ error: \"Schedule item not found\" });\n      }\n      res.json(item);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to update schedule item\" });\n    }\n  });\n\n  app.delete(\"/api/schedule-items/:id\", requireAuth, requireDb, async (req, res) => {\n    try {\n      await storage.deleteScheduleItem(req.params.id);\n      res.json({ success: true });\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to delete schedule item\" });\n    }\n  });\n\n  // Pending schedule items (for approval queue)\n  app.get(\"/api/schedule-items/pending\", requireAuth, requireDb, loadOrganizationContext, requireRole(\"admin\", \"operations\"), async (req, res) => {\n    try {\n      const items = await storage.getPendingScheduleItems(req.orgContext!.organizationId);\n      const itemsWithRequester = await Promise.all(\n        items.map(async (item) => {\n          let requestedByUser = null;\n          if (item.requestedBy) {\n            const user = await storage.getUser(item.requestedBy);\n            if (user) {\n              requestedByUser = { id: user.id, username: user.username };\n            }\n          }\n          return { ...item, requestedByUser };\n        })\n      );\n      res.json(itemsWithRequester);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch pending items\" });\n    }\n  });\n\n  // Approve schedule item\n  app.post(\"/api/schedule-items/:id/approve\", requireAuth, requireDb, loadOrganizationContext, requireRole(\"admin\", \"operations\"), async (req, res) => {\n    try {\n      const item = await storage.getScheduleItem(req.params.id);\n      if (!item) {\n        return res.status(404).json({ error: \"Schedule item not found\" });\n      }\n      if (item.status !== \"pending\") {\n        return res.status(400).json({ error: \"Only pending items can be approved\" });\n      }\n      const approvedItem = await storage.approveScheduleItem(req.params.id, req.session.userId!);\n      res.json(approvedItem);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to approve schedule item\" });\n    }\n  });\n\n  // Reject schedule item\n  app.post(\"/api/schedule-items/:id/reject\", requireAuth, requireDb, loadOrganizationContext, requireRole(\"admin\", \"operations\"), async (req, res) => {\n    try {\n      const item = await storage.getScheduleItem(req.params.id);\n      if (!item) {\n        return res.status(404).json({ error: \"Schedule item not found\" });\n      }\n      if (item.status !== \"pending\") {\n        return res.status(400).json({ error: \"Only pending items can be rejected\" });\n      }\n      const { reason } = req.body;\n      if (!reason || typeof reason !== \"string\") {\n        return res.status(400).json({ error: \"Rejection reason is required\" });\n      }\n      const rejectedItem = await storage.rejectScheduleItem(req.params.id, req.session.userId!, reason);\n      res.json(rejectedItem);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to reject schedule item\" });\n    }\n  });\n\n  // ==================== COLOR LABEL ROUTES ====================\n  \n  app.get(\"/api/color-labels\", requireAuth, requireDb, async (req, res) => {\n    try {\n      const labels = await storage.getColorLabels(req.session.userId!);\n      const labelMap = labels.reduce((acc, label) => {\n        acc[label.color] = label.label;\n        return acc;\n      }, {} as Record<string, string>);\n      res.json(labelMap);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch color labels\" });\n    }\n  });\n\n  app.post(\"/api/color-labels\", requireAuth, requireDb, async (req, res) => {\n    try {\n      const { color, label } = req.body;\n      if (!color || !label) {\n        return res.status(400).json({ error: \"Color and label required\" });\n      }\n      const colorLabel = await storage.upsertColorLabel(req.session.userId!, color, label);\n      res.json(colorLabel);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to save color label\" });\n    }\n  });\n\n  // ==================== STRIPE ROUTES ====================\n  \n  // Get Stripe publishable key\n  app.get(\"/api/stripe/publishable-key\", async (req, res) => {\n    try {\n      const publishableKey = await getStripePublishableKey();\n      res.json({ publishableKey });\n    } catch (error: any) {\n      console.error(\"Failed to get Stripe publishable key:\", error.message);\n      res.status(500).json({ error: \"Stripe not configured\" });\n    }\n  });\n\n  // Get available products and prices\n  app.get(\"/api/stripe/products\", async (req, res) => {\n    try {\n      const rows = await stripeService.listProductsWithPrices();\n      \n      // Group prices by product\n      const productsMap = new Map();\n      for (const row of rows as any[]) {\n        if (!productsMap.has(row.product_id)) {\n          productsMap.set(row.product_id, {\n            id: row.product_id,\n            name: row.product_name,\n            description: row.product_description,\n            active: row.product_active,\n            metadata: stripeService.parseMetadata(row.product_metadata),\n            prices: []\n          });\n        }\n        if (row.price_id) {\n          productsMap.get(row.product_id).prices.push({\n            id: row.price_id,\n            unit_amount: row.unit_amount,\n            currency: row.currency,\n            recurring: typeof row.recurring === 'string' ? JSON.parse(row.recurring) : row.recurring,\n            active: row.price_active,\n            metadata: stripeService.parseMetadata(row.price_metadata),\n          });\n        }\n      }\n      \n      res.json({ data: Array.from(productsMap.values()) });\n    } catch (error: any) {\n      console.error(\"Failed to get products:\", error.message);\n      res.status(500).json({ error: \"Failed to fetch products\" });\n    }\n  });\n\n  // Get prices for a product\n  app.get(\"/api/stripe/products/:productId/prices\", async (req, res) => {\n    try {\n      const { productId } = req.params;\n      const product = await stripeService.getProduct(productId);\n      if (!product) {\n        return res.status(404).json({ error: \"Product not found\" });\n      }\n      \n      const prices = await stripeService.getPricesForProduct(productId);\n      res.json({ data: prices });\n    } catch (error: any) {\n      console.error(\"Failed to get prices:\", error.message);\n      res.status(500).json({ error: \"Failed to fetch prices\" });\n    }\n  });\n\n  // Get user's subscription status\n  app.get(\"/api/subscription\", requireAuth, requireDb, async (req, res) => {\n    try {\n      const user = await storage.getUser(req.session.userId!);\n      if (!user?.stripeSubscriptionId) {\n        return res.json({ \n          subscription: null,\n          status: user?.subscriptionStatus || 'none',\n          trialEndsAt: user?.trialEndsAt\n        });\n      }\n      \n      const subscription = await stripeService.getSubscription(user.stripeSubscriptionId);\n      res.json({ \n        subscription,\n        status: user.subscriptionStatus,\n        trialEndsAt: user.trialEndsAt\n      });\n    } catch (error: any) {\n      console.error(\"Failed to get subscription:\", error.message);\n      res.status(500).json({ error: \"Failed to fetch subscription\" });\n    }\n  });\n\n  // Create checkout session\n  app.post(\"/api/stripe/checkout\", requireAuth, requireDb, async (req, res) => {\n    try {\n      const user = await storage.getUser(req.session.userId!);\n      if (!user) {\n        return res.status(404).json({ error: \"User not found\" });\n      }\n      \n      const { priceId, trialDays } = req.body;\n      if (!priceId) {\n        return res.status(400).json({ error: \"Price ID required\" });\n      }\n      \n      // Create or get customer\n      let customerId = user.stripeCustomerId;\n      if (!customerId) {\n        const customer = await stripeService.createCustomer(\n          user.email || `${user.username}@sewerswarm.app`,\n          user.id,\n          user.username\n        );\n        await storage.updateUserStripeInfo(user.id, { stripeCustomerId: customer.id });\n        customerId = customer.id;\n      }\n      \n      // Create checkout session\n      const baseUrl = `${req.protocol}://${req.get('host')}`;\n      const session = await stripeService.createCheckoutSession(\n        customerId,\n        priceId,\n        `${baseUrl}/schedule?checkout=success`,\n        `${baseUrl}/?checkout=cancelled`,\n        trialDays\n      );\n      \n      res.json({ url: session.url });\n    } catch (error: any) {\n      console.error(\"Failed to create checkout:\", error.message);\n      res.status(500).json({ error: \"Failed to create checkout session\" });\n    }\n  });\n\n  // Create customer portal session\n  app.post(\"/api/stripe/portal\", requireAuth, requireDb, async (req, res) => {\n    try {\n      const user = await storage.getUser(req.session.userId!);\n      if (!user?.stripeCustomerId) {\n        return res.status(400).json({ error: \"No subscription found\" });\n      }\n      \n      const baseUrl = `${req.protocol}://${req.get('host')}`;\n      const session = await stripeService.createCustomerPortalSession(\n        user.stripeCustomerId,\n        `${baseUrl}/schedule`\n      );\n      \n      res.json({ url: session.url });\n    } catch (error: any) {\n      console.error(\"Failed to create portal session:\", error.message);\n      res.status(500).json({ error: \"Failed to create portal session\" });\n    }\n  });\n\n  // Cancel subscription\n  app.post(\"/api/stripe/cancel-subscription\", requireAuth, requireDb, async (req, res) => {\n    try {\n      const user = await storage.getUser(req.session.userId!);\n      if (!user?.stripeSubscriptionId) {\n        return res.status(400).json({ error: \"No subscription found\" });\n      }\n      \n      await stripeService.cancelSubscription(user.stripeSubscriptionId);\n      await storage.updateUserStripeInfo(user.id, { \n        subscriptionStatus: 'cancelled',\n        stripeSubscriptionId: undefined\n      });\n      \n      res.json({ success: true });\n    } catch (error: any) {\n      console.error(\"Failed to cancel subscription:\", error.message);\n      res.status(500).json({ error: \"Failed to cancel subscription\" });\n    }\n  });\n\n  // Global error handler for database errors - must be registered AFTER routes\n  app.use(\"/api\", (err: any, req: Request, res: Response, next: NextFunction) => {\n    handleDbError(err, req, res, next);\n  });\n\n  const httpServer = createServer(app);\n\n  return httpServer;\n}\n","path":null,"size_bytes":39323,"size_tokens":null},"client/src/components/ui/kbd.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Kbd({ className, ...props }: React.ComponentProps<\"kbd\">) {\n  return (\n    <kbd\n      data-slot=\"kbd\"\n      className={cn(\n        \"bg-muted text-muted-foreground pointer-events-none inline-flex h-5 w-fit min-w-5 select-none items-center justify-center gap-1 rounded-sm px-1 font-sans text-xs font-medium\",\n        \"[&_svg:not([class*='size-'])]:size-3\",\n        \"[[data-slot=tooltip-content]_&]:bg-background/20 [[data-slot=tooltip-content]_&]:text-background dark:[[data-slot=tooltip-content]_&]:bg-background/10\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction KbdGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <kbd\n      data-slot=\"kbd-group\"\n      className={cn(\"inline-flex items-center gap-1\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Kbd, KbdGroup }\n","path":null,"size_bytes":862,"size_tokens":null},"client/src/pages/schedule.tsx":{"content":"import { useState, useEffect, useCallback } from \"react\";\nimport { isSameDay, startOfWeek, addDays } from \"date-fns\";\nimport { CalendarGrid, Crew, ScheduleItem } from \"@/components/schedule/CalendarGrid\";\nimport { Sidebar } from \"@/components/schedule/Sidebar\";\nimport { DepotCrewModal } from \"@/components/schedule/DepotCrewModal\";\nimport { TeamManagement } from \"@/components/schedule/TeamManagement\";\nimport { arrayMove } from \"@dnd-kit/sortable\";\nimport { useLocation } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { LogOut, Users, CreditCard, BarChart3, Eye, EyeOff } from \"lucide-react\";\nimport type { MemberRole } from \"@shared/schema\";\nimport { api } from \"@/lib/api\";\n\n// Types\ninterface Employee {\n    id: string;\n    name: string;\n    status: 'active' | 'holiday' | 'sick';\n    jobRole: 'operative' | 'assistant';\n    email?: string;\n    depotId?: string;\n}\n\ninterface Vehicle {\n    id: string;\n    name: string;\n    status: 'active' | 'off_road' | 'maintenance';\n    vehicleType: string;\n    depotId?: string;\n}\n\n// Mock Data\nconst MOCK_DEPOTS = [\n  { id: \"d1\", name: \"London Central Depot\", address: \"145 City Road, London\", employees: 12, vehicles: 8 },\n  { id: \"d2\", name: \"Manchester North\", address: \"88 Industrial Park, Manchester\", employees: 8, vehicles: 5 },\n  { id: \"d3\", name: \"Birmingham Hub\", address: \"22 West Midlands Way, Birmingham\", employees: 15, vehicles: 10 },\n  { id: \"d4\", name: \"Bristol Operations\", address: \"45 Avon Street, Bristol\", employees: 6, vehicles: 4 },\n];\n\nconst INITIAL_EMPLOYEES: Employee[] = [];\n\nconst INITIAL_VEHICLES: Vehicle[] = [];\n\nconst INITIAL_CREWS: (Crew & { depotId?: string, shift?: 'day'|'night' })[] = [];\n\nconst INITIAL_COLOR_LABELS: Record<string, string> = {\n    blue: \"Standard Job\",\n    green: \"Completed\",\n    red: \"Urgent\",\n    yellow: \"Pending\",\n    purple: \"Specialist\",\n    orange: \"Warning\",\n    pink: \"Other\",\n    teal: \"Maintenance\",\n    gray: \"Cancelled\"\n};\n\n// Updated Mock Data to use \"ScheduleItem\" structure\nconst MOCK_ITEMS: ScheduleItem[] = [];\n\nconst INITIAL_VEHICLE_TYPES = ['Van', 'CCTV', 'Jetting', 'Recycler', 'Other'];\n\n\nexport default function SchedulePage() {\n  // State - Initialize empty, data will be loaded from API\n  const [selectedDepotId, setSelectedDepotId] = useState<string>(() => {\n      return localStorage.getItem(\"sewer_swarm_selected_depot\") || \"\";\n  });\n  const [vehicleTypes, setVehicleTypes] = useState<string[]>(() => {\n    const saved = localStorage.getItem(\"sewer_swarm_vehicle_types\");\n    return saved ? JSON.parse(saved) : INITIAL_VEHICLE_TYPES;\n  });\n  const [depots, setDepots] = useState<{ id: string; name: string; address: string; employees: number; vehicles: number }[]>([]);\n  const [items, setItems] = useState<ScheduleItem[]>([]);\n  const [crews, setCrews] = useState<(Crew & { depotId?: string, shift?: 'day'|'night' })[]>([]);\n  const [employees, setEmployees] = useState<Employee[]>([]);\n  const [vehicles, setVehicles] = useState<Vehicle[]>([]);\n  const [colorLabels, setColorLabels] = useState<Record<string, string>>(() => {\n      const saved = localStorage.getItem(\"sewer_swarm_color_labels\");\n      return saved ? JSON.parse(saved) : INITIAL_COLOR_LABELS;\n  });\n  const [depotCrewModalOpen, setDepotCrewModalOpen] = useState(false);\n  const [settingsModalOpen, setSettingsModalOpen] = useState(false);\n  const [, setLocation] = useLocation();\n  const [currentUser, setCurrentUser] = useState<{ id: string; membershipRole: MemberRole }>({ id: '', membershipRole: 'admin' });\n  const [userLoading, setUserLoading] = useState(true);\n  const [dataLoading, setDataLoading] = useState(true);\n  const [showArchivedCrews, setShowArchivedCrews] = useState(false);\n\n  // Load all data from API\n  const loadData = useCallback(async () => {\n    try {\n      setDataLoading(true);\n      \n      // Fetch all data in parallel\n      const [depotsData, crewsData, employeesData, vehiclesData, itemsData] = await Promise.all([\n        api.getDepots(),\n        api.getCrews(true), // Include archived crews\n        api.getEmployees(),\n        api.getVehicles(),\n        api.getScheduleItems()\n      ]);\n      \n      // Transform API data to match local types\n      const transformedDepots = depotsData.map(d => ({\n        id: d.id,\n        name: d.name,\n        address: d.address,\n        employees: 0,\n        vehicles: 0\n      }));\n      \n      const transformedCrews = crewsData.map(c => ({\n        id: c.id,\n        name: c.name,\n        depotId: c.depotId,\n        shift: (c.shift as 'day' | 'night') || 'day',\n        archivedAt: c.archivedAt\n      }));\n      \n      const transformedEmployees = employeesData.map(e => ({\n        id: e.id,\n        name: e.name,\n        status: (e.status as 'active' | 'holiday' | 'sick') || 'active',\n        jobRole: (e.jobRole as 'operative' | 'assistant') || 'operative',\n        email: e.email,\n        depotId: e.depotId\n      }));\n      \n      const transformedVehicles = vehiclesData.map(v => ({\n        id: v.id,\n        name: v.name,\n        status: (v.status as 'active' | 'off_road' | 'maintenance') || 'active',\n        vehicleType: v.vehicleType || 'Van',\n        depotId: v.depotId\n      }));\n      \n      const transformedItems = itemsData.map(i => ({\n        ...i,\n        type: i.type as 'job' | 'operative' | 'assistant' | 'note',\n        date: new Date(i.date)\n      }));\n      \n      setDepots(transformedDepots);\n      setCrews(transformedCrews);\n      setEmployees(transformedEmployees);\n      setVehicles(transformedVehicles);\n      setItems(transformedItems);\n      \n      // Select first depot if none selected\n      if (!selectedDepotId && transformedDepots.length > 0) {\n        setSelectedDepotId(transformedDepots[0].id);\n      }\n    } catch (err) {\n      console.error('Error loading data from API:', err);\n    } finally {\n      setDataLoading(false);\n    }\n  }, [selectedDepotId]);\n\n  // Fetch current user info\n  useEffect(() => {\n    setUserLoading(true);\n    fetch('/api/me', { credentials: 'include' })\n      .then(res => {\n        if (!res.ok) {\n          if (res.status === 401) {\n            setLocation('/');\n            return null;\n          }\n          throw new Error('Failed to fetch user');\n        }\n        return res.json();\n      })\n      .then(data => {\n        if (data) {\n          const role = data.membershipRole || 'admin';\n          setCurrentUser({ id: data.id, membershipRole: role });\n          // Load data after authentication\n          loadData();\n        }\n      })\n      .catch(err => {\n        console.error('Error fetching user:', err);\n        setCurrentUser({ id: 'local', membershipRole: 'admin' });\n      })\n      .finally(() => setUserLoading(false));\n  }, [setLocation, loadData]);\n\n  // History State for Undo/Redo\n  const [history, setHistory] = useState<ScheduleItem[][]>([]);\n  const [future, setFuture] = useState<ScheduleItem[][]>([]);\n\n  const updateItemsWithHistory = (updateFn: (prev: ScheduleItem[]) => ScheduleItem[]) => {\n      setItems(prev => {\n          const newItems = updateFn(prev);\n          // Only push to history if something actually changed\n          if (newItems !== prev) {\n              setHistory(h => [...h, prev]);\n              setFuture([]); // Clear future on new action\n          }\n          return newItems;\n      });\n  };\n\n  const handleUndo = () => {\n      if (history.length === 0) return;\n      const previous = history[history.length - 1];\n      const newHistory = history.slice(0, history.length - 1);\n      \n      setFuture(f => [items, ...f]);\n      setItems(previous);\n      setHistory(newHistory);\n  };\n\n  const handleRedo = () => {\n      if (future.length === 0) return;\n      const next = future[0];\n      const newFuture = future.slice(1);\n      \n      setHistory(h => [...h, items]);\n      setItems(next);\n      setFuture(newFuture);\n  };\n\n  const isReadOnly = currentUser.membershipRole === 'user';\n  const selectedDepot = depots.find(d => d.id === selectedDepotId);\n\n  // Save selected depot and preferences to localStorage (for quick loading)\n  useEffect(() => {\n    if (selectedDepotId) {\n      localStorage.setItem(\"sewer_swarm_selected_depot\", selectedDepotId);\n    }\n  }, [selectedDepotId]);\n\n  useEffect(() => {\n    localStorage.setItem(\"sewer_swarm_vehicle_types\", JSON.stringify(vehicleTypes));\n  }, [vehicleTypes]);\n\n  useEffect(() => {\n    localStorage.setItem(\"sewer_swarm_color_labels\", JSON.stringify(colorLabels));\n  }, [colorLabels]);\n\n  // Force re-render on window resize (handles layout toggle)\n  useEffect(() => {\n    window.dispatchEvent(new Event('resize'));\n  }, []);\n\n  // --- Item Handlers ---\n  const handleItemCreate = async (newItem: ScheduleItem) => {\n     if (isReadOnly) return;\n     \n     // Use provided depotId if available (e.g. from Smart Search), otherwise use selected\n     const itemWithDepot = { \n         ...newItem, \n         depotId: newItem.depotId && newItem.depotId !== \"\" ? newItem.depotId : selectedDepotId \n     };\n     \n     // Ensure duration is a number\n     if (itemWithDepot.type === 'job') {\n        itemWithDepot.duration = Number(itemWithDepot.duration || 8);\n     }\n     \n     // Skip FREE_SLOT items from being persisted - these are UI-only visual helpers\n     const isFreeSlot = itemWithDepot.customer === \"FREE_SLOT\";\n     \n     try {\n       let createdItem = itemWithDepot;\n       \n       // Only persist non-FREE_SLOT items to database\n       if (!isFreeSlot) {\n         const apiItem = await api.createScheduleItem({\n           type: itemWithDepot.type,\n           date: itemWithDepot.date,\n           crewId: itemWithDepot.crewId,\n           depotId: itemWithDepot.depotId,\n           customer: itemWithDepot.customer,\n           jobNumber: itemWithDepot.jobNumber,\n           address: itemWithDepot.address,\n           projectManager: itemWithDepot.projectManager,\n           startTime: itemWithDepot.startTime,\n           onsiteTime: itemWithDepot.onsiteTime,\n           color: itemWithDepot.color,\n           duration: itemWithDepot.duration,\n           employeeId: itemWithDepot.employeeId,\n           vehicleId: itemWithDepot.vehicleId,\n           noteContent: itemWithDepot.noteContent\n         });\n         createdItem = { ...apiItem, date: new Date(apiItem.date), type: apiItem.type as 'job' | 'operative' | 'assistant' | 'note' };\n       }\n       \n       updateItemsWithHistory(prev => {\n           const newItems = [...prev, createdItem];\n           \n           // Handle free slot logic (UI only)\n           if (createdItem.type === 'job' && createdItem.duration && createdItem.duration < 8 && !isFreeSlot) {\n               const jobsForDay = [...prev, createdItem].filter(i => \n                   i.type === 'job' && \n                   i.customer !== \"FREE_SLOT\" &&\n                   i.crewId === createdItem.crewId && \n                   isSameDay(new Date(i.date), new Date(createdItem.date))\n               );\n               \n               const totalDuration = jobsForDay.reduce((sum, job) => sum + (Number(job.duration) || 0), 0);\n               \n               const cleanItems = newItems.filter(i => !(\n                   i.customer === \"FREE_SLOT\" && \n                   i.crewId === createdItem.crewId && \n                   isSameDay(new Date(i.date), new Date(createdItem.date))\n               ));\n               \n               if (totalDuration < 8) {\n                   const freeDuration = 8 - totalDuration;\n                   const freeSlot: ScheduleItem = {\n                       id: `free_${Date.now()}`,\n                       type: 'job',\n                       customer: \"FREE_SLOT\",\n                       address: \"Available for booking\",\n                       color: \"free\",\n                       duration: freeDuration,\n                       date: createdItem.date,\n                       crewId: createdItem.crewId,\n                       depotId: createdItem.depotId\n                   };\n                   cleanItems.push(freeSlot);\n               }\n               \n               return cleanItems;\n           }\n           return newItems;\n       });\n     } catch (error) {\n       console.error('Failed to create schedule item:', error);\n     }\n  };\n\n  const handleItemUpdate = async (updatedItem: ScheduleItem) => {\n    if (isReadOnly) return;\n    \n    // Skip FREE_SLOT items - they're UI-only\n    const isFreeSlot = updatedItem.customer === \"FREE_SLOT\" || updatedItem.id.startsWith('free_');\n    \n    try {\n      let finalItem = updatedItem;\n      \n      if (!isFreeSlot) {\n        const apiItem = await api.updateScheduleItem(updatedItem.id, {\n          type: updatedItem.type,\n          date: updatedItem.date,\n          crewId: updatedItem.crewId,\n          depotId: updatedItem.depotId,\n          customer: updatedItem.customer,\n          jobNumber: updatedItem.jobNumber,\n          address: updatedItem.address,\n          projectManager: updatedItem.projectManager,\n          startTime: updatedItem.startTime,\n          onsiteTime: updatedItem.onsiteTime,\n          color: updatedItem.color,\n          duration: updatedItem.duration,\n          employeeId: updatedItem.employeeId,\n          vehicleId: updatedItem.vehicleId,\n          noteContent: updatedItem.noteContent\n        });\n        finalItem = { ...apiItem, date: new Date(apiItem.date), type: apiItem.type as 'job' | 'operative' | 'assistant' | 'note' };\n      }\n\n      updateItemsWithHistory(prev => {\n          const originalItem = prev.find(i => i.id === updatedItem.id);\n          if (!originalItem) return prev;\n\n          const isJob = finalItem.type === 'job';\n          const changedLocation = isJob && (\n              originalItem.crewId !== finalItem.crewId ||\n              !isSameDay(new Date(originalItem.date), new Date(finalItem.date))\n          );\n          const changedDuration = isJob && (originalItem.duration !== finalItem.duration);\n\n          if (!isJob || (!changedLocation && !changedDuration)) {\n               return prev.map(i => i.id === finalItem.id ? finalItem : i);\n          }\n\n          const sourceDate = new Date(originalItem.date);\n          const targetDate = new Date(finalItem.date);\n\n          let tempItems = prev.map(i => i.id === finalItem.id ? finalItem : i);\n\n          tempItems = tempItems.filter(i => !(\n              i.customer === \"FREE_SLOT\" &&\n              i.crewId === originalItem.crewId &&\n              isSameDay(new Date(i.date), sourceDate)\n          ));\n\n          if (changedLocation) {\n               tempItems = tempItems.filter(i => !(\n                  i.customer === \"FREE_SLOT\" &&\n                  i.crewId === finalItem.crewId &&\n                  isSameDay(new Date(i.date), targetDate)\n              ));\n          }\n\n          const addFreeSlotIfNeeded = (itemsList: ScheduleItem[], crewId: string, date: Date, depotId: string) => {\n               const jobs = itemsList.filter(i =>\n                  i.type === 'job' &&\n                  i.customer !== \"FREE_SLOT\" &&\n                  i.crewId === crewId &&\n                  isSameDay(new Date(i.date), date)\n               );\n\n               const totalDuration = jobs.reduce((sum, job) => sum + (Number(job.duration) || 0), 0);\n\n               if (jobs.length > 0 && totalDuration < 8) {\n                   const freeDuration = 8 - totalDuration;\n                   const freeSlot: ScheduleItem = {\n                       id: `free_${Date.now()}`,\n                       type: 'job',\n                       customer: \"FREE_SLOT\",\n                       address: \"Available for booking\",\n                       color: \"free\",\n                       duration: freeDuration,\n                       date: date,\n                       crewId: crewId,\n                       depotId: depotId\n                   };\n                   return [...itemsList, freeSlot];\n               }\n               return itemsList;\n          };\n\n          tempItems = addFreeSlotIfNeeded(tempItems, originalItem.crewId, sourceDate, originalItem.depotId);\n\n          if (changedLocation) {\n              tempItems = addFreeSlotIfNeeded(tempItems, finalItem.crewId, targetDate, finalItem.depotId);\n          }\n\n          return tempItems;\n      });\n    } catch (error) {\n      console.error('Failed to update schedule item:', error);\n    }\n  };\n\n  const handleItemDelete = async (id: string) => {\n    if (isReadOnly) return;\n    \n    // Skip FREE_SLOT items - they're UI-only\n    const isFreeSlot = id.startsWith('free_');\n    \n    try {\n      if (!isFreeSlot) {\n        await api.deleteScheduleItem(id);\n      }\n\n      updateItemsWithHistory(prev => {\n          const itemToDelete = prev.find(i => i.id === id);\n          \n          if (!itemToDelete || itemToDelete.type !== 'job') {\n              return prev.filter(i => i.id !== id);\n          }\n\n          const itemsWithoutJobAndFreeSlots = prev.filter(i => {\n              if (i.id === id) return false;\n              \n              if (i.customer === \"FREE_SLOT\" && \n                  i.crewId === itemToDelete.crewId && \n                  isSameDay(new Date(i.date), new Date(itemToDelete.date))) {\n                  return false;\n              }\n              \n              return true;\n          });\n\n          const remainingJobs = itemsWithoutJobAndFreeSlots.filter(i => \n              i.type === 'job' && \n              i.customer !== \"FREE_SLOT\" &&\n              i.crewId === itemToDelete.crewId &&\n              isSameDay(new Date(i.date), new Date(itemToDelete.date))\n          );\n\n          const totalDuration = remainingJobs.reduce((sum, job) => sum + (Number(job.duration) || 0), 0);\n\n          if (remainingJobs.length > 0 && totalDuration < 8) {\n              const freeDuration = 8 - totalDuration;\n              const freeSlot: ScheduleItem = {\n                   id: `free_${Date.now()}`,\n                   type: 'job',\n                   customer: \"FREE_SLOT\",\n                   address: \"Available for booking\",\n                   color: \"free\",\n                   duration: freeDuration,\n                   date: itemToDelete.date,\n                   crewId: itemToDelete.crewId,\n                   depotId: itemToDelete.depotId\n               };\n               return [...itemsWithoutJobAndFreeSlots, freeSlot];\n          }\n\n          return itemsWithoutJobAndFreeSlots;\n      });\n    } catch (error) {\n      console.error('Failed to delete schedule item:', error);\n    }\n  };\n\n  const handleItemReorder = (activeId: string, overId: string) => {\n    if (isReadOnly) return;\n    updateItemsWithHistory((prev) => {\n        const oldIndex = prev.findIndex((i) => i.id === activeId);\n        const newIndex = prev.findIndex((i) => i.id === overId);\n        return arrayMove(prev, oldIndex, newIndex);\n    });\n  };\n\n  // --- Filter Resources by Depot ---\n  const filteredEmployees = employees.filter(e => e.depotId === selectedDepotId);\n  const filteredVehicles = vehicles.filter(v => v.depotId === selectedDepotId);\n  \n  // Filter crews by depot and archived visibility logic\n  // Archived crews should only show if they have schedule items in the current view range\n  const allDepotCrews = crews.filter(c => c.depotId === selectedDepotId);\n  const activeCrews = allDepotCrews.filter(c => !c.archivedAt);\n  \n  // For archived crew visibility: calculate based on current week view\n  const currentWeekStart = startOfWeek(new Date(), { weekStartsOn: 1 });\n  const currentWeekEnd = addDays(currentWeekStart, 6);\n  \n  const filteredCrews = allDepotCrews.filter(crew => {\n    // Active crews always show\n    if (!crew.archivedAt) return true;\n    \n    // User toggle to show all archived crews\n    if (showArchivedCrews) return true;\n    \n    // Archived crews show if they have any schedule items (past or present)\n    const hasAnyItems = items.some(item => item.crewId === crew.id);\n    return hasAnyItems;\n  });\n\n  // --- Crew Handlers ---\n  const handleCrewCreate = async (name: string, shift: 'day' | 'night' = 'day') => {\n    if (isReadOnly) return;\n    \n    try {\n      const newCrew = await api.createCrew({\n        name,\n        depotId: selectedDepotId,\n        shift\n      });\n      setCrews(prev => [...prev, {\n        id: newCrew.id,\n        name: newCrew.name,\n        depotId: newCrew.depotId,\n        shift: (newCrew.shift as 'day' | 'night') || 'day',\n        archivedAt: newCrew.archivedAt\n      }]);\n    } catch (error) {\n      console.error('Failed to create crew:', error);\n    }\n  };\n\n  const handleCrewUpdate = async (id: string, name: string, shift: 'day' | 'night' = 'day') => {\n    if (isReadOnly) return;\n    \n    // Optimistic update\n    setCrews(prev => prev.map(c => c.id === id ? { ...c, name, shift } : c));\n    \n    try {\n      await api.updateCrew(id, { name, shift });\n    } catch (error) {\n      console.error('Failed to update crew:', error);\n      // Reload data on error\n      loadData();\n    }\n  };\n\n  const handleCrewDelete = async (id: string) => {\n    if (isReadOnly) return;\n    \n    // Optimistic update - archive the crew\n    setCrews(prev => prev.map(c => c.id === id ? { ...c, archivedAt: new Date().toISOString() } : c));\n    \n    // Delete FUTURE items locally\n    setItems(prev => {\n      const today = new Date();\n      today.setHours(0, 0, 0, 0);\n      \n      return prev.filter(item => {\n          if (item.crewId !== id) return true;\n          const itemDate = new Date(item.date);\n          itemDate.setHours(0, 0, 0, 0);\n          return itemDate < today;\n      });\n    });\n    \n    try {\n      await api.archiveCrew(id);\n    } catch (error) {\n      console.error('Failed to archive crew in database:', error);\n      // Reload data on error to resync\n      loadData();\n    }\n  };\n\n  // --- Resource Handlers ---\n  const handleEmployeeCreate = async (name: string, jobRole: 'operative' | 'assistant' = 'operative', email?: string) => {\n    if (isReadOnly) return;\n    \n    try {\n      const newEmployee = await api.createEmployee({\n        name,\n        status: 'active',\n        jobRole,\n        email,\n        depotId: selectedDepotId\n      });\n      setEmployees(prev => [...prev, {\n        id: newEmployee.id,\n        name: newEmployee.name,\n        status: (newEmployee.status as 'active' | 'holiday' | 'sick') || 'active',\n        jobRole: (newEmployee.jobRole as 'operative' | 'assistant') || 'operative',\n        email: newEmployee.email,\n        depotId: newEmployee.depotId\n      }]);\n    } catch (error) {\n      console.error('Failed to create employee:', error);\n    }\n  };\n\n  const handleEmployeeUpdate = async (id: string, name: string, status?: 'active' | 'holiday' | 'sick', jobRole?: 'operative' | 'assistant', email?: string) => {\n    if (isReadOnly) return;\n    \n    // Optimistic update\n    setEmployees(prev => prev.map(e => e.id === id ? { ...e, name, ...(status ? { status } : {}), ...(jobRole ? { jobRole } : {}), ...(email !== undefined ? { email } : {}) } : e));\n    \n    try {\n      await api.updateEmployee(id, { name, ...(status ? { status } : {}), ...(jobRole ? { jobRole } : {}), ...(email !== undefined ? { email } : {}) });\n    } catch (error) {\n      console.error('Failed to update employee:', error);\n      loadData();\n    }\n  };\n\n  const handleEmployeeDelete = async (id: string) => {\n    if (isReadOnly) return;\n    \n    // Optimistic update\n    setEmployees(prev => prev.filter(e => e.id !== id));\n    \n    try {\n      await api.deleteEmployee(id);\n    } catch (error) {\n      console.error('Failed to delete employee:', error);\n      loadData();\n    }\n  };\n\n  const handleVehicleCreate = async (name: string, vehicleType: string = 'Van') => {\n    if (isReadOnly) return;\n    \n    try {\n      const newVehicle = await api.createVehicle({\n        name,\n        status: 'active',\n        vehicleType,\n        depotId: selectedDepotId\n      });\n      setVehicles(prev => [...prev, {\n        id: newVehicle.id,\n        name: newVehicle.name,\n        status: (newVehicle.status as 'active' | 'off_road' | 'maintenance') || 'active',\n        vehicleType: newVehicle.vehicleType || 'Van',\n        depotId: newVehicle.depotId\n      }]);\n    } catch (error) {\n      console.error('Failed to create vehicle:', error);\n    }\n  };\n\n  const handleVehicleUpdate = async (id: string, name: string, status?: 'active' | 'off_road' | 'maintenance', vehicleType?: string) => {\n    if (isReadOnly) return;\n    \n    // Optimistic update\n    setVehicles(prev => prev.map(v => v.id === id ? { ...v, name, ...(status ? { status } : {}), ...(vehicleType ? { vehicleType } : {}) } : v));\n    \n    try {\n      await api.updateVehicle(id, { name, ...(status ? { status } : {}), ...(vehicleType ? { vehicleType } : {}) });\n    } catch (error) {\n      console.error('Failed to update vehicle:', error);\n      loadData();\n    }\n  };\n\n  const handleVehicleDelete = async (id: string) => {\n    if (isReadOnly) return;\n    \n    // Optimistic update\n    setVehicles(prev => prev.filter(v => v.id !== id));\n    \n    try {\n      await api.deleteVehicle(id);\n    } catch (error) {\n      console.error('Failed to delete vehicle:', error);\n      loadData();\n    }\n  };\n\n  const handleColorLabelUpdate = (color: string, label: string) => {\n    if (isReadOnly) return;\n    setColorLabels(prev => ({ ...prev, [color]: label }));\n  };\n\n  // --- Depot Handlers ---\n  const handleDepotDelete = async (id: string) => {\n    if (isReadOnly) return;\n    \n    // Optimistic update\n    setDepots(prev => prev.filter(d => d.id !== id));\n    \n    // If deleting the selected depot, select another one\n    if (selectedDepotId === id) {\n      const remaining = depots.filter(d => d.id !== id);\n      if (remaining.length > 0) {\n        setSelectedDepotId(remaining[0].id);\n      }\n    }\n    \n    try {\n      await api.deleteDepot(id);\n    } catch (error) {\n      console.error('Failed to delete depot:', error);\n      loadData();\n    }\n  };\n\n  const handleDepotCreate = async () => {\n    if (isReadOnly) return;\n    \n    try {\n      const newDepot = await api.createDepot({\n        name: \"New Depot\",\n        address: \"Enter Address\"\n      });\n      setDepots(prev => [...prev, {\n        id: newDepot.id,\n        name: newDepot.name,\n        address: newDepot.address,\n        employees: 0,\n        vehicles: 0\n      }]);\n      setSelectedDepotId(newDepot.id);\n    } catch (error) {\n      console.error('Failed to create depot:', error);\n    }\n  };\n\n  const handleDepotUpdate = async (id: string, updates: { name?: string; address?: string }) => {\n    if (isReadOnly) return;\n    \n    // Optimistic update\n    setDepots(prev => prev.map(d => d.id === id ? { ...d, ...updates } : d));\n    \n    try {\n      await api.updateDepot(id, updates);\n    } catch (error) {\n      console.error('Failed to update depot:', error);\n      loadData();\n    }\n  };\n\n  // --- Vehicle Type Handlers ---\n  const handleVehicleTypeCreate = (type: string) => {\n    if (isReadOnly || !type.trim() || vehicleTypes.includes(type)) return;\n    setVehicleTypes(prev => [...prev, type]);\n  };\n\n  const handleVehicleTypeDelete = (type: string) => {\n    if (isReadOnly) return;\n    setVehicleTypes(prev => prev.filter(t => t !== type));\n  };\n\n  const filteredItems = items.filter(i => i.depotId === selectedDepotId);\n  \n  // Calculate actual employee/vehicle counts\n  // Note: Currently employees/vehicles are not strictly bound to depots in the model, \n  // but we can simulate this or just count total available for now as per requirement to \"show correct number\".\n  // If we want strict per-depot counts, we'd need to add depotId to Employee/Vehicle types.\n  // For now, let's assume all resources belong to the selected depot or distribute them.\n  // Actually, the user asked for \"correct number in the depot\".\n  // Let's update the depots state with these counts dynamically if possible, or just pass them down.\n  // The Sidebar takes `depots` which has `employees` and `vehicles` counts. \n  // Let's update the `depots` state to reflect the mock counts or real counts if we had them.\n  // Since we don't have depotId on employees yet, I will assume they are global for this prototype \n  // OR I will update the mock data to include depotId.\n  \n  // Let's just update the counts to match the total list length for the selected depot for now, \n  // or keep the mock numbers if they are just placeholders.\n  // User said: \"show the correct number of staff and vehicles in the depot\".\n  // This implies they expect the numbers to change when they add/remove people.\n  // I will map the depots to update their counts based on the resources.\n  // Since resources don't have depotId, I'll assume they belong to the currently selected depot for the sake of the UI update.\n  // Or better, I'll just update the selected depot's count in the `depots` array whenever employees/vehicles change.\n  \n  useEffect(() => {\n      setDepots(prev => prev.map(d => {\n          // Update counts for all depots, not just selected\n          const empCount = employees.filter(e => (e.depotId || 'd1') === d.id).length;\n          const vehCount = vehicles.filter(v => (v.depotId || 'd1') === d.id).length;\n          \n          return {\n              ...d,\n              employees: empCount,\n              vehicles: vehCount\n          };\n      }));\n  }, [employees, vehicles]); // Recalculate when full lists change\n\n  // Count archived crews that have items (for toggle button visibility)\n  const archivedCrewsWithItems = allDepotCrews.filter(c => c.archivedAt && items.some(i => i.crewId === c.id)).length;\n  const hasArchivedCrews = archivedCrewsWithItems > 0;\n\n  return (\n    <div className=\"flex h-screen w-screen overflow-hidden bg-slate-50 text-slate-900 min-w-0 relative\">\n      {/* Top Bar Sign Out */}\n      <div className=\"absolute top-4 right-4 z-50 flex items-center gap-3\">\n        {hasArchivedCrews && (\n          <Button \n            variant=\"outline\" \n            size=\"sm\" \n            className={`h-8 text-xs ${showArchivedCrews ? 'bg-amber-50 border-amber-200 text-amber-700' : 'bg-white'}`}\n            onClick={() => setShowArchivedCrews(!showArchivedCrews)}\n            title={showArchivedCrews ? \"Hide archived crews\" : \"Show archived crews with historical data\"}\n          >\n            {showArchivedCrews ? <EyeOff className=\"w-3 h-3 mr-2\" /> : <Eye className=\"w-3 h-3 mr-2\" />}\n            {showArchivedCrews ? 'Hide Archived' : `Show Archived (${archivedCrewsWithItems})`}\n          </Button>\n        )}\n        <Button variant=\"outline\" size=\"sm\" className=\"bg-white h-8 text-xs\" onClick={() => setLocation(\"/\")}>\n            <LogOut className=\"w-3 h-3 mr-2\" /> Sign Out\n        </Button>\n      </div>\n\n      <Sidebar \n        depots={depots} \n        selectedDepotId={selectedDepotId} \n        onSelectDepot={setSelectedDepotId}\n        onEditDepot={() => setDepotCrewModalOpen(true)}\n        onDeleteDepot={handleDepotDelete}\n        onUpdateDepot={handleDepotUpdate}\n        onAddDepot={handleDepotCreate}\n        isReadOnly={isReadOnly}\n        onOpenSettings={() => setSettingsModalOpen(true)}\n        canAccessSettings={currentUser.membershipRole === 'admin' || currentUser.membershipRole === 'operations'}\n      />\n      <div className=\"flex-1 flex flex-col min-w-0 overflow-hidden\">\n        <CalendarGrid \n          items={filteredItems} \n          crews={filteredCrews}\n          allItems={items}\n          allCrews={crews}\n          employees={filteredEmployees} \n          vehicles={filteredVehicles}\n          colorLabels={colorLabels}\n          isReadOnly={isReadOnly}\n          onItemCreate={handleItemCreate}\n          onItemUpdate={handleItemUpdate}\n          onItemDelete={handleItemDelete}\n          onItemReorder={handleItemReorder}\n          onCrewCreate={handleCrewCreate}\n          onCrewUpdate={handleCrewUpdate}\n          onCrewDelete={handleCrewDelete}\n          onEmployeeCreate={handleEmployeeCreate}\n          onEmployeeUpdate={handleEmployeeUpdate}\n          onEmployeeDelete={handleEmployeeDelete}\n          onVehicleCreate={handleVehicleCreate}\n          onVehicleUpdate={handleVehicleUpdate}\n          onVehicleDelete={handleVehicleDelete}\n          onColorLabelUpdate={handleColorLabelUpdate}\n          depots={depots}\n          vehicleTypes={vehicleTypes}\n          onUndo={handleUndo}\n          onRedo={handleRedo}\n          canUndo={history.length > 0}\n          canRedo={future.length > 0}\n        />\n      </div>\n\n      {/* Depot Management Modal - Crews, Employees, Vehicles */}\n      <DepotCrewModal\n        open={depotCrewModalOpen}\n        onOpenChange={setDepotCrewModalOpen}\n        depotName={selectedDepot?.name || \"\"}\n        crews={activeCrews}\n        employees={filteredEmployees}\n        vehicles={filteredVehicles}\n        onCrewCreate={handleCrewCreate}\n        onCrewUpdate={handleCrewUpdate}\n        onCrewDelete={handleCrewDelete}\n        onEmployeeCreate={handleEmployeeCreate}\n        onEmployeeUpdate={handleEmployeeUpdate}\n        onEmployeeDelete={handleEmployeeDelete}\n        onVehicleCreate={handleVehicleCreate}\n        onVehicleUpdate={handleVehicleUpdate}\n        onVehicleDelete={handleVehicleDelete}\n        vehicleTypes={vehicleTypes}\n        onVehicleTypeCreate={handleVehicleTypeCreate}\n        onVehicleTypeDelete={handleVehicleTypeDelete}\n        isReadOnly={isReadOnly}\n      />\n\n      {/* Settings Modal - Team Management */}\n      <Dialog open={settingsModalOpen} onOpenChange={setSettingsModalOpen}>\n        <DialogContent className=\"max-w-4xl max-h-[85vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle className=\"flex items-center gap-2\">\n              <Users className=\"w-5 h-5\" />\n              Team & Settings\n            </DialogTitle>\n          </DialogHeader>\n          \n          <Tabs defaultValue=\"team\" className=\"mt-4\">\n            <TabsList className=\"grid w-full grid-cols-3\">\n              <TabsTrigger value=\"team\" className=\"flex items-center gap-2\">\n                <Users className=\"w-4 h-4\" />\n                Team\n              </TabsTrigger>\n              <TabsTrigger value=\"usage\" className=\"flex items-center gap-2\">\n                <BarChart3 className=\"w-4 h-4\" />\n                Usage\n              </TabsTrigger>\n              <TabsTrigger value=\"billing\" className=\"flex items-center gap-2\">\n                <CreditCard className=\"w-4 h-4\" />\n                Billing\n              </TabsTrigger>\n            </TabsList>\n            \n            <TabsContent value=\"team\" className=\"mt-4\">\n              <TeamManagement \n                currentUserRole={currentUser.membershipRole} \n                currentUserId={currentUser.id} \n              />\n            </TabsContent>\n            \n            <TabsContent value=\"usage\" className=\"mt-4\">\n              <div className=\"space-y-4\">\n                <h3 className=\"font-medium text-slate-700\">Resource Usage</h3>\n                <p className=\"text-sm text-slate-500\">\n                  View your current plan limits and usage here. Upgrade to Pro for more resources.\n                </p>\n                <div className=\"grid gap-4 md:grid-cols-2\">\n                  <div className=\"p-4 border rounded-lg\">\n                    <div className=\"text-sm text-slate-500\">Depots</div>\n                    <div className=\"text-2xl font-bold\">{depots.length}</div>\n                  </div>\n                  <div className=\"p-4 border rounded-lg\">\n                    <div className=\"text-sm text-slate-500\">Crews</div>\n                    <div className=\"text-2xl font-bold\">{crews.length}</div>\n                  </div>\n                  <div className=\"p-4 border rounded-lg\">\n                    <div className=\"text-sm text-slate-500\">Employees</div>\n                    <div className=\"text-2xl font-bold\">{employees.length}</div>\n                  </div>\n                  <div className=\"p-4 border rounded-lg\">\n                    <div className=\"text-sm text-slate-500\">Vehicles</div>\n                    <div className=\"text-2xl font-bold\">{vehicles.length}</div>\n                  </div>\n                </div>\n              </div>\n            </TabsContent>\n            \n            <TabsContent value=\"billing\" className=\"mt-4\">\n              <div className=\"space-y-4\">\n                <h3 className=\"font-medium text-slate-700\">Subscription & Billing</h3>\n                <p className=\"text-sm text-slate-500\">\n                  Manage your subscription, view invoices, and update payment methods.\n                </p>\n                <Button \n                  onClick={async () => {\n                    try {\n                      const res = await fetch('/api/stripe/portal', {\n                        method: 'POST',\n                        credentials: 'include',\n                        headers: { 'Content-Type': 'application/json' }\n                      });\n                      if (res.ok) {\n                        const data = await res.json();\n                        if (data.url) {\n                          window.location.href = data.url;\n                        }\n                      } else {\n                        console.error('Failed to get billing portal URL');\n                      }\n                    } catch (err) {\n                      console.error('Error opening billing portal:', err);\n                    }\n                  }}\n                  className=\"bg-blue-600 hover:bg-blue-700\"\n                >\n                  <CreditCard className=\"w-4 h-4 mr-2\" />\n                  Open Billing Portal\n                </Button>\n              </div>\n            </TabsContent>\n          </Tabs>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":37632,"size_tokens":null},"client/src/components/schedule/ResourcesModal.tsx":{"content":"import { useState } from \"react\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter } from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Trash2, Edit, Plus, User, Truck, AlertCircle, Mail } from \"lucide-react\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Badge } from \"@/components/ui/badge\";\n\ninterface ResourcesModalProps {\n    open: boolean;\n    onOpenChange: (open: boolean) => void;\n    employees: { id: string; name: string; status: 'active' | 'holiday' | 'sick'; email?: string; jobRole?: 'operative' | 'assistant' }[];\n    vehicles: { id: string; name: string; status: 'active' | 'off_road' | 'maintenance' }[];\n    onEmployeeCreate: (name: string) => void;\n    onEmployeeUpdate: (id: string, name: string, status?: 'active' | 'holiday' | 'sick', jobRole?: 'operative' | 'assistant', email?: string) => void;\n    onEmployeeDelete: (id: string) => void;\n    onVehicleCreate: (name: string) => void;\n    onVehicleUpdate: (id: string, name: string, status?: 'active' | 'off_road' | 'maintenance') => void;\n    onVehicleDelete: (id: string) => void;\n}\n\nexport function ResourcesModal({ \n    open, onOpenChange, \n    employees, vehicles,\n    onEmployeeCreate, onEmployeeUpdate, onEmployeeDelete,\n    onVehicleCreate, onVehicleUpdate, onVehicleDelete\n}: ResourcesModalProps) {\n    const [newItemName, setNewItemName] = useState(\"\");\n    const [editingEmployee, setEditingEmployee] = useState<{ id: string, name: string, status: 'active' | 'holiday' | 'sick', email?: string } | null>(null);\n    const [editingVehicle, setEditingVehicle] = useState<{ id: string, name: string, status: 'active' | 'off_road' | 'maintenance' } | null>(null);\n\n    const handleAdd = (type: 'employee' | 'vehicle') => {\n        if (!newItemName.trim()) return;\n        if (type === 'employee') onEmployeeCreate(newItemName);\n        else onVehicleCreate(newItemName);\n        setNewItemName(\"\");\n    };\n\n    const handleEmployeeSave = () => {\n        if (!editingEmployee || !editingEmployee.name.trim()) return;\n        onEmployeeUpdate(editingEmployee.id, editingEmployee.name, editingEmployee.status, undefined, editingEmployee.email);\n        setEditingEmployee(null);\n    };\n\n    const handleVehicleSave = () => {\n        if (!editingVehicle || !editingVehicle.name.trim()) return;\n        onVehicleUpdate(editingVehicle.id, editingVehicle.name, editingVehicle.status);\n        setEditingVehicle(null);\n    };\n\n    return (\n        <Dialog open={open} onOpenChange={onOpenChange}>\n            <DialogContent className=\"sm:max-w-[600px] bg-white text-slate-900 h-[80vh] flex flex-col\">\n                <DialogHeader>\n                    <DialogTitle>Manage Resources</DialogTitle>\n                </DialogHeader>\n                \n                <Tabs defaultValue=\"employees\" className=\"flex-1 flex flex-col min-h-0\">\n                    <TabsList className=\"grid w-full grid-cols-2\">\n                        <TabsTrigger value=\"employees\">Employees</TabsTrigger>\n                        <TabsTrigger value=\"vehicles\">Vehicles</TabsTrigger>\n                    </TabsList>\n                    \n                    <TabsContent value=\"employees\" className=\"flex-1 flex flex-col min-h-0 mt-4 space-y-4\">\n                        <div className=\"flex gap-2\">\n                            <Input \n                                placeholder=\"Add new employee name...\" \n                                value={newItemName}\n                                onChange={(e) => setNewItemName(e.target.value)}\n                                onKeyDown={(e) => e.key === 'Enter' && handleAdd('employee')}\n                            />\n                            <Button onClick={() => handleAdd('employee')}><Plus className=\"w-4 h-4 mr-2\" /> Add</Button>\n                        </div>\n                        <div className=\"flex-1 overflow-y-auto border rounded-md divide-y\">\n                            {employees.map(emp => (\n                                <div key={emp.id} className=\"p-3 flex items-center justify-between hover:bg-slate-50\">\n                                    {editingEmployee?.id === emp.id ? (\n                                        <div className=\"flex items-center gap-2 flex-1 mr-4\">\n                                            <div className=\"flex flex-col gap-1 flex-1\">\n                                                <Input \n                                                    value={editingEmployee.name} \n                                                    onChange={(e) => setEditingEmployee({ ...editingEmployee, name: e.target.value })}\n                                                    autoFocus\n                                                    className=\"w-full\"\n                                                    placeholder=\"Name\"\n                                                />\n                                                <Input \n                                                    value={editingEmployee.email || \"\"} \n                                                    onChange={(e) => setEditingEmployee({ ...editingEmployee, email: e.target.value })}\n                                                    className=\"w-full text-xs\"\n                                                    placeholder=\"Email Address\"\n                                                    type=\"email\"\n                                                />\n                                            </div>\n                                            <Select \n                                                value={editingEmployee.status} \n                                                onValueChange={(val: any) => setEditingEmployee({ ...editingEmployee, status: val })}\n                                            >\n                                                <SelectTrigger className=\"w-32\">\n                                                    <SelectValue />\n                                                </SelectTrigger>\n                                                <SelectContent>\n                                                    <SelectItem value=\"active\">Active</SelectItem>\n                                                    <SelectItem value=\"holiday\">Holiday</SelectItem>\n                                                    <SelectItem value=\"sick\">Sick</SelectItem>\n                                                </SelectContent>\n                                            </Select>\n                                            <Button size=\"sm\" onClick={handleEmployeeSave}>Save</Button>\n                                            <Button size=\"sm\" variant=\"ghost\" onClick={() => setEditingEmployee(null)}>Cancel</Button>\n                                        </div>\n                                    ) : (\n                                        <div className=\"flex items-center gap-3 flex-1\">\n                                            <div className=\"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center text-blue-600\">\n                                                <User className=\"w-4 h-4\" />\n                                            </div>\n                                            <div className=\"flex flex-col\">\n                                                <span className=\"font-medium\">{emp.name}</span>\n                                                <div className=\"flex items-center gap-2\">\n                                                    {emp.status !== 'active' && (\n                                                        <span className=\"text-xs text-amber-600 font-medium uppercase tracking-wider flex items-center gap-1\">\n                                                            <AlertCircle className=\"w-3 h-3\" /> {emp.status}\n                                                        </span>\n                                                    )}\n                                                    {emp.email ? (\n                                                        <span className=\"text-xs text-slate-400 flex items-center gap-1\">\n                                                            <Mail className=\"w-3 h-3\" /> {emp.email}\n                                                        </span>\n                                                    ) : (\n                                                        <span className=\"text-xs text-red-400 flex items-center gap-1\">\n                                                            <AlertCircle className=\"w-3 h-3\" /> No Email\n                                                        </span>\n                                                    )}\n                                                </div>\n                                            </div>\n                                        </div>\n                                    )}\n                                    \n                                    {editingEmployee?.id !== emp.id && (\n                                        <div className=\"flex gap-1\">\n                                            <Button size=\"icon\" variant=\"ghost\" onClick={() => setEditingEmployee(emp)}>\n                                                <Edit className=\"w-4 h-4 text-slate-500\" />\n                                            </Button>\n                                            <Button size=\"icon\" variant=\"ghost\" onClick={() => onEmployeeDelete(emp.id)}>\n                                                <Trash2 className=\"w-4 h-4 text-red-500\" />\n                                            </Button>\n                                        </div>\n                                    )}\n                                </div>\n                            ))}\n                        </div>\n                    </TabsContent>\n\n                    <TabsContent value=\"vehicles\" className=\"flex-1 flex flex-col min-h-0 mt-4 space-y-4\">\n                        <div className=\"flex gap-2\">\n                            <Input \n                                placeholder=\"Add new vehicle name...\" \n                                value={newItemName}\n                                onChange={(e) => setNewItemName(e.target.value)}\n                                onKeyDown={(e) => e.key === 'Enter' && handleAdd('vehicle')}\n                            />\n                            <Button onClick={() => handleAdd('vehicle')}><Plus className=\"w-4 h-4 mr-2\" /> Add</Button>\n                        </div>\n                        <div className=\"flex-1 overflow-y-auto border rounded-md divide-y\">\n                            {vehicles.map(veh => (\n                                <div key={veh.id} className=\"p-3 flex items-center justify-between hover:bg-slate-50\">\n                                    {editingVehicle?.id === veh.id ? (\n                                        <div className=\"flex items-center gap-2 flex-1 mr-4\">\n                                            <Input \n                                                value={editingVehicle.name} \n                                                onChange={(e) => setEditingVehicle({ ...editingVehicle, name: e.target.value })}\n                                                autoFocus\n                                                className=\"w-40\"\n                                            />\n                                            <Select \n                                                value={editingVehicle.status} \n                                                onValueChange={(val: any) => setEditingVehicle({ ...editingVehicle, status: val })}\n                                            >\n                                                <SelectTrigger className=\"w-32\">\n                                                    <SelectValue />\n                                                </SelectTrigger>\n                                                <SelectContent>\n                                                    <SelectItem value=\"active\">Active</SelectItem>\n                                                    <SelectItem value=\"off_road\">VOR</SelectItem>\n                                                    <SelectItem value=\"maintenance\">Maintenance</SelectItem>\n                                                </SelectContent>\n                                            </Select>\n                                            <Button size=\"sm\" onClick={handleVehicleSave}>Save</Button>\n                                            <Button size=\"sm\" variant=\"ghost\" onClick={() => setEditingVehicle(null)}>Cancel</Button>\n                                        </div>\n                                    ) : (\n                                        <div className=\"flex items-center gap-3 flex-1\">\n                                            <div className=\"w-8 h-8 bg-slate-100 rounded-full flex items-center justify-center text-slate-600\">\n                                                <Truck className=\"w-4 h-4\" />\n                                            </div>\n                                            <div className=\"flex flex-col\">\n                                                <span className=\"font-medium\">{veh.name}</span>\n                                                {veh.status !== 'active' && (\n                                                    <span className=\"text-xs text-red-600 font-medium uppercase tracking-wider flex items-center gap-1\">\n                                                        <AlertCircle className=\"w-3 h-3\" /> {veh.status === 'off_road' ? 'VOR' : veh.status}\n                                                    </span>\n                                                )}\n                                            </div>\n                                        </div>\n                                    )}\n                                    \n                                    {editingVehicle?.id !== veh.id && (\n                                        <div className=\"flex gap-1\">\n                                            <Button size=\"icon\" variant=\"ghost\" onClick={() => setEditingVehicle(veh)}>\n                                                <Edit className=\"w-4 h-4 text-slate-500\" />\n                                            </Button>\n                                            <Button size=\"icon\" variant=\"ghost\" onClick={() => onVehicleDelete(veh.id)}>\n                                                <Trash2 className=\"w-4 h-4 text-red-500\" />\n                                            </Button>\n                                        </div>\n                                    )}\n                                </div>\n                            ))}\n                        </div>\n                    </TabsContent>\n                </Tabs>\n\n                <DialogFooter>\n                    <Button onClick={() => onOpenChange(false)}>Close</Button>\n                </DialogFooter>\n            </DialogContent>\n        </Dialog>\n    );\n}\n","path":null,"size_bytes":15206,"size_tokens":null},"client/src/App.tsx":{"content":"import { Switch, Route } from \"wouter\";\nimport { queryClient } from \"./lib/queryClient\";\nimport { QueryClientProvider } from \"@tanstack/react-query\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { TooltipProvider } from \"@/components/ui/tooltip\";\nimport NotFound from \"@/pages/not-found\";\nimport SchedulePage from \"@/pages/schedule\";\nimport HomePage from \"@/pages/home\";\nimport AcceptInvitePage from \"@/pages/accept-invite\";\n\nfunction App() {\n  return (\n    <QueryClientProvider client={queryClient}>\n      <TooltipProvider>\n        <Toaster />\n        <Switch>\n          {/* Landing Page */}\n          <Route path=\"/\">\n            <HomePage />\n          </Route>\n\n          {/* Schedule Page */}\n          <Route path=\"/schedule\">\n            <SchedulePage />\n          </Route>\n\n          {/* Accept Invite Page */}\n          <Route path=\"/invite/:token\">\n            <AcceptInvitePage />\n          </Route>\n\n          {/* Fallback to 404 */}\n          <Route component={NotFound} />\n        </Switch>\n      </TooltipProvider>\n    </QueryClientProvider>\n  );\n}\n\nexport default App;\n","path":null,"size_bytes":1097,"size_tokens":null},"client/src/components/schedule/NoteCard.tsx":{"content":"import { FileText, MoreHorizontal, Copy, Trash2, Edit, CalendarDays, CalendarRange } from \"lucide-react\";\nimport { useSortable } from \"@dnd-kit/sortable\";\nimport { CSS } from \"@dnd-kit/utilities\";\nimport { cn } from \"@/lib/utils\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuSeparator,\n} from \"@/components/ui/dropdown-menu\";\nimport {\n    ContextMenu,\n    ContextMenuContent,\n    ContextMenuItem,\n    ContextMenuTrigger,\n    ContextMenuSub,\n    ContextMenuSubContent,\n    ContextMenuSubTrigger,\n    ContextMenuSeparator,\n} from \"@/components/ui/context-menu\";\nimport { Button } from \"@/components/ui/button\";\nimport { ScheduleItem } from \"./CalendarGrid\";\n\ninterface NoteCardProps {\n  item: ScheduleItem;\n  onEdit: (item: ScheduleItem) => void;\n  onDelete: (id: string, mode: 'single' | 'week' | 'remainder_month' | 'remainder_year' | 'next_2_months' | 'next_3_months' | 'next_4_months' | 'next_5_months' | 'next_6_months') => void;\n  onDuplicate: (item: ScheduleItem, mode: 'single' | 'week' | 'following_week' | 'custom' | 'remainder_month' | 'remainder_year' | 'next_2_months' | 'next_3_months' | 'next_4_months' | 'next_5_months' | 'next_6_months', days?: number) => void;\n  isReadOnly?: boolean;\n  isSelected?: boolean;\n  onToggleSelection?: (id: string, multi: boolean) => void;\n}\n\nexport function NoteCard({ item, onEdit, onDelete, onDuplicate, isReadOnly = false, isSelected = false, onToggleSelection }: NoteCardProps) {\n  const {\n    attributes,\n    listeners,\n    setNodeRef,\n    transform,\n    transition,\n    isDragging,\n  } = useSortable({ id: item.id, data: item, disabled: isReadOnly });\n\n  const style = {\n    transform: CSS.Transform.toString(transform),\n    transition,\n    opacity: isDragging ? 0.5 : 1,\n  };\n\n  return (\n    <ContextMenu>\n        <ContextMenuTrigger>\n            <div\n            ref={setNodeRef}\n            style={style}\n            {...attributes}\n            {...listeners}\n            onDoubleClick={(e) => {\n                e.stopPropagation();\n                onEdit(item);\n            }}\n            onClick={(e) => {\n                if (e.shiftKey && onToggleSelection) {\n                    e.stopPropagation();\n                    onToggleSelection(item.id, true);\n                } else if (onToggleSelection) {\n                    // Optional: Click without shift selects just this one?\n                    // onToggleSelection(item.id, false);\n                }\n            }}\n            className={cn(\n                \"group relative rounded-lg border shadow-sm cursor-grab active:cursor-grabbing transition-all select-none overflow-hidden p-1 flex items-center gap-1\",\n                isSelected ? \"ring-2 ring-black ring-inset z-20 border-transparent\" : \"\",\n                // Grid cell behavior: fill the cell\n                \"w-full h-full min-w-0 mb-1\",\n                // Note Style - Red Border as requested\n                \"bg-red-50 border-red-300 hover:border-red-400\"\n            )}\n            >\n            <div className={cn(\"p-1 rounded-full shrink-0 relative bg-red-100 text-red-600\")}>\n                    <FileText className=\"w-3 h-3\" />\n                </div>\n                \n                <div className=\"flex flex-col min-w-0 flex-1\">\n                    <span className=\"text-[10px] font-medium text-red-900 leading-tight line-clamp-2 whitespace-normal break-words\">\n                        {item.noteContent || \"Empty Note\"}\n                    </span>\n                </div>\n\n            <div className=\"opacity-0 group-hover:opacity-100 transition-opacity\" onPointerDown={(e) => e.stopPropagation()}>\n                <DropdownMenu>\n                    <DropdownMenuTrigger asChild>\n                    <Button variant=\"ghost\" size=\"icon\" className=\"h-5 w-5 p-0 hover:bg-black/5 text-red-400 hover:text-red-700\">\n                        <MoreHorizontal className=\"h-3 w-3\" />\n                    </Button>\n                    </DropdownMenuTrigger>\n                    <DropdownMenuContent align=\"end\" className=\"w-48\">\n                    {!isReadOnly && (\n                        <>\n                        <DropdownMenuItem onClick={() => onEdit(item)}>\n                            <Edit className=\"w-3 h-3 mr-2\" /> Edit\n                        </DropdownMenuItem>\n                        \n                        <DropdownMenuSub>\n                            <DropdownMenuSubTrigger>\n                                <Copy className=\"w-3 h-3 mr-2\" /> Duplicate\n                            </DropdownMenuSubTrigger>\n                            <DropdownMenuSubContent className=\"w-48\">\n                                <DropdownMenuItem onClick={() => onDuplicate(item, 'single')}>\n                                    Duplicate Single\n                                </DropdownMenuItem>\n                                <DropdownMenuItem onClick={() => onDuplicate(item, 'custom', 5)}>\n                                    <CalendarDays className=\"w-3 h-3 mr-2\" /> Next 5 Days\n                                </DropdownMenuItem>\n                                <DropdownMenuItem onClick={() => onDuplicate(item, 'week')}>\n                                    <CalendarRange className=\"w-3 h-3 mr-2\" /> Remainder of Week\n                                </DropdownMenuItem>\n                                <DropdownMenuItem onClick={() => onDuplicate(item, 'following_week')}>\n                                    <CalendarRange className=\"w-3 h-3 mr-2\" /> Following Week\n                                </DropdownMenuItem>\n                                <DropdownMenuSeparator />\n                                <DropdownMenuItem onClick={() => onDuplicate(item, 'remainder_month')}>\n                                    <CalendarRange className=\"w-3 h-3 mr-2\" /> Remainder of Month\n                                </DropdownMenuItem>\n                                <DropdownMenuItem onClick={() => onDuplicate(item, 'remainder_year')}>\n                                    <CalendarRange className=\"w-3 h-3 mr-2\" /> Remainder of Year\n                                </DropdownMenuItem>\n                                <DropdownMenuItem onClick={() => onDuplicate(item, 'next_2_months')}>\n                                    <CalendarRange className=\"w-3 h-3 mr-2\" /> Next 2 Months\n                                </DropdownMenuItem>\n                                <DropdownMenuItem onClick={() => onDuplicate(item, 'next_3_months')}>\n                                    <CalendarRange className=\"w-3 h-3 mr-2\" /> Next 3 Months\n                                </DropdownMenuItem>\n                                <DropdownMenuItem onClick={() => onDuplicate(item, 'next_4_months')}>\n                                    <CalendarRange className=\"w-3 h-3 mr-2\" /> Next 4 Months\n                                </DropdownMenuItem>\n                                <DropdownMenuItem onClick={() => onDuplicate(item, 'next_5_months')}>\n                                    <CalendarRange className=\"w-3 h-3 mr-2\" /> Next 5 Months\n                                </DropdownMenuItem>\n                                <DropdownMenuItem onClick={() => onDuplicate(item, 'next_6_months')}>\n                                    <CalendarRange className=\"w-3 h-3 mr-2\" /> Next 6 Months\n                                </DropdownMenuItem>\n                            </DropdownMenuSubContent>\n                        </DropdownMenuSub>\n\n                        <DropdownMenuSeparator />\n\n                        <DropdownMenuSub>\n                            <DropdownMenuSubTrigger className=\"text-red-600\">\n                                <Trash2 className=\"w-3 h-3 mr-2\" /> Delete\n                            </DropdownMenuSubTrigger>\n                            <DropdownMenuSubContent className=\"w-48\">\n                                <DropdownMenuItem onClick={() => onDelete(item.id, 'single')} className=\"text-red-600\">\n                                    Delete Single\n                                </DropdownMenuItem>\n                                <DropdownMenuItem onClick={() => onDelete(item.id, 'week')} className=\"text-red-600\">\n                                    <CalendarRange className=\"w-3 h-3 mr-2\" /> Remainder of Week\n                                </DropdownMenuItem>\n                                <DropdownMenuSeparator />\n                                <DropdownMenuItem onClick={() => onDelete(item.id, 'remainder_month')} className=\"text-red-600\">\n                                    <CalendarRange className=\"w-3 h-3 mr-2\" /> Remainder of Month\n                                </DropdownMenuItem>\n                                <DropdownMenuItem onClick={() => onDelete(item.id, 'remainder_year')} className=\"text-red-600\">\n                                    <CalendarRange className=\"w-3 h-3 mr-2\" /> Remainder of Year\n                                </DropdownMenuItem>\n                                <DropdownMenuItem onClick={() => onDelete(item.id, 'next_2_months')} className=\"text-red-600\">\n                                    <CalendarRange className=\"w-3 h-3 mr-2\" /> Next 2 Months\n                                </DropdownMenuItem>\n                                <DropdownMenuItem onClick={() => onDelete(item.id, 'next_3_months')} className=\"text-red-600\">\n                                    <CalendarRange className=\"w-3 h-3 mr-2\" /> Next 3 Months\n                                </DropdownMenuItem>\n                                <DropdownMenuItem onClick={() => onDelete(item.id, 'next_4_months')} className=\"text-red-600\">\n                                    <CalendarRange className=\"w-3 h-3 mr-2\" /> Next 4 Months\n                                </DropdownMenuItem>\n                                <DropdownMenuItem onClick={() => onDelete(item.id, 'next_5_months')} className=\"text-red-600\">\n                                    <CalendarRange className=\"w-3 h-3 mr-2\" /> Next 5 Months\n                                </DropdownMenuItem>\n                                <DropdownMenuItem onClick={() => onDelete(item.id, 'next_6_months')} className=\"text-red-600\">\n                                    <CalendarRange className=\"w-3 h-3 mr-2\" /> Next 6 Months\n                                </DropdownMenuItem>\n                            </DropdownMenuSubContent>\n                        </DropdownMenuSub>\n                        </>\n                    )}\n                    {isReadOnly && (\n                        <DropdownMenuItem disabled className=\"text-xs text-slate-400\">\n                            Read Only Mode\n                        </DropdownMenuItem>\n                    )}\n                    </DropdownMenuContent>\n                </DropdownMenu>\n            </div>\n            </div>\n        </ContextMenuTrigger>\n        <ContextMenuContent className=\"w-48\">\n            {!isReadOnly && (\n                <>\n                <ContextMenuItem onClick={() => onEdit(item)}>\n                    <Edit className=\"w-3 h-3 mr-2\" /> Edit\n                </ContextMenuItem>\n                \n                <ContextMenuSub>\n                    <ContextMenuSubTrigger>\n                        <Copy className=\"w-3 h-3 mr-2\" /> Duplicate\n                    </ContextMenuSubTrigger>\n                    <ContextMenuSubContent className=\"w-48\">\n                        <ContextMenuItem onClick={() => onDuplicate(item, 'single')}>\n                            Duplicate Single\n                        </ContextMenuItem>\n                        <ContextMenuItem onClick={() => onDuplicate(item, 'custom', 5)}>\n                            <CalendarDays className=\"w-3 h-3 mr-2\" /> Next 5 Days\n                        </ContextMenuItem>\n                        <ContextMenuItem onClick={() => onDuplicate(item, 'week')}>\n                            <CalendarRange className=\"w-3 h-3 mr-2\" /> Remainder of Week\n                        </ContextMenuItem>\n                        <ContextMenuItem onClick={() => onDuplicate(item, 'following_week')}>\n                            <CalendarRange className=\"w-3 h-3 mr-2\" /> Following Week\n                        </ContextMenuItem>\n                        <ContextMenuSeparator />\n                        <ContextMenuItem onClick={() => onDuplicate(item, 'remainder_month')}>\n                            <CalendarRange className=\"w-3 h-3 mr-2\" /> Remainder of Month\n                        </ContextMenuItem>\n                        <ContextMenuItem onClick={() => onDuplicate(item, 'remainder_year')}>\n                            <CalendarRange className=\"w-3 h-3 mr-2\" /> Remainder of Year\n                        </ContextMenuItem>\n                        <ContextMenuItem onClick={() => onDuplicate(item, 'next_2_months')}>\n                            <CalendarRange className=\"w-3 h-3 mr-2\" /> Next 2 Months\n                        </ContextMenuItem>\n                        <ContextMenuItem onClick={() => onDuplicate(item, 'next_3_months')}>\n                            <CalendarRange className=\"w-3 h-3 mr-2\" /> Next 3 Months\n                        </ContextMenuItem>\n                        <ContextMenuItem onClick={() => onDuplicate(item, 'next_4_months')}>\n                            <CalendarRange className=\"w-3 h-3 mr-2\" /> Next 4 Months\n                        </ContextMenuItem>\n                        <ContextMenuItem onClick={() => onDuplicate(item, 'next_5_months')}>\n                            <CalendarRange className=\"w-3 h-3 mr-2\" /> Next 5 Months\n                        </ContextMenuItem>\n                        <ContextMenuItem onClick={() => onDuplicate(item, 'next_6_months')}>\n                            <CalendarRange className=\"w-3 h-3 mr-2\" /> Next 6 Months\n                        </ContextMenuItem>\n                    </ContextMenuSubContent>\n                </ContextMenuSub>\n\n                <ContextMenuSeparator />\n\n                <ContextMenuSub>\n                    <ContextMenuSubTrigger className=\"text-red-600\">\n                        <Trash2 className=\"w-3 h-3 mr-2\" /> Delete\n                    </ContextMenuSubTrigger>\n                    <ContextMenuSubContent className=\"w-48\">\n                        <ContextMenuItem onClick={() => onDelete(item.id, 'single')} className=\"text-red-600\">\n                            Delete Single\n                        </ContextMenuItem>\n                        <ContextMenuItem onClick={() => onDelete(item.id, 'week')} className=\"text-red-600\">\n                            <CalendarRange className=\"w-3 h-3 mr-2\" /> Remainder of Week\n                        </ContextMenuItem>\n                        <ContextMenuSeparator />\n                        <ContextMenuItem onClick={() => onDelete(item.id, 'remainder_month')} className=\"text-red-600\">\n                            <CalendarRange className=\"w-3 h-3 mr-2\" /> Remainder of Month\n                        </ContextMenuItem>\n                        <ContextMenuItem onClick={() => onDelete(item.id, 'remainder_year')} className=\"text-red-600\">\n                            <CalendarRange className=\"w-3 h-3 mr-2\" /> Remainder of Year\n                        </ContextMenuItem>\n                        <ContextMenuItem onClick={() => onDelete(item.id, 'next_2_months')} className=\"text-red-600\">\n                            <CalendarRange className=\"w-3 h-3 mr-2\" /> Next 2 Months\n                        </ContextMenuItem>\n                        <ContextMenuItem onClick={() => onDelete(item.id, 'next_3_months')} className=\"text-red-600\">\n                            <CalendarRange className=\"w-3 h-3 mr-2\" /> Next 3 Months\n                        </ContextMenuItem>\n                        <ContextMenuItem onClick={() => onDelete(item.id, 'next_4_months')} className=\"text-red-600\">\n                            <CalendarRange className=\"w-3 h-3 mr-2\" /> Next 4 Months\n                        </ContextMenuItem>\n                        <ContextMenuItem onClick={() => onDelete(item.id, 'next_5_months')} className=\"text-red-600\">\n                            <CalendarRange className=\"w-3 h-3 mr-2\" /> Next 5 Months\n                        </ContextMenuItem>\n                        <ContextMenuItem onClick={() => onDelete(item.id, 'next_6_months')} className=\"text-red-600\">\n                            <CalendarRange className=\"w-3 h-3 mr-2\" /> Next 6 Months\n                        </ContextMenuItem>\n                    </ContextMenuSubContent>\n                </ContextMenuSub>\n                </>\n            )}\n            {isReadOnly && (\n                <ContextMenuItem disabled className=\"text-xs text-slate-400\">\n                    Read Only Mode\n                </ContextMenuItem>\n            )}\n        </ContextMenuContent>\n    </ContextMenu>\n  );\n}","path":null,"size_bytes":16819,"size_tokens":null},"shared/schema.ts":{"content":"import { sql } from \"drizzle-orm\";\nimport { pgTable, text, varchar, timestamp, integer, boolean } from \"drizzle-orm/pg-core\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\n\n// ================= ORGANIZATIONS =================\nexport const organizations = pgTable(\"organizations\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  name: text(\"name\").notNull(),\n  ownerId: varchar(\"owner_id\").notNull(),\n  plan: text(\"plan\").notNull().default(\"starter\"),\n  stripeCustomerId: text(\"stripe_customer_id\"),\n  stripeSubscriptionId: text(\"stripe_subscription_id\"),\n  subscriptionStatus: text(\"subscription_status\").default(\"trialing\"),\n  trialEndsAt: timestamp(\"trial_ends_at\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const insertOrganizationSchema = createInsertSchema(organizations).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport type InsertOrganization = z.infer<typeof insertOrganizationSchema>;\nexport type Organization = typeof organizations.$inferSelect;\n\n// ================= ORGANIZATION MEMBERSHIPS =================\nexport type MemberRole = \"admin\" | \"operations\" | \"user\";\n\nexport const organizationMemberships = pgTable(\"organization_memberships\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  organizationId: varchar(\"organization_id\").notNull().references(() => organizations.id, { onDelete: \"cascade\" }),\n  userId: varchar(\"user_id\").notNull(),\n  role: text(\"role\").notNull().default(\"user\"),\n  invitedBy: varchar(\"invited_by\"),\n  invitedAt: timestamp(\"invited_at\").defaultNow(),\n  acceptedAt: timestamp(\"accepted_at\"),\n});\n\nexport const insertMembershipSchema = createInsertSchema(organizationMemberships).omit({\n  id: true,\n  invitedAt: true,\n});\n\nexport type InsertMembership = z.infer<typeof insertMembershipSchema>;\nexport type OrganizationMembership = typeof organizationMemberships.$inferSelect;\n\n// ================= TEAM INVITES =================\nexport const teamInvites = pgTable(\"team_invites\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  organizationId: varchar(\"organization_id\").notNull().references(() => organizations.id, { onDelete: \"cascade\" }),\n  email: text(\"email\").notNull(),\n  role: text(\"role\").notNull().default(\"user\"),\n  invitedBy: varchar(\"invited_by\").notNull(),\n  token: text(\"token\").notNull().unique(),\n  expiresAt: timestamp(\"expires_at\").notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const insertTeamInviteSchema = createInsertSchema(teamInvites).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport type InsertTeamInvite = z.infer<typeof insertTeamInviteSchema>;\nexport type TeamInvite = typeof teamInvites.$inferSelect;\n\n// ================= USERS =================\nexport const users = pgTable(\"users\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  username: text(\"username\").notNull().unique(),\n  password: text(\"password\").notNull(),\n  email: text(\"email\"),\n  role: text(\"role\").notNull().default(\"user\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  stripeCustomerId: text(\"stripe_customer_id\"),\n  stripeSubscriptionId: text(\"stripe_subscription_id\"),\n  subscriptionStatus: text(\"subscription_status\"),\n  trialEndsAt: timestamp(\"trial_ends_at\"),\n});\n\nexport const insertUserSchema = createInsertSchema(users).omit({\n  id: true,\n  createdAt: true,\n  stripeCustomerId: true,\n  stripeSubscriptionId: true,\n  subscriptionStatus: true,\n  trialEndsAt: true,\n});\n\nexport type InsertUser = z.infer<typeof insertUserSchema>;\nexport type User = typeof users.$inferSelect;\n\n// ================= DEPOTS =================\nexport const depots = pgTable(\"depots\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  name: text(\"name\").notNull(),\n  address: text(\"address\").notNull(),\n  userId: varchar(\"user_id\").notNull().references(() => users.id, { onDelete: \"cascade\" }),\n  organizationId: varchar(\"organization_id\").references(() => organizations.id, { onDelete: \"cascade\" }),\n});\n\nexport const insertDepotSchema = createInsertSchema(depots).omit({\n  id: true,\n});\n\nexport type InsertDepot = z.infer<typeof insertDepotSchema>;\nexport type Depot = typeof depots.$inferSelect;\n\n// ================= CREWS =================\nexport const crews = pgTable(\"crews\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  name: text(\"name\").notNull(),\n  depotId: varchar(\"depot_id\").notNull().references(() => depots.id, { onDelete: \"cascade\" }),\n  shift: text(\"shift\").notNull().default(\"day\"),\n  userId: varchar(\"user_id\").notNull().references(() => users.id, { onDelete: \"cascade\" }),\n  organizationId: varchar(\"organization_id\").references(() => organizations.id, { onDelete: \"cascade\" }),\n  archivedAt: timestamp(\"archived_at\"),\n});\n\nexport const insertCrewSchema = createInsertSchema(crews).omit({\n  id: true,\n});\n\nexport type InsertCrew = z.infer<typeof insertCrewSchema>;\nexport type Crew = typeof crews.$inferSelect;\n\n// ================= EMPLOYEES =================\nexport const employees = pgTable(\"employees\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  name: text(\"name\").notNull(),\n  status: text(\"status\").notNull().default(\"active\"),\n  jobRole: text(\"job_role\").notNull().default(\"operative\"),\n  email: text(\"email\"),\n  depotId: varchar(\"depot_id\").notNull().references(() => depots.id, { onDelete: \"cascade\" }),\n  userId: varchar(\"user_id\").notNull().references(() => users.id, { onDelete: \"cascade\" }),\n  organizationId: varchar(\"organization_id\").references(() => organizations.id, { onDelete: \"cascade\" }),\n});\n\nexport const insertEmployeeSchema = createInsertSchema(employees).omit({\n  id: true,\n});\n\nexport type InsertEmployee = z.infer<typeof insertEmployeeSchema>;\nexport type Employee = typeof employees.$inferSelect;\n\n// ================= VEHICLES =================\nexport const vehicles = pgTable(\"vehicles\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  name: text(\"name\").notNull(),\n  status: text(\"status\").notNull().default(\"active\"),\n  vehicleType: text(\"vehicle_type\").notNull(),\n  depotId: varchar(\"depot_id\").notNull().references(() => depots.id, { onDelete: \"cascade\" }),\n  userId: varchar(\"user_id\").notNull().references(() => users.id, { onDelete: \"cascade\" }),\n  organizationId: varchar(\"organization_id\").references(() => organizations.id, { onDelete: \"cascade\" }),\n});\n\nexport const insertVehicleSchema = createInsertSchema(vehicles).omit({\n  id: true,\n});\n\nexport type InsertVehicle = z.infer<typeof insertVehicleSchema>;\nexport type Vehicle = typeof vehicles.$inferSelect;\n\n// ================= SCHEDULE ITEMS =================\nexport type ScheduleStatus = \"approved\" | \"pending\" | \"rejected\";\n\nexport const scheduleItems = pgTable(\"schedule_items\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  type: text(\"type\").notNull(),\n  date: timestamp(\"date\").notNull(),\n  crewId: varchar(\"crew_id\").notNull().references(() => crews.id, { onDelete: \"cascade\" }),\n  depotId: varchar(\"depot_id\").notNull().references(() => depots.id, { onDelete: \"cascade\" }),\n  userId: varchar(\"user_id\").notNull().references(() => users.id, { onDelete: \"cascade\" }),\n  organizationId: varchar(\"organization_id\").references(() => organizations.id, { onDelete: \"cascade\" }),\n  \n  // Approval workflow fields\n  status: text(\"status\").notNull().default(\"approved\"),\n  requestedBy: varchar(\"requested_by\").references(() => users.id),\n  approvedBy: varchar(\"approved_by\").references(() => users.id),\n  approvedAt: timestamp(\"approved_at\"),\n  rejectionReason: text(\"rejection_reason\"),\n  \n  // Job fields\n  customer: text(\"customer\"),\n  jobNumber: text(\"job_number\"),\n  address: text(\"address\"),\n  projectManager: text(\"project_manager\"),\n  startTime: text(\"start_time\"),\n  onsiteTime: text(\"onsite_time\"),\n  color: text(\"color\"),\n  duration: integer(\"duration\"),\n  \n  // Person fields\n  employeeId: varchar(\"employee_id\").references(() => employees.id, { onDelete: \"cascade\" }),\n  vehicleId: varchar(\"vehicle_id\").references(() => vehicles.id, { onDelete: \"cascade\" }),\n  \n  // Note fields\n  noteContent: text(\"note_content\"),\n});\n\nexport const insertScheduleItemSchema = createInsertSchema(scheduleItems).omit({\n  id: true,\n  approvedAt: true,\n});\n\nexport type InsertScheduleItem = z.infer<typeof insertScheduleItemSchema>;\nexport type ScheduleItem = typeof scheduleItems.$inferSelect;\n\n// ================= COLOR LABELS =================\nexport const colorLabels = pgTable(\"color_labels\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  color: text(\"color\").notNull(),\n  label: text(\"label\").notNull(),\n  userId: varchar(\"user_id\").notNull().references(() => users.id, { onDelete: \"cascade\" }),\n  organizationId: varchar(\"organization_id\").references(() => organizations.id, { onDelete: \"cascade\" }),\n});\n\nexport const insertColorLabelSchema = createInsertSchema(colorLabels).omit({\n  id: true,\n});\n\nexport type InsertColorLabel = z.infer<typeof insertColorLabelSchema>;\nexport type ColorLabel = typeof colorLabels.$inferSelect;\n\n// ================= PLAN LIMITS =================\nexport const PLAN_LIMITS = {\n  starter: {\n    depots: 1,\n    crews: 3,\n    employees: 25,\n    vehicles: 10,\n    teamMembers: 5,\n    approvalWorkflow: false,\n  },\n  pro: {\n    depots: -1,\n    crews: 30,\n    employees: 250,\n    vehicles: 60,\n    teamMembers: -1,\n    approvalWorkflow: true,\n  },\n} as const;\n\nexport type PlanType = keyof typeof PLAN_LIMITS;\n","path":null,"size_bytes":9494,"size_tokens":null},"client/src/index.css":{"content":"@import \"tailwindcss\";\n@import \"tw-animate-css\";\n\n@custom-variant dark (&:is(.dark *));\n\n@theme inline {\n  --radius-sm: calc(var(--radius) - 4px);\n  --radius-md: calc(var(--radius) - 2px);\n  --radius-lg: var(--radius);\n  --radius-xl: calc(var(--radius) + 4px);\n  \n  /* Light Mode \"Sewer Swarm\" Clean Theme */\n  --color-background: hsl(210 40% 98%); /* F8F9FA - Very light gray */\n  --color-foreground: hsl(222 47% 11%); /* Dark Slate */\n  \n  --color-card: hsl(0 0% 100%); /* White */\n  --color-card-foreground: hsl(222 47% 11%);\n  \n  --color-popover: hsl(0 0% 100%);\n  --color-popover-foreground: hsl(222 47% 11%);\n  \n  --color-primary: hsl(221 83% 53%); /* #2563EB Blue */\n  --color-primary-foreground: hsl(0 0% 100%);\n  \n  --color-secondary: hsl(210 40% 96.1%);\n  --color-secondary-foreground: hsl(222 47% 11.2%);\n  \n  --color-muted: hsl(210 40% 96.1%);\n  --color-muted-foreground: hsl(215.4 16.3% 46.9%);\n  \n  --color-accent: hsl(210 40% 96.1%);\n  --color-accent-foreground: hsl(222 47% 11.2%);\n  \n  --color-destructive: hsl(0 84.2% 60.2%);\n  --color-destructive-foreground: hsl(210 40% 98%);\n  \n  --color-border: hsl(214.3 31.8% 91.4%);\n  --color-input: hsl(214.3 31.8% 91.4%);\n  --color-ring: hsl(221 83% 53%);\n  \n  --color-chart-1: hsl(221 83% 53%);\n  --color-chart-2: hsl(173 58% 39%);\n  --color-chart-3: hsl(197 37% 24%);\n  --color-chart-4: hsl(43 74% 66%);\n  --color-chart-5: hsl(27 87% 67%);\n  \n  --color-sidebar: hsl(0 0% 100%);\n  --color-sidebar-foreground: hsl(222 47% 11%);\n  --color-sidebar-primary: hsl(221 83% 53%);\n  --color-sidebar-primary-foreground: hsl(0 0% 100%);\n  --color-sidebar-accent: hsl(210 40% 96.1%);\n  --color-sidebar-accent-foreground: hsl(222 47% 11%);\n  --color-sidebar-border: hsl(220 13% 91%);\n  --color-sidebar-ring: hsl(221 83% 53%);\n\n  --radius: 0.5rem;\n}\n\n/* Base Styles */\n@layer base {\n  * {\n    @apply border-border;\n  }\n  body {\n    @apply font-sans antialiased bg-background text-foreground;\n    font-feature-settings: \"rlig\" 1, \"calt\" 1;\n  }\n}\n\n/* Scrollbar */\n::-webkit-scrollbar {\n  width: 8px;\n  height: 8px;\n}\n\n::-webkit-scrollbar-track {\n  background: transparent;\n}\n\n::-webkit-scrollbar-thumb {\n  background: hsl(214 32% 85%);\n  border-radius: 4px;\n}\n\n::-webkit-scrollbar-thumb:hover {\n  background: hsl(214 32% 75%);\n}\n\n/* Pastel Job Colors (Backgrounds) */\n.bg-job-blue { background-color: #BFDBFE; color: #1E3A8A; }\n.bg-job-green { background-color: #BBF7D0; color: #14532D; }\n.bg-job-yellow { background-color: #FEF08A; color: #713F12; }\n.bg-job-orange { background-color: #FED7AA; color: #7C2D12; }\n.bg-job-red { background-color: #FECACA; color: #7F1D1D; }\n.bg-job-purple { background-color: #E9D5FF; color: #581C87; }\n.bg-job-pink { background-color: #FBCFE8; color: #831843; }\n.bg-job-teal { background-color: #99F6E4; color: #134E4A; }\n.bg-job-gray { background-color: #E2E8F0; color: #1E293B; }\n","path":null,"size_bytes":2859,"size_tokens":null},"client/src/components/ui/button-group.tsx":{"content":"import { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Separator } from \"@/components/ui/separator\"\n\nconst buttonGroupVariants = cva(\n  \"flex w-fit items-stretch has-[>[data-slot=button-group]]:gap-2 [&>*]:focus-visible:relative [&>*]:focus-visible:z-10 has-[select[aria-hidden=true]:last-child]:[&>[data-slot=select-trigger]:last-of-type]:rounded-r-md [&>[data-slot=select-trigger]:not([class*='w-'])]:w-fit [&>input]:flex-1\",\n  {\n    variants: {\n      orientation: {\n        horizontal:\n          \"[&>*:not(:first-child)]:rounded-l-none [&>*:not(:first-child)]:border-l-0 [&>*:not(:last-child)]:rounded-r-none\",\n        vertical:\n          \"flex-col [&>*:not(:first-child)]:rounded-t-none [&>*:not(:first-child)]:border-t-0 [&>*:not(:last-child)]:rounded-b-none\",\n      },\n    },\n    defaultVariants: {\n      orientation: \"horizontal\",\n    },\n  }\n)\n\nfunction ButtonGroup({\n  className,\n  orientation,\n  ...props\n}: React.ComponentProps<\"div\"> & VariantProps<typeof buttonGroupVariants>) {\n  return (\n    <div\n      role=\"group\"\n      data-slot=\"button-group\"\n      data-orientation={orientation}\n      className={cn(buttonGroupVariants({ orientation }), className)}\n      {...props}\n    />\n  )\n}\n\nfunction ButtonGroupText({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  asChild?: boolean\n}) {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      className={cn(\n        \"bg-muted shadow-xs flex items-center gap-2 rounded-md border px-4 text-sm font-medium [&_svg:not([class*='size-'])]:size-4 [&_svg]:pointer-events-none\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction ButtonGroupSeparator({\n  className,\n  orientation = \"vertical\",\n  ...props\n}: React.ComponentProps<typeof Separator>) {\n  return (\n    <Separator\n      data-slot=\"button-group-separator\"\n      orientation={orientation}\n      className={cn(\n        \"bg-input relative !m-0 self-stretch data-[orientation=vertical]:h-auto\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  ButtonGroup,\n  ButtonGroupSeparator,\n  ButtonGroupText,\n  buttonGroupVariants,\n}\n","path":null,"size_bytes":2209,"size_tokens":null},"client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"grid place-content-center peer h-4 w-4 shrink-0 rounded-sm border border-primary shadow focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"grid place-content-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","path":null,"size_bytes":1031,"size_tokens":null},"client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-9 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-300 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","path":null,"size_bytes":5124,"size_tokens":null},"client/src/components/ui/field.tsx":{"content":"\"use client\"\n\nimport { useMemo } from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\nimport { Separator } from \"@/components/ui/separator\"\n\nfunction FieldSet({ className, ...props }: React.ComponentProps<\"fieldset\">) {\n  return (\n    <fieldset\n      data-slot=\"field-set\"\n      className={cn(\n        \"flex flex-col gap-6\",\n        \"has-[>[data-slot=checkbox-group]]:gap-3 has-[>[data-slot=radio-group]]:gap-3\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction FieldLegend({\n  className,\n  variant = \"legend\",\n  ...props\n}: React.ComponentProps<\"legend\"> & { variant?: \"legend\" | \"label\" }) {\n  return (\n    <legend\n      data-slot=\"field-legend\"\n      data-variant={variant}\n      className={cn(\n        \"mb-3 font-medium\",\n        \"data-[variant=legend]:text-base\",\n        \"data-[variant=label]:text-sm\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction FieldGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"field-group\"\n      className={cn(\n        \"group/field-group @container/field-group flex w-full flex-col gap-7 data-[slot=checkbox-group]:gap-3 [&>[data-slot=field-group]]:gap-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nconst fieldVariants = cva(\n  \"group/field data-[invalid=true]:text-destructive flex w-full gap-3\",\n  {\n    variants: {\n      orientation: {\n        vertical: [\"flex-col [&>*]:w-full [&>.sr-only]:w-auto\"],\n        horizontal: [\n          \"flex-row items-center\",\n          \"[&>[data-slot=field-label]]:flex-auto\",\n          \"has-[>[data-slot=field-content]]:[&>[role=checkbox],[role=radio]]:mt-px has-[>[data-slot=field-content]]:items-start\",\n        ],\n        responsive: [\n          \"@md/field-group:flex-row @md/field-group:items-center @md/field-group:[&>*]:w-auto flex-col [&>*]:w-full [&>.sr-only]:w-auto\",\n          \"@md/field-group:[&>[data-slot=field-label]]:flex-auto\",\n          \"@md/field-group:has-[>[data-slot=field-content]]:items-start @md/field-group:has-[>[data-slot=field-content]]:[&>[role=checkbox],[role=radio]]:mt-px\",\n        ],\n      },\n    },\n    defaultVariants: {\n      orientation: \"vertical\",\n    },\n  }\n)\n\nfunction Field({\n  className,\n  orientation = \"vertical\",\n  ...props\n}: React.ComponentProps<\"div\"> & VariantProps<typeof fieldVariants>) {\n  return (\n    <div\n      role=\"group\"\n      data-slot=\"field\"\n      data-orientation={orientation}\n      className={cn(fieldVariants({ orientation }), className)}\n      {...props}\n    />\n  )\n}\n\nfunction FieldContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"field-content\"\n      className={cn(\n        \"group/field-content flex flex-1 flex-col gap-1.5 leading-snug\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction FieldLabel({\n  className,\n  ...props\n}: React.ComponentProps<typeof Label>) {\n  return (\n    <Label\n      data-slot=\"field-label\"\n      className={cn(\n        \"group/field-label peer/field-label flex w-fit gap-2 leading-snug group-data-[disabled=true]/field:opacity-50\",\n        \"has-[>[data-slot=field]]:w-full has-[>[data-slot=field]]:flex-col has-[>[data-slot=field]]:rounded-md has-[>[data-slot=field]]:border [&>[data-slot=field]]:p-4\",\n        \"has-data-[state=checked]:bg-primary/5 has-data-[state=checked]:border-primary dark:has-data-[state=checked]:bg-primary/10\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction FieldTitle({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"field-label\"\n      className={cn(\n        \"flex w-fit items-center gap-2 text-sm font-medium leading-snug group-data-[disabled=true]/field:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction FieldDescription({ className, ...props }: React.ComponentProps<\"p\">) {\n  return (\n    <p\n      data-slot=\"field-description\"\n      className={cn(\n        \"text-muted-foreground text-sm font-normal leading-normal group-has-[[data-orientation=horizontal]]/field:text-balance\",\n        \"nth-last-2:-mt-1 last:mt-0 [[data-variant=legend]+&]:-mt-1.5\",\n        \"[&>a:hover]:text-primary [&>a]:underline [&>a]:underline-offset-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction FieldSeparator({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  children?: React.ReactNode\n}) {\n  return (\n    <div\n      data-slot=\"field-separator\"\n      data-content={!!children}\n      className={cn(\n        \"relative -my-2 h-5 text-sm group-data-[variant=outline]/field-group:-mb-2\",\n        className\n      )}\n      {...props}\n    >\n      <Separator className=\"absolute inset-0 top-1/2\" />\n      {children && (\n        <span\n          className=\"bg-background text-muted-foreground relative mx-auto block w-fit px-2\"\n          data-slot=\"field-separator-content\"\n        >\n          {children}\n        </span>\n      )}\n    </div>\n  )\n}\n\nfunction FieldError({\n  className,\n  children,\n  errors,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  errors?: Array<{ message?: string } | undefined>\n}) {\n  const content = useMemo(() => {\n    if (children) {\n      return children\n    }\n\n    if (!errors) {\n      return null\n    }\n\n    if (errors?.length === 1 && errors[0]?.message) {\n      return errors[0].message\n    }\n\n    return (\n      <ul className=\"ml-4 flex list-disc flex-col gap-1\">\n        {errors.map(\n          (error, index) =>\n            error?.message && <li key={index}>{error.message}</li>\n        )}\n      </ul>\n    )\n  }, [children, errors])\n\n  if (!content) {\n    return null\n  }\n\n  return (\n    <div\n      role=\"alert\"\n      data-slot=\"field-error\"\n      className={cn(\"text-destructive text-sm font-normal\", className)}\n      {...props}\n    >\n      {content}\n    </div>\n  )\n}\n\nexport {\n  Field,\n  FieldLabel,\n  FieldDescription,\n  FieldError,\n  FieldGroup,\n  FieldLegend,\n  FieldSeparator,\n  FieldSet,\n  FieldContent,\n  FieldTitle,\n}\n","path":null,"size_bytes":6044,"size_tokens":null},"client/src/components/ui/hover-card.tsx":{"content":"import * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-hover-card-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","path":null,"size_bytes":1237,"size_tokens":null},"client/src/components/ui/command.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\nconst CommandDialog = ({ children, ...props }: DialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-10 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected=true]:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","path":null,"size_bytes":4887,"size_tokens":null},"client/src/components/schedule/JobModal.tsx":{"content":"import { useState } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Calendar } from \"@/components/ui/calendar\";\nimport { Popover, PopoverContent, PopoverTrigger } from \"@/components/ui/popover\";\nimport { format } from \"date-fns\";\nimport { CalendarIcon, Clock, MapPin, User, Truck, Briefcase, Palette, Check } from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\n\nconst jobSchema = z.object({\n  title: z.string().min(1, \"Job title is required\"),\n  customer: z.string().min(1, \"Customer is required\"),\n  jobNumber: z.string().optional(),\n  address: z.string().min(1, \"Address is required\"),\n  date: z.date(),\n  startTime: z.string(),\n  onsiteTime: z.string(),\n  employeeId: z.string().min(1, \"Lead employee is required\"),\n  vehicleId: z.string().min(1, \"Vehicle is required\"),\n  assistantId: z.string().optional(),\n  color: z.string().default(\"blue\"),\n  crewId: z.string().optional(), // Added crewId\n});\n\nexport type JobFormData = z.infer<typeof jobSchema>;\n\ninterface JobModalProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  onSubmit: (data: JobFormData) => void;\n  initialData?: Partial<JobFormData>;\n  employees: { id: string; name: string }[];\n  vehicles: { id: string; name: string }[];\n  crews?: { id: string; name: string }[];\n}\n\n// Updated Colors based on Sewer Swarm Style (Pastels)\nconst COLORS = [\n  { name: \"Blue\", value: \"blue\", class: \"bg-[#BFDBFE] border-[#3B82F6]\" },\n  { name: \"Green\", value: \"green\", class: \"bg-[#BBF7D0] border-[#22C55E]\" },\n  { name: \"Yellow\", value: \"yellow\", class: \"bg-[#FEF08A] border-[#EAB308]\" },\n  { name: \"Orange\", value: \"orange\", class: \"bg-[#FED7AA] border-[#F97316]\" },\n  { name: \"Red\", value: \"red\", class: \"bg-[#FECACA] border-[#EF4444]\" },\n  { name: \"Purple\", value: \"purple\", class: \"bg-[#E9D5FF] border-[#A855F7]\" },\n  { name: \"Pink\", value: \"pink\", class: \"bg-[#FBCFE8] border-[#EC4899]\" },\n  { name: \"Teal\", value: \"teal\", class: \"bg-[#99F6E4] border-[#14B8A6]\" },\n  { name: \"Gray\", value: \"gray\", class: \"bg-[#E2E8F0] border-[#64748B]\" },\n];\n\nexport function JobModal({ open, onOpenChange, onSubmit, initialData, employees, vehicles, crews }: JobModalProps) {\n  const form = useForm<JobFormData>({\n    resolver: zodResolver(jobSchema),\n    defaultValues: {\n      title: initialData?.title || \"Standard Job\",\n      customer: initialData?.customer || \"\",\n      jobNumber: initialData?.jobNumber || \"\",\n      address: initialData?.address || \"\",\n      date: initialData?.date || new Date(),\n      startTime: initialData?.startTime || \"08:00\",\n      onsiteTime: initialData?.onsiteTime || \"08:30\",\n      employeeId: initialData?.employeeId || \"\",\n      vehicleId: initialData?.vehicleId || \"\",\n      assistantId: initialData?.assistantId || \"\",\n      color: initialData?.color || \"blue\",\n      crewId: initialData?.crewId || (crews && crews.length > 0 ? crews[0].id : \"\"),\n    },\n  });\n\n  // Reset form when modal opens with new data\n  // Note: In a real app, use useEffect to sync initialData with form\n  \n  const handleSubmit = (data: JobFormData) => {\n    onSubmit(data);\n    onOpenChange(false);\n    form.reset();\n  };\n\n  const selectedColor = form.watch(\"color\");\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"sm:max-w-[650px] max-h-[90vh] overflow-y-auto bg-white text-slate-900 border-slate-200 shadow-lg\">\n        <DialogHeader className=\"border-b border-slate-100 pb-4\">\n          <DialogTitle className=\"text-xl font-bold flex items-center gap-2 text-slate-800\">\n            <Briefcase className=\"w-5 h-5 text-blue-600\" />\n            {initialData ? \"Edit Job Schedule\" : \"New Job Schedule\"}\n          </DialogTitle>\n        </DialogHeader>\n\n        <form onSubmit={form.handleSubmit(handleSubmit)} className=\"space-y-6 mt-4\">\n          {/* Color Picker - Top for visibility like reference */}\n          <div className=\"space-y-3 bg-slate-50 p-4 rounded-lg border border-slate-100\">\n            <Label className=\"text-slate-700 font-semibold\">Category / Color</Label>\n            <div className=\"flex flex-wrap gap-3\">\n               {COLORS.map((c) => (\n                 <div \n                    key={c.value}\n                    onClick={() => form.setValue(\"color\", c.value)}\n                    className={cn(\n                      \"w-8 h-8 rounded-md cursor-pointer transition-all flex items-center justify-center border-2\",\n                      c.class,\n                      selectedColor === c.value ? \"scale-110 shadow-md ring-2 ring-offset-2 ring-slate-400\" : \"opacity-70 hover:opacity-100\"\n                    )}\n                    title={c.name}\n                 >\n                   {selectedColor === c.value && <Check className=\"w-4 h-4 text-slate-800\" />}\n                 </div>\n               ))}\n            </div>\n          </div>\n\n          {/* Basic Info */}\n          <div className=\"grid grid-cols-2 gap-4\">\n            <div className=\"space-y-2 col-span-2\">\n              <Label htmlFor=\"customer\">Customer / Project</Label>\n              <Input \n                id=\"customer\" \n                {...form.register(\"customer\")} \n                placeholder=\"e.g. Apex Construction\"\n                className=\"bg-white border-slate-300 focus:ring-blue-500\"\n              />\n              {form.formState.errors.customer && <p className=\"text-red-500 text-xs\">{form.formState.errors.customer.message}</p>}\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"jobNumber\">Job Number</Label>\n              <Input \n                id=\"jobNumber\" \n                {...form.register(\"jobNumber\")} \n                placeholder=\"J-2024-001\"\n                className=\"bg-white border-slate-300\"\n              />\n            </div>\n            \n            {crews && (\n              <div className=\"space-y-2\">\n                <Label>Crew Allocation</Label>\n                <Select \n                  onValueChange={(val) => form.setValue(\"crewId\", val)}\n                  defaultValue={form.getValues(\"crewId\")}\n                >\n                  <SelectTrigger className=\"bg-white border-slate-300\">\n                    <SelectValue placeholder=\"Select Crew\" />\n                  </SelectTrigger>\n                  <SelectContent className=\"bg-white border-slate-200\">\n                    {crews.map((c) => (\n                      <SelectItem key={c.id} value={c.id}>{c.name}</SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n            )}\n          </div>\n\n          {/* Location & Time */}\n          <div className=\"space-y-4 border-t border-slate-100 pt-4\">\n            <h3 className=\"text-sm font-bold text-slate-800 flex items-center gap-2 uppercase tracking-wider\">\n              <MapPin className=\"w-4 h-4 text-blue-500\" /> Location & Timing\n            </h3>\n            \n            <div className=\"space-y-2\">\n              <Label htmlFor=\"address\">Site Address</Label>\n              <Textarea \n                id=\"address\" \n                {...form.register(\"address\")} \n                placeholder=\"123 Construction Way, London...\"\n                className=\"bg-white border-slate-300 min-h-[80px]\"\n              />\n              {form.formState.errors.address && <p className=\"text-red-500 text-xs\">{form.formState.errors.address.message}</p>}\n            </div>\n\n            <div className=\"grid grid-cols-3 gap-4\">\n              <div className=\"space-y-2\">\n                <Label>Date</Label>\n                <Popover>\n                  <PopoverTrigger asChild>\n                    <Button\n                      variant={\"outline\"}\n                      className={cn(\n                        \"w-full justify-start text-left font-normal bg-white border-slate-300 hover:bg-slate-50\",\n                        !form.watch(\"date\") && \"text-muted-foreground\"\n                      )}\n                    >\n                      <CalendarIcon className=\"mr-2 h-4 w-4\" />\n                      {form.watch(\"date\") ? format(form.watch(\"date\"), \"PPP\") : <span>Pick a date</span>}\n                    </Button>\n                  </PopoverTrigger>\n                  <PopoverContent className=\"w-auto p-0 bg-white border-slate-200\" align=\"start\">\n                    <Calendar\n                      mode=\"single\"\n                      selected={form.watch(\"date\")}\n                      onSelect={(date) => date && form.setValue(\"date\", date)}\n                      initialFocus\n                      className=\"text-slate-900\"\n                    />\n                  </PopoverContent>\n                </Popover>\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"startTime\">Start Time</Label>\n                <Input \n                  type=\"time\" \n                  id=\"startTime\" \n                  {...form.register(\"startTime\")}\n                  className=\"bg-white border-slate-300\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"onsiteTime\">Onsite Time</Label>\n                <Input \n                  type=\"time\" \n                  id=\"onsiteTime\" \n                  {...form.register(\"onsiteTime\")}\n                  className=\"bg-white border-slate-300\"\n                />\n              </div>\n            </div>\n          </div>\n\n          {/* Resources */}\n          <div className=\"space-y-4 border-t border-slate-100 pt-4\">\n            <h3 className=\"text-sm font-bold text-slate-800 flex items-center gap-2 uppercase tracking-wider\">\n              <User className=\"w-4 h-4 text-blue-500\" /> Resources\n            </h3>\n\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div className=\"space-y-2\">\n                <Label>Lead Employee (Driver)</Label>\n                <Select \n                  onValueChange={(val) => form.setValue(\"employeeId\", val)}\n                  defaultValue={form.getValues(\"employeeId\")}\n                >\n                  <SelectTrigger className=\"bg-white border-slate-300\">\n                    <SelectValue placeholder=\"Select Lead\" />\n                  </SelectTrigger>\n                  <SelectContent className=\"bg-white border-slate-200\">\n                    {employees.map((e) => (\n                      <SelectItem key={e.id} value={e.id}>{e.name}</SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n                {form.formState.errors.employeeId && <p className=\"text-red-500 text-xs\">{form.formState.errors.employeeId.message}</p>}\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label>Vehicle</Label>\n                <Select \n                  onValueChange={(val) => form.setValue(\"vehicleId\", val)}\n                  defaultValue={form.getValues(\"vehicleId\")}\n                >\n                  <SelectTrigger className=\"bg-white border-slate-300\">\n                    <SelectValue placeholder=\"Select Vehicle\" />\n                  </SelectTrigger>\n                  <SelectContent className=\"bg-white border-slate-200\">\n                    {vehicles.map((v) => (\n                      <SelectItem key={v.id} value={v.id}>{v.name}</SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n                {form.formState.errors.vehicleId && <p className=\"text-red-500 text-xs\">{form.formState.errors.vehicleId.message}</p>}\n              </div>\n\n              <div className=\"space-y-2 col-span-2\">\n                <Label>Assistant (Optional)</Label>\n                <Select \n                  onValueChange={(val) => form.setValue(\"assistantId\", val)}\n                  defaultValue={form.getValues(\"assistantId\")}\n                >\n                  <SelectTrigger className=\"bg-white border-slate-300\">\n                    <SelectValue placeholder=\"Select Assistant\" />\n                  </SelectTrigger>\n                  <SelectContent className=\"bg-white border-slate-200\">\n                    <SelectItem value=\"none\">None</SelectItem>\n                    {employees.map((e) => (\n                      <SelectItem key={e.id} value={e.id}>{e.name}</SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n                <p className=\"text-[10px] text-slate-500\">Selecting an assistant will create a separate calendar entry for them.</p>\n              </div>\n            </div>\n          </div>\n\n          <DialogFooter className=\"border-t border-slate-100 pt-4\">\n            <Button type=\"button\" variant=\"outline\" onClick={() => onOpenChange(false)} className=\"border-slate-300 hover:bg-slate-50 text-slate-700\">Cancel</Button>\n            <Button type=\"submit\" className=\"bg-blue-600 hover:bg-blue-700 text-white shadow-sm\">Save Schedule</Button>\n          </DialogFooter>\n        </form>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","path":null,"size_bytes":13372,"size_tokens":null},"scripts/seed-stripe-products.ts":{"content":"import { getUncachableStripeClient } from '../server/stripeClient';\n\nasync function seedProducts() {\n  console.log('Creating Stripe products and prices...');\n  \n  try {\n    const stripe = await getUncachableStripeClient();\n    \n    // Check if products already exist\n    const existingProducts = await stripe.products.search({ \n      query: \"name:'Sewer Swarm Pro'\" \n    });\n    \n    if (existingProducts.data.length > 0) {\n      console.log('Products already exist, skipping seed.');\n      console.log('Existing products:');\n      for (const product of existingProducts.data) {\n        console.log(`  - ${product.name} (${product.id})`);\n      }\n      return;\n    }\n    \n    // Create the main subscription product\n    const proProduct = await stripe.products.create({\n      name: 'Sewer Swarm Pro',\n      description: 'Full access for larger teams. Up to 30 crews, 250 employees, and unlimited depots with approval workflow.',\n      metadata: {\n        features: 'Unlimited depots,Up to 30 crews,Up to 250 employees,Up to 100 vehicles,Drag-and-drop scheduling,Email notifications,Smart search,Conflict detection,Approval workflow',\n        tier: 'pro',\n        depot_limit: '999',\n        crew_limit: '30',\n        employee_limit: '250',\n        vehicle_limit: '100',\n        requires_approval: 'true',\n      },\n    });\n    console.log(`Created product: ${proProduct.name} (${proProduct.id})`);\n    \n    // Create monthly price\n    const monthlyPrice = await stripe.prices.create({\n      product: proProduct.id,\n      unit_amount: 4900, // ¬£49.00\n      currency: 'gbp',\n      recurring: { interval: 'month' },\n      metadata: {\n        display_name: 'Monthly',\n      },\n    });\n    console.log(`Created monthly price: ¬£${monthlyPrice.unit_amount! / 100}/month (${monthlyPrice.id})`);\n    \n    // Create annual price with discount\n    const annualPrice = await stripe.prices.create({\n      product: proProduct.id,\n      unit_amount: 47000, // ¬£470.00 (save ¬£118/year - ~20% off)\n      currency: 'gbp',\n      recurring: { interval: 'year' },\n      metadata: {\n        display_name: 'Annual',\n        savings: '20%',\n      },\n    });\n    console.log(`Created annual price: ¬£${annualPrice.unit_amount! / 100}/year (${annualPrice.id})`);\n    \n    // Create a starter tier\n    const starterProduct = await stripe.products.create({\n      name: 'Sewer Swarm Starter',\n      description: 'Perfect for small teams. 1 depot, up to 3 crews, 25 employees with auto-approval.',\n      metadata: {\n        features: '1 depot,Up to 3 crews,Up to 25 employees,Up to 10 vehicles,Drag-and-drop scheduling,Email notifications,Auto-approval',\n        tier: 'starter',\n        depot_limit: '1',\n        crew_limit: '3',\n        employee_limit: '25',\n        vehicle_limit: '10',\n        requires_approval: 'false',\n      },\n    });\n    console.log(`Created product: ${starterProduct.name} (${starterProduct.id})`);\n    \n    // Create starter monthly price\n    const starterMonthlyPrice = await stripe.prices.create({\n      product: starterProduct.id,\n      unit_amount: 2900, // ¬£29.00\n      currency: 'gbp',\n      recurring: { interval: 'month' },\n      metadata: {\n        display_name: 'Monthly',\n      },\n    });\n    console.log(`Created starter monthly price: ¬£${starterMonthlyPrice.unit_amount! / 100}/month (${starterMonthlyPrice.id})`);\n    \n    // Create starter annual price\n    const starterAnnualPrice = await stripe.prices.create({\n      product: starterProduct.id,\n      unit_amount: 27900, // ¬£279.00 (save ¬£69/year - ~20% off)\n      currency: 'gbp',\n      recurring: { interval: 'year' },\n      metadata: {\n        display_name: 'Annual',\n        savings: '20%',\n      },\n    });\n    console.log(`Created starter annual price: ¬£${starterAnnualPrice.unit_amount! / 100}/year (${starterAnnualPrice.id})`);\n    \n    console.log('\\n‚úÖ Products and prices created successfully!');\n    console.log('\\nProduct IDs for reference:');\n    console.log(`  Starter: ${starterProduct.id}`);\n    console.log(`  Pro: ${proProduct.id}`);\n    console.log('\\nPrice IDs for checkout:');\n    console.log(`  Starter Monthly: ${starterMonthlyPrice.id}`);\n    console.log(`  Starter Annual: ${starterAnnualPrice.id}`);\n    console.log(`  Pro Monthly: ${monthlyPrice.id}`);\n    console.log(`  Pro Annual: ${annualPrice.id}`);\n    \n  } catch (error: any) {\n    console.error('Failed to seed products:', error.message);\n    process.exit(1);\n  }\n}\n\nseedProducts();\n","path":null,"size_bytes":4443,"size_tokens":null},"server/webhookHandlers.ts":{"content":"import { getStripeSync } from './stripeClient';\n\nexport class WebhookHandlers {\n  static async processWebhook(payload: Buffer, signature: string, uuid: string): Promise<void> {\n    if (!Buffer.isBuffer(payload)) {\n      throw new Error(\n        'STRIPE WEBHOOK ERROR: Payload must be a Buffer. ' +\n        'Received type: ' + typeof payload + '. ' +\n        'This usually means express.json() parsed the body before reaching this handler. ' +\n        'FIX: Ensure webhook route is registered BEFORE app.use(express.json()).'\n      );\n    }\n\n    const sync = await getStripeSync();\n    await sync.processWebhook(payload, signature, uuid);\n  }\n}\n","path":null,"size_bytes":644,"size_tokens":null},"server/db.ts":{"content":"import { drizzle } from \"drizzle-orm/node-postgres\";\nimport { migrate } from \"drizzle-orm/node-postgres/migrator\";\nimport { sql } from \"drizzle-orm\";\nimport pg from \"pg\";\nimport * as schema from \"@shared/schema\";\n\n// Track database readiness state using an object for live binding\nexport const dbState = { ready: false };\n\n// For backwards compatibility, also expose a getter function\nexport function isDbReady(): boolean {\n  return dbState.ready;\n}\n\n// Get database URL from environment variable (works for both development and production)\nfunction getDatabaseUrl(): string | null {\n  const isProduction = process.env.NODE_ENV === 'production';\n  \n  // In production, prefer PRODUCTION_DATABASE_URL (for AWS RDS)\n  if (isProduction && process.env.PRODUCTION_DATABASE_URL) {\n    console.log(\"Using PRODUCTION_DATABASE_URL for production environment (AWS RDS)\");\n    return process.env.PRODUCTION_DATABASE_URL;\n  }\n  \n  // Fall back to DATABASE_URL for development or if PRODUCTION_DATABASE_URL is not set\n  if (process.env.DATABASE_URL) {\n    const env = process.env.NODE_ENV || 'development';\n    console.log(`Using DATABASE_URL from environment variable (${env} mode)`);\n    return process.env.DATABASE_URL;\n  }\n  \n  console.error(\"DATABASE_URL not found in environment variables.\");\n  console.error(\"Please ensure a PostgreSQL database is provisioned.\");\n  return null;\n}\n\nconst databaseUrl = getDatabaseUrl();\n\n// Determine if we need SSL (required for AWS RDS)\nfunction getPoolConfig(url: string): pg.PoolConfig {\n  const isProduction = process.env.NODE_ENV === 'production';\n  const isAwsRds = url.includes('.rds.amazonaws.com');\n  \n  const config: pg.PoolConfig = {\n    connectionString: url,\n    connectionTimeoutMillis: 15000,\n  };\n  \n  // AWS RDS requires SSL\n  if (isAwsRds || isProduction) {\n    config.ssl = { rejectUnauthorized: false };\n    console.log(\"SSL enabled for database connection\");\n  }\n  \n  return config;\n}\n\n// Create pool only if we have a database URL\nexport const pool = databaseUrl ? new pg.Pool(getPoolConfig(databaseUrl)) : null;\n\n// Handle pool errors gracefully\nif (pool) {\n  pool.on('error', (err) => {\n    console.error('Unexpected database pool error:', err);\n    dbState.ready = false;\n  });\n}\n\n// Export db - will be null if no database URL is configured\nexport const db = pool ? drizzle(pool, { schema }) : null;\n\nexport async function runMigrations(): Promise<boolean> {\n  if (!pool || !db) {\n    console.error(\"Database not configured - skipping migrations\");\n    console.error(\"Set DATABASE_URL environment variable to enable database features\");\n    dbState.ready = false;\n    return false;\n  }\n  \n  console.log(\"Checking database connection...\");\n  \n  // Test database connection first\n  try {\n    const client = await pool.connect();\n    console.log(\"Database connection successful\");\n    client.release();\n  } catch (error: any) {\n    console.error(\"Failed to connect to database:\", error.message);\n    console.error(\"Please ensure DATABASE_URL is correctly configured for this environment.\");\n    dbState.ready = false;\n    return false;\n  }\n  \n  console.log(\"Checking database schema...\");\n  try {\n    // Check if the users table exists (core table that should always exist)\n    const result = await db.execute(sql`\n      SELECT EXISTS (\n        SELECT FROM information_schema.tables \n        WHERE table_schema = 'public' \n        AND table_name = 'users'\n      );\n    `);\n    \n    const tablesExist = result.rows[0]?.exists === true;\n    \n    if (tablesExist) {\n      console.log(\"Database schema already exists, skipping migrations\");\n      dbState.ready = true;\n      return true;\n    }\n    \n    console.log(\"Running database migrations...\");\n    await migrate(db, { migrationsFolder: \"./migrations\" });\n    console.log(\"Migrations completed successfully\");\n    dbState.ready = true;\n    return true;\n  } catch (error: any) {\n    console.error(\"Migration error:\", error.message);\n    dbState.ready = false;\n    return false;\n  }\n}\n","path":null,"size_bytes":3985,"size_tokens":null},"client/src/hooks/useScheduleData.ts":{"content":"import { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { api } from \"@/lib/api\";\nimport type { ScheduleItem } from \"@/lib/api\";\n\nexport function useScheduleData() {\n  const queryClient = useQueryClient();\n\n  const depots = useQuery({\n    queryKey: [\"depots\"],\n    queryFn: () => api.getDepots(),\n  });\n\n  const crews = useQuery({\n    queryKey: [\"crews\"],\n    queryFn: () => api.getCrews(true),\n  });\n\n  const employees = useQuery({\n    queryKey: [\"employees\"],\n    queryFn: () => api.getEmployees(),\n  });\n\n  const vehicles = useQuery({\n    queryKey: [\"vehicles\"],\n    queryFn: () => api.getVehicles(),\n  });\n\n  const scheduleItems = useQuery({\n    queryKey: [\"scheduleItems\"],\n    queryFn: async () => {\n      const items = await api.getScheduleItems();\n      // Convert date strings to Date objects\n      return items.map(item => ({\n        ...item,\n        date: new Date(item.date),\n      }));\n    },\n  });\n\n  const colorLabels = useQuery({\n    queryKey: [\"colorLabels\"],\n    queryFn: () => api.getColorLabels(),\n  });\n\n  // Mutations\n  const createScheduleItem = useMutation({\n    mutationFn: (item: Omit<ScheduleItem, \"id\" | \"userId\">) => api.createScheduleItem(item),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"scheduleItems\"] });\n    },\n  });\n\n  const updateScheduleItem = useMutation({\n    mutationFn: ({ id, data }: { id: string; data: Partial<ScheduleItem> }) =>\n      api.updateScheduleItem(id, data),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"scheduleItems\"] });\n    },\n  });\n\n  const deleteScheduleItem = useMutation({\n    mutationFn: (id: string) => api.deleteScheduleItem(id),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"scheduleItems\"] });\n    },\n  });\n\n  const saveColorLabel = useMutation({\n    mutationFn: ({ color, label }: { color: string; label: string }) =>\n      api.saveColorLabel(color, label),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"colorLabels\"] });\n    },\n  });\n\n  const createDepot = useMutation({\n    mutationFn: (depot: { name: string; address: string }) => api.createDepot(depot),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"depots\"] });\n    },\n  });\n\n  const createCrew = useMutation({\n    mutationFn: (crew: { name: string; depotId: string; shift: string }) => api.createCrew(crew),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"crews\"] });\n    },\n  });\n\n  const createEmployee = useMutation({\n    mutationFn: (employee: { name: string; status: string; jobRole: string; email?: string; depotId: string }) =>\n      api.createEmployee(employee),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"employees\"] });\n    },\n  });\n\n  const createVehicle = useMutation({\n    mutationFn: (vehicle: { name: string; status: string; vehicleType: string; depotId: string }) =>\n      api.createVehicle(vehicle),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"vehicles\"] });\n    },\n  });\n\n  return {\n    depots: depots.data || [],\n    crews: crews.data || [],\n    employees: employees.data || [],\n    vehicles: vehicles.data || [],\n    scheduleItems: scheduleItems.data || [],\n    colorLabels: colorLabels.data || {},\n    isLoading:\n      depots.isLoading ||\n      crews.isLoading ||\n      employees.isLoading ||\n      vehicles.isLoading ||\n      scheduleItems.isLoading ||\n      colorLabels.isLoading,\n    mutations: {\n      createScheduleItem,\n      updateScheduleItem,\n      deleteScheduleItem,\n      saveColorLabel,\n      createDepot,\n      createCrew,\n      createEmployee,\n      createVehicle,\n    },\n  };\n}\n","path":null,"size_bytes":3694,"size_tokens":null},"replit.md":{"content":"# Sewer Swarm - Crew Scheduling Application\n\n## Overview\n\nSewer Swarm is a drag-and-drop crew scheduling platform designed for drainage, civils, CCTV surveying, jetting, and utility contractors. The application provides intelligent workforce optimization with AI-driven logic, conflict detection, and real-time crew visibility across multiple depots.\n\n**Core Purpose:** Enable contractors to efficiently schedule jobs, operatives, assistants, and vehicles across multiple crews and depots with visual calendar management and automated conflict detection.\n\n**Key Features:**\n- Drag-and-drop calendar interface for scheduling\n- Multi-depot crew management\n- Employee and vehicle resource tracking\n- Smart search for crew availability\n- Email notifications for scheduled staff\n- Color-coded job categorization\n- Batch operations (duplicate to week, month, year)\n\n## User Preferences\n\nPreferred communication style: Simple, everyday language.\n\n## System Architecture\n\n### Frontend Architecture\n\n**Framework:** React with TypeScript using Vite as the build tool\n\n**UI Component Library:** \n- shadcn/ui components (Radix UI primitives)\n- Tailwind CSS for styling with custom \"Sewer Swarm\" theme (clean blue-gray palette)\n- Custom CSS variables for theming in `index.css`\n\n**State Management:**\n- TanStack Query (React Query) for server state management\n- Local React state for UI interactions\n- Session-based authentication state\n\n**Drag-and-Drop:** \n- @dnd-kit/core for drag-and-drop functionality\n- @dnd-kit/sortable for sortable lists\n- Used extensively in CalendarGrid component for scheduling items\n\n**Routing:** \n- Wouter for client-side routing\n- Two main routes: home (landing/auth) and schedule (main app)\n\n**Form Handling:**\n- react-hook-form for form state\n- zod for schema validation via @hookform/resolvers\n\n**Key UI Patterns:**\n- Modal-based workflows for creating/editing resources\n- Context menus and dropdown menus for quick actions\n- Responsive sidebar with collapse functionality\n- Calendar grid with crew rows and date columns\n\n### Backend Architecture\n\n**Server Framework:** Express.js with TypeScript\n\n**API Design:** RESTful API with session-based authentication\n\n**Authentication:**\n- express-session for session management\n- bcrypt for password hashing\n- Session cookies with httpOnly and sameSite flags\n\n**Middleware:**\n- JSON body parsing with raw body capture for webhook support\n- Request logging with duration tracking\n- Authentication middleware (`requireAuth`)\n\n**Development Server:**\n- Vite middleware integration for HMR in development\n- Static file serving in production\n- Custom error handling\n\n### Data Storage\n\n**Database:** PostgreSQL via Neon serverless driver (`@neondatabase/serverless`)\n\n**ORM:** Drizzle ORM with node-postgres driver\n\n**Schema Design:**\n- Organizations table for multi-tenant data isolation\n- Organization memberships with role-based access control (admin, operations, user)\n- Team invites for email-based member onboarding with token authentication\n- Users table with authentication credentials\n- Depots (locations) with address information\n- Crews associated with depots and shifts\n- Employees with status tracking (active/holiday/sick) and job roles\n- Vehicles with status and type categorization\n- Schedule items linking crews, employees, vehicles, and jobs with approval workflow\n- Color labels for job categorization\n\n**Role-Based Access Control (RBAC):**\n- Admin: Full access to all features including team management and billing\n- Operations Manager: Manage schedules, approve/reject bookings, manage resources\n- Booker/User: Create booking requests (auto-approved on Starter, requires approval on Pro)\n\n**Plan Limits:**\n- Starter (¬£29/mo): 1 depot, 3 crews, 25 employees, 10 vehicles, auto-approval\n- Pro (¬£49/mo): Unlimited depots, 30 crews, 250 employees, 100 vehicles, approval workflow\n\n**Database Features:**\n- Cascade deletion for maintaining referential integrity\n- UUID primary keys via `gen_random_uuid()`\n- Timestamps for audit trails\n- Organization-scoped data isolation (all entities linked to organizationId)\n- Deterministic organization selection (owned org first, then most recent membership)\n\n**Migration Strategy:** Drizzle Kit for schema migrations stored in `/migrations` directory\n\n### External Dependencies\n\n**Third-Party UI Components:**\n- Radix UI primitives for accessible components (dialogs, dropdowns, menus, tooltips, etc.)\n- Lucide React for icons\n- date-fns for date manipulation\n- react-day-picker for calendar components\n- vaul for drawer components\n\n**Development Tools:**\n- Replit-specific plugins for dev banner and cartographer (development only)\n- Vite plugin for runtime error overlay\n\n**Styling:**\n- Tailwind CSS v4 (using @import syntax in CSS)\n- class-variance-authority for component variants\n- clsx and tailwind-merge via cn() utility\n\n**Build Process:**\n- Vite for frontend bundling\n- esbuild for server-side bundling (ESM format)\n- TypeScript compilation checking without emit\n\n**Session Storage:** In-memory session store (suitable for development; would need Redis/database store for production scaling)\n\n**Environment Variables:**\n- DATABASE_URL for PostgreSQL connection\n- SESSION_SECRET for session encryption\n- NODE_ENV for environment detection\n\n**Notable Constraints:**\n- Monorepo structure with shared schema between client and server\n- Client root is in `/client` directory\n- Build output goes to `/dist` (server) and `/dist/public` (client)\n- Path aliases: `@/` maps to client/src, `@shared/` maps to shared directory","path":null,"size_bytes":5540,"size_tokens":null},"server/stripeService.ts":{"content":"import { getUncachableStripeClient } from './stripeClient';\nimport { db } from './db';\nimport { sql } from 'drizzle-orm';\n\nexport class StripeService {\n  async createCustomer(email: string, userId: string, name?: string) {\n    const stripe = await getUncachableStripeClient();\n    return await stripe.customers.create({\n      email,\n      name,\n      metadata: { userId },\n    });\n  }\n\n  async createCheckoutSession(\n    customerId: string, \n    priceId: string, \n    successUrl: string, \n    cancelUrl: string,\n    trialDays?: number\n  ) {\n    const stripe = await getUncachableStripeClient();\n    \n    const sessionParams: any = {\n      customer: customerId,\n      payment_method_types: ['card'],\n      line_items: [{ price: priceId, quantity: 1 }],\n      mode: 'subscription',\n      success_url: successUrl,\n      cancel_url: cancelUrl,\n    };\n    \n    if (trialDays && trialDays > 0) {\n      sessionParams.subscription_data = {\n        trial_period_days: trialDays,\n      };\n    }\n    \n    return await stripe.checkout.sessions.create(sessionParams);\n  }\n\n  async createCustomerPortalSession(customerId: string, returnUrl: string) {\n    const stripe = await getUncachableStripeClient();\n    return await stripe.billingPortal.sessions.create({\n      customer: customerId,\n      return_url: returnUrl,\n    });\n  }\n\n  async getProduct(productId: string) {\n    if (!db) return null;\n    const result = await db.execute(\n      sql`SELECT * FROM stripe.products WHERE id = ${productId}`\n    );\n    return result.rows[0] || null;\n  }\n\n  async listProducts(active = true, limit = 20, offset = 0) {\n    if (!db) return [];\n    const result = await db.execute(\n      sql`SELECT * FROM stripe.products WHERE active = ${active} LIMIT ${limit} OFFSET ${offset}`\n    );\n    return result.rows;\n  }\n\n  async listProductsWithPrices(active = true, limit = 20, offset = 0) {\n    if (!db) return [];\n    const safeLimit = Math.min(Math.max(1, limit), 100);\n    const safeOffset = Math.max(0, offset);\n    \n    const result = await db.execute(\n      sql`\n        WITH paginated_products AS (\n          SELECT id, name, description, metadata, active\n          FROM stripe.products\n          WHERE active = ${active}\n          ORDER BY id\n          LIMIT ${safeLimit} OFFSET ${safeOffset}\n        )\n        SELECT \n          p.id as product_id,\n          p.name as product_name,\n          p.description as product_description,\n          p.active as product_active,\n          p.metadata as product_metadata,\n          pr.id as price_id,\n          pr.unit_amount,\n          pr.currency,\n          pr.recurring,\n          pr.active as price_active,\n          pr.metadata as price_metadata\n        FROM paginated_products p\n        LEFT JOIN stripe.prices pr ON pr.product = p.id AND pr.active = true\n        ORDER BY p.id, pr.unit_amount\n      `\n    );\n    return result.rows;\n  }\n  \n  parseMetadata(metadata: any): Record<string, string> | null {\n    if (!metadata) return null;\n    if (typeof metadata === 'object') return metadata;\n    if (typeof metadata === 'string') {\n      try {\n        return JSON.parse(metadata);\n      } catch {\n        return null;\n      }\n    }\n    return null;\n  }\n\n  async getPrice(priceId: string) {\n    if (!db) return null;\n    const result = await db.execute(\n      sql`SELECT * FROM stripe.prices WHERE id = ${priceId}`\n    );\n    return result.rows[0] || null;\n  }\n\n  async listPrices(active = true, limit = 20, offset = 0) {\n    if (!db) return [];\n    const result = await db.execute(\n      sql`SELECT * FROM stripe.prices WHERE active = ${active} LIMIT ${limit} OFFSET ${offset}`\n    );\n    return result.rows;\n  }\n\n  async getPricesForProduct(productId: string) {\n    if (!db) return [];\n    const result = await db.execute(\n      sql`SELECT * FROM stripe.prices WHERE product = ${productId} AND active = true`\n    );\n    return result.rows;\n  }\n\n  async getSubscription(subscriptionId: string) {\n    if (!db) return null;\n    const result = await db.execute(\n      sql`SELECT * FROM stripe.subscriptions WHERE id = ${subscriptionId}`\n    );\n    return result.rows[0] || null;\n  }\n\n  async getCustomerSubscriptions(customerId: string) {\n    if (!db) return [];\n    const result = await db.execute(\n      sql`SELECT * FROM stripe.subscriptions WHERE customer = ${customerId} ORDER BY created DESC`\n    );\n    return result.rows;\n  }\n\n  async cancelSubscription(subscriptionId: string) {\n    const stripe = await getUncachableStripeClient();\n    return await stripe.subscriptions.cancel(subscriptionId);\n  }\n}\n\nexport const stripeService = new StripeService();\n","path":null,"size_bytes":4580,"size_tokens":null},"server/stripeClient.ts":{"content":"import Stripe from 'stripe';\n\nlet connectionSettings: any;\n\nasync function getCredentials() {\n  const hostname = process.env.REPLIT_CONNECTORS_HOSTNAME;\n  const xReplitToken = process.env.REPL_IDENTITY\n    ? 'repl ' + process.env.REPL_IDENTITY\n    : process.env.WEB_REPL_RENEWAL\n      ? 'depl ' + process.env.WEB_REPL_RENEWAL\n      : null;\n\n  if (!xReplitToken) {\n    throw new Error('X_REPLIT_TOKEN not found for repl/depl');\n  }\n\n  const connectorName = 'stripe';\n  const isProduction = process.env.REPLIT_DEPLOYMENT === '1';\n  const targetEnvironment = isProduction ? 'production' : 'development';\n\n  const url = new URL(`https://${hostname}/api/v2/connection`);\n  url.searchParams.set('include_secrets', 'true');\n  url.searchParams.set('connector_names', connectorName);\n  url.searchParams.set('environment', targetEnvironment);\n\n  const response = await fetch(url.toString(), {\n    headers: {\n      'Accept': 'application/json',\n      'X_REPLIT_TOKEN': xReplitToken\n    }\n  });\n\n  const data = await response.json();\n  \n  connectionSettings = data.items?.[0];\n\n  if (!connectionSettings || (!connectionSettings.settings.publishable || !connectionSettings.settings.secret)) {\n    throw new Error(`Stripe ${targetEnvironment} connection not found`);\n  }\n\n  return {\n    publishableKey: connectionSettings.settings.publishable,\n    secretKey: connectionSettings.settings.secret,\n  };\n}\n\nexport async function getUncachableStripeClient() {\n  const { secretKey } = await getCredentials();\n\n  return new Stripe(secretKey, {\n    apiVersion: '2025-11-17.clover',\n  });\n}\n\nexport async function getStripePublishableKey() {\n  const { publishableKey } = await getCredentials();\n  return publishableKey;\n}\n\nexport async function getStripeSecretKey() {\n  const { secretKey } = await getCredentials();\n  return secretKey;\n}\n\nlet stripeSync: any = null;\n\nexport async function getStripeSync() {\n  if (!stripeSync) {\n    const { StripeSync } = await import('stripe-replit-sync');\n    const secretKey = await getStripeSecretKey();\n    \n    const isProduction = process.env.NODE_ENV === 'production';\n    const databaseUrl = isProduction && process.env.PRODUCTION_DATABASE_URL \n      ? process.env.PRODUCTION_DATABASE_URL \n      : process.env.DATABASE_URL!;\n\n    stripeSync = new StripeSync({\n      poolConfig: {\n        connectionString: databaseUrl,\n        max: 2,\n      },\n      stripeSecretKey: secretKey,\n    });\n  }\n  return stripeSync;\n}\n","path":null,"size_bytes":2433,"size_tokens":null},"client/src/pages/auth.tsx":{"content":"import { useState } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Card, CardContent, CardDescription, CardFooter, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Briefcase } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\n\nexport default function AuthPage() {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const [loading, setLoading] = useState(false);\n\n  const handleLogin = async (e: React.FormEvent<HTMLFormElement>) => {\n    e.preventDefault();\n    setLoading(true);\n    \n    const formData = new FormData(e.currentTarget);\n    const username = formData.get(\"username\") as string;\n    const password = formData.get(\"password\") as string;\n\n    try {\n      const response = await fetch(\"/api/login\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ username, password }),\n      });\n\n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.error || \"Login failed\");\n      }\n\n      toast({\n        title: \"Success\",\n        description: \"Logged in successfully\",\n      });\n      \n      setLocation(\"/schedule\");\n    } catch (error: any) {\n      toast({\n        title: \"Error\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleRegister = async (e: React.FormEvent<HTMLFormElement>) => {\n    e.preventDefault();\n    setLoading(true);\n    \n    const formData = new FormData(e.currentTarget);\n    const username = formData.get(\"username\") as string;\n    const password = formData.get(\"password\") as string;\n    const email = formData.get(\"email\") as string;\n\n    try {\n      const response = await fetch(\"/api/register\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ username, password, email, role: \"user\" }),\n      });\n\n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.error || \"Registration failed\");\n      }\n\n      toast({\n        title: \"Success\",\n        description: \"Account created successfully\",\n      });\n      \n      setLocation(\"/schedule\");\n    } catch (error: any) {\n      toast({\n        title: \"Error\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 flex items-center justify-center p-4\">\n      <div className=\"w-full max-w-md\">\n        <div className=\"text-center mb-8\">\n          <div className=\"flex items-center justify-center gap-3 mb-3\">\n            <Briefcase className=\"w-10 h-10 text-blue-600\" />\n            <h1 className=\"text-3xl font-bold text-slate-900\">Crew Scheduler</h1>\n          </div>\n          <p className=\"text-slate-600\">Multi-depot crew scheduling system</p>\n        </div>\n\n        <Tabs defaultValue=\"login\" className=\"w-full\">\n          <TabsList className=\"grid w-full grid-cols-2\">\n            <TabsTrigger value=\"login\">Login</TabsTrigger>\n            <TabsTrigger value=\"register\">Register</TabsTrigger>\n          </TabsList>\n          \n          <TabsContent value=\"login\">\n            <Card>\n              <CardHeader>\n                <CardTitle>Login</CardTitle>\n                <CardDescription>Enter your credentials to access your schedule</CardDescription>\n              </CardHeader>\n              <form onSubmit={handleLogin}>\n                <CardContent className=\"space-y-4\">\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"login-username\">Username</Label>\n                    <Input \n                      id=\"login-username\" \n                      name=\"username\" \n                      type=\"text\" \n                      required \n                      data-testid=\"input-login-username\"\n                    />\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"login-password\">Password</Label>\n                    <Input \n                      id=\"login-password\" \n                      name=\"password\" \n                      type=\"password\" \n                      required \n                      data-testid=\"input-login-password\"\n                    />\n                  </div>\n                </CardContent>\n                <CardFooter>\n                  <Button \n                    type=\"submit\" \n                    className=\"w-full\" \n                    disabled={loading}\n                    data-testid=\"button-login\"\n                  >\n                    {loading ? \"Logging in...\" : \"Login\"}\n                  </Button>\n                </CardFooter>\n              </form>\n            </Card>\n          </TabsContent>\n          \n          <TabsContent value=\"register\">\n            <Card>\n              <CardHeader>\n                <CardTitle>Register</CardTitle>\n                <CardDescription>Create a new account to get started</CardDescription>\n              </CardHeader>\n              <form onSubmit={handleRegister}>\n                <CardContent className=\"space-y-4\">\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"register-username\">Username</Label>\n                    <Input \n                      id=\"register-username\" \n                      name=\"username\" \n                      type=\"text\" \n                      required \n                      data-testid=\"input-register-username\"\n                    />\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"register-email\">Email</Label>\n                    <Input \n                      id=\"register-email\" \n                      name=\"email\" \n                      type=\"email\" \n                      data-testid=\"input-register-email\"\n                    />\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"register-password\">Password</Label>\n                    <Input \n                      id=\"register-password\" \n                      name=\"password\" \n                      type=\"password\" \n                      required \n                      minLength={6}\n                      data-testid=\"input-register-password\"\n                    />\n                  </div>\n                </CardContent>\n                <CardFooter>\n                  <Button \n                    type=\"submit\" \n                    className=\"w-full\" \n                    disabled={loading}\n                    data-testid=\"button-register\"\n                  >\n                    {loading ? \"Creating account...\" : \"Register\"}\n                  </Button>\n                </CardFooter>\n              </form>\n            </Card>\n          </TabsContent>\n        </Tabs>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":7164,"size_tokens":null},"client/src/lib/api.ts":{"content":"// API Client for crew scheduling backend\n\nexport interface User {\n  id: string;\n  username: string;\n  email?: string;\n  role: string;\n}\n\nexport interface Depot {\n  id: string;\n  name: string;\n  address: string;\n  userId: string;\n}\n\nexport interface Crew {\n  id: string;\n  name: string;\n  depotId: string;\n  shift: string;\n  userId: string;\n  archivedAt?: string | null;\n}\n\nexport interface Employee {\n  id: string;\n  name: string;\n  status: string;\n  jobRole: string;\n  email?: string;\n  depotId: string;\n  userId: string;\n}\n\nexport interface Vehicle {\n  id: string;\n  name: string;\n  status: string;\n  vehicleType: string;\n  depotId: string;\n  userId: string;\n}\n\nexport interface ScheduleItem {\n  id: string;\n  type: string;\n  date: Date | string;\n  crewId: string;\n  depotId: string;\n  userId: string;\n  customer?: string;\n  jobNumber?: string;\n  address?: string;\n  projectManager?: string;\n  startTime?: string;\n  onsiteTime?: string;\n  color?: string;\n  duration?: number;\n  employeeId?: string;\n  vehicleId?: string;\n  noteContent?: string;\n}\n\nclass API {\n  private async request<T>(url: string, options?: RequestInit): Promise<T> {\n    const response = await fetch(url, {\n      ...options,\n      headers: {\n        \"Content-Type\": \"application/json\",\n        ...options?.headers,\n      },\n    });\n\n    if (!response.ok) {\n      const error = await response.json().catch(() => ({ error: \"Request failed\" }));\n      throw new Error(error.error || `HTTP ${response.status}`);\n    }\n\n    return response.json();\n  }\n\n  // Auth\n  async login(username: string, password: string): Promise<User> {\n    return this.request(\"/api/login\", {\n      method: \"POST\",\n      body: JSON.stringify({ username, password }),\n    });\n  }\n\n  async register(username: string, password: string, email?: string): Promise<User> {\n    return this.request(\"/api/register\", {\n      method: \"POST\",\n      body: JSON.stringify({ username, password, email, role: \"user\" }),\n    });\n  }\n\n  async logout(): Promise<void> {\n    await this.request(\"/api/logout\", { method: \"POST\" });\n  }\n\n  async getMe(): Promise<User> {\n    return this.request(\"/api/me\");\n  }\n\n  // Depots\n  async getDepots(): Promise<Depot[]> {\n    return this.request(\"/api/depots\");\n  }\n\n  async createDepot(depot: Omit<Depot, \"id\" | \"userId\">): Promise<Depot> {\n    return this.request(\"/api/depots\", {\n      method: \"POST\",\n      body: JSON.stringify(depot),\n    });\n  }\n\n  async updateDepot(id: string, depot: Partial<Depot>): Promise<Depot> {\n    return this.request(`/api/depots/${id}`, {\n      method: \"PATCH\",\n      body: JSON.stringify(depot),\n    });\n  }\n\n  async deleteDepot(id: string): Promise<void> {\n    await this.request(`/api/depots/${id}`, { method: \"DELETE\" });\n  }\n\n  // Crews\n  async getCrews(includeArchived: boolean = false): Promise<Crew[]> {\n    const url = includeArchived ? \"/api/crews?includeArchived=true\" : \"/api/crews\";\n    return this.request(url);\n  }\n\n  async createCrew(crew: Omit<Crew, \"id\" | \"userId\">): Promise<Crew> {\n    return this.request(\"/api/crews\", {\n      method: \"POST\",\n      body: JSON.stringify(crew),\n    });\n  }\n\n  async updateCrew(id: string, crew: Partial<Crew>): Promise<Crew> {\n    return this.request(`/api/crews/${id}`, {\n      method: \"PATCH\",\n      body: JSON.stringify(crew),\n    });\n  }\n\n  async archiveCrew(id: string): Promise<void> {\n    await this.request(`/api/crews/${id}`, { method: \"DELETE\" });\n  }\n\n  async restoreCrew(id: string): Promise<Crew> {\n    return this.request(`/api/crews/${id}/restore`, { method: \"POST\" });\n  }\n\n  // Employees\n  async getEmployees(): Promise<Employee[]> {\n    return this.request(\"/api/employees\");\n  }\n\n  async createEmployee(employee: Omit<Employee, \"id\" | \"userId\">): Promise<Employee> {\n    return this.request(\"/api/employees\", {\n      method: \"POST\",\n      body: JSON.stringify(employee),\n    });\n  }\n\n  async updateEmployee(id: string, employee: Partial<Employee>): Promise<Employee> {\n    return this.request(`/api/employees/${id}`, {\n      method: \"PATCH\",\n      body: JSON.stringify(employee),\n    });\n  }\n\n  async deleteEmployee(id: string): Promise<void> {\n    await this.request(`/api/employees/${id}`, { method: \"DELETE\" });\n  }\n\n  // Vehicles\n  async getVehicles(): Promise<Vehicle[]> {\n    return this.request(\"/api/vehicles\");\n  }\n\n  async createVehicle(vehicle: Omit<Vehicle, \"id\" | \"userId\">): Promise<Vehicle> {\n    return this.request(\"/api/vehicles\", {\n      method: \"POST\",\n      body: JSON.stringify(vehicle),\n    });\n  }\n\n  async updateVehicle(id: string, vehicle: Partial<Vehicle>): Promise<Vehicle> {\n    return this.request(`/api/vehicles/${id}`, {\n      method: \"PATCH\",\n      body: JSON.stringify(vehicle),\n    });\n  }\n\n  async deleteVehicle(id: string): Promise<void> {\n    await this.request(`/api/vehicles/${id}`, { method: \"DELETE\" });\n  }\n\n  // Schedule Items\n  async getScheduleItems(): Promise<ScheduleItem[]> {\n    return this.request(\"/api/schedule-items\");\n  }\n\n  async createScheduleItem(item: Omit<ScheduleItem, \"id\" | \"userId\">): Promise<ScheduleItem> {\n    return this.request(\"/api/schedule-items\", {\n      method: \"POST\",\n      body: JSON.stringify(item),\n    });\n  }\n\n  async updateScheduleItem(id: string, item: Partial<ScheduleItem>): Promise<ScheduleItem> {\n    return this.request(`/api/schedule-items/${id}`, {\n      method: \"PATCH\",\n      body: JSON.stringify(item),\n    });\n  }\n\n  async deleteScheduleItem(id: string): Promise<void> {\n    await this.request(`/api/schedule-items/${id}`, { method: \"DELETE\" });\n  }\n\n  // Color Labels\n  async getColorLabels(): Promise<Record<string, string>> {\n    return this.request(\"/api/color-labels\");\n  }\n\n  async saveColorLabel(color: string, label: string): Promise<void> {\n    await this.request(\"/api/color-labels\", {\n      method: \"POST\",\n      body: JSON.stringify({ color, label }),\n    });\n  }\n}\n\nexport const api = new API();\n","path":null,"size_bytes":5873,"size_tokens":null},"client/src/components/schedule/TeamManagement.tsx":{"content":"import { useState } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle, DialogTrigger, DialogFooter } from \"@/components/ui/dialog\";\nimport { AlertDialog, AlertDialogAction, AlertDialogCancel, AlertDialogContent, AlertDialogDescription, AlertDialogFooter, AlertDialogHeader, AlertDialogTitle, AlertDialogTrigger } from \"@/components/ui/alert-dialog\";\nimport { UserPlus, Trash2, Shield, ShieldCheck, User, Mail, Loader2, X, Copy, Check, RefreshCw } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport {\n  useMembers,\n  useInvites,\n  useCreateInvite,\n  useDeleteInvite,\n  useResendInvite,\n  useUpdateMemberRole,\n  useRemoveMember,\n  type MemberRole,\n  type Member,\n  type TeamInvite,\n  getRoleDisplayName,\n} from \"@/hooks/useOrganization\";\n\ninterface TeamManagementProps {\n  currentUserRole: MemberRole;\n  currentUserId: string;\n}\n\nexport function TeamManagement({ currentUserRole, currentUserId }: TeamManagementProps) {\n  const { toast } = useToast();\n  const [inviteDialogOpen, setInviteDialogOpen] = useState(false);\n  const [inviteEmail, setInviteEmail] = useState(\"\");\n  const [inviteRole, setInviteRole] = useState<MemberRole>(\"user\");\n  const [copiedToken, setCopiedToken] = useState<string | null>(null);\n\n  const { data: members = [], isLoading: membersLoading } = useMembers();\n  const { data: invites = [], isLoading: invitesLoading } = useInvites();\n  const createInviteMutation = useCreateInvite();\n  const deleteInviteMutation = useDeleteInvite();\n  const resendInviteMutation = useResendInvite();\n  const updateRoleMutation = useUpdateMemberRole();\n  const removeMemberMutation = useRemoveMember();\n\n  const isAdmin = currentUserRole === \"admin\";\n\n  const handleCreateInvite = async () => {\n    if (!inviteEmail.trim()) {\n      toast({ title: \"Error\", description: \"Please enter an email address\", variant: \"destructive\" });\n      return;\n    }\n\n    try {\n      await createInviteMutation.mutateAsync({ email: inviteEmail.trim(), role: inviteRole });\n      toast({ title: \"Invite sent\", description: `Invitation sent to ${inviteEmail}` });\n      setInviteDialogOpen(false);\n      setInviteEmail(\"\");\n      setInviteRole(\"user\");\n    } catch (error: any) {\n      toast({ title: \"Error\", description: error.message || \"Failed to create invite\", variant: \"destructive\" });\n    }\n  };\n\n  const handleDeleteInvite = async (invite: TeamInvite) => {\n    try {\n      await deleteInviteMutation.mutateAsync(invite.id);\n      toast({ title: \"Invite cancelled\", description: `Invitation to ${invite.email} has been cancelled` });\n    } catch (error: any) {\n      toast({ title: \"Error\", description: error.message || \"Failed to cancel invite\", variant: \"destructive\" });\n    }\n  };\n\n  const handleResendInvite = async (invite: TeamInvite) => {\n    try {\n      const updatedInvite = await resendInviteMutation.mutateAsync(invite.id);\n      copyInviteLink(updatedInvite.token);\n      toast({ title: \"Invite resent\", description: `New invite link generated for ${invite.email} and copied to clipboard` });\n    } catch (error: any) {\n      toast({ title: \"Error\", description: error.message || \"Failed to resend invite\", variant: \"destructive\" });\n    }\n  };\n\n  const handleUpdateRole = async (member: Member, newRole: MemberRole) => {\n    try {\n      await updateRoleMutation.mutateAsync({ id: member.id, role: newRole });\n      toast({ title: \"Role updated\", description: `${member.username}'s role has been changed to ${getRoleDisplayName(newRole)}` });\n    } catch (error: any) {\n      toast({ title: \"Error\", description: error.message || \"Failed to update role\", variant: \"destructive\" });\n    }\n  };\n\n  const handleRemoveMember = async (member: Member) => {\n    try {\n      await removeMemberMutation.mutateAsync(member.id);\n      toast({ title: \"Member removed\", description: `${member.username} has been removed from the team` });\n    } catch (error: any) {\n      toast({ title: \"Error\", description: error.message || \"Failed to remove member\", variant: \"destructive\" });\n    }\n  };\n\n  const copyInviteLink = (token: string) => {\n    const inviteUrl = `${window.location.origin}/invite/${token}`;\n    navigator.clipboard.writeText(inviteUrl);\n    setCopiedToken(token);\n    setTimeout(() => setCopiedToken(null), 2000);\n    toast({ title: \"Link copied\", description: \"Invite link copied to clipboard\" });\n  };\n\n  const getRoleBadgeColor = (role: MemberRole) => {\n    switch (role) {\n      case \"admin\":\n        return \"bg-red-100 text-red-700 border-red-200\";\n      case \"operations\":\n        return \"bg-blue-100 text-blue-700 border-blue-200\";\n      case \"user\":\n        return \"bg-green-100 text-green-700 border-green-200\";\n      default:\n        return \"bg-gray-100 text-gray-700 border-gray-200\";\n    }\n  };\n\n  const getRoleIcon = (role: MemberRole) => {\n    switch (role) {\n      case \"admin\":\n        return <Shield className=\"h-3 w-3\" />;\n      case \"operations\":\n        return <ShieldCheck className=\"h-3 w-3\" />;\n      default:\n        return <User className=\"h-3 w-3\" />;\n    }\n  };\n\n  if (membersLoading || invitesLoading) {\n    return (\n      <div className=\"flex items-center justify-center p-8\" data-testid=\"team-loading\">\n        <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\" data-testid=\"team-management\">\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h2 className=\"text-2xl font-bold\" data-testid=\"text-team-title\">Team Members</h2>\n          <p className=\"text-muted-foreground\">Manage who has access to your organization</p>\n        </div>\n        {isAdmin && (\n          <Dialog open={inviteDialogOpen} onOpenChange={setInviteDialogOpen}>\n            <DialogTrigger asChild>\n              <Button data-testid=\"button-invite-member\">\n                <UserPlus className=\"h-4 w-4 mr-2\" />\n                Invite Member\n              </Button>\n            </DialogTrigger>\n            <DialogContent>\n              <DialogHeader>\n                <DialogTitle>Invite Team Member</DialogTitle>\n                <DialogDescription>\n                  Send an invitation to join your organization. They'll receive a link to sign up.\n                </DialogDescription>\n              </DialogHeader>\n              <div className=\"space-y-4 py-4\">\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"invite-email\">Email address</Label>\n                  <Input\n                    id=\"invite-email\"\n                    type=\"email\"\n                    placeholder=\"colleague@example.com\"\n                    value={inviteEmail}\n                    onChange={(e) => setInviteEmail(e.target.value)}\n                    data-testid=\"input-invite-email\"\n                  />\n                </div>\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"invite-role\">Role</Label>\n                  <Select value={inviteRole} onValueChange={(v) => setInviteRole(v as MemberRole)}>\n                    <SelectTrigger id=\"invite-role\" data-testid=\"select-invite-role\">\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"admin\">Admin - Full access to all features</SelectItem>\n                      <SelectItem value=\"operations\">Operations Manager - Manage schedules and approve bookings</SelectItem>\n                      <SelectItem value=\"user\">Booker - Create booking requests</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n              </div>\n              <DialogFooter>\n                <Button variant=\"outline\" onClick={() => setInviteDialogOpen(false)}>Cancel</Button>\n                <Button\n                  onClick={handleCreateInvite}\n                  disabled={createInviteMutation.isPending}\n                  data-testid=\"button-send-invite\"\n                >\n                  {createInviteMutation.isPending && <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />}\n                  Send Invite\n                </Button>\n              </DialogFooter>\n            </DialogContent>\n          </Dialog>\n        )}\n      </div>\n\n      <Card>\n        <CardHeader>\n          <CardTitle>Members ({members.length})</CardTitle>\n          <CardDescription>People with access to this organization</CardDescription>\n        </CardHeader>\n        <CardContent>\n          <div className=\"space-y-4\">\n            {members.map((member) => (\n              <div\n                key={member.id}\n                className=\"flex items-center justify-between p-3 rounded-lg border bg-card\"\n                data-testid={`member-row-${member.userId}`}\n              >\n                <div className=\"flex items-center gap-3\">\n                  <div className=\"h-10 w-10 rounded-full bg-muted flex items-center justify-center\">\n                    <User className=\"h-5 w-5 text-muted-foreground\" />\n                  </div>\n                  <div>\n                    <div className=\"font-medium flex items-center gap-2\">\n                      {member.username}\n                      {member.userId === currentUserId && (\n                        <Badge variant=\"outline\" className=\"text-xs\">You</Badge>\n                      )}\n                    </div>\n                    {member.email && (\n                      <div className=\"text-sm text-muted-foreground flex items-center gap-1\">\n                        <Mail className=\"h-3 w-3\" />\n                        {member.email}\n                      </div>\n                    )}\n                  </div>\n                </div>\n                <div className=\"flex items-center gap-3\">\n                  {isAdmin && member.userId !== currentUserId ? (\n                    <>\n                      <Select\n                        value={member.role}\n                        onValueChange={(v) => handleUpdateRole(member, v as MemberRole)}\n                        disabled={updateRoleMutation.isPending}\n                      >\n                        <SelectTrigger className=\"w-[180px]\" data-testid={`select-role-${member.userId}`}>\n                          <SelectValue />\n                        </SelectTrigger>\n                        <SelectContent>\n                          <SelectItem value=\"admin\">Admin</SelectItem>\n                          <SelectItem value=\"operations\">Operations Manager</SelectItem>\n                          <SelectItem value=\"user\">Booker</SelectItem>\n                        </SelectContent>\n                      </Select>\n                      <AlertDialog>\n                        <AlertDialogTrigger asChild>\n                          <Button variant=\"ghost\" size=\"icon\" className=\"text-destructive hover:text-destructive\">\n                            <Trash2 className=\"h-4 w-4\" />\n                          </Button>\n                        </AlertDialogTrigger>\n                        <AlertDialogContent>\n                          <AlertDialogHeader>\n                            <AlertDialogTitle>Remove team member?</AlertDialogTitle>\n                            <AlertDialogDescription>\n                              Are you sure you want to remove {member.username} from the organization?\n                              They will lose access to all schedules and data.\n                            </AlertDialogDescription>\n                          </AlertDialogHeader>\n                          <AlertDialogFooter>\n                            <AlertDialogCancel>Cancel</AlertDialogCancel>\n                            <AlertDialogAction\n                              onClick={() => handleRemoveMember(member)}\n                              className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\n                            >\n                              Remove\n                            </AlertDialogAction>\n                          </AlertDialogFooter>\n                        </AlertDialogContent>\n                      </AlertDialog>\n                    </>\n                  ) : (\n                    <Badge className={`${getRoleBadgeColor(member.role)} flex items-center gap-1`}>\n                      {getRoleIcon(member.role)}\n                      {getRoleDisplayName(member.role)}\n                    </Badge>\n                  )}\n                </div>\n              </div>\n            ))}\n          </div>\n        </CardContent>\n      </Card>\n\n      {isAdmin && invites.length > 0 && (\n        <Card>\n          <CardHeader>\n            <CardTitle>Pending Invites ({invites.length})</CardTitle>\n            <CardDescription>Invitations that haven't been accepted yet</CardDescription>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-4\">\n              {invites.map((invite) => (\n                <div\n                  key={invite.id}\n                  className=\"flex items-center justify-between p-3 rounded-lg border bg-muted/30\"\n                  data-testid={`invite-row-${invite.id}`}\n                >\n                  <div className=\"flex items-center gap-3\">\n                    <div className=\"h-10 w-10 rounded-full bg-muted flex items-center justify-center\">\n                      <Mail className=\"h-5 w-5 text-muted-foreground\" />\n                    </div>\n                    <div>\n                      <div className=\"font-medium\">{invite.email}</div>\n                      <div className=\"text-sm text-muted-foreground\">\n                        Invited as {getRoleDisplayName(invite.role)}\n                      </div>\n                    </div>\n                  </div>\n                  <div className=\"flex items-center gap-2\">\n                    <Button\n                      variant=\"outline\"\n                      size=\"sm\"\n                      onClick={() => copyInviteLink(invite.token)}\n                      data-testid={`button-copy-invite-${invite.id}`}\n                    >\n                      {copiedToken === invite.token ? (\n                        <Check className=\"h-4 w-4 mr-1\" />\n                      ) : (\n                        <Copy className=\"h-4 w-4 mr-1\" />\n                      )}\n                      Copy Link\n                    </Button>\n                    <Button\n                      variant=\"outline\"\n                      size=\"sm\"\n                      onClick={() => handleResendInvite(invite)}\n                      disabled={resendInviteMutation.isPending}\n                      data-testid={`button-resend-invite-${invite.id}`}\n                    >\n                      {resendInviteMutation.isPending ? (\n                        <Loader2 className=\"h-4 w-4 mr-1 animate-spin\" />\n                      ) : (\n                        <RefreshCw className=\"h-4 w-4 mr-1\" />\n                      )}\n                      Resend\n                    </Button>\n                    <Button\n                      variant=\"ghost\"\n                      size=\"icon\"\n                      onClick={() => handleDeleteInvite(invite)}\n                      disabled={deleteInviteMutation.isPending}\n                      className=\"text-destructive hover:text-destructive\"\n                    >\n                      <X className=\"h-4 w-4\" />\n                    </Button>\n                  </div>\n                </div>\n              ))}\n            </div>\n          </CardContent>\n        </Card>\n      )}\n    </div>\n  );\n}\n","path":null,"size_bytes":15842,"size_tokens":null},"client/src/components/schedule/QuotaUsage.tsx":{"content":"import { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Building2, Users, Truck, Loader2, ArrowUpCircle, Crown } from \"lucide-react\";\nimport { useQuota, getPlanDisplayName } from \"@/hooks/useOrganization\";\n\ninterface QuotaUsageProps {\n  onUpgrade?: () => void;\n}\n\nexport function QuotaUsage({ onUpgrade }: QuotaUsageProps) {\n  const { data: quota, isLoading } = useQuota();\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center p-8\" data-testid=\"quota-loading\">\n        <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />\n      </div>\n    );\n  }\n\n  if (!quota) {\n    return null;\n  }\n\n  const getUsageColor = (used: number, limit: number) => {\n    const percentage = (used / limit) * 100;\n    if (percentage >= 90) return \"text-red-600\";\n    if (percentage >= 70) return \"text-amber-600\";\n    return \"text-green-600\";\n  };\n\n  const getProgressColor = (used: number, limit: number) => {\n    const percentage = (used / limit) * 100;\n    if (percentage >= 90) return \"bg-red-500\";\n    if (percentage >= 70) return \"bg-amber-500\";\n    return \"bg-green-500\";\n  };\n\n  const usageItems = [\n    {\n      label: \"Depots\",\n      icon: Building2,\n      used: quota.usage.depots.used,\n      limit: quota.usage.depots.limit,\n    },\n    {\n      label: \"Crews\",\n      icon: Users,\n      used: quota.usage.crews.used,\n      limit: quota.usage.crews.limit,\n    },\n    {\n      label: \"Employees\",\n      icon: Users,\n      used: quota.usage.employees.used,\n      limit: quota.usage.employees.limit,\n    },\n    {\n      label: \"Vehicles\",\n      icon: Truck,\n      used: quota.usage.vehicles.used,\n      limit: quota.usage.vehicles.limit,\n    },\n  ];\n\n  return (\n    <Card data-testid=\"quota-usage-card\">\n      <CardHeader className=\"pb-3\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Crown className=\"h-5 w-5 text-amber-500\" />\n              {getPlanDisplayName(quota.plan)} Plan\n            </CardTitle>\n            <CardDescription>\n              {quota.requiresApproval ? \"Bookings require approval\" : \"Bookings auto-approved\"}\n            </CardDescription>\n          </div>\n          {quota.plan === \"starter\" && onUpgrade && (\n            <Button size=\"sm\" onClick={onUpgrade} data-testid=\"button-upgrade\">\n              <ArrowUpCircle className=\"h-4 w-4 mr-2\" />\n              Upgrade\n            </Button>\n          )}\n        </div>\n      </CardHeader>\n      <CardContent className=\"space-y-4\">\n        {usageItems.map((item) => {\n          const Icon = item.icon;\n          const percentage = Math.round((item.used / item.limit) * 100);\n          const isAtLimit = item.used >= item.limit;\n\n          return (\n            <div key={item.label} className=\"space-y-1\" data-testid={`quota-${item.label.toLowerCase()}`}>\n              <div className=\"flex items-center justify-between text-sm\">\n                <div className=\"flex items-center gap-2\">\n                  <Icon className=\"h-4 w-4 text-muted-foreground\" />\n                  <span>{item.label}</span>\n                </div>\n                <div className={`flex items-center gap-2 ${getUsageColor(item.used, item.limit)}`}>\n                  <span className=\"font-medium\">\n                    {item.used} / {item.limit}\n                  </span>\n                  {isAtLimit && (\n                    <Badge variant=\"destructive\" className=\"text-xs\">\n                      Limit reached\n                    </Badge>\n                  )}\n                </div>\n              </div>\n              <div className=\"h-2 w-full bg-secondary rounded-full overflow-hidden\">\n                <div\n                  className={`h-full transition-all ${getProgressColor(item.used, item.limit)}`}\n                  style={{ width: `${Math.min(percentage, 100)}%` }}\n                />\n              </div>\n            </div>\n          );\n        })}\n      </CardContent>\n    </Card>\n  );\n}\n","path":null,"size_bytes":4128,"size_tokens":null},"server/quotaService.ts":{"content":"import { storage } from \"./storage\";\n\nexport type PlanType = \"starter\" | \"pro\";\n\nexport interface PlanLimits {\n  maxDepots: number;\n  maxCrews: number;\n  maxEmployees: number;\n  maxVehicles: number;\n  requiresApproval: boolean;\n}\n\nexport const PLAN_LIMITS: Record<PlanType, PlanLimits> = {\n  starter: {\n    maxDepots: 1,\n    maxCrews: 3,\n    maxEmployees: 25,\n    maxVehicles: 10,\n    requiresApproval: false,\n  },\n  pro: {\n    maxDepots: 999,\n    maxCrews: 30,\n    maxEmployees: 250,\n    maxVehicles: 100,\n    requiresApproval: true,\n  },\n};\n\nexport interface QuotaUsage {\n  depots: { used: number; limit: number; remaining: number };\n  crews: { used: number; limit: number; remaining: number };\n  employees: { used: number; limit: number; remaining: number };\n  vehicles: { used: number; limit: number; remaining: number };\n}\n\nexport interface QuotaCheckResult {\n  allowed: boolean;\n  reason?: string;\n  currentUsage?: number;\n  limit?: number;\n}\n\nexport async function getOrganizationQuotaUsage(organizationId: string, plan: PlanType): Promise<QuotaUsage> {\n  const limits = PLAN_LIMITS[plan];\n  \n  const [depots, crews, employees, vehicles] = await Promise.all([\n    storage.getDepotsByOrg(organizationId),\n    storage.getCrewsByOrg(organizationId),\n    storage.getEmployeesByOrg(organizationId),\n    storage.getVehiclesByOrg(organizationId),\n  ]);\n  \n  return {\n    depots: {\n      used: depots.length,\n      limit: limits.maxDepots,\n      remaining: Math.max(0, limits.maxDepots - depots.length),\n    },\n    crews: {\n      used: crews.length,\n      limit: limits.maxCrews,\n      remaining: Math.max(0, limits.maxCrews - crews.length),\n    },\n    employees: {\n      used: employees.length,\n      limit: limits.maxEmployees,\n      remaining: Math.max(0, limits.maxEmployees - employees.length),\n    },\n    vehicles: {\n      used: vehicles.length,\n      limit: limits.maxVehicles,\n      remaining: Math.max(0, limits.maxVehicles - vehicles.length),\n    },\n  };\n}\n\nexport async function canCreateDepot(organizationId: string, plan: PlanType): Promise<QuotaCheckResult> {\n  const limits = PLAN_LIMITS[plan];\n  const depots = await storage.getDepotsByOrg(organizationId);\n  \n  if (depots.length >= limits.maxDepots) {\n    return {\n      allowed: false,\n      reason: `You have reached the maximum number of depots (${limits.maxDepots}) for your ${plan === \"starter\" ? \"Starter\" : \"Pro\"} plan.${plan === \"starter\" ? \" Upgrade to Pro for more depots.\" : \"\"}`,\n      currentUsage: depots.length,\n      limit: limits.maxDepots,\n    };\n  }\n  \n  return { allowed: true };\n}\n\nexport async function canCreateCrew(organizationId: string, plan: PlanType): Promise<QuotaCheckResult> {\n  const limits = PLAN_LIMITS[plan];\n  const crews = await storage.getCrewsByOrg(organizationId);\n  \n  if (crews.length >= limits.maxCrews) {\n    return {\n      allowed: false,\n      reason: `You have reached the maximum number of crews (${limits.maxCrews}) for your ${plan === \"starter\" ? \"Starter\" : \"Pro\"} plan.${plan === \"starter\" ? \" Upgrade to Pro for more crews.\" : \"\"}`,\n      currentUsage: crews.length,\n      limit: limits.maxCrews,\n    };\n  }\n  \n  return { allowed: true };\n}\n\nexport async function canCreateEmployee(organizationId: string, plan: PlanType): Promise<QuotaCheckResult> {\n  const limits = PLAN_LIMITS[plan];\n  const employees = await storage.getEmployeesByOrg(organizationId);\n  \n  if (employees.length >= limits.maxEmployees) {\n    return {\n      allowed: false,\n      reason: `You have reached the maximum number of employees (${limits.maxEmployees}) for your ${plan === \"starter\" ? \"Starter\" : \"Pro\"} plan.${plan === \"starter\" ? \" Upgrade to Pro for more employees.\" : \"\"}`,\n      currentUsage: employees.length,\n      limit: limits.maxEmployees,\n    };\n  }\n  \n  return { allowed: true };\n}\n\nexport async function canCreateVehicle(organizationId: string, plan: PlanType): Promise<QuotaCheckResult> {\n  const limits = PLAN_LIMITS[plan];\n  const vehicles = await storage.getVehiclesByOrg(organizationId);\n  \n  if (vehicles.length >= limits.maxVehicles) {\n    return {\n      allowed: false,\n      reason: `You have reached the maximum number of vehicles (${limits.maxVehicles}) for your ${plan === \"starter\" ? \"Starter\" : \"Pro\"} plan.${plan === \"starter\" ? \" Upgrade to Pro for more vehicles.\" : \"\"}`,\n      currentUsage: vehicles.length,\n      limit: limits.maxVehicles,\n    };\n  }\n  \n  return { allowed: true };\n}\n\nexport function planRequiresApproval(plan: PlanType): boolean {\n  return PLAN_LIMITS[plan].requiresApproval;\n}\n","path":null,"size_bytes":4526,"size_tokens":null},"client/src/components/schedule/PendingApprovals.tsx":{"content":"import { useState } from \"react\";\nimport { format } from \"date-fns\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Check, X, Loader2, Calendar, MapPin, User, Clock, AlertCircle } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport {\n  usePendingScheduleItems,\n  useApproveScheduleItem,\n  useRejectScheduleItem,\n  type PendingScheduleItem,\n} from \"@/hooks/useOrganization\";\n\nexport function PendingApprovals() {\n  const { toast } = useToast();\n  const [rejectingItem, setRejectingItem] = useState<PendingScheduleItem | null>(null);\n  const [rejectionReason, setRejectionReason] = useState(\"\");\n\n  const { data: pendingItems = [], isLoading } = usePendingScheduleItems();\n  const approveMutation = useApproveScheduleItem();\n  const rejectMutation = useRejectScheduleItem();\n\n  const handleApprove = async (item: PendingScheduleItem) => {\n    try {\n      await approveMutation.mutateAsync(item.id);\n      toast({\n        title: \"Booking approved\",\n        description: `The booking for ${item.customer || \"Unknown customer\"} has been approved.`,\n      });\n    } catch (error: any) {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to approve booking\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const handleReject = async () => {\n    if (!rejectingItem || !rejectionReason.trim()) {\n      toast({\n        title: \"Error\",\n        description: \"Please provide a reason for rejection\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    try {\n      await rejectMutation.mutateAsync({\n        id: rejectingItem.id,\n        reason: rejectionReason.trim(),\n      });\n      toast({\n        title: \"Booking rejected\",\n        description: `The booking has been rejected.`,\n      });\n      setRejectingItem(null);\n      setRejectionReason(\"\");\n    } catch (error: any) {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to reject booking\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center p-8\" data-testid=\"pending-loading\">\n        <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />\n      </div>\n    );\n  }\n\n  if (pendingItems.length === 0) {\n    return (\n      <Card data-testid=\"no-pending-approvals\">\n        <CardContent className=\"flex flex-col items-center justify-center py-12\">\n          <div className=\"h-16 w-16 rounded-full bg-green-100 flex items-center justify-center mb-4\">\n            <Check className=\"h-8 w-8 text-green-600\" />\n          </div>\n          <h3 className=\"text-lg font-semibold mb-2\">All caught up!</h3>\n          <p className=\"text-muted-foreground text-center\">\n            There are no pending bookings waiting for approval.\n          </p>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\" data-testid=\"pending-approvals\">\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h2 className=\"text-2xl font-bold flex items-center gap-2\">\n            <AlertCircle className=\"h-6 w-6 text-amber-500\" />\n            Pending Approvals\n          </h2>\n          <p className=\"text-muted-foreground\">\n            {pendingItems.length} booking{pendingItems.length !== 1 ? \"s\" : \"\"} awaiting your review\n          </p>\n        </div>\n      </div>\n\n      <div className=\"space-y-4\">\n        {pendingItems.map((item) => (\n          <Card key={item.id} data-testid={`pending-item-${item.id}`}>\n            <CardContent className=\"p-4\">\n              <div className=\"flex items-start justify-between\">\n                <div className=\"space-y-3 flex-1\">\n                  <div className=\"flex items-center gap-2\">\n                    <Badge variant=\"outline\" className=\"bg-amber-50 text-amber-700 border-amber-200\">\n                      {item.type}\n                    </Badge>\n                    {item.requestedByUser && (\n                      <span className=\"text-sm text-muted-foreground flex items-center gap-1\">\n                        <User className=\"h-3 w-3\" />\n                        Requested by {item.requestedByUser.username}\n                      </span>\n                    )}\n                  </div>\n\n                  <div className=\"grid gap-2 sm:grid-cols-2\">\n                    <div className=\"flex items-center gap-2 text-sm\">\n                      <Calendar className=\"h-4 w-4 text-muted-foreground\" />\n                      <span>{format(new Date(item.date), \"EEEE, d MMMM yyyy\")}</span>\n                    </div>\n                    {item.location && (\n                      <div className=\"flex items-center gap-2 text-sm\">\n                        <MapPin className=\"h-4 w-4 text-muted-foreground\" />\n                        <span>{item.location}</span>\n                      </div>\n                    )}\n                  </div>\n\n                  {item.customer && (\n                    <div className=\"text-sm\">\n                      <span className=\"font-medium\">Customer:</span> {item.customer}\n                    </div>\n                  )}\n\n                  {item.notes && (\n                    <div className=\"text-sm text-muted-foreground\">\n                      <span className=\"font-medium\">Notes:</span> {item.notes}\n                    </div>\n                  )}\n                </div>\n\n                <div className=\"flex gap-2 ml-4\">\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    className=\"border-red-200 text-red-600 hover:bg-red-50 hover:text-red-700\"\n                    onClick={() => {\n                      setRejectingItem(item);\n                      setRejectionReason(\"\");\n                    }}\n                    disabled={rejectMutation.isPending}\n                    data-testid={`button-reject-${item.id}`}\n                  >\n                    <X className=\"h-4 w-4 mr-1\" />\n                    Reject\n                  </Button>\n                  <Button\n                    size=\"sm\"\n                    className=\"bg-green-600 hover:bg-green-700\"\n                    onClick={() => handleApprove(item)}\n                    disabled={approveMutation.isPending}\n                    data-testid={`button-approve-${item.id}`}\n                  >\n                    {approveMutation.isPending ? (\n                      <Loader2 className=\"h-4 w-4 mr-1 animate-spin\" />\n                    ) : (\n                      <Check className=\"h-4 w-4 mr-1\" />\n                    )}\n                    Approve\n                  </Button>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        ))}\n      </div>\n\n      <Dialog open={!!rejectingItem} onOpenChange={() => setRejectingItem(null)}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Reject Booking</DialogTitle>\n            <DialogDescription>\n              Please provide a reason for rejecting this booking. This will be visible to the person who requested it.\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"space-y-4 py-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"rejection-reason\">Reason for rejection</Label>\n              <Input\n                id=\"rejection-reason\"\n                placeholder=\"e.g., Crew not available on this date\"\n                value={rejectionReason}\n                onChange={(e) => setRejectionReason(e.target.value)}\n                data-testid=\"input-rejection-reason\"\n              />\n            </div>\n          </div>\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setRejectingItem(null)}>\n              Cancel\n            </Button>\n            <Button\n              variant=\"destructive\"\n              onClick={handleReject}\n              disabled={rejectMutation.isPending || !rejectionReason.trim()}\n              data-testid=\"button-confirm-reject\"\n            >\n              {rejectMutation.isPending && <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />}\n              Reject Booking\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":8575,"size_tokens":null},"client/src/hooks/useOrganization.ts":{"content":"import { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\n\nexport type MemberRole = \"admin\" | \"operations\" | \"user\";\nexport type PlanType = \"starter\" | \"pro\";\n\nexport interface Organization {\n  id: string;\n  name: string;\n  plan: PlanType;\n  subscriptionStatus: string;\n}\n\nexport interface QuotaUsage {\n  depots: { used: number; limit: number; remaining: number };\n  crews: { used: number; limit: number; remaining: number };\n  employees: { used: number; limit: number; remaining: number };\n  vehicles: { used: number; limit: number; remaining: number };\n}\n\nexport interface QuotaInfo {\n  plan: PlanType;\n  limits: {\n    maxDepots: number;\n    maxCrews: number;\n    maxEmployees: number;\n    maxVehicles: number;\n    requiresApproval: boolean;\n  };\n  usage: QuotaUsage;\n  requiresApproval: boolean;\n}\n\nexport interface Member {\n  id: string;\n  userId: string;\n  username: string;\n  email: string;\n  role: MemberRole;\n  acceptedAt: Date | null;\n}\n\nexport interface TeamInvite {\n  id: string;\n  organizationId: string;\n  email: string;\n  role: MemberRole;\n  invitedBy: string;\n  token: string;\n  expiresAt: Date;\n  createdAt: Date;\n}\n\nexport interface PendingScheduleItem {\n  id: string;\n  type: string;\n  date: Date;\n  crewId: string;\n  depotId: string;\n  status: string;\n  requestedBy: string;\n  requestedByUser: { id: string; username: string } | null;\n  customer: string | null;\n  location: string | null;\n  notes: string | null;\n}\n\nexport function useOrganization() {\n  return useQuery<{ id: string; name: string; plan: PlanType; subscriptionStatus: string; membershipRole: MemberRole }>({\n    queryKey: [\"/api/organization\"],\n  });\n}\n\nexport function useQuota() {\n  return useQuery<QuotaInfo>({\n    queryKey: [\"/api/organization/quota\"],\n  });\n}\n\nexport function useMembers() {\n  return useQuery<Member[]>({\n    queryKey: [\"/api/organization/members\"],\n  });\n}\n\nexport function useInvites() {\n  return useQuery<TeamInvite[]>({\n    queryKey: [\"/api/organization/invites\"],\n  });\n}\n\nexport function usePendingScheduleItems() {\n  return useQuery<PendingScheduleItem[]>({\n    queryKey: [\"/api/schedule-items/pending\"],\n  });\n}\n\nexport function useCreateInvite() {\n  const queryClient = useQueryClient();\n  return useMutation({\n    mutationFn: async (data: { email: string; role: MemberRole }) => {\n      const res = await fetch(\"/api/organization/invites\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify(data),\n      });\n      if (!res.ok) {\n        const error = await res.json();\n        throw new Error(error.error || \"Failed to create invite\");\n      }\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/organization/invites\"] });\n    },\n  });\n}\n\nexport function useDeleteInvite() {\n  const queryClient = useQueryClient();\n  return useMutation({\n    mutationFn: async (id: string) => {\n      const res = await fetch(`/api/organization/invites/${id}`, {\n        method: \"DELETE\",\n      });\n      if (!res.ok) {\n        const error = await res.json();\n        throw new Error(error.error || \"Failed to delete invite\");\n      }\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/organization/invites\"] });\n    },\n  });\n}\n\nexport function useResendInvite() {\n  const queryClient = useQueryClient();\n  return useMutation({\n    mutationFn: async (id: string) => {\n      const res = await fetch(`/api/organization/invites/${id}/resend`, {\n        method: \"POST\",\n      });\n      if (!res.ok) {\n        const error = await res.json();\n        throw new Error(error.error || \"Failed to resend invite\");\n      }\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/organization/invites\"] });\n    },\n  });\n}\n\nexport function useUpdateMemberRole() {\n  const queryClient = useQueryClient();\n  return useMutation({\n    mutationFn: async ({ id, role }: { id: string; role: MemberRole }) => {\n      const res = await fetch(`/api/organization/members/${id}/role`, {\n        method: \"PATCH\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ role }),\n      });\n      if (!res.ok) {\n        const error = await res.json();\n        throw new Error(error.error || \"Failed to update member role\");\n      }\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/organization/members\"] });\n    },\n  });\n}\n\nexport function useRemoveMember() {\n  const queryClient = useQueryClient();\n  return useMutation({\n    mutationFn: async (id: string) => {\n      const res = await fetch(`/api/organization/members/${id}`, {\n        method: \"DELETE\",\n      });\n      if (!res.ok) {\n        const error = await res.json();\n        throw new Error(error.error || \"Failed to remove member\");\n      }\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/organization/members\"] });\n    },\n  });\n}\n\nexport function useApproveScheduleItem() {\n  const queryClient = useQueryClient();\n  return useMutation({\n    mutationFn: async (id: string) => {\n      const res = await fetch(`/api/schedule-items/${id}/approve`, {\n        method: \"POST\",\n      });\n      if (!res.ok) {\n        const error = await res.json();\n        throw new Error(error.error || \"Failed to approve item\");\n      }\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/schedule-items/pending\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/schedule-items\"] });\n    },\n  });\n}\n\nexport function useRejectScheduleItem() {\n  const queryClient = useQueryClient();\n  return useMutation({\n    mutationFn: async ({ id, reason }: { id: string; reason: string }) => {\n      const res = await fetch(`/api/schedule-items/${id}/reject`, {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ reason }),\n      });\n      if (!res.ok) {\n        const error = await res.json();\n        throw new Error(error.error || \"Failed to reject item\");\n      }\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/schedule-items/pending\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/schedule-items\"] });\n    },\n  });\n}\n\nexport function canManageTeam(role: MemberRole): boolean {\n  return role === \"admin\";\n}\n\nexport function canManageResources(role: MemberRole): boolean {\n  return role === \"admin\" || role === \"operations\";\n}\n\nexport function canApproveBookings(role: MemberRole): boolean {\n  return role === \"admin\" || role === \"operations\";\n}\n\nexport function getRoleDisplayName(role: MemberRole): string {\n  switch (role) {\n    case \"admin\":\n      return \"Admin\";\n    case \"operations\":\n      return \"Operations Manager\";\n    case \"user\":\n      return \"Booker\";\n    default:\n      return role;\n  }\n}\n\nexport function getPlanDisplayName(plan: PlanType): string {\n  switch (plan) {\n    case \"starter\":\n      return \"Starter\";\n    case \"pro\":\n      return \"Pro\";\n    default:\n      return plan;\n  }\n}\n","path":null,"size_bytes":7215,"size_tokens":null},"server/rbacMiddleware.ts":{"content":"import type { Request, Response, NextFunction } from \"express\";\nimport { storage } from \"./storage\";\nimport { canCreateDepot, canCreateCrew, canCreateEmployee, canCreateVehicle, type PlanType } from \"./quotaService\";\n\nexport type MemberRole = \"admin\" | \"operations\" | \"user\";\n\ninterface OrganizationContext {\n  organizationId: string;\n  membershipId: string;\n  role: MemberRole;\n  plan: PlanType;\n  subscriptionStatus: string;\n}\n\ndeclare global {\n  namespace Express {\n    interface Request {\n      orgContext?: OrganizationContext;\n    }\n  }\n}\n\nexport async function loadOrganizationContext(\n  req: Request,\n  res: Response,\n  next: NextFunction\n) {\n  if (!req.session.userId) {\n    return res.status(401).json({ error: \"Not authenticated\" });\n  }\n\n  try {\n    const primaryMembership = await storage.getPrimaryMembership(req.session.userId);\n    if (!primaryMembership) {\n      return res.status(403).json({ error: \"No organization membership found\" });\n    }\n\n    req.orgContext = {\n      organizationId: primaryMembership.organization.id,\n      membershipId: primaryMembership.id,\n      role: primaryMembership.role as MemberRole,\n      plan: primaryMembership.organization.plan as PlanType,\n      subscriptionStatus: primaryMembership.organization.subscriptionStatus || \"trialing\",\n    };\n\n    next();\n  } catch (error) {\n    console.error(\"Error loading organization context:\", error);\n    res.status(500).json({ error: \"Failed to load organization context\" });\n  }\n}\n\nexport function requireRole(...allowedRoles: MemberRole[]) {\n  return (req: Request, res: Response, next: NextFunction) => {\n    if (!req.orgContext) {\n      return res.status(500).json({ error: \"Organization context not loaded\" });\n    }\n\n    if (!allowedRoles.includes(req.orgContext.role)) {\n      return res.status(403).json({\n        error: `Access denied. This action requires one of these roles: ${allowedRoles.join(\", \")}`,\n      });\n    }\n\n    next();\n  };\n}\n\nexport function requireAdmin(req: Request, res: Response, next: NextFunction) {\n  return requireRole(\"admin\")(req, res, next);\n}\n\nexport function requireOperationsOrAdmin(req: Request, res: Response, next: NextFunction) {\n  return requireRole(\"admin\", \"operations\")(req, res, next);\n}\n\nexport function requireActiveSubscription(req: Request, res: Response, next: NextFunction) {\n  if (!req.orgContext) {\n    return res.status(500).json({ error: \"Organization context not loaded\" });\n  }\n\n  const validStatuses = [\"active\", \"trialing\"];\n  if (!validStatuses.includes(req.orgContext.subscriptionStatus)) {\n    return res.status(402).json({\n      error: \"Your subscription is not active. Please update your payment method.\",\n      subscriptionStatus: req.orgContext.subscriptionStatus,\n    });\n  }\n\n  next();\n}\n\nexport async function checkDepotQuota(req: Request, res: Response, next: NextFunction) {\n  if (!req.orgContext) {\n    return res.status(500).json({ error: \"Organization context not loaded\" });\n  }\n\n  const result = await canCreateDepot(req.orgContext.organizationId, req.orgContext.plan);\n  if (!result.allowed) {\n    return res.status(403).json({\n      error: result.reason,\n      quotaExceeded: true,\n      currentUsage: result.currentUsage,\n      limit: result.limit,\n    });\n  }\n\n  next();\n}\n\nexport async function checkCrewQuota(req: Request, res: Response, next: NextFunction) {\n  if (!req.orgContext) {\n    return res.status(500).json({ error: \"Organization context not loaded\" });\n  }\n\n  const result = await canCreateCrew(req.orgContext.organizationId, req.orgContext.plan);\n  if (!result.allowed) {\n    return res.status(403).json({\n      error: result.reason,\n      quotaExceeded: true,\n      currentUsage: result.currentUsage,\n      limit: result.limit,\n    });\n  }\n\n  next();\n}\n\nexport async function checkEmployeeQuota(req: Request, res: Response, next: NextFunction) {\n  if (!req.orgContext) {\n    return res.status(500).json({ error: \"Organization context not loaded\" });\n  }\n\n  const result = await canCreateEmployee(req.orgContext.organizationId, req.orgContext.plan);\n  if (!result.allowed) {\n    return res.status(403).json({\n      error: result.reason,\n      quotaExceeded: true,\n      currentUsage: result.currentUsage,\n      limit: result.limit,\n    });\n  }\n\n  next();\n}\n\nexport async function checkVehicleQuota(req: Request, res: Response, next: NextFunction) {\n  if (!req.orgContext) {\n    return res.status(500).json({ error: \"Organization context not loaded\" });\n  }\n\n  const result = await canCreateVehicle(req.orgContext.organizationId, req.orgContext.plan);\n  if (!result.allowed) {\n    return res.status(403).json({\n      error: result.reason,\n      quotaExceeded: true,\n      currentUsage: result.currentUsage,\n      limit: result.limit,\n    });\n  }\n\n  next();\n}\n\nexport function canManageResources(role: MemberRole): boolean {\n  return role === \"admin\" || role === \"operations\";\n}\n\nexport function canApproveBookings(role: MemberRole): boolean {\n  return role === \"admin\" || role === \"operations\";\n}\n\nexport function canManageTeam(role: MemberRole): boolean {\n  return role === \"admin\";\n}\n\nexport function canModifySchedule(role: MemberRole, plan: PlanType): boolean {\n  if (plan === \"starter\") {\n    return role === \"admin\" || role === \"operations\";\n  }\n  return true;\n}\n\nexport function bookingRequiresApproval(role: MemberRole, plan: PlanType): boolean {\n  if (plan === \"starter\") {\n    return false;\n  }\n  return role === \"user\";\n}\n","path":null,"size_bytes":5422,"size_tokens":null},"client/src/pages/accept-invite.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useLocation, useParams } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription, CardFooter } from \"@/components/ui/card\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Loader2, CheckCircle, AlertCircle, Users, Building2 } from \"lucide-react\";\n\ninterface InviteInfo {\n  email: string;\n  role: string;\n  organizationName: string;\n  invitedBy: string;\n  expiresAt: string;\n}\n\nexport default function AcceptInvitePage() {\n  const [, setLocation] = useLocation();\n  const params = useParams<{ token: string }>();\n  const { toast } = useToast();\n  \n  const [loading, setLoading] = useState(true);\n  const [submitting, setSubmitting] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const [inviteInfo, setInviteInfo] = useState<InviteInfo | null>(null);\n  const [password, setPassword] = useState(\"\");\n  const [confirmPassword, setConfirmPassword] = useState(\"\");\n  const [success, setSuccess] = useState(false);\n\n  const token = params.token;\n\n  useEffect(() => {\n    if (!token) {\n      setError(\"No invite token provided\");\n      setLoading(false);\n      return;\n    }\n\n    const fetchInviteInfo = async () => {\n      try {\n        const response = await fetch(`/api/invites/${token}`);\n        if (!response.ok) {\n          const data = await response.json();\n          throw new Error(data.error || \"Invalid invite\");\n        }\n        const data = await response.json();\n        setInviteInfo(data);\n      } catch (err: any) {\n        setError(err.message || \"Failed to load invite\");\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    fetchInviteInfo();\n  }, [token]);\n\n  const handleAccept = async (e: React.FormEvent) => {\n    e.preventDefault();\n    \n    if (password !== confirmPassword) {\n      toast({\n        title: \"Passwords don't match\",\n        description: \"Please make sure your passwords match\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    if (password.length < 6) {\n      toast({\n        title: \"Password too short\",\n        description: \"Password must be at least 6 characters\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    setSubmitting(true);\n\n    try {\n      const response = await fetch(\"/api/invites/accept\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({\n          token,\n          username: inviteInfo?.email,\n          password,\n        }),\n      });\n\n      if (!response.ok) {\n        const data = await response.json();\n        throw new Error(data.error || \"Failed to accept invite\");\n      }\n\n      setSuccess(true);\n      toast({\n        title: \"Welcome to the team!\",\n        description: `You've joined ${inviteInfo?.organizationName}`,\n      });\n\n      setTimeout(() => {\n        setLocation(\"/schedule\");\n      }, 2000);\n    } catch (err: any) {\n      toast({\n        title: \"Failed to accept invite\",\n        description: err.message,\n        variant: \"destructive\",\n      });\n    } finally {\n      setSubmitting(false);\n    }\n  };\n\n  const getRoleLabel = (role: string) => {\n    switch (role) {\n      case \"admin\": return \"Administrator\";\n      case \"operations\": return \"Operations Manager\";\n      case \"user\": return \"Booker\";\n      default: return role;\n    }\n  };\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 flex items-center justify-center p-4\">\n        <Card className=\"w-full max-w-md\">\n          <CardContent className=\"flex flex-col items-center justify-center py-12\">\n            <Loader2 className=\"h-8 w-8 animate-spin text-blue-600 mb-4\" />\n            <p className=\"text-slate-600\">Loading invite details...</p>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 flex items-center justify-center p-4\">\n        <Card className=\"w-full max-w-md\">\n          <CardContent className=\"flex flex-col items-center justify-center py-12\">\n            <AlertCircle className=\"h-12 w-12 text-red-500 mb-4\" />\n            <h2 className=\"text-xl font-semibold text-slate-900 mb-2\">Invalid Invite</h2>\n            <p className=\"text-slate-600 text-center mb-6\">{error}</p>\n            <Button onClick={() => setLocation(\"/\")} data-testid=\"button-go-home\">\n              Go to Home\n            </Button>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  if (success) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 flex items-center justify-center p-4\">\n        <Card className=\"w-full max-w-md\">\n          <CardContent className=\"flex flex-col items-center justify-center py-12\">\n            <CheckCircle className=\"h-12 w-12 text-green-500 mb-4\" />\n            <h2 className=\"text-xl font-semibold text-slate-900 mb-2\">Welcome to the team!</h2>\n            <p className=\"text-slate-600 text-center\">Redirecting you to the schedule...</p>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 flex items-center justify-center p-4\">\n      <Card className=\"w-full max-w-md\">\n        <CardHeader className=\"text-center\">\n          <div className=\"flex justify-center mb-4\">\n            <div className=\"p-3 bg-blue-100 rounded-full\">\n              <Users className=\"h-8 w-8 text-blue-600\" />\n            </div>\n          </div>\n          <CardTitle className=\"text-2xl\">You're Invited!</CardTitle>\n          <CardDescription>\n            Join your team on Sewer Swarm\n          </CardDescription>\n        </CardHeader>\n\n        <CardContent className=\"space-y-6\">\n          <div className=\"bg-slate-50 rounded-lg p-4 space-y-3\">\n            <div className=\"flex items-center gap-3\">\n              <Building2 className=\"h-5 w-5 text-slate-500\" />\n              <div>\n                <p className=\"text-sm text-slate-500\">Organization</p>\n                <p className=\"font-medium text-slate-900\" data-testid=\"text-org-name\">{inviteInfo?.organizationName}</p>\n              </div>\n            </div>\n            <div className=\"flex items-center gap-3\">\n              <Users className=\"h-5 w-5 text-slate-500\" />\n              <div>\n                <p className=\"text-sm text-slate-500\">Your Role</p>\n                <p className=\"font-medium text-slate-900\" data-testid=\"text-role\">{getRoleLabel(inviteInfo?.role || \"\")}</p>\n              </div>\n            </div>\n            <p className=\"text-sm text-slate-500\">\n              Invited by <span className=\"font-medium text-slate-700\">{inviteInfo?.invitedBy}</span>\n            </p>\n          </div>\n\n          <form onSubmit={handleAccept} className=\"space-y-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"email\">Email</Label>\n              <Input\n                id=\"email\"\n                type=\"email\"\n                value={inviteInfo?.email || \"\"}\n                disabled\n                className=\"bg-slate-50\"\n                data-testid=\"input-email\"\n              />\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"password\">Create Password</Label>\n              <Input\n                id=\"password\"\n                type=\"password\"\n                value={password}\n                onChange={(e) => setPassword(e.target.value)}\n                placeholder=\"Choose a secure password\"\n                required\n                minLength={6}\n                data-testid=\"input-password\"\n              />\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"confirmPassword\">Confirm Password</Label>\n              <Input\n                id=\"confirmPassword\"\n                type=\"password\"\n                value={confirmPassword}\n                onChange={(e) => setConfirmPassword(e.target.value)}\n                placeholder=\"Confirm your password\"\n                required\n                minLength={6}\n                data-testid=\"input-confirm-password\"\n              />\n            </div>\n\n            <Button\n              type=\"submit\"\n              className=\"w-full\"\n              disabled={submitting}\n              data-testid=\"button-accept-invite\"\n            >\n              {submitting ? (\n                <>\n                  <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                  Joining...\n                </>\n              ) : (\n                \"Accept Invite & Join Team\"\n              )}\n            </Button>\n          </form>\n        </CardContent>\n\n        <CardFooter className=\"justify-center\">\n          <p className=\"text-sm text-slate-500\">\n            Already have an account?{\" \"}\n            <button\n              onClick={() => setLocation(\"/\")}\n              className=\"text-blue-600 hover:underline\"\n              data-testid=\"link-login\"\n            >\n              Sign in instead\n            </button>\n          </p>\n        </CardFooter>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":9260,"size_tokens":null}},"version":2}